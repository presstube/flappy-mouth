var Bm=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var HA=Bm((xI,Om)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Yd=function(r,e){return(Yd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])})(r,e)};function _n(r,e){function t(){this.constructor=r}Yd(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function ne(r,e,t,n){return new(t||(t=Promise))(function(o,i){function a(c){try{u(n.next(c))}catch(l){i(l)}}function s(c){try{u(n.throw(c))}catch(l){i(l)}}function u(c){c.done?o(c.value):new t(function(l){l(c.value)}).then(a,s)}u((n=n.apply(r,[])).next())})}function re(r,e){var t,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(o=2&l[0]?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,n=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){a=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(l[0]===6&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=e.call(r,a)}catch(h){l=[6,h],n=0}finally{t=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var Lm=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var o=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+o+"."),this.set(e,o)}},r.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,n,o=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return Wm(n,a[0],a[1]),a.join("=")}),n);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var a=i.split(":"),s=a[0],u=a[1];e.urlFlags[s]=function(c,l){if((l=l.toLowerCase())==="true"||l==="false")return l==="true";if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(s,u)})}},r}();function Wm(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function q(){return Zd}var Zd=null,Aa=new Map,ku=new Map;function Jd(r,e){var t=ef(r,e);return Aa.get(t)}function Vm(r){return ku.get(r)}function hh(r){for(var e=Aa.entries(),t=[];;){var n=e.next(),o=n.done,i=n.value;if(o)break;var a=i[0],s=i[1];a.split("_")[0]===r&&t.push(s)}return t}function Qd(r){var e=r.kernelName,t=r.backendName,n=ef(e,t);if(Aa.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");Aa.set(n,r)}function Um(r){var e=r.kernelName;ku.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),ku.set(e,r)}function ef(r,e){return e+"_"+r}function Au(r,e,t){return Math.max(r,Math.min(e,t))}function tf(r){return r%2==0?r:r+1}function zm(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function R(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function Ne(r,e,t){t===void 0&&(t=""),R(vt(r,e),function(){return t+" Shapes "+r+" and "+e+" must match"})}function Ho(r){R(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Do(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||Pn(r)&&!t)for(var n=0;n<r.length;++n)Do(r[n],e,t);else e.push(r);return e}function ie(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function vt(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Je(r){return r%1==0}function Gm(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function Iu(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function Co(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function dh(r,e,t){return e===void 0&&(e=function(n){return 0}),new Promise(function(n,o){var i=0,a=function(){if(r())n();else{i++;var s=e(i);t!=null&&i>=t?o():setTimeout(a,s)}};a()})}function qm(r,e){for(var t=1,n=-1,o=0;o<r.length;++o)if(r[o]>=0)t*=r[o];else if(r[o]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+o);n=o}else if(r[o]<0)throw Error("Shapes can not be < 0. Found "+r[o]+" at dim "+o);if(n===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var i=r.slice();return i[n]=e/t,i}function ft(r,e){var t=e.length;return R((r=r==null?e.map(function(n,o){return o}):[].concat(r)).every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+r}),R(r.every(function(n){return Je(n)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(n){return n<0?t+n:n})}function Wr(r,e){for(var t=[],n=[],o=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||o?null:ft(e,r).sort(),a=0,s=0;s<r.length;++s){if(i!=null){if(i[a]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(i[a]==null||i[a]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[a]<=s&&a++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function yi(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else{if(r!=="bool")throw new Error("Unknown data type "+r);t=new Uint8Array(e)}return t}function Ia(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else{if(r!=="string")throw new Error("Unknown data type "+r);t=new Array(e)}return t}function Hm(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function jm(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Xm(r,e){return e!=="complex64"&&(e!=="float32"||r==="complex64")&&(e!=="int32"||r==="float32"||r==="complex64")&&(e!=="bool"||r!=="bool")}function Pn(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function nf(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function Km(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function vc(r){return typeof r=="string"||r instanceof String}function $m(r){return typeof r=="boolean"}function Ym(r){return typeof r=="number"}function Fi(r){return Array.isArray(r)?Fi(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":Ym(r)?"float32":vc(r)?"string":$m(r)?"bool":"float32"}function Ru(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Nu(r,e){for(var t=e;t<r;++t)if(r%t==0)return t;return r}function Bn(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function rf(r,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Do(r)),t&&Hm(r,e),function(i,a){return i instanceof Float32Array&&a==="float32"||i instanceof Int32Array&&a==="int32"||i instanceof Uint8Array&&a==="bool"}(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var n=new Uint8Array(r.length),o=0;o<n.length;++o)Math.round(r[o])!==0&&(n[o]=1);return n}throw new Error("Unknown data type "+e)}function fh(r,e){if(r.length===0)return e[0];var t=r.reduce(function(n,o){return n*o});if(t===0)return[];if(t!==e.length)throw new Error("["+r+"] does not match the input size.");return function n(o,i,a){var s=new Array;if(i.length===1)for(var u=i[0],c=0;c<u;c++)s[c]=a[o+c];else{u=i[0];var l=i.slice(1),h=l.reduce(function(d,f){return d*f});for(c=0;c<u;c++)s[c]=n(o+c*h,l,a)}return s}(0,r,e)}function of(r,e){for(var t=Mi(r,e),n=0;n<t.length;n++)t[n]=1;return t}function Mi(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function Nn(){return q().platform.now()}function af(r){r.forEach(function(e){R(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function Zm(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",q().platform.encode(r,e)}function Ra(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",q().platform.decode(r,e)}function ph(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],o=0;o<r.length-1;++o)n+=t[o]*r[o];return n}function Jm(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),o=0;o<n.length-1;++o)n[o]=Math.floor(r/t[o]),r-=n[o]*t[o];return n[n.length-1]=r,n}var Qm=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new eg)}return r.prototype.profileKernel=function(e,t,n){var o,i=this,a=this.backendTimer.time(function(){o=n()});return o.forEach(function(s){s.data().then(function(u){(function(c,l,h){if(l!=="float32")return!1;for(var d=0;d<c.length;d++){var f=c[d];if(isNaN(f)||!isFinite(f))return console.warn("Found "+f+" in the result of '"+h+"'"),!0}})(u,s.dtype,e),a.then(function(c){var l="";c.getExtraProfileInfo!=null&&(l=c.getExtraProfileInfo()),i.logger.logKernelProfile(e,s,u,c.kernelMs,t,l)})})}),o},r}(),eg=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,o,i,a){var s=typeof o=="number"?Co(o+"ms",9):o.error,u=Co(e,25),c=t.rank,l=t.size,h=Co(t.shape.toString(),14),d="";for(var f in i){var p=i[f].shape||t.shape,v=p.length;d+=f+": "+v+"D "+(v>0?p:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+c+"D "+h+"	%c"+l+"	%c"+d+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}(),vh=20,ti=3,Zs=7;function tg(r,e,t,n){var o=Bn(e),i=function(c,l,h,d){var f=ie(l),p=d[d.length-1],v=new Array(p).fill(0),m=l.length,g=h==="complex64"?ri(c):c;if(m>1)for(var _=0;_<f/p;_++)for(var x=_*p,b=0;b<p;b++)v[b]=Math.max(v[b],ni(g[x+b],0,h).length);return v}(r,e,t,o),a=e.length,s=function c(l,h,d,f,p,v){v===void 0&&(v=!0);var m=d==="complex64"?2:1,g=h[0],_=h.length;if(_===0)return d==="complex64"?[ni(ri(l)[0],0,d)]:d==="bool"?[sf(l[0])]:[l[0].toString()];if(_===1){if(g>vh){var x=ti*m,b=Array.from(l.slice(0,x)),y=Array.from(l.slice((g-ti)*m,g*m));return d==="complex64"&&(b=ri(b),y=ri(y)),["["+b.map(function(M,B){return ni(M,p[B],d)}).join(", ")+", ..., "+y.map(function(M,B){return ni(M,p[g-ti+B],d)}).join(", ")+"]"]}return["["+(d==="complex64"?ri(l):Array.from(l)).map(function(M,B){return ni(M,p[B],d)}).join(", ")+"]"]}var w=h.slice(1),E=f.slice(1),C=f[0]*m,T=[];if(g>vh){for(var S=0;S<ti;S++){var I=(A=S*C)+C;T.push.apply(T,c(l.slice(A,I),w,d,E,p,!1))}for(T.push("..."),S=g-ti;S<g;S++)I=(A=S*C)+C,T.push.apply(T,c(l.slice(A,I),w,d,E,p,S===g-1))}else for(S=0;S<g;S++){var A;I=(A=S*C)+C,T.push.apply(T,c(l.slice(A,I),w,d,E,p,S===g-1))}var F=_===2?",":"";for(T[0]="["+T[0]+F,S=1;S<T.length-1;S++)T[S]=" "+T[S]+F;var O=`,
`;for(S=2;S<_;S++)O+=`
`;return T[T.length-1]=" "+T[T.length-1]+"]"+(v?"":O),T}(r,e,t,o,i),u=["Tensor"];return n&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function ni(r,e,t){return Co(Array.isArray(r)?parseFloat(r[0].toFixed(Zs))+" + "+parseFloat(r[1].toFixed(Zs))+"j":vc(r)?"'"+r+"'":t==="bool"?sf(r):parseFloat(r.toFixed(Zs)).toString(),e)}function sf(r){return r===0?"false":"true"}function ri(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var _i=function(){function r(e,t,n){var o=this;if(this.dtype=t,this.shape=e.slice(),this.size=ie(e),n!=null){var i=n.length;R(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Ia(t,this.size),this.strides=Bn(e)}return r.prototype.set=function(e){for(var t=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];n.length===0&&(n=[0]),R(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var n=0,o=0,i=e;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[n]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}n++}for(var u=e[e.length-1],c=0;c<e.length-1;++c)u+=this.strides[c]*e[c];return this.values[u]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return On().makeTensor(this.values,this.shape,this.dtype)},r}(),On=null,G=null,uf=null,He=function(){function r(e,t,n,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ie(e),this.strides=Bn(e),this.dataId=n,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),R(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},r.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},r.prototype.as4D=function(e,t,n,o){return this.throwIfDisposed(),this.reshape([e,t,n,o])},r.prototype.as5D=function(e,t,n,o,i){return this.throwIfDisposed(),this.reshape([e,t,n,o,i])},r.prototype.asType=function(e){return this.throwIfDisposed(),G.cast(this,e)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return ne(this,void 0,void 0,function(){var e;return re(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,G.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return G.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return ne(this,void 0,void 0,function(){var e;return re(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,fh(this.shape,e)]}})})},r.prototype.arraySync=function(){return fh(this.shape,this.dataSync())},r.prototype.data=function(){return ne(this,void 0,void 0,function(){var e,t;return re(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=On().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(o){return Ra(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataSync=function(){this.throwIfDisposed();var e=On().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Ra(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return ne(this,void 0,void 0,function(){var e;return re(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,On().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(On().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(e){return e===void 0&&(e=!1),G.print(this,e)},r.prototype.reshape=function(e){return this.throwIfDisposed(),G.reshape(this,e)},r.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},r.prototype.expandDims=function(e){return e===void 0&&(e=0),G.expandDims(this,e)},r.prototype.cumsum=function(e,t,n){return e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1),G.cumsum(this,e,t,n)},r.prototype.squeeze=function(e){return this.throwIfDisposed(),G.squeeze(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),G.clone(this)},r.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),G.oneHot(this,e,t,n)},r.prototype.toString=function(e){return e===void 0&&(e=!1),tg(this.dataSync(),this.shape,this.dtype,e)},r.prototype.tile=function(e){return this.throwIfDisposed(),G.tile(this,e)},r.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),G.gather(this,e,t)},r.prototype.matMul=function(e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!1),this.throwIfDisposed(),G.matMul(this,e,t,n)},r.prototype.dot=function(e){return this.throwIfDisposed(),G.dot(this,e)},r.prototype.norm=function(e,t,n){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),G.norm(this,e,t,n)},r.prototype.slice=function(e,t){return this.throwIfDisposed(),G.slice(this,e,t)},r.prototype.reverse=function(e){return this.throwIfDisposed(),G.reverse(this,e)},r.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof r&&(e=[e]),G.concat([this].concat(e),t)},r.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),G.split(this,e,t)},r.prototype.stack=function(e,t){return t===void 0&&(t=0),G.stack([this,e],t)},r.prototype.unstack=function(e){return e===void 0&&(e=0),G.unstack(this,e)},r.prototype.pad=function(e,t){return t===void 0&&(t=0),G.pad(this,e,t)},r.prototype.batchNormalization=function(e,t,n,o,i){return n===void 0&&(n=.001),uf("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,o,n)},r.prototype.batchNorm=function(e,t,n,o,i){return i===void 0&&(i=.001),this.throwIfDisposed(),G.batchNorm(this,e,t,n,o,i)},r.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.all(this,e,t)},r.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.any(this,e,t)},r.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.logSumExp(this,e,t)},r.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.sum(this,e,t)},r.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.prod(this,e,t)},r.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.mean(this,e,t)},r.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.min(this,e,t)},r.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.max(this,e,t)},r.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),G.argMin(this,e)},r.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),G.argMax(this,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),G.cast(this,e)},r.prototype.add=function(e){return this.throwIfDisposed(),G.add(this,e)},r.prototype.addStrict=function(e){return this.throwIfDisposed(),G.addStrict(this,e)},r.prototype.atan2=function(e){return this.throwIfDisposed(),G.atan2(this,e)},r.prototype.sub=function(e){return this.throwIfDisposed(),G.sub(this,e)},r.prototype.subStrict=function(e){return this.throwIfDisposed(),G.subStrict(this,e)},r.prototype.pow=function(e){return this.throwIfDisposed(),G.pow(this,e)},r.prototype.powStrict=function(e){return this.throwIfDisposed(),G.powStrict(this,e)},r.prototype.mul=function(e){return this.throwIfDisposed(),G.mul(this,e)},r.prototype.mulStrict=function(e){return this.throwIfDisposed(),G.mulStrict(this,e)},r.prototype.div=function(e){return this.throwIfDisposed(),G.div(this,e)},r.prototype.divNoNan=function(e){return this.throwIfDisposed(),G.divNoNan(this,e)},r.prototype.floorDiv=function(e){return this.throwIfDisposed(),G.floorDiv(this,e)},r.prototype.divStrict=function(e){return this.throwIfDisposed(),G.divStrict(this,e)},r.prototype.minimum=function(e){return this.throwIfDisposed(),G.minimum(this,e)},r.prototype.minimumStrict=function(e){return this.throwIfDisposed(),G.minimumStrict(this,e)},r.prototype.maximum=function(e){return this.throwIfDisposed(),G.maximum(this,e)},r.prototype.maximumStrict=function(e){return this.throwIfDisposed(),G.maximumStrict(this,e)},r.prototype.mod=function(e){return this.throwIfDisposed(),G.mod(this,e)},r.prototype.modStrict=function(e){return this.throwIfDisposed(),G.modStrict(this,e)},r.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),G.squaredDifferenceStrict(this,e)},r.prototype.transpose=function(e){return this.throwIfDisposed(),G.transpose(this,e)},r.prototype.notEqual=function(e){return this.throwIfDisposed(),G.notEqual(this,e)},r.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),G.notEqualStrict(this,e)},r.prototype.less=function(e){return this.throwIfDisposed(),G.less(this,e)},r.prototype.lessStrict=function(e){return this.throwIfDisposed(),G.lessStrict(this,e)},r.prototype.equal=function(e){return this.throwIfDisposed(),G.equal(this,e)},r.prototype.equalStrict=function(e){return this.throwIfDisposed(),G.equalStrict(this,e)},r.prototype.lessEqual=function(e){return this.throwIfDisposed(),G.lessEqual(this,e)},r.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),G.lessEqualStrict(this,e)},r.prototype.greater=function(e){return this.throwIfDisposed(),G.greater(this,e)},r.prototype.greaterStrict=function(e){return this.throwIfDisposed(),G.greaterStrict(this,e)},r.prototype.greaterEqual=function(e){return this.throwIfDisposed(),G.greaterEqual(this,e)},r.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),G.greaterEqualStrict(this,e)},r.prototype.logicalAnd=function(e){return this.throwIfDisposed(),G.logicalAnd(this,e)},r.prototype.logicalOr=function(e){return this.throwIfDisposed(),G.logicalOr(this,e)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),G.logicalNot(this)},r.prototype.logicalXor=function(e){return this.throwIfDisposed(),G.logicalXor(this,e)},r.prototype.where=function(e,t){return this.throwIfDisposed(),G.where(e,this,t)},r.prototype.neg=function(){return this.throwIfDisposed(),G.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),G.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),G.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),G.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),G.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),G.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),G.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),G.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),G.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),G.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),G.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),G.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),G.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),G.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),G.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),G.abs(this)},r.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),G.clipByValue(this,e,t)},r.prototype.relu=function(){return this.throwIfDisposed(),G.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),G.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),G.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),G.selu(this)},r.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),G.leakyRelu(this,e)},r.prototype.prelu=function(e){return this.throwIfDisposed(),G.prelu(this,e)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),G.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),G.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),G.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),G.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),G.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),G.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),G.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),G.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),G.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),G.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),G.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),G.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),G.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),G.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),G.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),G.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),G.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),G.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),G.round(this)},r.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),G.step(this,e)},r.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),G.softmax(this,e)},r.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),G.logSoftmax(this,e)},r.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),G.image.resizeBilinear(this,e,t)},r.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),G.image.resizeNearestNeighbor(this,e,t)},r.prototype.conv1d=function(e,t,n,o,i,a){return o===void 0&&(o="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),G.conv1d(this,e,t,n,o,i,a)},r.prototype.conv2d=function(e,t,n,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),G.conv2d(this,e,t,n,o,i,a)},r.prototype.conv2dTranspose=function(e,t,n,o,i){return this.throwIfDisposed(),G.conv2dTranspose(this,e,t,n,o,i)},r.prototype.depthwiseConv2D=function(e,t,n,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),G.depthwiseConv2d(this,e,t,n,o,i,a)},r.prototype.separableConv2d=function(e,t,n,o,i,a){return i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),G.separableConv2d(this,e,t,n,o,i,a)},r.prototype.avgPool=function(e,t,n,o){return this.throwIfDisposed(),G.avgPool(this,e,t,n,o)},r.prototype.maxPool=function(e,t,n,o){return this.throwIfDisposed(),G.maxPool(this,e,t,n,o)},r.prototype.localResponseNormalization=function(e,t,n,o){return e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),o===void 0&&(o=.5),G.localResponseNormalization(this,e,t,n,o)},r.prototype.pool=function(e,t,n,o,i){return this.throwIfDisposed(),G.pool(this,e,t,n,o,i)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),On().makeVariable(this,e,t,n)},r.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),G.unsortedSegmentSum(this,e,t)},r.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),G.batchToSpaceND(this,e,t)},r.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),G.spaceToBatchND(this,e,t)},r.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),G.topk(this,e,t)},r.prototype.stridedSlice=function(e,t,n,o,i,a,s,u){return o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),G.stridedSlice(this,e,t,n,o,i,a,s,u)},r.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),G.depthToSpace(this,e,t)},r.prototype.fft=function(){return this.throwIfDisposed(),G.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),G.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),G.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),G.spectral.irfft(this)},r}();Object.defineProperty(He,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var mh,Du,Ou,Fu,Mu,Oo=function(r){function e(t,n,o,i){var a=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=n,a.name=o,a}return _n(e,r),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!vt(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");On().disposeTensor(this),this.dataId=t.dataId,On().incRef(this,null)},e.prototype.dispose=function(){On().disposeVariable(this),this.isDisposedInternal=!0},e}(He);Object.defineProperty(Oo,Symbol.hasInstance,{value:function(r){return r instanceof He&&r.assign!=null&&r.assign instanceof Function}}),function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"}(mh||(mh={})),function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"}(Du||(Du={})),function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"}(Ou||(Ou={})),function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"}(Fu||(Fu={})),function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"}(Mu||(Mu={}));var ng={float32:Fu,int32:Du,bool:Ou,complex64:Mu};function wt(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return ng[r][e]}function Js(r){return wt(r,"int32")}function Xe(r,e){if(r.dtype===e.dtype)return[r,e];var t=wt(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function rg(r,e){R(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+e.dtype+") input must match"})}function cf(r){var e=[];return function t(n,o,i){if(n!=null){if(n instanceof He)return void o.push(n);if(a=n,!(!Array.isArray(a)&&typeof a!="object")){var a,s=n;for(var u in s){var c=s[u];i.has(c)||(i.add(c),t(c,o,i))}}}}(r,e,new Set),e}var Qs,gh=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),og=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new gh}return r.prototype.ready=function(){return ne(this,void 0,void 0,function(){var e,t,n;return re(this,function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,o.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(n)]:[3,4];case 3:return o.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return ne(this,void 0,void 0,function(){var t,n,o;return re(this,function(i){switch(i.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=n,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Qm(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this;hh(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this;hh(e).forEach(function(n){n.disposeFunc!=null&&n.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var o=n.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then(function(s){return!(i<t.pendingBackendInitId)&&(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return!(i<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],o=this.initializeBackend(n),i=o.success,a=o.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),o=n.backend,i=this.readSync(t);o.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n,o=this,i=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},r.prototype.scopedRun=function(e,t,n){e();try{var o=n();return t(),o}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(o){return{x:function(){return o.toFloat()}}},[]),t},r.prototype.runKernel=function(e,t,n,o,i){return this.runKernelFunc(null,t,null,e,n,o,i)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var o=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=o-t-i-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},r.prototype.runKernelFunc=function(e,t,n,o,i,a,s){var u,c=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var l=[],h=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var d,f=function(_){h&&(l=_.map(function(x){return c.keep(c.clone(x))}))},p=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=Jd(o,this.backendName);return d=g!=null?function(){var _=c.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:i,backend:c.backend});var x=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,_,x);var b=x.map(function(w){var E=w.dataId,C=w.shape,T=w.dtype;return c.makeTensorFromDataId(E,C,T)}),y=b.filter(function(w,E){return s[E]});return f((a||[]).slice().concat(y)),b}:function(){var _=c.backend.numDataIds();m=c.tidy(function(){return e(c.backend,f)});var x=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,_,x),x},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,t,function(){return d()}):d()}),h&&this.addTapeNode(o,t,u,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(_){return t[_].shape}),outputShapes:u.map(function(_){return _.shape})}),Array.isArray(m)?u:u[0]},r.prototype.makeTensor=function(e,t,n,o){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",o=o||this.backend;var i=e;n==="string"&&vc(e[0])&&(i=e.map(function(l){return Zm(l)}));var a=o.write(i,t,n),s=new He(t,n,a,this.nextTensorId());if(this.incRef(s,o),n==="string"){var u=this.state.tensorInfo.get(a),c=Km(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,o){var i=new He(t,n=n||"float32",e,this.nextTensorId());return this.incRef(i,o),i},r.prototype.makeVariable=function(e,t,n,o){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),o!=null&&o!==e.dtype&&(e=e.asType(o));var i=new Oo(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,n===0){this.state.numDataBuffers++;var o=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(o=e.size*nf(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Oo||this.track(e)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return ne(this,void 0,void 0,function(){var t,n;return re(this,function(o){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},u=Vm(e);u!=null&&(o=u.gradFunc),o!=null&&(s.gradient=function(c){return c=c.map(function(l,h){if(l==null){var d=n[h],f=Mi(d.size,d.dtype);return a.makeTensor(f,d.shape,d.dtype)}return l}),o(c.length>1?c:c[0],i)}),this.state.activeTape.push(s)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=cf(e),o=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){u.kept||u.scopeId!==s.id||t.track(u)})},r.prototype.gradients=function(e,t,n,o){var i=this;if(o===void 0&&(o=!1),R(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});R(a instanceof He,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,l){for(var h={},d={},f=0;f<c.length;f++)h[c[f].id]=!0;for(f=0;f<u.length;f++){var p=(w=u[f]).inputs;for(var v in p){for(var m=p[v],g=!1,_=0;_<c.length;_++)if(h[m.id]){w.outputs.forEach(function(S){return h[S.id]=!0}),g=!0,d[w.id]=!0;break}if(g)break}}var x={};x[l.id]=!0;var b={};for(f=u.length-1;f>=0;f--)for(p=(w=u[f]).inputs,_=0;_<w.outputs.length;_++)if(x[w.outputs[_].id]){for(var v in p)x[p[v].id]=!0,b[w.id]=!0;break}var y=[];for(f=0;f<u.length;f++){var w;if(d[(w=u[f]).id]&&b[w.id]){var E={};for(var v in w.inputs){var C=w.inputs[v];h[C.id]&&(E[v]=C)}var T=Object.assign({},w);T.inputs=E,T.outputs=w.outputs,y.push(T)}}return y}(this.state.activeTape,t,a);if(!o&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[a.id]=n??(u=a.shape,c=of(ie(u),"float32"),D.makeTensor(c,u,"float32")),function(d,f,p){for(var v=function(g){var _=f[g],x=[];if(_.outputs.forEach(function(E){var C=d[E.id];C!=null?x.push(C):x.push(null)}),_.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+_.kernelName+".");var b=_.gradient(x),y=function(E){if(!(E in b))throw new Error("Cannot backprop through input "+E+". Available gradients found: "+Object.keys(b)+".");var C=p(function(){return b[E]()});if(C.dtype!=="float32")throw new Error("Error in gradient for op "+_.kernelName+". The gradient of input "+E+" must have 'float32' dtype, but has '"+C.dtype+"'");var T=_.inputs[E];if(!vt(C.shape,T.shape))throw new Error("Error in gradient for op "+_.kernelName+". The gradient of input '"+E+"' has shape '"+C.shape+"', which does not match the shape of the input '"+T.shape+"'");if(d[T.id]==null)d[T.id]=C;else{var S=d[T.id];d[T.id]=S.add(C),S.dispose()}};for(var w in _.inputs)y(w)},m=f.length-1;m>=0;m--)v(m)}(l,s,function(d){return i.tidy(d)});var h=t.map(function(d){return l[d.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(d){for(var f=0,p=d.saved;f<p.length;f++)p[f].dispose()}),i.state.activeTape=null),{value:a,grads:h}})},r.prototype.customGrad=function(e){var t=this;return R(Ru(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];R(o.every(function(s){return s instanceof He}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),t.runKernelFunc(function(s,u){return R((n=e.apply(void 0,o.concat([u]))).value instanceof He,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),R(Ru(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(s,u){var c=n.gradFunc(s,u),l=Array.isArray(c)?c:[c];R(l.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),R(l.every(function(d){return d instanceof He}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return l.forEach(function(d,f){h[f]=function(){return d}}),h})}},r.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},r.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},r.prototype.time=function(e){return ne(this,void 0,void 0,function(){var t,n;return re(this,function(o){switch(o.label){case 0:return t=Nn(),[4,this.backend.time(e)];case 1:return(n=o.sent()).wallMs=Nn()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new gh,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r}(),D=function(){var r=function(){if(Qs==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Qs=t}return Qs}();if(r._tfengine==null){var e=new Lm(r);r._tfengine=new og(e)}return function(t){Zd=t}(r._tfengine.ENV),On=function(){return r._tfengine},r._tfengine}();function lf(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var $n=q();$n.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),$n.registerFlag("IS_BROWSER",function(){return lf()}),$n.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),$n.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),$n.registerFlag("PROD",function(){return!1}),$n.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return $n.getBool("DEBUG")}),$n.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),$n.registerFlag("IS_TEST",function(){return!1});var bi,$t,Xt,Br={},eu={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ig(r,e){Br[r]=e}function Gn(r){r in Br||(Br[r]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return n.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete Br[t]},!1),t===1?n.getContext("webgl",eu)||n.getContext("experimental-webgl",eu):n.getContext("webgl2",eu)}(r));var e=Br[r];return e.isContextLost()?(delete Br[r],Gn(r)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Br[r])}function hs(r,e){return[e,r]}function li(r){var e=ie(r);return Iu(Math.ceil(e/4))}function Pi(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function mc(r,e){var t,n,o,i,a,s,u,c,l,h=r;return q().getNumber("WEBGL_VERSION")===2?(t=h.R32F,n=h.R16F,o=h.RGBA16F,i=h.RGBA32F,a=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(t=r.RGBA,n=r.RGBA,o=r.RGBA,i=h.RGBA,a=r.RGBA,s=4,u=4,c=e!=null?e.HALF_FLOAT_OES:null,l=r.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function ae(r,e,t){var n=t();return e&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+cg(o,i))}(r),n}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(bi||(bi={})),function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"}($t||($t={})),function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Xt||(Xt={}));var ag=596e-10,sg=65504;function ug(r){return!!(q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||ag<Math.abs(r)&&Math.abs(r)<sg)}function cg(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function na(r,e,t){return nr(r,e,function(){return r.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function lg(r,e,t){var n=nr(r,e,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ae(r,e,function(){return r.shaderSource(n,t)}),ae(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function hg(r,e,t){var n=nr(r,e,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ae(r,e,function(){return r.shaderSource(n,t)}),ae(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw function(o,i){var a=dg.exec(i);if(a==null)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split(`
`),c=u.length.toString().length+2,l=u.map(function(m,g){return Co((g+1).toString(),c)+m}),h=0,d=0;d<l.length;d++)h=Math.max(l[d].length,h);var f=l.slice(0,s-1),p=l.slice(s-1,s),v=l.slice(s);console.log(f.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+Co(p[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))}(t,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var tu,nu,dg=/ERROR: [0-9]+:([0-9]+):/g;function fg(r,e){return nr(r,e,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function pg(r,e,t){if(ae(r,e,function(){return r.linkProgram(t)}),r.getProgramParameter(t,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function ru(r,e,t){if(ae(r,e,function(){return r.validateProgram(t)}),r.getProgramParameter(t,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function vg(r,e,t){var n=nr(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return ae(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),ae(r,e,function(){return r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function mg(r,e,t){var n=nr(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return ae(r,e,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)}),ae(r,e,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function gg(r,e){return nr(r,e,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function yg(r,e){var t=q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="["+r+"x"+e+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t)throw n="["+r+"x"+e+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function _g(r,e){return nr(r,e,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function yh(r,e,t,n,o,i,a,s){var u=r.getAttribLocation(t,n);return u!==-1&&(ae(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,o)}),ae(r,e,function(){return r.vertexAttribPointer(u,i,r.FLOAT,!1,a,s)}),ae(r,e,function(){return r.enableVertexAttribArray(u)}),!0)}function bg(r,e,t,n){Sg(r,n),ae(r,e,function(){return r.activeTexture(r.TEXTURE0+n)}),ae(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)})}function xg(r,e,t,n){return nr(r,e,function(){return r.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')}function wg(r,e,t){return r.getUniformLocation(e,t)}function Cg(r,e,t,n,o,i){ae(r,e,function(){return bg(r,e,n,i)}),ae(r,e,function(){return r.uniform1i(o,i)})}function ou(r,e,t,n){ae(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)}),ae(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)})}function _h(r,e,t){ae(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),ae(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function ra(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Eg(r,e))}function Eg(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function nr(r,e,t,n){var o=ae(r,e,function(){return t()});if(o==null)throw new Error(n);return o}function Sg(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function Na(r,e){return e===void 0&&(e=2),ie(r.slice(0,r.length-e))}function Da(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function iu(r){var e=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(e=[Na(r)].concat(Da(r))),e}function Tg(r,e){var t;e===void 0&&(e=!1);var n=q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,(r=r.map(function(c,l){return l>=r.length-2?tf(r[l]):r[l]})).length===1&&(r=[2,r[0]])),r.length!==2){var o=Wr(r);r=o.newShape}var i=ie(r);if(r.length<=1&&i<=n)return[1,i];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(e){var a=Na(r),s=2,u=2;return r.length&&(s=(t=Da(r))[0],u=t[1]),Iu(i=a*(s/2)*(u/2)).map(function(c){return 2*c})}return Iu(i)}function oa(r){return r%2==0}function ia(r,e){if(vt(r=r.slice(-2),e=e.slice(-2))||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r.slice(-1)[0],n=e.slice(-1)[0];if(t===n||oa(t)&&oa(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&oa(r[0])&&oa(e[0])}function kg(r){if(tu==null){var e=Gn(r);tu=e.getParameter(e.MAX_TEXTURE_SIZE)}return tu}function Ag(r){if(nu==null){var e=Gn(r);nu=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,nu)}function Ig(r){if(r===0)return 0;var e=Gn(r);return rn(e,"EXT_disjoint_timer_query_webgl2")&&r===2?2:rn(e,"EXT_disjoint_timer_query")?1:0}function rn(r,e){return r.getExtension(e)!=null}function bh(r){try{if(Gn(r)!=null)return!0}catch{return!1}return!1}function Rg(r){if(r===0)return!1;var e=Gn(r);if(r===1){if(!rn(e,"OES_texture_float"))return!1}else if(!rn(e,"EXT_color_buffer_float"))return!1;return Pu(e)}function Ng(r){if(r===0)return!1;var e=Gn(r);if(r!==1){if(rn(e,"EXT_color_buffer_float"))return Pu(e);if(rn(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(n,o){var i=mc(n,o),a=n.createTexture();n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a,0);var u=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(a),n.deleteFramebuffer(s),u}(e,t)}return!1}return!!rn(e,"OES_texture_float")&&!!rn(e,"WEBGL_color_buffer_float")&&Pu(e)}function Pu(r){var e=mc(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var o=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(n),o}function Dg(r){return r===2&&Gn(r).fenceSync!=null}var he=q();function hf(r){q().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ee(r,e){return D.tidy(r,e)}function Vt(r){cf(r).forEach(function(e){return e.dispose()})}function Og(r){return D.keep(r)}function Oa(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];q().getBool("IS_TEST")||console.warn.apply(console,r)}function Tr(r,e){var t=r;if(Pn(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||Pn(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&q().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,a,s){if(s=s||[],!Array.isArray(i)&&!Pn(i))return void R(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});R(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),R(i.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"});for(var u=a.slice(1),c=0;c<i.length;++c)o(i[c],u,s.concat(c))}(r,n,[]),n}function xh(r,e,t,n){if(r!=null&&(r!=="numeric"&&r!==e||r==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+n+"' must be "+r+" tensor, but got "+e+" tensor")}function k(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof He)return xh(n,r.dtype,e,t),r;var o=Fi(r);if(o!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(o=n),xh(n,o,e,t),r==null||!Pn(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+i+"'")}var a=Tr(r,o);Pn(r)||Array.isArray(r)||(r=[r]);var s=o!=="string"?rf(r,o,q().getBool("DEBUG")):Do(r,[],!0);return D.makeTensor(s,a,o)}function Fa(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(o,i){return k(o,e+"["+i+"]",t)},n)}function df(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function Fg(r,e,t){for(var n=r.length+e.length,o=[],i=0,a=0,s=0;s<n;s++)t.indexOf(s)===-1?o.push(r[i++]):o.push(e[a++]);return o}function St(r,e){for(var t=[],n=r.length,o=0;o<n;o++)e.indexOf(o)===-1&&t.push(r[o]);return[t,e.map(function(i){return r[i]})]}function zt(r,e){return Fg(r,e.map(function(t){return 1}),e)}function jt(r,e,t){R(df(e,t),function(){return r+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function qn(r,e){if(df(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(o){return t.push(o)}),t}function gc(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Hn(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function Mg(r,e){var t=r[0].length;r.forEach(function(o,i){R(o.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+t+")"})}),R(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var n=r[0];r.forEach(function(o,i){for(var a=0;a<t;a++)R(a===e||o[a]===n[a],function(){return"Error in concat"+t+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+i+"."})})}function Fo(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}function N(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];D.startScope(t);try{var s=n.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),D.endScope(s),s}catch(u){throw D.endScope(null),u}};return Object.defineProperty(o,"name",{value:t,configurable:!0}),o}he.registerFlag("HAS_WEBGL",function(){return he.getNumber("WEBGL_VERSION")>0}),he.registerFlag("WEBGL_VERSION",function(){return bh(2)?2:bh(1)?1:0}),he.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return he.get("WEBGL_VERSION")===2}),he.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),he.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),he.registerFlag("WEBGL_PACK",function(){return he.getBool("HAS_WEBGL")}),he.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_CLIP",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),he.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_REDUCE",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_LAZILY_UNPACK",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_CONV_IM2COL",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return kg(he.getNumber("WEBGL_VERSION"))}),he.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Ag(he.getNumber("WEBGL_VERSION"))}),he.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=he.getNumber("WEBGL_VERSION");return r===0?0:Ig(r)}),he.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return he.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),he.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Rg(he.getNumber("WEBGL_VERSION"))}),he.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!he.getBool("WEBGL_FORCE_F16_TEXTURES")&&he.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),he.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Ng(he.getNumber("WEBGL_VERSION"))}),he.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Dg(he.getNumber("WEBGL_VERSION"))}),he.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return he.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),uf=hf;var xt=N({complex_:function(r,e){var t=k(r,"real","complex"),n=k(e,"imag","complex");return Ne(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex()."),D.runKernelFunc(function(o){return o.complex(t,n)},{$real:t,$imag:n})}}),nn=N({real_:function(r){var e=k(r,"input","real");return D.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),Fn=N({imag_:function(r){var e=k(r,"input","imag");return D.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Ct(r,e,t){return kr(r,e,Tr(r,t),t)}function kr(r,e,t,n){if(n==null&&(n=Fi(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Pn(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){af(e);var o=ie(e),i=ie(t);R(o===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<t.length;++a){var s=t[a],u=a!==t.length-1||s!==ie(e.slice(a));R(t[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return Pn(r)||Array.isArray(r)||(r=[r]),e=e||t,r=n!=="string"?rf(r,n,q().getBool("DEBUG")):Do(r,[],!0),D.makeTensor(r,e,n)}function J(r,e){if((Pn(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Pn(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return kr(r,[],[],e)}function rt(r,e){Ho(r);var t=Tr(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return kr(r,null,t,e)}function yr(r,e,t){if(Ho(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Tr(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return kr(r,e,n,t)}function yc(r,e,t){if(Ho(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Tr(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return kr(r,e,n,t)}function Bt(r,e,t){if(Ho(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Tr(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return kr(r,e,n,t)}function Pg(r,e,t){if(Ho(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Tr(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return kr(r,e,n,t)}function Bg(r,e,t){if(Ho(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Tr(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return kr(r,e=e||n,n,t)}function Lg(r,e,t,n){return e===void 0&&(e=!0),D.makeVariable(r,e,t,n)}function jo(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=jo(r,"float32"),n=Ve(r,"float32");return xt(t,n)}var o=of(ie(r),e);return D.makeTensor(o,r,e)}function Ve(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Ve(r,"float32"),n=Ve(r,"float32");return xt(t,n)}var o=Mi(ie(r),e);return D.makeTensor(o,r,e)}function Ln(r,e,t){return D.runKernelFunc(function(n){return n.fill(r,e,t)},{})}function Wg(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");return D.runKernelFunc(function(n){return n.linspace(r,e,t)},{})}function Ma(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");if(r===e||r<e&&t<0||e<r&&t>1)return Ve([0],n);var o=Mi(Math.abs(Math.ceil((e-r)/t)),n);e<r&&t===1&&(t=-1),o[0]=r;for(var i=1;i<o.length;i++)o[i]=o[i-1]+t;return rt(o,n)}var ff=N({onesLike_:function(r){var e=k(r,"x","onesLike");if(e.dtype==="complex64"){var t=ff(nn(e)),n=Te(Fn(e));return xt(t,n)}return D.runKernelFunc(function(o){return o.onesLike(e)},{$x:e},function(o,i){return{$x:function(){return Te(o)}}})}}),Te=N({zerosLike_:function(r){var e=k(r,"x","zerosLike");return D.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,n){return{$x:function(){return Te(t)}}})}}),st=N({concat_:function(r,e){e===void 0&&(e=0),R(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Fa(r,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),e=ft(e,t[0].shape)[0];var n=Fo(t.map(function(s){return s.shape}),e);if(ie(n)===0)return Ct([],n);if((t=t.filter(function(s){return s.size>0})).length===1)return t[0];var o=t.map(function(s){return s.shape});Mg(o,e);var i=t,a={axis:e};return D.runKernelFunc(function(s){return s.concat(t,e)},i,function(s){var u=o.map(function(c){return c[e]});return _c(s,u,e).map(function(c){return function(){return c}})},"Concat",a)}}),Vg=N({concat1d_:function(r){return st(r,0)}}),Ug=N({concat2d_:function(r,e){return st(r,e)}}),zg=N({concat3d_:function(r,e){return st(r,e)}}),Gg=N({concat4d_:function(r,e){return st(r,e)}}),_c=N({split_:function(r,e,t){t===void 0&&(t=0);var n,o=k(r,"x","split");return t=ft(t,o.shape)[0],typeof e=="number"?(R(o.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(o.shape[t]/e)):(R(o.shape[t]===e.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e),D.runKernelFunc(function(i){return i.split(o,n,t)},{$x:o},function(i){return{$x:function(){return st(i,t)}}})}});function Zr(r,e){return r(e={exports:{}},e.exports),e.exports}var qg=Zr(function(r){(function(e,t,n){function o(s){var u,c=this,l=(u=4022871197,function(h){h=h.toString();for(var d=0;d<h.length;d++){var f=.02519603282416938*(u+=h.charCodeAt(d));f-=u=f>>>0,u=(f*=u)>>>0,u+=4294967296*(f-=u)}return 23283064365386963e-26*(u>>>0)});c.next=function(){var h=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=h-(c.c=0|h)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new o(s),l=u&&u.state,h=c.next;return h.int32=function(){return 4294967296*c.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,l&&(typeof l=="object"&&i(l,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=a:this.alea=a})(0,r)}),Hg=Zr(function(r){(function(e,t,n){function o(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new o(s),l=u&&u.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=c.next,h.quick=h,l&&(typeof l=="object"&&i(l,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=a:this.xor128=a})(0,r)}),jg=Zr(function(r){(function(e,t,n){function o(s){var u=this,c="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=c.next,h.quick=h,l&&(typeof l=="object"&&i(l,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=a:this.xorwow=a})(0,r)}),Xg=Zr(function(r){(function(e,t,n){function o(s){var u=this;u.next=function(){var c,l,h=u.x,d=u.i;return c=h[d],l=(c^=c>>>7)^c<<24,l^=(c=h[d+1&7])^c>>>10,l^=(c=h[d+3&7])^c>>>3,l^=(c=h[d+4&7])^c<<7,c=h[d+7&7],l^=(c^=c<<13)^c<<9,h[d]=l,u.i=d+1&7,l},function(c,l){var h,d=[];if(l===(0|l))d[0]=l;else for(l=""+l,h=0;h<l.length;++h)d[7&h]=d[7&h]<<15^l.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],c.x=d,c.i=0,h=256;h>0;--h)c.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var c=new o(s),l=u&&u.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=c.next,h.quick=h,l&&(l.x&&i(l,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=a:this.xorshift7=a})(0,r)}),Kg=Zr(function(r){(function(e,t,n){function o(s){var u=this;u.next=function(){var c,l,h=u.w,d=u.X,f=u.i;return u.w=h=h+1640531527|0,l=d[f+34&127],c=d[f=f+1&127],l^=l<<13,c^=c<<17,l^=l>>>15,c^=c>>>12,l=d[f]=l^c,u.i=f,l+(h^h>>>16)|0},function(c,l){var h,d,f,p,v,m=[],g=128;for(l===(0|l)?(d=l,l=null):(l+="\0",d=0,g=Math.max(g,l.length)),f=0,p=-32;p<g;++p)l&&(d^=l.charCodeAt((p+32)%l.length)),p===0&&(v=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,p>=0&&(v=v+1640531527|0,f=(h=m[127&p]^=d+v)==0?f+1:0);for(f>=128&&(m[127&(l&&l.length||0)]=-1),f=127,p=512;p>0;--p)d=m[f+34&127],h=m[f=f+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,m[f]=d^h;c.w=v,c.X=m,c.i=f}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var c=new o(s),l=u&&u.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=c.next,h.quick=h,l&&(l.X&&i(l,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=a:this.xor4096=a})(0,r)}),$g=Zr(function(r){(function(e,t,n){function o(s){var u=this,c="";u.next=function(){var h=u.b,d=u.c,f=u.d,p=u.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,u.b=h=h<<20^h>>>12^d,u.c=d=d-f|0,u.d=f<<16^d>>>16^p,u.a=p-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=c.next,h.quick=h,l&&(typeof l=="object"&&i(l,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=a:this.tychei=a})(0,r)}),Lr=Zr(function(r){(function(e,t){var n,o=this,i=256,a=6,s="random",u=t.pow(i,a),c=t.pow(2,52),l=2*c,h=i-1;function d(g,_,x){var b=[],y=v(function C(T,S){var I,A=[],F=typeof T;if(S&&F=="object")for(I in T)try{A.push(C(T[I],S-1))}catch{}return A.length?A:F=="string"?T:T+"\0"}((_=_==1?{entropy:!0}:_||{}).entropy?[g,m(e)]:g??function(){try{var C;return n&&(C=n.randomBytes)?C=C(i):(C=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(C)),m(C)}catch{var T=o.navigator,S=T&&T.plugins;return[+new Date,o,S,o.screen,m(e)]}}(),3),b),w=new f(b),E=function(){for(var C=w.g(a),T=u,S=0;C<c;)C=(C+S)*i,T*=i,S=w.g(1);for(;C>=l;)C/=2,T/=2,S>>>=1;return(C+S)/T};return E.int32=function(){return 0|w.g(4)},E.quick=function(){return w.g(4)/4294967296},E.double=E,v(m(w.S),e),(_.pass||x||function(C,T,S,I){return I&&(I.S&&p(I,w),C.state=function(){return p(w,{})}),S?(t[s]=C,T):C})(E,y,"global"in _?_.global:this==t,_.state)}function f(g){var _,x=g.length,b=this,y=0,w=b.i=b.j=0,E=b.S=[];for(x||(g=[x++]);y<i;)E[y]=y++;for(y=0;y<i;y++)E[y]=E[w=h&w+g[y%x]+(_=E[y])],E[w]=_;(b.g=function(C){for(var T,S=0,I=b.i,A=b.j,F=b.S;C--;)T=F[I=h&I+1],S=S*i+F[h&(F[I]=F[A=h&A+T])+(F[A]=T)];return b.i=I,b.j=A,S})(i)}function p(g,_){return _.i=g.i,_.j=g.j,_.S=g.S.slice(),_}function v(g,_){for(var x,b=g+"",y=0;y<b.length;)_[h&y]=h&(x^=19*_[h&y])+b.charCodeAt(y++);return m(_)}function m(g){return String.fromCharCode.apply(0,g)}if(t["seed"+s]=d,v(t.random(),e),r.exports){r.exports=d;try{n=require("crypto")}catch{}}})([],Math)});Lr.alea=qg,Lr.xor128=Hg,Lr.xorwow=jg,Lr.xorshift7=Xg,Lr.xor4096=Kg,Lr.tychei=$g;var ds=Lr.alea,bc=function(){function r(e,t,n,o,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=ds(a.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(o=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),Yg=function(){function r(e,t,n,o){this.alpha=e,this.beta=1/t,this.dtype=n;var i=o||Math.random();this.randu=ds(i.toString()),this.randn=new bc(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,o,i,a;;){do o=this.randn.nextValue(),a=1+this.c*o;while(a<=0);if(a*=a*a,t=1-.331*(e=o*o)*e,n=.5*e+this.d*(1-a+Math.log(a)),(i=this.randu())<t||Math.log(i)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),Zg=function(){function r(e,t,n,o){var i=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=ds(o)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function pe(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",af(r),new _i(r,e,t)}function Jg(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}var pf=N({batchToSpaceND_:function(r,e,t){var n=k(r,"x","batchToSpaceND"),o=e.reduce(function(i,a){return i*a});return R(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),R(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),R(n.shape[0]%o==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o}),D.runKernelFunc(function(i){return i.batchToSpaceND(n,e,t)},{$x:n},function(i){return{$x:function(){return i.spaceToBatchND(e,t)}}})}}),Qg=N({broadcastTo_:function(r,e){var t=k(r,"broadcastTo","x"),n=t.shape;if(e.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var o=t.shape.slice();o.length<e.length;)o.unshift(1);t=t.reshape(o)}for(var i=Array.from(e),a=e.length-1;a>=0;a--)if(t.shape[a]===e[a])i[a]=1;else if(t.shape[a]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var s=i.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return s.length===0?t.clone():D.runKernelFunc(function(u){return u.tile(t,i)},{input:t},function(u){return{input:function(){return u.sum(s,!0)}}})}}),ey=N({cast_:function(r,e){var t=k(r,"x","cast");if(!jm(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={dtype:e};return D.runKernelFunc(function(o){return o.cast(t,e)},{x:t},function(o){return{x:function(){return o.clone()}}},"Cast",n)}}),ty=N({clone_:function(r){var e=k(r,"x","clone",null);return D.runKernelFunc(function(){return D.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),ny=N({cumsum_:function(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var o=k(r,"x","cumsum"),i=qn([e|=0],o.rank),a=o;i!=null&&(a=o.transpose(i));var s=Hn(1,o.rank)[0],u=D.runKernelFunc(function(c){return c.cumsum(a,s,t,n)},{permutedX:a},function(c){return{permutedX:function(){return c.cumsum(e,t,!n)}}});return i!=null&&(u=u.transpose(i)),u}}),ry=N({depthToSpace_:function(r,e,t){t===void 0&&(t="NHWC");var n=k(r,"x","depthToSpace"),o=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],a=t==="NHWC"?n.shape[3]:n.shape[1];return R(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+`  for depthToSpace with input shape
      `+n.shape}),R(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+` for depthToSpace with input shape
          `+n.shape}),R(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+n.shape}),D.runKernelFunc(function(s){return s.depthToSpace(n,e,t)},{$x:n})}}),tn=N({expandDims_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","expandDims",null);R(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n=t.shape.slice();return e<0&&(R(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),n.splice(e,0,1),pn(t,n)}}),vf=N({eye_:function(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var o=pe([r,e],n),i=r<=e?r:e,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(r,e);if(t==null)return s;if(t.length===1)return Eo(tn(s,0),[t[0],1,1]);if(t.length===2)return Eo(tn(tn(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Eo(tn(tn(tn(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),oy=N({multinomial_:function(r,e,t,n){n===void 0&&(n=!1);var o=k(r,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?o.as2D(1,-1):o,u=D.runKernelFunc(function(c){return c.multinomial(s,n,e,t)},{logits2D:s});return a===1?u.as1D():u}}),Bu=N({oneHot_:function(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=k(r,"indices","oneHot","int32"),i=o.shape.concat([e]);return o=o.flatten(),D.runKernelFunc(function(a){return a.oneHot(o,e,t,n)},{$indices:o},function(a){return{$indices:function(){return Ve(o.shape,"float32")}}}).reshape(i)}}),Jr=N({pad_:function(r,e,t){t===void 0&&(t=0);var n=k(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:e,constantValue:t};return D.runKernelFunc(function(i){return i.pad(n,e,t)},{x:n},function(i){var a=e.map(function(s){return s[0]});return{x:function(){return i.slice(a,n.shape)}}},"PadV2",o)}}),iy=N({pad1d_:function(r,e,t){return t===void 0&&(t=0),R(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Jr(r,[e],t)}}),ay=N({pad2d_:function(r,e,t){return t===void 0&&(t=0),R(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Jr(r,e,t)}}),sy=N({pad3d_:function(r,e,t){return t===void 0&&(t=0),R(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Jr(r,e,t)}}),uy=N({pad4d_:function(r,e,t){return t===void 0&&(t=0),R(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Jr(r,e,t)}}),cy=N({rand_:function(r,e,t){var n=ie(r),o=null;if(t==null||t==="float32")o=new Float32Array(n);else if(t==="int32")o=new Int32Array(n);else{if(t!=="bool")throw new Error("Unknown data type "+t);o=new Uint8Array(n)}for(var i=0;i<n;i++)o[i]=e();return D.makeTensor(o,r,t)}}),ly=N({randomNormal_:function(r,e,t,n,o){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new bc(e,t,n,!1,o),a=pe(r,n),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),hy=N({randomGamma_:function(r,e,t,n,o){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var i=new Yg(e,t,n,o),a=pe(r,n),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),mf=N({randomUniform_:function(r,e,t,n,o){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var i=pe(r,n),a=new Zg(e,t,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),pn=N({reshape_:function(r,e){var t=k(r,"x","reshape",null);e=qm(e,t.size),R(t.size===ie(e),function(){return"new shape and old shape must have the same number of elements."});var n={shape:e};return D.runKernelFunc(function(o){return o.reshape(t,e)},{x:t},function(o){return{x:function(){return o.reshape(t.shape)}}},"Reshape",n)}}),gf=N({spaceToBatchND_:function(r,e,t){var n=k(r,"x","spaceToBatchND");return R(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),R(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),R(n.shape.reduce(function(o,i,a){return a>0&&a<=e.length?o&&(i+t[a-1][0]+t[a-1][1])%e[a-1]==0:o},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),D.runKernelFunc(function(o){return o.spaceToBatchND(n,e,t)},{$x:n},function(o){return{$x:function(){return o.batchToSpaceND(e,t)}}})}}),yf=N({squeeze_:function(r,e){var t=k(r,"x","squeeze");return pn(t,Wr(t.shape,e).newShape)}}),Jt=N({stack_:function(r,e){e===void 0&&(e=0);var t=Fa(r,"tensors","stack");if(R(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var n=t[0].rank,o=t[0].shape,i=t[0].dtype;R(e<=n,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){Ne(o,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){R(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(s){return s.expandDims(e)});return st(a,e)}}),Eo=N({tile_:function(r,e){var t=k(r,"x","tile",null);R(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."});var n=[t],o={reps:e};return D.runKernelFunc(function(i,a){var s=i.tile(t,e);return a([t]),s},{x:t},function(i,a){var s=a[0];return{x:function(){var u=Te(s);if(s.rank===1)for(var c=0;c<e[0];++c)u=u.add(i.slice([c*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(c=0;c<e[0];++c)for(var l=0;l<e[1];++l)u=u.add(i.slice([c*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(c=0;c<e[0];++c)for(l=0;l<e[1];++l)for(var h=0;h<e[2];++h)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],h*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<e[0];++c)for(l=0;l<e[1];++l)for(h=0;h<e[2];++h)for(var d=0;d<e[3];++d)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],h*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",o,n)}}),dy=N({truncatedNormal_:function(r,e,t,n,o){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new bc(e,t,n,!0,o),a=pe(r,n),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),ut=N({unstack_:function(r,e){e===void 0&&(e=0),e=e||0;var t=k(r,"x","unstack");R(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length);var n={axis:e};return D.runKernelFunc(function(o){return o.unstack(t,e)},{x:t},function(o){return{x:function(){return Jt(o,e)}}},"Unpack",n)}}),fy=function(r,e){return ne(this,void 0,void 0,function(){var t,n,o,i,a,s,u,c,l,h;return re(this,function(d){switch(d.label){case 0:return t=k(r,"x","setdiff1d"),n=k(e,"y","setdiff1d"),R(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),R(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),R(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return o=d.sent(),[4,n.data()];case 2:for(i=d.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new _i([s],t.dtype),c=new _i([s],"int32"),l=0,h=0;l<o.length;l++)a.has(o[l])||(u.values[h]=o[l],c.values[h]=l,h++);return[2,[u.toTensor(),c.toTensor()]]}})})};function Pa(r,e,t,n){n===void 0&&(n=!0);var o=[];if(n)(o=o.concat(e.slice(0))).push(r[0]/t),o=o.concat(r.slice(1));else{o=o.concat(r[0]);for(var i=e.length,a=0;a<i;++a)o=o.concat([r[a+1]/e[a],e[a]]);o=o.concat(r.slice(i+1))}return o}function Ba(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var o=e+1;o<r;++o)o<=2*e?(n.push(o),n.push(o-(e+1))):n.push(o)}else{var i=[],a=[];for(o=1;o<r;++o)o>=2*e+1||o%2==1?a.push(o):i.push(o);n.push.apply(n,i),n.push(0),n.push.apply(n,a)}return n}function La(r,e,t,n){n===void 0&&(n=!0);var o=[];n?o.push(r[0]/t):o.push(r[0]*t);for(var i=1;i<r.length;++i)i<=e.length?n?o.push(e[i-1]*r[i]):o.push(r[i]/e[i-1]):o.push(r[i]);return o}function _f(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function bf(r,e,t){for(var n=r.slice(0,1),o=0;o<t;++o)n.push(r[o+1]-e[o][0]-e[o][1]);return n}function xf(r,e){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var t=e.shape,n=t[t.length-1],o=1,i=0;i<t.length-1;++i)o*=t[i];var a=r.shape,s=t.slice();s.pop();var u=1;for(i=n;i<r.rank;++i)u*=a[i],s.push(a[i]);var c=Bn(r.shape).map(function(l){return l/u}).concat([1]).slice(0,n);return[s,o,u,c]}var wf=30;function au(r){return r<=wf?r:Nu(r,Math.floor(Math.sqrt(r)))}function py(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+r+", sliceDim: "+n+", and batchDim: "+o+".";if(t.rank<o)throw new Error(i+" update.rank < "+o+". ");if(r.length<n+(t.rank-o))throw new Error(i+" Output shape length < "+(n+(t.rank-o)));if(t.rank!==o+r.length-n)throw new Error(i+" update.rank != "+(o+r.length-n));for(var a=0;a<o;++a)if(t.shape[a]!==e.shape[a])throw new Error(i+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-o;++a)if(t.shape[a+o]!==r[a+n])throw new Error(i+" updates.shape["+(a+o)+"] ("+t.shape[a+o]+") != shape["+(a+o)+"] ("+r[a+o]+")")}function vy(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}py(t,e,r)}function Wa(r,e,t){for(var n=e.shape.length,o=n>1?e.shape[n-1]:1,i=t.length,a=1,s=o;s<i;++s)a*=t[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:ie(e.shape)/u,sliceSize:a,strides:Bn(t.slice(0,o)).concat([1]),outputSize:ie(t)}}function my(r,e,t){R(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+e+" must match the rank of the array ("+r.rank+")."}),R(r.rank===t.length,function(){return"Error in slice"+r.rank+"D: Length of size "+t+" must match the rank of the array ("+r.rank+")."});for(var n=function(i){R(e[i]+t[i]<=r.shape[i],function(){return"Error in slice"+r.rank+"D: begin["+i+"] + size["+i+"] ("+(e[i]+t[i])+") would overflow input.shape["+i+"] ("+r.shape[i]+")"})},o=0;o<r.rank;++o)n(o)}function wh(r){for(var e=[],t=0;r>0;)1&r&&e.push(t),r/=2,t++;return e}function xc(r,e,t){for(var n=[],o=0;o<r.length;o++)n[o]=Math.ceil((e[o]-r[o])/t[o]);return n}function gy(r,e,t,n,o){var i=e[o],a=t[o]||1;(r&1<<o||i==null)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=n[o];return i<0&&(i+=s),i=Au(0,i,s-1)}function yy(r,e,t,n,o){var i=e[o],a=t[o]||1;(r&1<<o||i==null)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=n[o];return i<0&&(i+=s),i=a>0?Au(0,i,s):Au(-1,i,s-1)}function Cf(r,e,t){for(var n=t.length,o=0;o<t.length;o++)if(t[o]>1){n=o;break}for(o=n+1;o<t.length;o++)if(e[o]>0||t[o]!==r[o])return!1;return!0}function Ef(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function _y(r,e){R(Ru(r),function(){return"The f passed in variableGrads(f) must be a function"}),R(e==null||Array.isArray(e)&&e.every(function(l){return l instanceof Oo}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var n in e=[],D.registeredVariables)e.push(D.registeredVariables[n]);var o=t?e.filter(function(l){return!l.trainable}):null,i=e.length;R((e=e.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=D.gradients(r,e,null,!0),s=a.value,u=a.grads;R(u.some(function(l){return l!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),R(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return e.forEach(function(l,h){u[h]!=null&&(c[l.name]=u[h])}),o!=null&&o.forEach(function(l){return c[l.name]=null}),{value:s,grads:c}}function fs(r){return D.customGrad(r)}var rr=N({softmax_:function(r,e){e===void 0&&(e=-1);var t=k(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return D.runKernelFunc(function(n,o){var i=n.softmax(t,e);return o([i]),i},{logits:t},function(n,o){var i=o[0],a=n.mul(i);return{logits:function(){return a.sub(a.sum([e],!0).mul(i))}}},"Softmax",{dim:e},[],[!0])}}),by=N({logSoftmax_:function(r,e){e===void 0&&(e=-1);var t=k(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return fs(function(n,o){var i=n.max(e,!0),a=n.sub(i),s=a.toFloat().sub(a.exp().sum(e,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(e,!0).mul(l))}}})(t)}}),Sf=function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),Tf=function(){function r(){}return r.prototype.time=function(e){return V("time")},r.prototype.read=function(e){return V("read")},r.prototype.readSync=function(e){return V("readSync")},r.prototype.numDataIds=function(){return V("numDataIds")},r.prototype.disposeData=function(e){return V("disposeData")},r.prototype.write=function(e,t,n){return V("write")},r.prototype.move=function(e,t,n,o){return V("move")},r.prototype.memory=function(){return V("memory")},r.prototype.floatPrecision=function(){return V("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(e,t,n,o){return V("batchMatMul")},r.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,V("fusedBatchMatMul")},r.prototype.slice=function(e,t,n){return V("slice")},r.prototype.stridedSlice=function(e,t,n,o){return V("stridedSlice")},r.prototype.unstack=function(e,t){return V("unstack")},r.prototype.reverse=function(e,t){return V("reverse")},r.prototype.concat=function(e,t){return V("concat")},r.prototype.neg=function(e){return V("neg")},r.prototype.add=function(e,t){return V("add")},r.prototype.addN=function(e){return V("addN")},r.prototype.subtract=function(e,t){return V("subtract")},r.prototype.multiply=function(e,t){return V("multiply")},r.prototype.realDivide=function(e,t){return V("realDivide")},r.prototype.floorDiv=function(e,t){return V("floorDiv")},r.prototype.sum=function(e,t){return V("sum")},r.prototype.prod=function(e,t){return V("prod")},r.prototype.unsortedSegmentSum=function(e,t,n){return V("unsortedSegmentSum")},r.prototype.argMin=function(e,t){return V("argMin")},r.prototype.argMax=function(e,t){return V("argMax")},r.prototype.equal=function(e,t){return V("equal")},r.prototype.notEqual=function(e,t){return V("notEqual")},r.prototype.less=function(e,t){return V("less")},r.prototype.lessEqual=function(e,t){return V("lessEqual")},r.prototype.greater=function(e,t){return V("greater")},r.prototype.greaterEqual=function(e,t){return V("greaterEqual")},r.prototype.logicalNot=function(e){return V("logicalNot")},r.prototype.logicalAnd=function(e,t){return V("logicalAnd")},r.prototype.logicalOr=function(e,t){return V("logicalOr")},r.prototype.where=function(e){return V("where")},r.prototype.select=function(e,t,n){return V("select")},r.prototype.topk=function(e,t,n){return V("topk")},r.prototype.min=function(e,t){return V("min")},r.prototype.minimum=function(e,t){return V("minimum")},r.prototype.mod=function(e,t){return V("mod")},r.prototype.max=function(e,t){return V("max")},r.prototype.maximum=function(e,t){return V("maximum")},r.prototype.all=function(e,t){return V("all")},r.prototype.any=function(e,t){return V("any")},r.prototype.squaredDifference=function(e,t){return V("squaredDifference")},r.prototype.ceil=function(e){return V("ceil")},r.prototype.floor=function(e){return V("floor")},r.prototype.round=function(e){return V("round")},r.prototype.sign=function(e){return V("sign")},r.prototype.isNaN=function(e){return V("isNaN")},r.prototype.isInf=function(e){return V("isInf")},r.prototype.isFinite=function(e){return V("isFinite")},r.prototype.pow=function(e,t){return V("pow")},r.prototype.exp=function(e){return V("exp")},r.prototype.expm1=function(e){return V("expm1")},r.prototype.softmax=function(e,t){return V("softmax")},r.prototype.log=function(e){return V("log")},r.prototype.log1p=function(e){return V("log1p")},r.prototype.sqrt=function(e){return V("sqrt")},r.prototype.rsqrt=function(e){return V("rsqrt")},r.prototype.square=function(e){return V("square")},r.prototype.reciprocal=function(e){return V("reciprocal")},r.prototype.relu=function(e){return V("relu")},r.prototype.relu6=function(e){return V("relu6")},r.prototype.prelu=function(e,t){return V("prelu")},r.prototype.elu=function(e){return V("elu")},r.prototype.eluDer=function(e,t){return V("eluDer")},r.prototype.selu=function(e){return V("selu")},r.prototype.int=function(e){return V("int")},r.prototype.clip=function(e,t,n){return V("clip")},r.prototype.abs=function(e){return V("abs")},r.prototype.complexAbs=function(e){return V("complexAbs")},r.prototype.sigmoid=function(e){return V("sigmoid")},r.prototype.softplus=function(e){return V("softplus")},r.prototype.sin=function(e){return V("sin")},r.prototype.cos=function(e){return V("cos")},r.prototype.tan=function(e){return V("tan")},r.prototype.asin=function(e){return V("asin")},r.prototype.acos=function(e){return V("acos")},r.prototype.atan=function(e){return V("atan")},r.prototype.atan2=function(e,t){return V("atan2")},r.prototype.sinh=function(e){return V("sinh")},r.prototype.cosh=function(e){return V("cosh")},r.prototype.tanh=function(e){return V("tanh")},r.prototype.asinh=function(e){return V("asinh")},r.prototype.acosh=function(e){return V("acosh")},r.prototype.atanh=function(e){return V("atanh")},r.prototype.erf=function(e){return V("erf")},r.prototype.step=function(e,t){return V("step")},r.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,V("fusedConv2d")},r.prototype.conv2d=function(e,t,n){return V("conv2d")},r.prototype.conv2dDerInput=function(e,t,n){return V("conv2dDerInput")},r.prototype.conv2dDerFilter=function(e,t,n){return V("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,V("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(e,t,n){return V("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(e,t,n){return V("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(e,t,n){return V("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(e,t,n){return V("conv3d")},r.prototype.conv3dDerInput=function(e,t,n){return V("conv3dDerInput")},r.prototype.conv3dDerFilter=function(e,t,n){return V("conv3dDerFilter")},r.prototype.maxPool=function(e,t){return V("maxPool")},r.prototype.maxPoolBackprop=function(e,t,n,o){return V("maxPoolBackprop")},r.prototype.avgPool=function(e,t){return V("avgPool")},r.prototype.avgPoolBackprop=function(e,t,n){return V("avgPoolBackprop")},r.prototype.avgPool3d=function(e,t){return V("avgPool3d")},r.prototype.avgPool3dBackprop=function(e,t,n){return V("avgPool3dBackprop")},r.prototype.maxPool3d=function(e,t){return V("maxPool3d")},r.prototype.maxPool3dBackprop=function(e,t,n,o){return V("maxPool3dBackprop")},r.prototype.reshape=function(e,t){return V("reshape")},r.prototype.cast=function(e,t){return V("cast")},r.prototype.tile=function(e,t){return V("tile")},r.prototype.pad=function(e,t,n){return V("pad")},r.prototype.transpose=function(e,t){return V("transpose")},r.prototype.gather=function(e,t,n){return V("gather")},r.prototype.gatherND=function(e,t){return V("gatherND")},r.prototype.scatterND=function(e,t,n){return V("scatterND")},r.prototype.batchToSpaceND=function(e,t,n){return V("batchToSpaceND")},r.prototype.spaceToBatchND=function(e,t,n){return V("spaceToBatchND")},r.prototype.resizeBilinear=function(e,t,n,o){return V("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(e,t,n){return V("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(e,t,n,o){return V("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(e,t,n){return V("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(e,t,n,o,i,a){return V("batchNormalization")},r.prototype.localResponseNormalization4D=function(e,t,n,o,i){return V("localResponseNormalization4D")},r.prototype.LRNGrad=function(e,t,n,o,i,a,s){return V("LRNGrad")},r.prototype.multinomial=function(e,t,n,o){return V("multinomial")},r.prototype.oneHot=function(e,t,n,o){return V("oneHot")},r.prototype.cumsum=function(e,t,n,o){return V("cumsum")},r.prototype.nonMaxSuppression=function(e,t,n,o,i){return V("nonMaxSuppression")},r.prototype.fft=function(e){return V("fft")},r.prototype.ifft=function(e){return V("ifft")},r.prototype.complex=function(e,t){return V("complex")},r.prototype.real=function(e){return V("real")},r.prototype.imag=function(e){return V("imag")},r.prototype.cropAndResize=function(e,t,n,o,i,a){return V("cropAndResize")},r.prototype.depthToSpace=function(e,t,n){return V("depthToSpace")},r.prototype.split=function(e,t,n){return V("split")},r.prototype.sparseToDense=function(e,t,n,o){return V("sparseToDense")},r.prototype.diag=function(e){return V("diag")},r.prototype.fill=function(e,t,n){return V("fill")},r.prototype.onesLike=function(e){return V("onesLike")},r.prototype.zerosLike=function(e){return V("zerosLike")},r.prototype.linspace=function(e,t,n){return V("linspace")},r.prototype.dispose=function(){return V("dispose")},r}();function V(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function vr(r,e){for(var t=r.length,n=[],o=0;o<t;o++){var i=t-1-o,a=r[i]||1;(e[e.length-1-o]||1)>1&&a===1&&n.unshift(i)}return n}function lt(r,e){for(var t=[],n=0;n<e.length;n++){var o=r[r.length-n-1],i=e.length-n-1,a=e[i];(o==null||o===1&&a>1)&&t.unshift(i)}return t}function xe(r,e){for(var t=[],n=Math.max(r.length,e.length),o=0;o<n;o++){var i=r[r.length-o-1];i==null&&(i=1);var a=e[e.length-o-1];if(a==null&&(a=1),i===1)t.unshift(a);else if(a===1)t.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+r+" and "+e+".");t.unshift(i)}}return t}function xi(r,e,t,n,o,i,a){a===void 0&&(a="channelsLast");var s,u=za(e),c=u[0],l=u[1];if(a==="channelsLast")s=[c,l,r[3],r[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[c,l,r[1],r[1]]}return Qr(r,s,t,n,o,i,!1,a)}function Va(r,e,t,n,o,i,a){a===void 0&&(a="NDHWC");var s,u,c=Lu(e),l=c[0],h=c[1],d=c[2];if(a==="NDHWC")u="channelsLast",s=[l,h,d,r[4],r[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,h,d,r[1],r[1]]}return Ua(r,s,t,n,o,!1,u,i)}function Qr(r,e,t,n,o,i,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3];if(s==="channelsLast")c=r[0],l=r[1],h=r[2],d=r[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);c=r[0],d=r[1],l=r[2],h=r[3]}var f,p=e[0],v=e[1],m=e[3],g=za(t),_=g[0],x=g[1],b=za(n),y=b[0],w=b[1],E=So(p,y),C=So(v,w),T=function(O,M,B,P,L,W,z,H){var Y,te,ce;if(typeof O=="number"){Y={top:O,bottom:O,left:O,right:O,type:O===0?"VALID":"NUMBER"};var Z=function(me,Ee,ke,ze,K){ze==null&&(ze=kf(me,Ee,ke));var Q=me[0],Ie=me[1],Se=hi((Q-Ee+2*ze)/ke+1,K);R(Je(Se),function(){return"The output # of rows ("+Se+") must be an integer. Change the stride and/or zero pad parameters"});var de=hi((Ie-Ee+2*ze)/ke+1,K);return R(Je(de),function(){return"The output # of columns ("+de+") must be an integer. Change the stride and/or zero pad parameters"}),[Se,de]}([M,B],W,P,O,H);te=Z[0],ce=Z[1]}else if(O==="same"){te=Math.ceil(M/P),ce=Math.ceil(B/L);var oe=Math.max(0,(te-1)*P+W-M),le=Math.max(0,(ce-1)*L+z-B),$=Math.floor(oe/2),ve=oe-$,De=Math.floor(le/2);Y={top:$,bottom:ve,left:De,right:le-De,type:"SAME"}}else{if(O!=="valid")throw Error("Unknown padding parameter: "+O);Y={top:0,bottom:0,left:0,right:0,type:"VALID"},te=Math.ceil((M-W+1)/P),ce=Math.ceil((B-z+1)/L)}return{padInfo:Y,outHeight:te,outWidth:ce}}(o,l,h,_,x,E,C,i),S=T.padInfo,I=T.outHeight,A=T.outWidth,F=a?m*d:m;return s==="channelsFirst"?f=[c,F,I,A]:s==="channelsLast"&&(f=[c,I,A,F]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:h,inChannels:d,outHeight:I,outWidth:A,outChannels:F,padInfo:S,strideHeight:_,strideWidth:x,filterHeight:p,filterWidth:v,effectiveFilterHeight:E,effectiveFilterWidth:C,dilationHeight:y,dilationWidth:w,inShape:r,outShape:f,filterShape:e}}function Ua(r,e,t,n,o,i,a,s){i===void 0&&(i=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3],f=u[4];if(a==="channelsLast")c=r[0],l=r[1],h=r[2],d=r[3],f=r[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);c=r[0],f=r[1],l=r[2],h=r[3],d=r[4]}var p,v=e[0],m=e[1],g=e[2],_=e[4],x=Lu(t),b=x[0],y=x[1],w=x[2],E=Lu(n),C=E[0],T=E[1],S=E[2],I=So(v,C),A=So(m,T),F=So(g,S),O=function(z,H,Y,te,ce,Z,oe,le,$,ve,De){var me,Ee,ke,ze;if(typeof z=="number"){me={top:z,bottom:z,left:z,right:z,front:z,back:z,type:z===0?"VALID":"NUMBER"};var K=function(Tn,ln,ei,io,kn,Xs){kn==null&&(kn=kf(Tn,ln,io));var Fm=Tn[0],Mm=Tn[1],Pm=Tn[2],Ks=hi((Fm-ln+2*kn)/io+1,Xs);R(Je(Ks),function(){return"The output # of depths ("+Ks+") must be an integer. Change the stride and/or zero pad parameters"});var $s=hi((Mm-ln+2*kn)/io+1,Xs);R(Je($s),function(){return"The output # of rows ("+$s+") must be an integer. Change the stride and/or zero pad parameters"});var Ys=hi((Pm-ln+2*kn)/io+1,Xs);return R(Je(Ys),function(){return"The output # of columns ("+Ys+") must be an integer. Change the stride and/or zero pad parameters"}),[Ks,$s,Ys,ei]}([H,Y,te,1],le,1,ce,z,De);Ee=K[0],ke=K[1],ze=K[2]}else if(z==="same"){Ee=Math.ceil(H/ce),ke=Math.ceil(Y/Z),ze=Math.ceil(te/oe);var Q=(Ee-1)*ce+le-H,Ie=(ke-1)*Z+$-Y,Se=(ze-1)*oe+ve-te,de=Math.floor(Q/2),Oe=Q-de,Ke=Math.floor(Ie/2),_t=Ie-Ke,Ot=Math.floor(Se/2);me={top:Ke,bottom:_t,left:Ot,right:Se-Ot,front:de,back:Oe,type:"SAME"}}else{if(z!=="valid")throw Error("Unknown padding parameter: "+z);me={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ee=Math.ceil((H-le+1)/ce),ke=Math.ceil((Y-$+1)/Z),ze=Math.ceil((te-ve+1)/oe)}return{padInfo:me,outDepth:Ee,outHeight:ke,outWidth:ze}}(o,l,h,d,b,y,w,I,A,F,s),M=O.padInfo,B=O.outDepth,P=O.outHeight,L=O.outWidth,W=i?_*f:_;return a==="channelsFirst"?p=[c,W,B,P,L]:a==="channelsLast"&&(p=[c,B,P,L,W]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:h,inWidth:d,inChannels:f,outDepth:B,outHeight:P,outWidth:L,outChannels:W,padInfo:M,strideDepth:b,strideHeight:y,strideWidth:w,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:I,effectiveFilterHeight:A,effectiveFilterWidth:F,dilationDepth:C,dilationHeight:T,dilationWidth:S,inShape:r,outShape:p,filterShape:e}}function kf(r,e,t,n){n===void 0&&(n=1);var o=So(e,n);return Math.floor((r[0]*(t-1)-t+o)/2)}function za(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Lu(r){return typeof r=="number"?[r,r,r]:r}function So(r,e){return e<=1?r:r+(r-1)*(e-1)}function hi(r,e){if(!e)return r;switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function Mo(r){var e=za(r),t=e[0],n=e[1],o=e[2];return t===1&&n===1&&o===1}function Gt(r,e){return Mo(r)||Mo(e)}function wc(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function Af(r,e,t){if(e==="complex64"){if(r.dtype==="complex64")return r.clone();var n=Ve(r.shape),o=r.toFloat(),i=t.complex(o,n);return n.dispose(),o.dispose(),i}if(!Xm(r.dtype,e))return D.makeTensorFromDataId(r.dataId,r.shape,e);if(r.dtype==="complex64"){var a=t.real(r);return i=a.cast(e),a.dispose(),i}if(e==="int32")return t.int(r);if(e==="bool"){var s=J(0,r.dtype);return i=t.notEqual(r,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+e)}function Wu(r,e){return D.makeTensorFromDataId(r.dataId,e,r.dtype)}function If(r,e,t){var n=(e-r)/(t-1),o=Mi(t,"float32");o[0]=r;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return rt(o,"float32")}function Vu(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+e.length+".");for(var t=new Float32Array(2*r.length),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function Ch(r,e){return{real:r[2*e],imag:r[2*e+1]}}function xy(r,e,t,n){r[2*n]=e,r[2*n+1]=t}function wy(r,e,t){var n=(t?2:-2)*Math.PI*(r/e);return{real:Math.cos(n),imag:Math.sin(n)}}function Cy(r,e,t){var n=function(i,a,s){return function(u,c,l){for(var h=0,d=u.length,f=0,p=!1;h<d;){var v=l(c,u[f=h+(d-h>>>1)]);v>0?h=f+1:(d=f,p=!v)}return p?h:-h-1}(i,a,s||Ey)}(r,e,t),o=n<0?-(n+1):n;r.splice(o,0,e)}function Ey(r,e){return r>e?1:r<e?-1:0}function Cc(r,e,t,n,o){return Rf(r,e,t,n,o,0).selectedIndices}function Ec(r,e,t,n,o,i){var a=Rf(r,e,t,n,o,i);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function Rf(r,e,t,n,o,i,a,s){s===void 0&&(s=!1);for(var u=Array.from(e).map(function(b,y){return{score:b,boxIndex:y,suppressBeginIndex:0}}).filter(function(b){return b.score>o}).sort(Eh),c=i>0?-.5/i:0,l=[],h=[];l.length<t&&u.length>0;){var d=u.pop(),f=d.score,p=d.boxIndex,v=d.suppressBeginIndex;if(f<o)break;for(var m=!1,g=l.length-1;g>=v;--g){var _=Sy(r,p,l[g]);if(_>=n){m=!0;break}if(d.score=d.score*Ty(n,c,_),d.score<=o)break}d.suppressBeginIndex=l.length,m||(d.score===f?(l.push(p),h.push(d.score)):d.score>o&&Cy(u,d,Eh))}var x=l.length;return s&&(l.fill(0,x),h.fill(0,x)),{selectedIndices:rt(l,"int32"),selectedScores:rt(h,"float32"),numValidOutputs:J(x,"int32")}}function Sy(r,e,t){var n=r.subarray(4*e,4*e+4),o=r.subarray(4*t,4*t+4),i=Math.min(n[0],n[2]),a=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),f=(s-i)*(u-a),p=(h-c)*(d-l);if(f<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(a,l),g=Math.min(s,h),_=Math.min(u,d),x=Math.max(g-v,0)*Math.max(_-m,0);return x/(f+p-x)}function Ty(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function Eh(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function Nf(r,e,t){var n=new Array(r.rank).fill(0),o=r.shape.slice();return e.map(function(i){o[t]=i;var a=r.slice(n,o);return n[t]+=i,a})}function Df(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];var o=pe(t,r.dtype);for(n=0;n<o.values.length;++n){for(var i=o.indexToLoc(n),a=new Array(r.rank),s=0;s<a.length;s++)a[s]=i[s]%r.shape[s];var u=r.locToIndex(a);o.values[n]=r.values[u]}return o.toTensor()}function Of(r,e,t,n,o){for(var i=e[e.length-1],a=[r.length/i,i],s=a[0],u=a[1],c=yi(t,s*n),l=yi("int32",s*n),h=0;h<s;h++){for(var d=h*u,f=r.subarray(d,d+u),p=[],v=0;v<f.length;v++)p.push({value:f[v],index:v});p.sort(function(b,y){return y.value-b.value});var m=h*n,g=c.subarray(m,m+n),_=l.subarray(m,m+n);for(v=0;v<n;v++)g[v]=p[v].value,_[v]=p[v].index}var x=e.slice();return x[x.length-1]=n,[Ct(c,x,t),Ct(l,x,"int32")]}function Sc(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);var o=pe(r,"int32"),i=pe([t.length,r.length],"int32");for(n=0;n<t.length;n++){var a=o.indexToLoc(t[n]),s=n*r.length;i.values.set(a,s)}return i.toTensor()}var ky=function(r,e){this.outputShape=[],this.outputShape=r,this.variableNames=e.map(function(o,i){return"T"+i});var t=[];this.variableNames.forEach(function(o){t.push("float v"+o+" = get"+o+"AtOutCoords();")});var n=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+n+`;
        setOutput(result);
      }
    `},Ay=function(r,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=e.map(function(o,i){return"T"+i});var t=[];this.variableNames.forEach(function(o){t.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var n=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+n+`;
        setOutput(result);
      }
    `},Iy=function(r,e,t){this.variableNames=["A"];var n=r.windowSize,o=r.batchSize,i=r.inSize,a=Math.ceil(i/n);t||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];var s=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function Ff(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return r+"."+t})}function Wt(r,e){return e===1?[r]:Ff(r,e)}function kt(){var r,e,t,n,o,i,a,s,u,c;return q().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",o="texture",i="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",o="texture2D",i="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Vr(r,e,t){t===void 0&&(t="index");var n=Bn(e);return n.map(function(o,i){return"int "+r[i]+" = "+t+" / "+o+"; "+(i===n.length-1?"int "+r[i+1]+" = "+t+" - "+r[i]+" * "+o:"index -= "+r[i]+" * "+o)+";"}).join("")}function Tc(r){var e=Bn(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var Mf=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Ry(r,e,t,n){var o=[];r.forEach(function(f){var p=ie(f.shapeInfo.logicalShape);f.shapeInfo.isUniform?o.push("uniform float "+f.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+f.name+";"),o.push("uniform int offset"+f.name+";"))});var i,a,s=o.join(`
`),u=r.map(function(f){return function(p,v,m){m===void 0&&(m=!1);var g="";g+=m?Pf(p):lo(p);var _=p.shapeInfo.logicalShape,x=v.logicalShape;return _.length<=x.length&&(g+=m?function(b,y){var w,E=b.name,C=E.charAt(0).toUpperCase()+E.slice(1),T="get"+C+"AtOutCoords",S=b.shapeInfo.logicalShape.length,I=y.logicalShape.length,A=vr(b.shapeInfo.logicalShape,y.logicalShape),F=Be(I),O=I-S,M=["x","y","z","w","u","v"];w=S===0?"":I<2&&A.length>=1?"coords = 0;":A.map(function(Y){return"coords."+M[Y+O]+" = 0;"}).join(`
`);var B="";B=I<2&&S>0?"coords":b.shapeInfo.logicalShape.map(function(Y,te){return"coords."+M[te+O]}).join(", ");var P="return outputValue;",L=ie(b.shapeInfo.logicalShape)===1,W=ie(y.logicalShape)===1;if(S!==1||L||W){if(L&&!W)P=I===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(A.length){var z=S-2,H=S-1;A.indexOf(z)>-1&&A.indexOf(H)>-1?P="return vec4(outputValue.x);":A.indexOf(z)>-1?P="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":A.indexOf(H)>-1&&(P="return vec4(outputValue.xx, outputValue.zz);")}}else P=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+T+`() {
      `+F+` coords = getOutputCoords();
      `+w+`
      vec4 outputValue = get`+C+"("+B+`);
      `+P+`
    }
  `}(p,v):function(b,y){var w=b.name,E=w.charAt(0).toUpperCase()+w.slice(1),C="get"+E+"AtOutCoords",T=y.texShape,S=b.shapeInfo.texShape,I=b.shapeInfo.logicalShape.length,A=y.logicalShape.length;if(!b.shapeInfo.isUniform&&I===A&&b.shapeInfo.flatOffset==null&&vt(S,T))return`
      float `+C+`() {
        return sampleTexture(`+w+`, resultUV);
      }
    `;var F,O=Be(A),M=vr(b.shapeInfo.logicalShape,y.logicalShape),B=A-I,P=["x","y","z","w","u","v"];F=I===0?"":A<2&&M.length>=1?"coords = 0;":M.map(function(W){return"coords."+P[W+B]+" = 0;"}).join(`
`);var L="";return L=A<2&&I>0?"coords":b.shapeInfo.logicalShape.map(function(W,z){return"coords."+P[z+B]}).join(", "),`
    float `+C+`() {
      `+O+` coords = getOutputCoords();
      `+F+`
      return get`+E+"("+L+`);
    }
  `}(p,v)),g}(f,e,n)}).join(`
`),c=e.texShape,l=kt(),h=function(f){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+f.texture2D+`(textureSampler, uv).r;
    }
  `}(l),d=function(f){return f.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+f.varyingFs+` vec2 resultUV;
    `+f.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+f.defineSpecialNaN+`
    `+f.defineSpecialInf+`
    `+f.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Ny+`
    `+Dy+`
    `+Oy+`
  `}(l);return e.isPacked?(i=function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(b,y){var w=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)];return w[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+w[1]+`.0);
      }
    `:w[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+w[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      return 2 * (resTexRC.x * `+w[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(b,y){var w=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)];if(vt(b,y))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+w[0]+", "+w[1]+`));
      }
    `;var E=Math.ceil(b[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));

      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      int r = 2 * (index / `+E+`);
      int c = imod(index, `+E+`) * 2;

      return ivec2(r, c);
    }
  `}(f,p);case 3:return v=f,m=p,g=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],_=Math.ceil(v[2]/2),x=_*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      int b = index / `+x+`;
      index -= b * `+x+`;

      int r = 2 * (index / `+_+`);
      int c = imod(index, `+_+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(b,y){for(var w=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],E=Math.ceil(b[b.length-1]/2),C=E*Math.ceil(b[b.length-2]/2),T=C,S="",I="b, r, c",A=2;A<b.length-1;A++)T*=b[b.length-A-1],S=`
      int b`+A+" = index / "+T+`;
      index -= b`+A+" * "+T+`;
    `+S,I="b"+A+", "+I;return`
    ivec`+b.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      `+S+`

      int b = index / `+C+`;
      index -= b * `+C+`;

      int r = 2 * (index / `+E+`);
      int c = imod(index, `+E+`) * 2;

      return ivec`+b.length+"("+I+`);
    }
  `}(f,p)}var v,m,g,_,x}(e.logicalShape,c),a=function(f){return`
    void setOutput(vec4 val) {
      `+f.output+` = val;
    }
  `}(l)):(i=function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(g,_){return _[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return resTexRC.x * `+_[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(g,_){return vt(g,_)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `:g[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+_[0]+", "+_[1]+`));
        int index = resTexRC.x * `+_[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:g[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+_[0]+", "+_[1]+`));
        int index = resTexRC.x * `+_[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = index / `+g[1]+`;
      int c = index - r * `+g[1]+`;
      return ivec2(r, c);
    }
  `}(f,p);case 3:return v=p,m=Vr(["r","c","d"],f),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+m+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(g,_){var x=Vr(["r","c","d","d2"],g);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      `+x+`
      return ivec4(r, c, d, d2);
    }
  `}(f,p);case 5:return function(g,_){var x=Vr(["r","c","d","d2","d3"],g);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+_[0]+`,
                             `+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+x+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(f,p);case 6:return function(g,_){var x=Vr(["r","c","d","d2","d3","d4"],g);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+x+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(f,p);default:throw new Error(f.length+"-D output sampling is not yet supported")}var v,m}(e.logicalShape,c),a=function(f){return`
    void setOutput(float val) {
      `+f.output+` = vec4(val, 0, 0, 0);
    }
  `}(l)),n&&(d+=Fy),[d,h,a,s,i,u,t].join(`
`)}function lo(r){var e=r.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return"float "+o+"() {return "+n+";}";var i=t.shapeInfo.texShape,a=i[0],s=i[1];if(a===1&&s===1)return`
      float `+o+`() {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,c=u[0],l=u[1],h=Mr(n);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+c+", "+l+", "+h+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 1:return function(t){var n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+ao(t)+`
      }
    `;var i=t.shapeInfo.texShape,a=i[0],s=i[1];if(s===1&&a===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var u=Mr(n);return s===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:a===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 2:return function(t){var n=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=t.shapeInfo.texShape;if(a!=null&&vt(n,a)){var s=a[0],u=a[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var c=Wr(n),l=c.newShape,h=c.keptDims,d=l;if(d.length<n.length){var f=ho(t,d);return`
      `+lo(f)+`
      float `+i+`(int row, int col) {
        return `+i+"("+fo(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+n[1]+`, 1)));
        `+ao(t)+`
      }
    `;var p=a[0],v=a[1],m=Mr(o);return v===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:p===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+n[1]+" + col + "+m+`;
    vec2 uv = uvFromFlat(`+p+", "+v+`, index);
    return sampleTexture(`+o+`, uv);
  }
`}(r);case 3:return function(t){var n=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=n[1]*n[2],s=n[2],u=Wr(n),c=u.newShape,l=u.keptDims,h=c;if(h.length<n.length){var d=ho(t,h);return`
        `+lo(d)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+fo(["row","col","depth"],l)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+ao(t)+`
      }
    `;var f=t.shapeInfo.texShape,p=f[0],v=f[1],m=t.shapeInfo.flatOffset;if(v===a&&m==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+p+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(v===s&&m==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+n[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var g=Mr(o);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+p+", "+v+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `}(r);case 4:return function(t){var n=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=n[3],s=n[2]*a,u=n[1]*s,c=Wr(n),l=c.newShape,h=c.keptDims;if(l.length<n.length){var d=ho(t,l);return`
      `+lo(d)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+fo(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+ao(t)+`
      }
    `;var f=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,v=p[0],m=p[1];if(m===u&&f==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(m===a&&f==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n[1]*n[2]+", "+n[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var g=Mr(o);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+m+", index + "+g+`);
      return sampleTexture(`+o+`, uv);
    }
  `}(r);case 5:return function(t){var n=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=n[4],s=n[3]*a,u=n[2]*s,c=n[1]*u,l=Wr(n),h=l.newShape,d=l.keptDims;if(h.length<n.length){var f=ho(t,h);return`
      `+lo(f)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+fo(["row","col","depth","depth2","depth3"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+c+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+ao(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,m=v[0],g=v[1];if(g===c&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(g===a&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]+`,
               `+n[2]*n[3]+", "+n[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var _=Mr(o);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+_+`;
      vec2 uv = uvFromFlat(`+m+", "+g+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(r);case 6:return function(t){var n=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=Wr(n),s=a.newShape,u=a.keptDims;if(s.length<n.length){var c=ho(t,s);return`
      `+lo(c)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+fo(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var l=n[5],h=n[4]*l,d=n[3]*h,f=n[2]*d,p=n[1]*f;if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+f+", "+d+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+ao(t)+`
      }
    `;var v=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,g=m[0],_=m[1];if(_===p&&v==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+f+", "+d+", "+h+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+_+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(_===l&&v==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]*n[4]+`,
               `+n[2]*n[3]*n[4]+`,
               `+n[3]*n[4]+`,
               `+n[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+_+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var x=Mr(o);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+f+" + depth * "+d+` +
          depth2 * `+h+" + depth3 * "+l+" + depth4 + "+x+`;
      vec2 uv = uvFromFlat(`+g+", "+_+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(r);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function Pf(r){var e,t,n;switch(r.shapeInfo.logicalShape.length){case 0:return e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=kt(),`
    vec4 `+t+`() {
      return `+n.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(o){var i=o.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=kt();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+c.texture2D+"("+i+`, uv);
    }
  `}(r);case 2:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=u[0],l=u[1],h=kt();if(u!=null&&vt(i,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+c+`.0);

        return `+h.texture2D+"("+a+`, uv);
      }
    `;var d=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],f=Math.ceil(i[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+f+", "+d[0]+", "+d[1]+`, row, col);
      return `+h.texture2D+"("+a+`, uv);
    }
  `}(r);case 3:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(i[0]===1){var l=i.slice(1),h=ho(o,l);return`
        `+Pf(h)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+fo(["b","row","col"],[1,2])+`);
        }
      `}var d=c[0],f=c[1],p=Math.ceil(i[2]/2),v=p*Math.ceil(i[1]/2),m=kt();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+d+", "+f+", "+v+", "+p+`, b, row, col);
      return `+m.texture2D+"("+a+`, uv);
    }
  `}(r);default:return function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],h=l[0],d=l[1],f=Math.ceil(i[a-1]/2),p=f*Math.ceil(i[a-2]/2),v="int b, int row, int col",m="b * "+p+" + (row / 2) * "+f+" + (col / 2)",g=2;g<a-1;g++)v="int b"+g+", "+v,p*=i[a-g-1],m="b"+g+" * "+p+" + "+m;var _=kt();return`
    vec4 `+u+"("+v+`) {
      int index = `+m+`;
      int texR = index / `+d+`;
      int texC = index - texR * `+d+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+d+", "+h+`);
      return `+_.texture2D+"("+s+`, uv);
    }
  `}(r)}}var Ny=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Dy=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Oy=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Fy=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Mr(r){return"offset"+r}function ao(r){var e=r.name,t=ie(r.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Be(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function ho(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function fo(r,e){return e.map(function(t){return r[t]}).join(", ")}var My=function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,R(r.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var o=r[r.length-1],i=Math.ceil(o/e);this.outputShape=r.slice(0,-1),i>1&&this.outputShape.push(i),n||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=Be(c),h=Wt("coords",c);if(i===1){var d=Be(s=c+1);a=`
        `+d+" sourceLocR = "+d+"("+h.join()+`, 0);
        ++`+h[c-1]+`;
        `+d+" sourceLocG = "+d+"("+h.join()+`, 0);
        ++`+h[c-2]+`;
        `+d+" sourceLocA = "+d+"("+h.join()+`, 0);
        --`+h[c-1]+`;
        `+d+" sourceLocB = "+d+"("+h.join()+`, 0);
        --`+h[c-2]+";"}else s=c,a=`
        `+l+` sourceLocR = coords;
        ++`+h[c-1]+`;
        `+l+` sourceLocG = coords;
        ++`+h[c-2]+`;
        `+l+` sourceLocA = coords;
        --`+h[c-1]+`;
        `+l+` sourceLocB = coords;
        --`+h[c-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),p="."+f[s-1],v=f.map(function(C){return"int "+C}),m=Wt("sourceLocR",s-1).concat("inIdx.r"),g=Wt("sourceLocG",s-1).concat("inIdx.g"),_=Wt("sourceLocB",s-1).concat("inIdx.b"),x=Wt("sourceLocA",s-1).concat("inIdx.a"),b=t==="max"?"greaterThan":"lessThan",y=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+_.join()+`),
                             getBestIndicesAChannel(`+x.join()+")));",w=`vec4(
            getAChannel(`+m.join()+`),
            hasNextCol ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow ? getAChannel(`+_.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+x.join()+") : 0.)",E=n?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+f.join()+`),
                                          vec2(`+f.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+f.join()+`),
                               vec2(`+f.slice(-2).join()+`));
      }
      `+E+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+h[c-1]+" < "+(u[c-1]-1)+`;
        bool hasNextRow = `+h[c-2]+" < "+(u[c-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+w+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+y+`
          vec4 candidate = `+w+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+b+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},Py=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,o=r.strideWidth,i=r.dilationHeight,a=r.dilationWidth,s=r.effectiveFilterHeight,u=r.effectiveFilterWidth,c=s-1-r.padInfo.top,l=u-1-r.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+l+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},By=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,o=r.strideDepth,i=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterDepth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=l-1-r.padInfo.front,p=h-1-r.padInfo.top,v=d-1-r.padInfo.left,m=1/(e*t*n);this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+p+", "+v+`);
      const float avgMultiplier = float(`+m+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+d+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Ly=function(r,e,t,n,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],xe(r,e),xe(r,t);var a="0.0";n!=null&&(xe(r,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";o!=null&&(xe(r,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},Wy=function(r,e,t,n,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],xe(r,e),xe(r,t);var a="vec4(0.0)";n!=null&&(xe(r,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";o!=null&&(xe(r,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},Vy="return areal * breal - aimag * bimag;",Uy="return areal * bimag + aimag * breal;",Sh=function(r,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=xe(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},su="return a + b;",uu="return a - b;",Th="return a * b;",Bf="return (a < 0.) ? b * a : a;",$e=function(r,e,t){this.variableNames=["A","B"],this.outputShape=xe(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},Lf=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Yn=function(r,e,t,n){n===void 0&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=xe(e,t);var o=this.outputShape.length,i="";if(n)if(o===0||ie(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+Be(o)+` coords = getOutputCoords();
        `,o===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=Wt("coords",o);i+=`
            bool nextRowOutOfBounds =
              (`+a[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+a[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},zy=function(){function r(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(o,i){n.minLoc==null&&(n.minLoc=o.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(n.minLoc,e),o.gl.uniform1f(n.maxLoc,t)}},r}(),Gy=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(o,i){n.minLoc==null&&(n.minLoc=o.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(n.minLoc,e),o.gl.uniform1f(n.maxLoc,t)}},r}(),qy=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},Hy=function(r){this.outputShape=[],this.outputShape=Fo(r,1),this.variableNames=r.map(function(s,u){return"T"+u});var e=new Array(r.length-1);e[0]=r[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+r[t][1];var n=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var o=e[t-1];n.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+o+"));")}var i=e.length,a=e[e.length-1];n.push("else setOutput(getT"+i+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `},jy=function(r,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Fo(r,e);var t=this.outputShape,n=t.length,o=Be(n),i=Wt("coords",n),a=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map(function(m,g){return"T"+g});var s=new Array(r.length-1);s[0]=r[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+r[u][e];var c=a[e],l=a.slice(-2),h=a.join(),d="if ("+c+" < "+s[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+l.join()+`));
        }`;for(u=1;u<s.length;u++){var f=s[u-1];d+=`
        if (`+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+aa(a,c,f)+`),
            vec2(`+aa(l,c,f)+`));
        }`}var p=s.length,v=s[s.length-1];d+=`
        return getChannel(
          getT`+p+"("+aa(a,c,v)+`),
          vec2(`+aa(l,c,v)+"));",this.userCode=`
      float getValue(`+a.map(function(m){return"int "+m})+`) {
        `+d+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[n-1]+" = "+i[n-1]+` + 1;
        if (`+i[n-1]+" < "+t[n-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[n-2]+" = "+i[n-2]+` + 1;
        if (`+i[n-2]+" < "+t[n-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[n-1]+" = "+i[n-1]+` - 1;
        if (`+i[n-2]+" < "+t[n-2]+` &&
            `+i[n-1]+" < "+t[n-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function aa(r,e,t){var n=r.indexOf(e);return r.map(function(o,i){return i===n?o+" - "+t:o}).join()}var Xy=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,o=r.padInfo.left,i=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+o+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Ky=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,o=r.strideWidth,i=r.dataFormat==="channelsLast",a=e-1-r.padInfo.top,s=t-1-r.padInfo.left,u=i?1:2,c=i?2:3,l=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+l+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},$y=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,o=r.padInfo.front,i=r.padInfo.top,a=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+o+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+i+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+a+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Yy=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,o=r.strideDepth,i=r.strideHeight,a=r.strideWidth,s=e-1-r.padInfo.front,u=t-1-r.padInfo.top,c=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Zy=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,o=r.padInfo.left,i=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+o+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},Jy=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,o=r.strideWidth,i=e-1-r.padInfo.top,a=t-1-r.padInfo.left,s=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},kh=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var o=r.padInfo.top,i=r.padInfo.left,a=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,l=r.filterHeight,h=r.filterWidth,d=4*Math.floor(r.inChannels/4),f=r.inChannels%4,p=r.dataFormat==="channelsLast",v=p?1:2,m=p?2:3,g=p?3:1,_="",x="";t&&(_=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,x="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+_+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+g+`];

        ivec2 xRCCorner =
            ivec2(coords[`+v+"], coords["+m+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+c+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+d+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(f===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+d+`) *
                    getW(wR, wC, `+d+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+d+`, xR, xC) *
                    getW(wR, wC, `+d+`, d2);
              }

            } else if (`+(f===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(f===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2),
                getW(wR, wC, `+d+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1),
                  getX(batch, xR, xC, `+d+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC),
                  getX(batch, `+d+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+b+`
        `+x+`
        setOutput(result);
      }
    `},Qy=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var e=r.padInfo.front,t=r.padInfo.top,n=r.padInfo.left,o=r.strideDepth,i=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,l=r.filterDepth,h=r.filterHeight,d=r.filterWidth,f=4*Math.floor(r.inChannels/4),p=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+l+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+d+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+f+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+f+`) *
                  getW(wF, wR, wC, `+f+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1),
                  getX(batch, xF, xR, xC, `+f+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2),
                  getW(wF, wR, wC, `+f+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Ah=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var o=r.inHeight,i=r.inWidth,a=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,c=r.strideWidth,l=r.dilationHeight,h=r.dilationWidth,d=r.filterHeight,f=r.filterWidth,p=r.outChannels/r.inChannels,v="",m="";t&&(v=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,m="result = activation(result);");var g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+g+`
        `+m+`
        setOutput(result);
      }
    `},Ih=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var o=r.inHeight,i=r.inWidth,a=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,c=r.strideWidth,l=r.dilationHeight,h=r.dilationWidth,d=r.filterHeight,f=r.filterWidth,p=f,v="int xR; int xC; int xCOffset;",m=0;m<d;m++)for(var g=0;g<f;g++)v+=`
          vec4 xTexelR`+m+"C"+2*g+` = vec4(0.);
          vec4 wR`+m+"C"+g+` = vec4(0.);
          vec4 xR`+m+"C"+g+" = vec4(0.);";for(m=0;m<d;m++)for(var _=0;_<p;_++){if(v+=`
          xR = xRCorner + `+m*l+`;
          xC = xCCorner + `+(g=2*_)*h+`;
        `,c===1){if(g<f&&(v+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+m+"C"+g+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+`.xy);
                } else {
                  xR`+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xR`+m+"C"+g+" = xTexelR"+m+"C"+g+`;
              `,g+1<f)){var x=s%2==0?tf(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(v+=`
                  xCOffset = xC + `+s%2+" + "+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+m+"C"+g+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+`;
                `}}else g<f&&(v+=`
              if(xR >= 0 && xR < `+o+`) {
            `,s%2==1?(v+=`
                xCOffset = xC + 1 - `+c+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
              `,g+1<f&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+c+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+c+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+`.xy);
              `,g+1<f&&(v+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
                `)),v+="}");g<f&&(v+=`
            vec4 wTexelR`+m+"C"+g+" = getW("+m+", "+g+`, d1, q);
            wR`+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+`.xz);
          `,g+1<f&&(v+=`
              vec4 wTexelR`+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+`, d1, q);
              wR`+m+"C"+(g+1)+` =
                vec4(wTexelR`+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<d;m++)for(g=0;g<f;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var b="",y="";t&&(b=n?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,y="result = activation(result);");var w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+v+`

        vec4 result = dotProd;
        `+w+`
        `+y+`
        setOutput(result);
      }
    `},e0=function(r,e,t,n,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=r[0],a=r[1],s=r[2],u=r[3],c=e[0],l=t[0],h=t[1];this.outputShape=[c,l,h,u];var d=n==="bilinear"?1:0,f=[a-1+".0",s-1+".0"],p=f[0],v=f[1],m=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=m[0],_=m[1],x=m[2],b=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],y=b[0],w=b[1],E=b[2];this.userCode=`
      const float height_ratio = float(`+g+`);
      const float width_ratio = float(`+y+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+_+`;
        float width_scale = `+w+`;

        float in_y = `+x+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+E+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+d+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},t0=function(r,e,t){this.variableNames=["x"],this.outputShape=r;var n=r.length,o=r[r.length-1],i=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Be(n)+` coords = getOutputCoords();
        int end = `+Rh(n,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+Rh(n,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(n,"coords")+`);
        }
        setOutput(val);
      }
    `};function Rh(r,e){if(r===1)return""+e;if(r===2)return e+".y";if(r===3)return e+".z";if(r===4)return e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var n0=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=bi.DENSE;var e=li(r),t=kt();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Vr(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},r0=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=bi.DENSE;var e=li(r),t=kt();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Vr(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},o0=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}(),i0=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},a0=function(r){this.variableNames=["A"],this.outTexUsage=$t.DOWNLOAD;var e=kt();this.outputShape=r,this.userCode=`
      `+Mf+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},s0=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=$t.DOWNLOAD;var e=kt();this.outputShape=r,this.userCode=`
      `+Mf+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},u0=function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var n=kt(),o=e[0],i=e[1];this.outputShape=r;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Tc(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},c0=function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=kt(),o=e[0],i=e[1];this.outputShape=r;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+=`
          localCoords = coords;
          if(localCoords[2] + `+c+" < "+r[2]+`) {
            localCoords[2] += `+c+`;
            if(localCoords[1] + `+u+" < "+r[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
              values = `+n.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+l+`] = values[0];
              } else if(offset == 1) {
                result[`+l+`] = values[1];
              } else if(offset == 2) {
                result[`+l+`] = values[2];
              } else {
                result[`+l+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Tc(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+n.output+" = "+s+`;
      }
    `},l0="return real * expR - imag * expI;",h0="return real * expI + imag * expR;",Nh=function(r,e,t){this.variableNames=["real","imag"];var n=e[1];this.outputShape=e;var o=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=t?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},d0=function(){function r(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,o){t.valueLoc==null&&(t.valueLoc=n.getUniformLocationNoThrow(o,"value")),n.gl.uniform1f(t.valueLoc,e)}},r}(),f0=function(r,e,t){this.variableNames=["A","indices"];var n=r.slice();n[t]=e,this.outputShape=n,this.rank=n.length;var o=Be(this.rank),i=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],h=0;h<a.length;h++)h===s?l.push("int(getIndices("+c[h]+"))"):l.push(""+c[h]);return l.join()}(r,t);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},p0=function(r,e,t){this.sliceDim=r,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var n=Be(e.length),o=Be(t.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function v0(r,e){var t=kt();return lg(r,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function m0(r,e){return vg(r,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function g0(r,e){return mg(r,e,new Uint16Array([0,1,2,2,1,3]))}function Bi(r,e,t,n,o,i,a){yg(t,n);var s=gg(r,e),u=r.TEXTURE_2D;return ae(r,e,function(){return r.bindTexture(u,s)}),ae(r,e,function(){return r.texParameteri(u,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),ae(r,e,function(){return r.texParameteri(u,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),ae(r,e,function(){return r.texParameteri(u,r.TEXTURE_MIN_FILTER,r.NEAREST)}),ae(r,e,function(){return r.texParameteri(u,r.TEXTURE_MAG_FILTER,r.NEAREST)}),ae(r,e,function(){return r.texImage2D(u,0,o,t,n,0,i,a,null)}),ae(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)}),s}function y0(r,e,t,n,o){var i=hs(t,n);return Bi(r,e,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,r.FLOAT)}function _0(r,e,t,n,o){var i=hs(t,n);return Bi(r,e,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function b0(r,e,t,n,o){var i=hs(t,n);return Bi(r,e,i[0],i[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function x0(r,e,t,n,o){var i=Pi(t,n);return Bi(r,e,i[0],i[1],o.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function w0(r,e,t,n,o){var i=Pi(t,n);return Bi(r,e,i[0],i[1],o.internalFormatPackedHalfFloat,r.RGBA,o.textureTypeHalfFloat)}function C0(r,e,t,n){return ae(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),yh(r,e,t,"clipSpacePos",n,3,20,0)&&yh(r,e,t,"uv",n,2,20,12)}function E0(r,e,t,n,o,i,a){var s,u,c;ae(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),i instanceof Uint8Array?(s=new Uint8Array(n*o*4),u=r.UNSIGNED_BYTE,c=r.RGBA):(s=new Float32Array(n*o*4),u=r.FLOAT,c=a.internalFormatPackedFloat),s.set(i),ae(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,c,n,o,0,r.RGBA,u,s)}),ae(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function S0(r,e,t,n){ae(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),n.data instanceof Uint8Array?ae(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)}):ae(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)}),ae(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function T0(r,e,t,n,o){var i=r.createBuffer();ae(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,i)});var a=16*t*n;return ae(r,e,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,a,r.STREAM_READ)}),ae(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,0)}),ae(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),i}function k0(r,e,t){var n=r,o=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,o),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),o}function A0(r,e,t,n,o){var i=hs(t,n),a=i[0],s=i[1],u=new Uint8Array(t*n*4);return ae(r,e,function(){return r.readPixels(0,0,a,s,o.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function I0(r,e,t,n,o,i,a,s){var u=r,c=new Float32Array(function(l,h){var d=Pi(l,h);return d[0]*d[1]*4}(i,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function R0(r,e,t,n){var o=new Float32Array(t*n*4);return ae(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,o)}),o}var N0=function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=q().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,ig(t,e)):this.gl=Gn(t);var n="WEBGL_color_buffer_float";if(q().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=na(this.gl,this.debug,"OES_texture_float"),rn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=na(this.gl,this.debug,"OES_texture_half_float");else if(q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),rn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=na(this.gl,this.debug,"EXT_color_buffer_half_float");else if(q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",rn(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!rn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=m0(this.gl,this.debug),this.indexBuffer=g0(this.gl,this.debug),this.framebuffer=_g(this.gl,this.debug),this.textureConfig=mc(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return q().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;ae(t,this.debug,function(){return t.finish()}),ae(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),ae(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),ae(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),ae(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),ae(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),y0(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),_0(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),b0(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),S0(this.gl,this.debug,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,o){this.throwIfDisposed(),E0(this.gl,this.debug,e,t,n,o,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),w0(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),x0(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(_h(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ae(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var o=this;return this.downloadMatrixDriver(e,function(){return A0(o.gl,o.debug,t,n,o.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,o,i,a){return I0(this.gl,e,0,0,0,i,a,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return k0(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var o=T0(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t,n,o=this;if(q().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},t=a}else q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return o.isQueryAvailable(t,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var o=this;return this.downloadMatrixDriver(e,function(){return R0(o.gl,o.debug,t,n)})},r.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=hg(t,this.debug,e),o=v0(t,this.debug),i=fg(t,this.debug);return ae(t,this.debug,function(){return t.attachShader(i,o)}),ae(t,this.debug,function(){return t.attachShader(i,n)}),pg(t,this.debug,i),this.debug&&ru(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=C0(t,this.debug,this.program,this.vertexBuffer)),i},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&ae(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&ru(this.gl,this.debug,this.program),ae(this.gl,this.debug,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?xg(this.gl,this.debug,e,t):wg(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),ae(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),Cg(this.gl,this.debug,this.program,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var o=Pi(t,n),i=o[0],a=o[1];this.setOutputMatrixTextureDriver(e,i,a)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,o){this.setOutputMatrixWriteRegionDriver(n,e,o,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&ru(this.gl,this.debug,this.program),ra(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),ae(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),ae(this.gl,this.debug,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=na(this.gl,this.debug,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},r.prototype.endQuery=function(){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(e){return ne(this,void 0,void 0,function(){var t=this;return re(this,function(n){switch(n.label){case 0:return[4,dh(function(){return t.disposed||t.isQueryAvailable(e,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(e,o.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=function(n){for(var o=0;o<n.length&&n[o]();++o);return o-1}(this.itemsToPoll.map(function(n){return n.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||dh(function(){return n.pollItems(),n.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),ou(this.gl,this.debug,e,this.framebuffer),this.debug&&ra(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(ou(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ra(this.gl)):_h(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var o=this.gl;ou(o,this.debug,e,this.framebuffer),this.debug&&ra(o),this.outputTexture=e,ae(o,this.debug,function(){return o.viewport(0,0,t,n)}),ae(o,this.debug,function(){return o.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,o){var i=this;this.throwIfDisposed(),ae(this.gl,this.debug,function(){return i.gl.scissor(e,t,n,o)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function Dh(r,e){if(r.length!==e.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+e.length+" inputs");r.forEach(function(t,n){var o=t.logicalShape,i=e[n],a=i.shape;if(!vt(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!t.isUniform||!i.isUniform){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!vt(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var D0=function(r,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var n=t.filterWidth,o=t.inChannels,i=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,c=t.dilationWidth,l=t.dilationHeight,h=t.dataFormat,d=s.left,f=s.top,p=o*n,v=kt(),m=h==="channelsLast",g=m?0:1,_=m?1:2,x="",b=0;b<=1;b++)for(var y=0;y<=1;y++)x+=`
          blockIndex = rc.y + `+y+`;
          pos = rc.x + `+b+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+f+`;
            d0 = offsetY + `+l+" * (pos / "+p+`);

            if(d0 < `+e[g]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+i+". - "+d+`.);
              d1 = offsetX + `+c+" * (int(mod(float(pos), "+p+".) / "+o+`.));

              if(d1 < `+e[_]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+m+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*b+y)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*b+y)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+x+`

        `+v.output+` = result;
      }
    `},O0=function(r,e,t,n,o){this.variableNames=["x"],this.outputShape=[];var i,a=e,s=r[3]-1;this.outputShape=r;var u="float("+t+") + float("+n+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},F0=function(r,e,t,n,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=e,this.bias=t,this.alpha=n,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},M0=function(r,e,t,n,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,a=e,s=r[3]-1;this.outputShape=r;var u="float("+t+") + float("+n+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},P0=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideHeight,t=r.strideWidth,n=r.dilationHeight,o=r.effectiveFilterHeight,i=r.effectiveFilterWidth,a=o-1-r.padInfo.top,s=i-1-r.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},B0=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,o=r.dilationDepth,i=r.dilationHeight,a=r.dilationWidth,s=r.effectiveFilterDepth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,l=s-1-r.padInfo.front,h=u-1-r.padInfo.top,d=c-1-r.padInfo.left,f=s*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+h+", "+d+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+n+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+f+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},cu=function(r,e,t,n,o,i,a){t===void 0&&(t=!1),n===void 0&&(n=!1),o===void 0&&(o=!1),i===void 0&&(i=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=t?r[1]:r[2],u=Math.ceil(s/2),c=t?"i * 2, rc.y":"rc.y, i * 2",l=n?"rc.z, i * 2":"i * 2, rc.z",h=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";i&&(f=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,p="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+f+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+c+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+d[0]+`);
          result += (`+h[1]+" * "+d[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+v+`

        `+p+`

        setOutput(result);
      }
    `},L0=function(){function r(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,o){t.seedLoc==null&&(t.seedLoc=n.getUniformLocation(o,"seed")),n.gl.uniform1f(t.seedLoc,e)}},r}(),W0=function(r,e,t,n){this.variableNames=["indices"],this.outputShape=[r,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},V0=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var e=r.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Wt("rc",e),n=Be(e),o=function(s,u,c){if(s===1)return"rc > "+u[0];for(var l="",h=s-2;h<s;h++)l+=c[h]+" >= "+u[h],h<s-1&&(l+="||");return l}(e,r,t),i=function(s,u,c,l){if(s===1)return"";var h=l.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+c+`;
  `}(e,r[r.length-1],r[r.length-2],t),a=function(s,u){var c=s.length,l=function(h,d){for(var f=[],p=0;p<=1;p++)for(var v=0;v<=1;v++){for(var m=(p===0?"r":"rp1")+", "+(v===0?"c":"cp1"),g=2;g<h;g++)m=d[d.length-1-g]+","+m;f.push(m)}return f}(c,u);return c===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+l[0]+`),
          cEdge ? 0. : getA(`+l[1]+`),
          rEdge ? 0. : getA(`+l[2]+`),
          rEdge || cEdge ? 0. : getA(`+l[3]+")"}(r,t);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},U0=function(r,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,c){return u[0]+r[c]+u[1]});var n=r.length,o=Be(n),i=e.map(function(u){return u[0]}).join(","),a=e.map(function(u,c){return u[0]+r[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+o+" start = "+o+"("+i+`);
      `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},z0=function(r,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(m,g){return m[0]+r[g]+m[1]});for(var n=r.length,o=Be(n),i=e.map(function(m){return m[0]}).join(","),a=e.map(function(m,g){return m[0]+r[g]}).join(","),s=Wt("rc",n),u=Wt("source",n),c=s[n-1]+" < "+this.outputShape[n-1],l=n===1?"source":"vec2("+u.slice(-2).join()+")",h=[o+" rc = outputLoc;",s[n-1]+` += 1;
       if(`+c+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+s[n-2]+` += 1;
       if(`+s[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+s[n-1]+` += 1;
         if(`+c+") {"],d=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,v=n===1?2:4;p<v;p++)f+=`
        `+h[p]+`
        if (`+d+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+o+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+l+`);
        }
      `;f+=n===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+i+`);
      const `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+f+`
        setOutput(result);
      }
    `},lu=function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,o=r.strideHeight,i=r.strideWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,l=r.padInfo.top,h=r.padInfo.left;this.outputShape=r.outShape;var d=e==="avg",f="0.0";if(d||(f="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+i+`);
        const ivec2 pads = ivec2(`+l+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+c+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+c+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(p="avgValue / count");var v=4*Math.floor(n/4),m=n%4,g=`
      if (`+d+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+l+", "+h+`);
      const float initializationValue = `+f+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+f+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+g+`
          }

          int xC = xCCorner + `+v+`;
          if (`+(m===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(m===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(m===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+g+`
          }
        }
        setOutput(`+p+`);
      }
    `}},hu=function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,o=r.strideDepth,i=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterDepth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.front,p=r.padInfo.top,v=r.padInfo.left;this.outputShape=r.outShape;var m=e==="avg",g="0.0";if(m||(g="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+i+", "+a+`);
        const ivec3 pads = ivec3(`+f+", "+p+", "+v+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+l+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+h+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+d+`;
                  wC += `+c+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+h+" * "+d+` +
                      wR * `+d+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var _=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(_="avgValue / count");var x=4*Math.floor(n/4),b=n%4,y=`
      if (`+m+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+f+", "+p+", "+v+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC += 4) {
              int xC = xCCorner + wC * `+c+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+c+`, ch)
              );

              `+y+`
            }

            int xC = xCCorner + `+x+`;
            if (`+(b===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+y+`
            } else if (`+(b===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                initializationValue,
                initializationValue
              );

              `+y+`
            } else if (`+(b===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                initializationValue
              );

              `+y+`
            }
          }
          setOutput(`+_+`);
        }
      }
    `}},G0=function(r,e){this.variableNames=["x"];var t=r.windowSize,n=r.batchSize,o=r.inSize,i=Math.ceil(o/t);this.outputShape=[n,i];var a="0.0",s="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",s="min"):e==="max"&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var c=4*Math.floor(t/4),l=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,d="vec4";e==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):e==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var f="";o%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(l===1)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(l===2)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(l===3)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `},q0=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var t="",n=0;n<4;n++){var o="thisRC = rc;";n%2==1&&(o+="thisRC.z += 1;"),n>1&&(o+="thisRC.y += 1;"),t+=`
        `+o+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Vr(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Tc(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+t+`

        setOutput(result);
      }
    `},H0=function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,o=n[1],i=n[2],a=r.shape,s=a[1],u=a[2],c=[t&&s>1?o-1:o,t&&u>1?i-1:i],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],f=1/h,p=1/d,v=2*Math.ceil(f)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},j0=function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var o=r[0],i=r[1],a=r[2],s=r[3];this.outputShape=[o,e,t,s];var u=[n&&e>1?i-1:i,n&&t>1?a-1:a],c=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},X0=function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=r[0],i=r[1],a=r[2],s=r[3];this.outputShape=[o,e,t,s];var u=[n&&e>1?i-1:i,n&&t>1?a-1:a],c=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`,
          `+u[1]/c[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},K0=function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,o=n[1],i=n[2],a=r.shape,s=a[1],u=a[2],c=[t&&s>1?o-1:o,t&&u>1?i-1:i],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],f=1/h,p=1/d,v=2*Math.ceil(f)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+l[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+l[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},$0=function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var o=r[0],i=r[1],a=r[2],s=r[3];this.outputShape=[o,e,t,s];var u=[n&&e>1?i-1:i,n&&t>1?a-1:a],c=[n&&e>1?e-1:e,n&&t>1?t-1:t],l=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+l+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},Y0=function(r,e){this.variableNames=["x"];var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=r,t!==1){var n=r.map(function(i,a){return function(s){return e.indexOf(s)!==-1&&r[s]!==1?r[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),o=Be(t);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `},Z0=function(r,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=r;var n=Wt("rc",t),o=n[t-1]+" + 1 < "+this.outputShape[t-1],i=n[t-2]+" + 1 < "+this.outputShape[t-2],a=Be(t);function s(u){var c=r.map(function(l,h){return function(d,f){return e.indexOf(d)!==-1&&r[d]!==1?r[d]+" - "+f[d]+" - 1":""+f[d]}(h,u)});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(n.slice())+`;
          if(`+o+`){
            result.g = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)}(n.slice())+`;
          }
          if(`+i+`) {
            result.b = `+function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)}(n.slice())+`;
            if(`+o+`) {
              result.a = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)}(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `},Oh=function(r,e,t,n,o,i,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Be(o.length),u=Be(i.length),c="";t===1?c="i":t===2&&(c="i, j");var l="getIndices("+c+")",h="";n===1?h="i":n===2&&(h="i, coords[1]");var d="getUpdates("+h+")",f=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+o+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+l+`);
              flattenedIndex += index * `+f+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+d+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},J0=function(r,e){this.variableNames=["x","segmentIds"];var t=r.windowSize,n=r.batchSize,o=r.inSize,i=r.numSegments,a=i*Math.ceil(o/t);this.outputShape=[n,a];var s=4*Math.floor(t/4),u=t%4,c=`
        sumValue += dot(values, segFilter);
    `,l="";o%t>0&&(l=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var h="";o%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+l+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+c+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+c+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+c+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+c+`
        }
        setOutput(sumValue);
      }
    `},Q0=function(r,e,t){var n,o;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)o="resRC",n="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+i[u]),u<r&&a.push(""+i[u]);n=a.join(),o=s.join()}var c=Be(t);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},e_=function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=Be(this.rank),o="uniform int start["+this.rank+"];",i=function(a){if(a===1)return"sourceLoc";if(a<=6)return du.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);t=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+e.map(function(a,s){return"sourceLoc."+du[s]+" = start["+s+"] + coords."+du[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+t+`
        setOutput(getSource(`+i+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,o){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(o,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r}(),du=["x","y","z","w","u","v"],t_=function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Be(this.rank),n=Wt("coords",this.rank),o=Wt("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s=`
      result.x = `+a+`;
      if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+a+`;
        --`+o[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(l,h){return"start["+h+"]"}).join()+");":e.map(function(l,h){return o[h]+" = "+n[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+c+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,o){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(o,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r}(),n_=function(r,e,t){this.variableNames=["x"],this.outputShape=t;var n=t.length,o=Be(t.length),i=Be(t.length),a="";if(n===1)a="coords * strides + begin";else{var s=0;a=t.map(function(u,c){return s++,t.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+r+`);
      `+o+" strides = "+o+"("+e+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},r_=function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(e,t,n){var o,i=Fh(t,n),a=Mh(e,i,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===Xt.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===Xt.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===Xt.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===Xt.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===Xt.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(o),o},r.prototype.releaseTexture=function(e,t,n,o){if(this.freeTextures!=null){var i=Mh(t,Fh(n,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(o){e.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r}();function Fh(r,e){if(r===$t.UPLOAD)return Xt.PACKED_2X2_FLOAT32;if(r===$t.RENDER||r==null)return function(t){return q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Xt.PACKED_2X2_FLOAT32:Xt.UNPACKED_FLOAT32:t?Xt.PACKED_2X2_FLOAT16:Xt.UNPACKED_FLOAT16}(e);if(r===$t.DOWNLOAD||r===$t.PIXELS)return Xt.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function Mh(r,e,t){return r[0]+"_"+r[1]+"_"+e+"_"+t}var o_=function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[n]*e[n];this.outputShape=t,this.rank=t.length;var o=Be(this.rank),i=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<a.length;l++)c.push("imod("+u[l]+", "+a[l]+")");return c.join()}(r);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},i_=function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];this.outputShape=t,this.rank=t.length;var o=Be(this.rank),i=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<a.length;l++)c[a[l]]=u[l];return c.join()}(e);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},a_=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Be(this.rank),i=Ff("rc",this.rank),a=new Array(this.rank);for(n=0;n<e.length;n++)a[e[n]]=i[n];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+t[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+u+`) {
        result[1] = `+c+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+u+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `},kc=1.7580993408473768,Ac=1.0507009873554805,ge=function(r,e){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},bn="if (isnan(x)) return x;",s_="return x;",Ph="return abs(x);",Wf=bn+`
  return (x < 0.0) ? 0.0 : x;
`,Vf=bn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Uf="return (x >= 0.0) ? x : (exp(x) - 1.0);",u_=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+kc+`;
  float scale = `+Ac+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Bh="return -x;",Lh="return ceil(x);",Wh="return floor(x);",Vh="return exp(x);",Uh="return exp(x) - 1.0;",c_=bn+`
  return sin(x);
`,l_=bn+`
  return cos(x);
`,h_=bn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,d_=bn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,f_=bn+`
  return atan(x);
`,p_=bn+"return log(x + sqrt(x * x + 1.0));",v_=bn+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,m_=bn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,sa="return x;",g_="return x;",zf=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Gf=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,qf=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,oi=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},y_=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var e=r.length,t=Wt("rc",e),n=Be(e),o=function(s,u){if(s===1)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c}(e,t),i=t.slice(-2),a=e<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},ua={};function ca(r,e){if(e===void 0&&(e=!1),r==="linear")return e?g_:s_;if(r==="relu")return e?zf:Wf;if(r==="elu")return e?qf:Uf;if(r==="relu6")return e?Gf:Vf;if(r==="prelu")return e?Lf:Bf;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var __=600,b_=function(r){function e(t){var n,o=r.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!q().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var i=Gn(q().getNumber("WEBGL_VERSION"));o.binaryCache=((n=q().getNumber("WEBGL_VERSION"))in ua||(ua[n]={}),ua[n]),o.gpgpu=new N0(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=t,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=t.gl.canvas;return o.textureManager=new r_(o.gpgpu),o.numMBBeforeWarning=q().global.screen==null?1024:q().global.screen.height*q().global.screen.width*window.devicePixelRatio*__/1024/1024,o.texData=new Sf(o,D),o}return _n(e,r),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,n,o){if(q().getBool("DEBUG")&&this.checkNumericalProblems(t),o==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:n,dtype:o,values:t,usage:$t.UPLOAD}),i},e.prototype.move=function(t,n,o,i){if(q().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:o,dtype:i,values:n,usage:$t.UPLOAD})},e.prototype.readSync=function(t){var n=this.texData.get(t),o=n.values,i=n.dtype,a=n.complexTensors,s=n.slice,u=n.shape,c=n.isPacked;if(s!=null){var l=void 0;l=c?new oi(u,sa):new ge(u,sa);var h=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),d=this.readSync(h.dataId);return this.disposeData(h.dataId),d}if(o!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return o;var f,p,v=this.activeTimers!=null;return v&&(f=Nn()),i==="complex64"?p=Vu(a.real.dataSync(),a.imag.dataSync()):p=this.getValuesFromTexture(t),v&&(this.downloadWaitMs+=Nn()-f),this.convertAndCacheOnCPU(t,p)},e.prototype.read=function(t){return ne(this,void 0,void 0,function(){var n,o,i,a,s,u,c,l,h,d,f,p,v,m,g,_,x,b,y,w,E,C;return re(this,function(T){switch(T.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(S){return n.push(S)})];if(o=this.texData.get(t),i=o.values,a=o.shape,s=o.slice,u=o.dtype,c=o.complexTensors,l=o.isPacked,s!=null)return h=void 0,h=l?new oi(a,sa):new ge(a,sa),d=this.runWebGLProgram(h,[{dataId:t,shape:a,dtype:u}],u),f=this.read(d.dataId),this.disposeData(d.dataId),[2,f];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(!q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&q().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&q().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),m=this.texData.get(v.dataId),p=(C=this.gpgpu).createBufferFromTexture.apply(C,[m.texture].concat(li(a)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:T.sent(),T.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return _=T.sent(),x=_[0],b=_[1],g=Vu(x,b),[3,5];case 4:p==null?g=this.getValuesFromTexture(t):(y=ie(a),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,y)),T.label=5;case 5:return v!=null&&this.disposeData(v.dataId),w=this.convertAndCacheOnCPU(t,g),E=this.pendingRead.get(t),this.pendingRead.delete(t),E.forEach(function(S){return S(w)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,w]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var o=t[n];if(!ug(o))throw q().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var n,o=this.texData.get(t),i=o.shape,a=o.dtype,s=o.isPacked,u=ie(i);if(q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),h=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,[l.texture].concat(li(i))).subarray(0,u);return this.disposeData(c.dataId),h}var d=q().getBool("WEBGL_PACK")&&s===!0,f=d?iu(i):i,p=d?new s0(f):new a0(f),v=this.runWebGLProgram(p,[{shape:f,dtype:a,dataId:t}],"float32"),m=this.texData.get(v.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeData(v.dataId),g},e.prototype.time=function(t){return ne(this,void 0,void 0,function(){var n,o,i,a,s,u,c;return re(this,function(l){switch(l.label){case 0:return n=this.activeTimers,o=[],i=!1,this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,t(),a=Do(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),s=Do(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=n,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return c=l.sent(),u.kernelMs=zm(c),u.getExtraProfileInfo=function(){return c.map(function(h,d){return{name:s[d],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Nn(),endMs:null}},e.prototype.endTimer=function(t){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Nn(),t)},e.prototype.getQueryTime=function(t){return ne(this,void 0,void 0,function(){var n;return re(this,function(o){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(n=t).endMs-n.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var n=this.texData.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),o=n.texture,i=n.dtype,a=n.texShape,s=n.usage,u=n.isPacked,c=n.slice,l=c&&c.origDataId||t,h=this.dataRefCount.get(l);h>1?this.dataRefCount.set(l,h-1):(this.dataRefCount.delete(l),o!=null&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var d=this.texData.get(t);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return q().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=D.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,n){var o=this;return n===void 0&&(n=128),this.getCPUBackend()!=null&&t.every(function(i){return o.texData.get(i.dataId).texture==null&&i.size<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,n){var o=this.makeOutput(t.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:D.keep(t.clone()),imag:D.keep(n.clone())},o},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,n,o);if(ie(o)===0)return Ct([],o,t.dtype);var i=this.texData.get(t.dataId).isPacked,a=Cf(t.shape,n,o);if(i||!a){var s=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new t_(o):new e_(o),u=s.getCustomSetupFunc(n);return this.compileAndRun(s,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,n,o)},e.prototype.shallowSlice=function(t,n,o){var i=this.texData.get(t.dataId),a=this.makeOutput(o,t.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=t.dtype;var u=Ef(n,t.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||t.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},e.prototype.stridedSlice=function(t,n,o,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,n,o,i);var a=xc(n,o,i);if(a.some(function(u){return u===0}))return Ct([],a);var s=new n_(n,i,a);return this.compileAndRun(s,[t])},e.prototype.reverse=function(t,n){var o=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Z0(t.shape,n):new Y0(t.shape,n);return this.compileAndRun(o,[t])},e.prototype.concat=function(t,n){if(t[0].dtype==="complex64"){var o=t.map(function(f){return nn(f)}),i=t.map(function(f){return Fn(f)});return xt(this.concat(o,n),this.concat(i,n))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,n);if(t.length===1)return t[0];if(t.length>q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(t.length/2),s=this.concat(t.slice(0,a),n),u=this.concat(t.slice(a),n);return this.concat([s,u],n)}if(q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var c=new jy(t.map(function(f){return f.shape}),n);return this.compileAndRun(c,t)}var l=Fo(t.map(function(f){return f.shape}),n),h=t.map(function(f){return f.as2D(-1,ie(f.shape.slice(n)))}),d=new Hy(h.map(function(f){return f.shape}));return this.compileAndRun(d,h).reshape(l)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Bh,t.dtype);var n=new ge(t.shape,Bh);return this.compileAndRun(n,[t])},e.prototype.batchMatMul=function(t,n,o,i){var a=o?t.shape[2]:t.shape[1],s=i?n.shape[1]:n.shape[2],u=o?t.shape[1]:t.shape[2],c=t.shape[0];if((a===1||s===1)&&u>1e3){o&&(t=t.transpose([0,2,1])),i&&(n=n.transpose([0,2,1]));var l=s===1?t:t.as3D(c,u,1),h=s===1?2:1,d=s===1?n.as3D(c,1,u):n;return this.multiply(l,d).sum(h,!0)}var f=wt(t.dtype,n.dtype),p=new cu(t.shape,[c,a,s],o,i);return this.compileAndRun(p,[t,n],f)},e.prototype.fusedBatchMatMul=function(t){var n=t.a,o=t.b,i=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=i?n.shape[2]:n.shape[1],h=a?o.shape[1]:o.shape[2],d=n.shape[0],f=wt(n.dtype,o.dtype),p=s!=null,v=c!=null,m=u?ca(u,!0):null,g=new cu(n.shape,[d,l,h],i,a,p,m,v),_=[n,o];return s&&_.push(s),c&&_.push(c),this.compileAndRun(g,_,f)},e.prototype.multiply=function(t,n){if(t.dtype==="complex64"){var o=this.texData.get(t.dataId),i=this.texData.get(n.dataId),a=new Sh(Vy,t.shape,n.shape),s=new Sh(Uy,t.shape,n.shape),u=[this.makeComplexComponentTensorInfo(t,o.complexTensors.real),this.makeComplexComponentTensorInfo(t,o.complexTensors.imag),this.makeComplexComponentTensorInfo(n,i.complexTensors.real),this.makeComplexComponentTensorInfo(n,i.complexTensors.imag)],c=this.compileAndRun(a,u),l=this.compileAndRun(s,u),h=this.complex(c,l);return c.dispose(),l.dispose(),h}if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.multiply(t,n);if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,Th,t.dtype);var d=new $e(Th,t.shape,n.shape);return this.compileAndRun(d,[t,n],t.dtype)},e.prototype.batchNormalization=function(t,n,o,i,a,s){var u=[t,n,o],c=null;s!=null&&(c=s.shape,u.push(s));var l=null;if(a!=null&&(l=a.shape,u.push(a)),q().getBool("WEBGL_PACK_NORMALIZATION")){var h=new Wy(t.shape,n.shape,o.shape,c,l,i);return this.compileAndRun(h,u)}var d=new Ly(t.shape,n.shape,o.shape,c,l,i);return this.compileAndRun(d,u)},e.prototype.localResponseNormalization4D=function(t,n,o,i,a){var s=q().getBool("WEBGL_PACK_NORMALIZATION")?new M0(t.shape,n,o,i,a):new O0(t.shape,n,o,i,a);return this.compileAndRun(s,[t])},e.prototype.LRNGrad=function(t,n,o,i,a,s,u){var c=new F0(n.shape,i,a,s,u);return this.compileAndRun(c,[n,o,t])},e.prototype.tile=function(t,n){if(t.dtype==="string"){var o=this.readSync(t.dataId).map(function(a){return Ra(a)});return Df(pe(t.shape,t.dtype,o),n)}var i=new o_(t.shape,n);return this.compileAndRun(i,[t])},e.prototype.pad=function(t,n,o){var i=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new z0(t.shape,n,o):new U0(t.shape,n,o);return this.compileAndRun(i,[t])},e.prototype.transpose=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,n);var o=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new a_(t.shape,n):new i_(t.shape,n);return this.compileAndRun(o,[t])},e.prototype.gather=function(t,n,o){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.gather(t,n,o);var i=new f0(t.shape,n.size,o);return this.compileAndRun(i,[t,n])},e.prototype.batchToSpaceND=function(t,n,o){R(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=n.reduce(function(h,d){return h*d}),a=Pa(t.shape,n,i),s=Ba(a.length,n.length),u=La(t.shape,n,i),c=_f(o,n.length),l=bf(u,o,n.length);return t.reshape(a).transpose(s).reshape(u).slice(c,l)},e.prototype.spaceToBatchND=function(t,n,o){R(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=n.reduce(function(d,f){return d*f}),a=[[0,0]];a.push.apply(a,o);for(var s=1+n.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),c=Pa(u.shape,n,i,!1),l=Ba(c.length,n.length,!1),h=La(u.shape,n,i,!1);return u.reshape(c).transpose(l).reshape(h)},e.prototype.reduce=function(t,n,o){var i=t.shape[0],a=t.shape[1],s=au(a),u=new G0({windowSize:s,inSize:a,batchSize:i},n),c=this.compileAndRun(u,[t],o);return c.shape[1]===1?c:this.reduce(c,n,o)},e.prototype.argReduce=function(t,n,o){o===void 0&&(o=null);var i=t.shape[0],a=t.shape[1];o!=null&&(i=o.shape[0],a=o.shape[1]);var s=au(a),u=new Iy({windowSize:s,inSize:a,batchSize:i},n,o==null),c=[t];o!=null&&c.push(o);var l=this.compileAndRun(u,c,"int32");return l.shape[1]===1?l:this.argReduce(t,n,l)},e.prototype.argReducePacked=function(t,n,o){o===void 0&&(o=null);var i=o!=null?o.shape:t.shape,a=au(i[i.length-1]),s=new My(i,a,n,o==null),u=o==null?[t]:[t,o],c=this.compileAndRun(s,u,"int32");return c.rank===t.rank?this.argReducePacked(t,n,c):c},e.prototype.sum=function(t,n){jt("sum",n,t.rank);var o=St(t.shape,n),i=o[0],a=ie(o[1]),s=t.as2D(-1,a),u=Js(t.dtype);return this.reduce(s,"sum",u).reshape(i)},e.prototype.prod=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,n);var o=St(t.shape,n),i=o[0],a=ie(o[1]),s=t.as2D(-1,a),u=Js(t.dtype);return this.reduce(s,"prod",u).reshape(i)},e.prototype.unsortedSegmentSum=function(t,n,o){var i=0,a=qn([i],t.rank),s=t;a!=null&&(s=t.transpose(a),i=Hn(1,t.rank)[0]);var u=function(f,p,v){for(var m=[],g=f.length,_=0;_<g;_++)_!==p?m.push(f[_]):m.push(v);return m}(s.shape,i,o),c=ie([s.shape[i]]),l=s.as2D(-1,c),h=Js(t.dtype),d=this.segOpCompute(l,"unsortedSegmentSum",n,h,o).reshape(u);return a!=null&&(d=d.transpose(gc(a))),d},e.prototype.segOpCompute=function(t,n,o,i,a){var s=t.shape[0],u=t.shape[1],c=function(d,f){var p,v=!1;for(d<=wf?(p=d,v=!0):p=Nu(d,Math.floor(Math.sqrt(d)));!v;)p>f||p===d?v=!0:p=Nu(d,p+1);return p}(u,a),l=new J0({windowSize:c,inSize:u,batchSize:s,numSegments:a}),h=this.compileAndRun(l,[t,o],i);return h.shape[1]===a?h:(o=Ma(0,a).tile([u/c]),this.segOpCompute(h,n,o,i,a))},e.prototype.argMinMaxReduce=function(t,n,o){var i=[n];if(jt("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,t.rank),!q().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var a=St(t.shape,i),s=a[0],u=ie(a[1]),c=t.as2D(-1,u);return this.argReduce(c,o).reshape(s)}return this.argReducePacked(t,o)},e.prototype.argMin=function(t,n){return this.argMinMaxReduce(t,n,"min")},e.prototype.argMax=function(t,n){return this.argMinMaxReduce(t,n,"max")},e.prototype.cumsum=function(t,n,o,i){if(n!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+n);var a=new t0(t.shape,o,i);return this.compileAndRun(a,[t])},e.prototype.equal=function(t,n){if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(equal(a, b));
`,"bool");var o=new $e("return float(a == b);",t.shape,n.shape);return this.compileAndRun(o,[t,n],"bool")},e.prototype.notEqual=function(t,n){if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(notEqual(a, b));
`,"bool");var o=new $e("return float(a != b);",t.shape,n.shape);return this.compileAndRun(o,[t,n],"bool")},e.prototype.less=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.less(t,n);if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThan(a, b));
`,"bool");var o=new $e("return float(a < b);",t.shape,n.shape);return this.compileAndRun(o,[t,n],"bool")},e.prototype.lessEqual=function(t,n){if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new $e("return float(a <= b);",t.shape,n.shape);return this.compileAndRun(o,[t,n],"bool")},e.prototype.greater=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.greater(t,n);if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new $e("return float(a > b);",t.shape,n.shape);return this.compileAndRun(o,[t,n],"bool")},e.prototype.greaterEqual=function(t,n){if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new $e("return float(a >= b);",t.shape,n.shape);return this.compileAndRun(o,[t,n],"bool")},e.prototype.logicalNot=function(t){var n=new ge(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(n,[t])},e.prototype.logicalAnd=function(t,n){if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new $e("return float(a >= 1.0 && b >= 1.0);",t.shape,n.shape);return this.compileAndRun(o,[t,n],"bool")},e.prototype.logicalOr=function(t,n){if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new $e("return float(a >= 1.0 || b >= 1.0);",t.shape,n.shape);return this.compileAndRun(o,[t,n],"bool")},e.prototype.select=function(t,n,o){var i=new Q0(t.rank,n.shape,n.rank);return this.compileAndRun(i,[t,n,o],wt(n.dtype,o.dtype))},e.prototype.where=function(t){Oa("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return Sc(t.shape,n)},e.prototype.topk=function(t,n,o){return Of(t.dataSync(),t.shape,t.dtype,n)},e.prototype.min=function(t,n){jt("min",n,t.rank);var o=St(t.shape,n),i=o[0],a=ie(o[1]),s=t.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},e.prototype.minimum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.minimum(t,n);var o=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yn(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new $e(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,n.shape);return this.compileAndRun(o,[t,n])},e.prototype.mod=function(t,n){var o=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yn(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new $e(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,n.shape);return this.compileAndRun(o,[t,n])},e.prototype.max=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,n);jt("max",n,t.rank);var o=St(t.shape,n),i=o[0],a=ie(o[1]),s=t.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},e.prototype.maximum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.maximum(t,n);var o=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yn(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new $e(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,n.shape);return this.compileAndRun(o,[t,n])},e.prototype.all=function(t,n){jt("all",n,t.rank);var o=St(t.shape,n),i=o[0],a=ie(o[1]),s=t.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},e.prototype.any=function(t,n){jt("any",n,t.rank);var o=St(t.shape,n),i=o[0],a=ie(o[1]),s=t.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},e.prototype.realDivide=function(t,n){if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new $e(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,n.shape);return this.compileAndRun(o,[t,n],"float32")},e.prototype.floorDiv=function(t,n){if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new $e(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,n.shape);return this.compileAndRun(o,[t,n],"int32")},e.prototype.add=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,su);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.add(t,n);var o=wt(t.dtype,n.dtype);if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,su,o);var i=new $e(su,t.shape,n.shape);return this.compileAndRun(i,[t,n],o)},e.prototype.packedUnaryOp=function(t,n,o){var i=new oi(t.shape,n);return this.compileAndRun(i,[t],o)},e.prototype.packedBinaryOp=function(t,n,o,i,a){a===void 0&&(a=!1);var s=new Yn(o,t.shape,n.shape,a);return this.compileAndRun(s,[t,n],i)},e.prototype.complexSeparableBinaryOp=function(t,n,o){var i=this,a=this.texData.get(t.dataId),s=this.texData.get(n.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(d){var f=d[0],p=d[1],v=i.makeComplexComponentTensorInfo(t,f),m=i.makeComplexComponentTensorInfo(n,p),g=new $e(o,t.shape,n.shape);return i.compileAndRun(g,[v,m],wt(f.dtype,p.dtype))}),c=u[0],l=u[1],h=this.complex(c,l);return c.dispose(),l.dispose(),h},e.prototype.makeComplexComponentTensorInfo=function(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>q().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(t.length/2),o=this.addN(t.slice(0,n)),i=this.addN(t.slice(n));return this.addN([o,i])}var a=t.map(function(c){return c.dtype}).reduce(function(c,l){return wt(c,l)}),s=t.map(function(c){return c.shape}),u=q().getBool("WEBGL_PACK")?new Ay(t[0].shape,s):new ky(t[0].shape,s);return this.compileAndRun(u,t,a)},e.prototype.subtract=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,uu);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.subtract(t,n);var o=wt(t.dtype,n.dtype);if(q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,uu,t.dtype);var i=new $e(uu,t.shape,n.shape);return this.compileAndRun(i,[t,n],o)},e.prototype.pow=function(t,n){var o=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yn(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new $e(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,n.shape),i=wt(t.dtype,n.dtype);return this.compileAndRun(o,[t,n],i)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Lh,t.dtype);var n=new ge(t.shape,Lh);return this.compileAndRun(n,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Wh,t.dtype);var n=new ge(t.shape,Wh);return this.compileAndRun(n,[t])},e.prototype.sign=function(t){var n=new ge(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(n,[t])},e.prototype.isNaN=function(t){var n=new ge(t.shape,"return float(isnan(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isInf=function(t){var n=new ge(t.shape,"return float(isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isFinite=function(t){var n=new ge(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.round=function(t){var n=new ge(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(n,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Vh,t.dtype);var n=new ge(t.shape,Vh);return this.compileAndRun(n,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Uh,t.dtype);var n=new ge(t.shape,Uh);return this.compileAndRun(n,[t])},e.prototype.softmax=function(t,n){var o=ft([n],t.shape),i=this.max(t,o),a=zt(i.shape,o),s=this.subtract(t,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var n=new ge(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(n,[t])},e.prototype.log1p=function(t){var n=new ge(t.shape,"return log(1.0 + x);");return this.compileAndRun(n,[t])},e.prototype.sqrt=function(t){var n=new ge(t.shape,"return sqrt(x);");return this.compileAndRun(n,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var n=new ge(t.shape,"return inversesqrt(x);");return this.compileAndRun(n,[t])},e.prototype.reciprocal=function(t){var n=new ge(t.shape,"return 1.0 / x;");return this.compileAndRun(n,[t])},e.prototype.relu=function(t){var n;return n=q().getBool("WEBGL_PACK")?new oi(t.shape,zf):new ge(t.shape,Wf),this.compileAndRun(n,[t])},e.prototype.relu6=function(t){var n;return n=q().getBool("WEBGL_PACK")?new oi(t.shape,Gf):new ge(t.shape,Vf),this.compileAndRun(n,[t])},e.prototype.prelu=function(t,n){var o=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yn(Lf,t.shape,n.shape):new $e(Bf,t.shape,n.shape);return this.compileAndRun(o,[t,n])},e.prototype.elu=function(t){if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,qf,t.dtype);var n=new ge(t.shape,Uf);return this.compileAndRun(n,[t])},e.prototype.eluDer=function(t,n){var o=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yn(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,n.shape):new $e("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,n.shape);return this.compileAndRun(o,[t,n])},e.prototype.selu=function(t){var n=new ge(t.shape,u_);return this.compileAndRun(n,[t])},e.prototype.int=function(t){var n=new ge(t.shape,"return float(int(x));");return this.compileAndRun(n,[t],"int32")},e.prototype.clip=function(t,n,o){var i,a=(i=q().getBool("WEBGL_PACK_CLIP")?new Gy(t.shape):new zy(t.shape)).getCustomSetupFunc(n,o);return this.compileAndRun(i,[t],null,a)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ph,t.dtype);var n=new ge(t.shape,Ph);return this.compileAndRun(n,[t])},e.prototype.complexAbs=function(t){var n=this.texData.get(t.dataId),o=new qy(t.shape),i=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)];return this.compileAndRun(o,i)},e.prototype.sigmoid=function(t){var n=new ge(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(n,[t])},e.prototype.softplus=function(t){var n=new ge(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(n,[t])},e.prototype.sin=function(t){var n=new ge(t.shape,c_);return this.compileAndRun(n,[t])},e.prototype.cos=function(t){var n=new ge(t.shape,l_);return this.compileAndRun(n,[t])},e.prototype.tan=function(t){var n=new ge(t.shape,"return tan(x);");return this.compileAndRun(n,[t])},e.prototype.asin=function(t){var n=new ge(t.shape,h_);return this.compileAndRun(n,[t])},e.prototype.acos=function(t){var n=new ge(t.shape,d_);return this.compileAndRun(n,[t])},e.prototype.atan=function(t){var n=new ge(t.shape,f_);return this.compileAndRun(n,[t])},e.prototype.atan2=function(t,n){var o=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yn(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new $e(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,n.shape);return this.compileAndRun(o,[t,n])},e.prototype.sinh=function(t){var n=new ge(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.cosh=function(t){var n=new ge(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.tanh=function(t){var n=new ge(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(n,[t])},e.prototype.asinh=function(t){var n=new ge(t.shape,p_);return this.compileAndRun(n,[t])},e.prototype.acosh=function(t){var n=new ge(t.shape,v_);return this.compileAndRun(n,[t])},e.prototype.atanh=function(t){var n=new ge(t.shape,m_);return this.compileAndRun(n,[t])},e.prototype.erf=function(t){var n=new ge(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(n,[t])},e.prototype.step=function(t,n){var o=new ge(t.shape,function(i){return i===void 0&&(i=0),bn+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `}(n));return this.compileAndRun(o,[t])},e.prototype.conv2dByMatMul=function(t,n,o,i,a,s){var u=t.shape,c=this.texData.get(t.dataId),l=o.inChannels,h=u[0]*u[1]*u[2],d=o.outChannels,f=o.dataFormat==="channelsLast",p=(h===1||d===1)&&l>1e3,v=u[2]%2!=0&&!!c.isPacked;if(p||!q().getBool("WEBGL_LAZILY_UNPACK")||!q().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var m=f?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],g=this.reshape(t,[1,m,o.inChannels]),_=this.reshape(n,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:_,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var x=f?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),b={dataId:t.dataId,shape:[1,x,o.inChannels],dtype:t.dtype},y=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,R(ia(c.shape,b.shape),function(){return"packed reshape "+c.shape+" to "+b.shape+" isn't free"});var w=this.reshape(n,[1,o.inChannels,o.outChannels]),E=this.fusedBatchMatMul({a:b,b:w,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),C=this.texData.get(E.dataId);return R(C.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=y,C.shape=o.outShape,D.makeTensorFromDataId(E.dataId,o.outShape,E.dtype)},e.prototype.conv2dWithIm2Row=function(t,n,o,i,a,s){var u=o.filterWidth,c=o.filterHeight,l=o.inChannels,h=o.outWidth,d=o.outHeight,f=o.dataFormat==="channelsLast",p=u*c*l,v=d*h,m=[p,v],g=t.squeeze([0]),_=n.reshape([1,p,-1]),x=new D0(m,g.shape,o),b=this.compileAndRun(x,[g]).reshape([1,m[0],m[1]]),y=i!=null,w=s!=null,E=a?ca(a,!0):null,C=new cu(b.shape,[1,v,o.outChannels],!0,!1,y,E,w),T=[b,_];i&&T.push(i),w&&T.push(s);var S=this.compileAndRun(C,T);return f?S.reshape([1,d,h,o.outChannels]):S.reshape([1,o.outChannels,d,h])},e.prototype.fusedConv2d=function(t){var n=t.input,o=t.filter,i=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(n,o,i,a,s,u);if(q().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,o,i,a,s,u);var c=a!=null,l=u!=null,h=s?ca(s,!1):null,d=new kh(i,c,h,l),f=[n,o];return a&&f.push(a),u&&f.push(u),this.compileAndRun(d,f)},e.prototype.conv2d=function(t,n,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(t,n,o);if(q().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,n,o);var i=new kh(o);return this.compileAndRun(i,[t,n])},e.prototype.conv2dDerInput=function(t,n,o){var i=new Ky(o);return this.compileAndRun(i,[t,n])},e.prototype.conv2dDerFilter=function(t,n,o){var i=new Xy(o);return this.compileAndRun(i,[t,n])},e.prototype.fusedDepthwiseConv2D=function(t){var n,o=t.input,i=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=q().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,h=u?ca(u,l):null,d=[o,i],f=s!=null,p=c!=null;return f&&d.push(s),p&&d.push(c),l?(n=new Ih(a,f,h,p),this.compileAndRun(n,d)):(n=new Ah(a,f,h,p),this.compileAndRun(n,d))},e.prototype.depthwiseConv2D=function(t,n,o){var i;return q().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new Ih(o),this.compileAndRun(i,[t,n])):(i=new Ah(o),this.compileAndRun(i,[t,n]))},e.prototype.depthwiseConv2DDerInput=function(t,n,o){var i=new Jy(o);return this.compileAndRun(i,[t,n])},e.prototype.depthwiseConv2DDerFilter=function(t,n,o){var i=new Zy(o);return this.compileAndRun(i,[t,n])},e.prototype.conv3d=function(t,n,o){var i=new Qy(o);return this.compileAndRun(i,[t,n])},e.prototype.conv3dDerInput=function(t,n,o){var i=new Yy(o);return this.compileAndRun(i,[t,n])},e.prototype.conv3dDerFilter=function(t,n,o){var i=new $y(o);return this.compileAndRun(i,[t,n])},e.prototype.maxPool=function(t,n){var o=new lu(n,"max",!1);return this.compileAndRun(o,[t])},e.prototype.avgPool=function(t,n){var o=new lu(n,"avg",!1);return this.compileAndRun(o,[t],"float32")},e.prototype.maxPoolBackprop=function(t,n,o,i){var a=new lu(i,"max",!0),s=this.compileAndRun(a,[n]),u=new P0(i),c=this.compileAndRun(u,[t,s],n.dtype);return s.dispose(),c},e.prototype.avgPoolBackprop=function(t,n,o){var i=new Py(o);return this.compileAndRun(i,[t],n.dtype)},e.prototype.cast=function(t,n){return Af(t,n,this)},e.prototype.unstack=function(t,n){for(var o=t.shape[n],i=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==n&&(i[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[n]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[n]=s,l[s]=this.slice(t,u,c).reshape(i);return l},e.prototype.avgPool3d=function(t,n){var o=new hu(n,"avg",!1);return this.compileAndRun(o,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,n,o){var i=new By(o);return this.compileAndRun(i,[t],n.dtype)},e.prototype.maxPool3d=function(t,n){var o=new hu(n,"max",!1);return this.compileAndRun(o,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,n,o,i){var a=new hu(i,"max",!0),s=this.compileAndRun(a,[n]),u=new B0(i),c=this.compileAndRun(u,[t,s],n.dtype);return s.dispose(),c},e.prototype.reshape=function(t,n){var o=this.texData.get(t.dataId);if(o.isPacked&&!ia(t.shape,n)&&(o.texture===null||!ia(o.shape,n))){var i=this.packedReshape(t,n);return D.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return Wu(t,n)},e.prototype.resizeBilinear=function(t,n,o,i){var a=q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new X0(t.shape,n,o,i):new j0(t.shape,n,o,i);return this.compileAndRun(a,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,n,o){var i=new H0(t,n,o);return this.compileAndRun(i,[t])},e.prototype.resizeNearestNeighbor=function(t,n,o,i){var a=new $0(t.shape,n,o,i);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,n,o){var i=new K0(t,n,o);return this.compileAndRun(i,[t])},e.prototype.multinomial=function(t,n,o,i){var a=n?t:rr(t),s=a.shape[0],u=a.shape[1],c=new L0(s,u,o),l=c.getCustomSetupFunc(i);return this.compileAndRun(c,[a],"int32",l)},e.prototype.oneHot=function(t,n,o,i){var a=new W0(t.size,n,o,i);return this.compileAndRun(a,[t])},e.prototype.diag=function(t){var n=new i0(t.size);return this.compileAndRun(n,[t])},e.prototype.nonMaxSuppression=function(t,n,o,i,a){return Oa("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Cc(t.dataSync(),n.dataSync(),o,i,a)},e.prototype.cropAndResize=function(t,n,o,i,a,s){var u=new e0(t.shape,n.shape,i,a,s);return this.compileAndRun(u,[t,n,o],"float32")},e.prototype.depthToSpace=function(t,n,o){R(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});var i=t.shape[0],a=o==="NHWC"?t.shape[1]:t.shape[2],s=o==="NHWC"?t.shape[2]:t.shape[3],u=o==="NHWC"?t.shape[3]:t.shape[1],c=a*n,l=s*n,h=u/(n*n),d=new o0(o==="NHWC"?[i,c,l,h]:[i,h,c,l],n,o);return this.compileAndRun(d,[t])},e.prototype.split=function(t,n,o){return Nf(t,n,o)},e.prototype.scatterND=function(t,n,o){var i=Wa(0,t,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,h=[l/u,u],d=t.reshape([s,a]),f=n.reshape([s,u]);if(l===0)return Wu(Ct([]),o);var p=J(0),v=new Oh(s,a,d.rank,f.rank,c,h);return this.compileAndRun(v,[f,d,p]).reshape(o)},e.prototype.sparseToDense=function(t,n,o,i){var a=Wa(0,t,o),s=a.sliceRank,u=a.numUpdates,c=a.strides,l=a.outputSize,h=new Oh(u,s,t.rank,n.rank,c,[l,1]);return this.compileAndRun(h,[n,t,i]).reshape(o)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,n){var o=this.texData.get(t.dataId),i=new Nh(l0,t.shape,n),a=new Nh(h0,t.shape,n),s=[this.makeComplexComponentTensorInfo(t,o.complexTensors.real),this.makeComplexComponentTensorInfo(t,o.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(a,s),l=this.complex(u,c).as2D(t.shape[0],t.shape[1]);return u.dispose(),c.dispose(),l},e.prototype.gatherND=function(t,n){var o=n.shape,i=o[o.length-1],a=xf(t,n),s=a[0],u=a[1],c=a[2],l=a[3],h=n.reshape([u,i]),d=t.reshape([t.size/c,c]),f=new p0(i,l,[u,c]);return this.compileAndRun(f,[d,h]).reshape(s)},e.prototype.fill=function(t,n,o){if((o=o||Fi(n))==="string"){var i=Ia(o,ie(t));return i.fill(n),D.makeTensor(i,t,o,this)}var a=new d0(t,n),s=a.getCustomSetupFunc(n);return this.compileAndRun(a,[],o,s)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,n,o){return If(t,n,o)},e.prototype.makeTensorInfo=function(t,n){var o=this.write(null,t,n);return this.texData.get(o).usage=null,{dataId:o,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n){var o=this.makeTensorInfo(t,n).dataId;return D.makeTensorFromDataId(o,t,n,this)},e.prototype.unpackTensor=function(t){var n=new y_(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new V0(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,n){var o=[Na(t.shape)].concat(Da(t.shape)),i={dtype:t.dtype,shape:o,dataId:t.dataId},a=[Na(n)].concat(Da(n)),s=new q0(a,o),u=this.runWebGLProgram(s,[i],t.dtype,null,!0);return{dataId:u.dataId,shape:n,dtype:u.dtype}},e.prototype.decode=function(t){var n,o=this.texData.get(t),i=o.isPacked,a=o.shape,s=o.dtype,u=iu(a);return n=i?new r0(u):new n0(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(n,[{shape:u,dtype:s,dataId:t}],s,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,n,o,i,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(t.outputShape,o),c=this.texData.get(u.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===bi.DENSE){var l=li(t.outputShape);c.texShape=l.map(function(x){return 2*x})}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),ie(u.shape)===0)return c.values=yi(u.dtype,0),u;var h=[],d=n.map(function(x){if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=s.texData.get(x.dataId);if(b.texture==null){if(!t.packedInputs&&ie(x.shape)<=q().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=x.shape)}else if(!!b.isPacked!=!!t.packedInputs)x=b.isPacked?s.unpackTensor(x):s.packTensor(x),h.push(x),b=s.texData.get(x.dataId);else if(b.isPacked&&!ia(b.shape,x.shape)){var y=x,w=x.shape;x.shape=b.shape,x=s.packedReshape(x,w),h.push(x),b=s.texData.get(x.dataId),y.shape=w}return s.uploadToGPU(x.dataId),{shape:x.shape,texData:b,isUniform:!1}});this.uploadToGPU(u.dataId);var f,p={shape:u.shape,texData:c,isUniform:!1},v=function(x,b,y){var w="";b.concat(y).forEach(function(T){var S=T.texData!=null&&T.texData.slice!=null&&T.texData.slice.flatOffset>0,I=T.isUniform?"uniform":T.texData.texShape;w+=T.shape+"_"+I+"_"+S});var E=x.userCode,C=x.constructor.name;return C+="_"+w+"_"+E}(t,d,p),m=this.getAndSaveBinary(v,function(){return function(x,b,y,w){var E=b.userCode,C=y.map(function(L,W){var z={logicalShape:L.shape,texShape:L.isUniform?null:L.texData.texShape,isUniform:L.isUniform,isPacked:!L.isUniform&&L.texData.isPacked,flatOffset:null};return L.texData!=null&&L.texData.slice!=null&&L.texData.slice.flatOffset>0&&(z.flatOffset=L.texData.slice.flatOffset),{name:b.variableNames[W],shapeInfo:z}}),T=C.map(function(L){return L.shapeInfo}),S={logicalShape:w.shape,texShape:w.texData.texShape,isUniform:!1,isPacked:w.texData.isPacked,flatOffset:null},I=Ry(C,S,E,b.packedInputs),A=x.createProgram(I),F=null,O=x.getUniformLocation(A,"NAN",!1);q().getNumber("WEBGL_VERSION")===1&&(F=x.getUniformLocation(A,"INFINITY",!1));for(var M={},B=0;B<b.variableNames.length;B++){var P=b.variableNames[B];M[P]=x.getUniformLocation(A,P,!1),M["offset"+P]=x.getUniformLocation(A,"offset"+P,!1)}return{program:b,source:I,webGLProgram:A,uniformLocations:M,inShapeInfos:T,outShapeInfo:S,infLoc:F,nanLoc:O}}(s.gpgpu,t,d,p)}),g=this.activeTimers!=null;if(g&&(f=this.startTimer()),function(x,b,y,w,E){Dh(b.inShapeInfos,y),Dh([b.outShapeInfo],[w]);var C=w.texData.texture,T=w.texData.texShape;w.texData.isPacked?x.setOutputPackedMatrixTexture(C,T[0],T[1]):x.setOutputMatrixTexture(C,T[0],T[1]),x.setProgram(b.webGLProgram),q().getNumber("WEBGL_VERSION")===1&&b.infLoc!==null&&x.gl.uniform1f(b.infLoc,1/0),b.nanLoc!==null&&x.gl.uniform1f(b.nanLoc,NaN),y.forEach(function(S,I){var A=b.program.variableNames[I],F=b.uniformLocations[A],O=b.uniformLocations["offset"+A];if(F!=null)if(S.isUniform)if(ie(S.shape)<2)x.gl.uniform1f(F,S.uniformValues[0]);else{var M=S.uniformValues;M instanceof Float32Array||(M=new Float32Array(M)),x.gl.uniform1fv(F,M)}else S.texData.slice!=null&&O!=null&&x.gl.uniform1i(O,S.texData.slice.flatOffset),x.setInputMatrixTexture(S.texData.texture,F,I)}),E!=null&&E(x,b.webGLProgram),x.executeProgram()}(this.gpgpu,m,d,p,i),h.forEach(function(x){return s.disposeData(x.dataId)}),g&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)})),!q().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&a===!1){var _=this.unpackTensor(u);return this.disposeData(u.dataId),_}return u},e.prototype.compileAndRun=function(t,n,o,i,a){a===void 0&&(a=!1),o=o||n[0].dtype;var s=this.runWebGLProgram(t,n,o,i,a);return D.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(q().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(n){t.gpgpu.deleteProgram(t.binaryCache[n].webGLProgram),delete t.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ee(function(){if(!q().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=q().getBool("DEBUG");q().set("DEBUG",!1);var o=t.abs(J(1e-8)).dataSync()[0];if(q().set("DEBUG",n),o>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var n,o=this.texData.get(t),i=o.shape,a=o.dtype,s=o.values,u=o.texture,c=o.usage,l=o.isPacked;if(u==null){var h,d=this.activeTimers!=null;d&&(h=Nn());var f=o.texShape;if(f==null&&(f=Tg(i,l),o.texShape=f),s!=null){var p=iu(i),v=void 0,m=f[1],g=f[0],_=s instanceof Uint8Array;l?(m=(n=Pi(f[0],f[1]))[0],g=n[1],v=new c0(p,[g,m],_)):v=new u0(p,[g,m],_);var x=this.makeTensorInfo([g,m],a);this.texData.get(x.dataId).usage=_?$t.PIXELS:$t.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),m,g,s);var b=this.runWebGLProgram(v,[x],a,null,!0),y=this.texData.get(b.dataId);o.texture=y.texture,o.texShape=y.texShape,o.isPacked=y.isPacked,o.usage=y.usage,this.disposeData(x.dataId),this.texData.delete(b.dataId),o.values=null,d&&(this.uploadWaitMs+=Nn()-h)}else{var w=this.acquireTexture(f,c,a,l);o.texture=w}}},e.prototype.convertAndCacheOnCPU=function(t,n){var o=this.texData.get(t),i=o.dtype;return this.releaseGPUData(t),n!=null&&(o.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)}(n,i)),o.values},e.prototype.acquireTexture=function(t,n,o,i){if(this.numBytesInGPU+=this.computeBytes(t,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,i)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*nf(n)},e}(Tf);lf()&&D.registerBackend("webgl",function(){return new b_},2);var x_=N({square_:function(r){var e=k(r,"x","square"),t=[e];return D.runKernelFunc(function(n,o){return o([e]),n.square(e)},{x:e},null,"Square",{},t,[])}}),wi="SquaredDifference",Hf=N({squaredDifference_:function(r,e){var t,n=k(r,"a","squaredDifference"),o=k(e,"b","squaredDifference");t=Xe(n,o),n=t[0],o=t[1],xe(n.shape,o.shape);var i={a:n,b:o},a=[n,o];return D.runKernelFunc(function(s,u){var c=s.squaredDifference(n,o);return u([n,o]),c},i,function(s,u){var c=u[0],l=u[1],h=J(2);return{a:function(){return s.mul(c.sub(l).mul(h))},b:function(){return s.mul(l.sub(c).mul(h))}}},wi,{},a,[])}}),w_=N({abs_:function(r){var e=k(r,"x","abs");return e.dtype==="complex64"?D.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):D.runKernelFunc(function(t,n){var o=t.abs(e);return n([e]),o},{x:e},function(t,n){var o=n[0];return{x:function(){return t.mul(o.toFloat().step(-1))}}},"Abs")}}),C_=N({acos_:function(r){var e=k(r,"x","acos");return D.runKernelFunc(function(t,n){var o=t.acos(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.divStrict(J(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),E_=N({acosh_:function(r){var e=k(r,"x","acosh");return D.runKernelFunc(function(t,n){var o=t.acosh(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),S_=N({asin_:function(r){var e=k(r,"x","asin");return D.runKernelFunc(function(t,n){var o=t.asin(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.divStrict(J(1).sub(o.toFloat().square()).sqrt())}}})}}),T_=N({asinh_:function(r){var e=k(r,"x","asinh");return D.runKernelFunc(function(t,n){var o=t.asinh(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.divStrict(J(1).add(o.toFloat().square()).sqrt())}}})}}),k_=N({atan_:function(r){var e=k(r,"x","atan");return D.runKernelFunc(function(t,n){var o=t.atan(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.div(o.toFloat().square().add(1))}}})}}),A_=N({atanh_:function(r){var e=k(r,"x","atanh");return D.runKernelFunc(function(t,n){var o=t.atanh(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.div(J(1).sub(o.toFloat().square()))}}})}}),I_=N({ceil_:function(r){var e=k(r,"x","ceil");return D.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),Ic=N({clipByValue_:function(r,e,t){var n=k(r,"x","clipByValue");R(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."});var o=[n],i={min:e,max:t};return D.runKernelFunc(function(a,s){var u=a.clip(n,e,t);return s([n]),u},{x:n},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),Te(a))}}},"ClipByValue",i,o)}}),R_=N({cos_:function(r){var e=k(r,"x","cos"),t=[e];return D.runKernelFunc(function(n,o){var i=n.cos(e);return o([e]),i},{x:e},function(n,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(n)}}},"Cos",{},t)}}),N_=N({cosh_:function(r){var e=k(r,"x","cosh");return D.runKernelFunc(function(t,n){var o=t.cosh(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return o.toFloat().sinh().mulStrict(t)}}})}}),D_=N({erf_:function(r){var e=k(r,"x","erf");return R(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),D.runKernelFunc(function(t,n){var o=t.erf(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Uu=N({exp_:function(r){var e=k(r,"x","exp");return D.runKernelFunc(function(t,n){var o=t.exp(e);return n([o]),o},{x:e},function(t,n){return{x:function(){return t.mulStrict(n[0])}}},"Exp",{},[],[!0])}}),O_=N({expm1_:function(r){var e=k(r,"x","expm1");return D.runKernelFunc(function(t,n){var o=t.expm1(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.mul(o.exp())}}})}}),F_=N({floor_:function(r){var e=k(r,"x","floor");return D.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),M_=N({log_:function(r){var e=k(r,"x","log"),t=[e];return D.runKernelFunc(function(n,o){var i=n.log(e);return o([e]),i},{x:e},function(n,o){var i=o[0];return{x:function(){return n.div(i.toFloat())}}},"Log",{},t)}}),P_=N({log1p_:function(r){var e=k(r,"x","log1p");return D.runKernelFunc(function(t,n){var o=t.log1p(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.div(o.add(1))}}})}}),B_=N({logSigmoid_:function(r){var e=k(r,"x","logSigmoid");return D.runKernelFunc(function(t,n){var o=t.softplus(e.neg()).neg();return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.mul(o.neg().sigmoid())}}})}}),Ga=N({neg_:function(r){var e=k(r,"x","neg"),t=[e];return D.runKernelFunc(function(n){return n.neg(e)},{x:e},function(n){return{x:function(){return n.neg()}}},"Neg",{},t)}}),L_=N({reciprocal_:function(r){var e=k(r,"x","reciprocal");return D.runKernelFunc(function(t,n){var o=t.reciprocal(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.div(o.square().neg())}}})}}),W_=N({round_:function(r){var e=k(r,"x","round");return D.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),jf=N({rsqrt_:function(r){var e=k(r,"x","rsqrt"),t=[e];return D.runKernelFunc(function(n,o){var i=n.rsqrt(e);return o([e]),i},{x:e},function(n,o){var i=o[0];return{x:function(){return n.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),Xf=N({sigmoid_:function(r){var e=k(r,"x","sigmoid");return D.runKernelFunc(function(t,n){var o=t.sigmoid(e);return n([o]),o},{x:e},function(t,n){var o=n[0];return{x:function(){return t.mul(o.mul(J(1).sub(o)))}}},"Sigmoid")}}),V_=N({sign_:function(r){var e=k(r,"x","sign");return D.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),U_=N({isNaN_:function(r){var e=k(r,"x","isNaN");return D.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),z_=N({isInf_:function(r){var e=k(r,"x","isInf");return D.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),G_=N({isFinite_:function(r){var e=k(r,"x","isFinite");return D.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),q_=N({sin_:function(r){var e=k(r,"x","sin"),t=[e];return D.runKernelFunc(function(n,o){var i=n.sin(e);return o([e]),i},{x:e},function(n,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(n)}}},"Sin",{},t)}}),H_=N({sinh_:function(r){var e=k(r,"x","sinh");return D.runKernelFunc(function(t,n){var o=t.sinh(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return o.toFloat().cosh().mulStrict(t)}}})}}),j_=N({softplus_:function(r){var e=k(r,"x","softplus");return D.runKernelFunc(function(t,n){var o=t.softplus(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.mul(o.sigmoid())}}})}}),X_=N({sqrt_:function(r){var e=k(r,"x","sqrt");return D.runKernelFunc(function(t,n){var o=t.sqrt(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.div(o.toFloat().sqrt().mul(2))}}})}}),K_=N({step_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","step");return D.runKernelFunc(function(n){return n.step(t,e)},{$x:t},function(n){return{$x:function(){return Te(n)}}})}}),$_=N({tan_:function(r){var e=k(r,"x","tan");return D.runKernelFunc(function(t,n){var o=t.tan(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return t.div(o.cos().square())}}})}}),Y_=N({tanh_:function(r){var e=k(r,"x","tanh");return D.runKernelFunc(function(t,n){var o=t.tanh(e);return n([o]),o},{x:e},function(t,n){var o=n[0];return{x:function(){return J(1).sub(o.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function Kf(r,e,t,n,o,i){var a,s,u=k(r,"x","batchNorm"),c=k(e,"mean","batchNorm"),l=k(t,"variance","batchNorm");return o!=null&&(a=k(o,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),R(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),R(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),R(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),a!=null&&R(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&R(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Li(u,c,l,s,a,i)}function $f(r,e,t,n,o,i){var a,s,u=k(r,"x","batchNorm"),c=k(e,"mean","batchNorm"),l=k(t,"variance","batchNorm");return o!=null&&(a=k(o,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),R(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),R(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),R(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),a!=null&&R(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&R(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Li(u,c,l,s,a,i)}function Yf(r,e,t,n,o,i){var a,s,u=k(r,"x","batchNorm"),c=k(e,"mean","batchNorm"),l=k(t,"variance","batchNorm");return o!=null&&(a=k(o,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),R(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),R(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),R(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),a!=null&&R(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&R(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Li(u,c,l,s,a,i)}function Li(r,e,t,n,o,i){i==null&&(i=.001);var a,s,u,c=k(r,"x","batchNorm"),l=k(e,"mean","batchNorm"),h=k(t,"variance","batchNorm");o!=null&&(a=k(o,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),R(l.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),R(s==null||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),R(a==null||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=c.rank===0||c.rank===1?c.as4D(1,1,1,c.size):c.rank===2?c.as4D(1,1,c.shape[0],c.shape[1]):c.rank===3?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var d=[c,l,h,a];return D.runKernelFunc(function(f,p){var v=f.batchNormalization(u,la(l),la(h),i,la(a),la(s));return p([c,l,h,a]),v},{x:c,mean:l,variance:h,scale:a,offset:s},function(f,p){var v=p,m=v[0],g=v[1],_=v[2],x=v[3],b=x??J(1),y=lt(g.shape,u.shape),w=[];if(g.rank===1){for(var E=0;E<u.shape.length-1;++E)w.push(u.shape[E]);w.push(1)}var C=m.sub(g),T=f.mul(b),S=jf(_.add(J(i))),I=S.mul(S).mul(S).mul(J(-.5));return{x:function(){return g.rank===1?f.mul(Eo(S.as4D(1,1,1,g.shape[0]),w)).mul(b).reshape(m.shape):f.mul(S).mul(b).reshape(m.shape)},mean:function(){var A=S.mul(J(-1)).mul(T);return g.rank===1&&(A=A.sum(y)),A.reshape(g.shape)},variance:function(){var A=I.mul(C).mul(T);return g.rank===1&&(A=A.sum(y)),A.reshape(g.shape)},scale:function(){var A=C.mul(S),F=f.mul(A);return g.rank===1&&(F=F.sum(y)),F.reshape(g.shape)},offset:function(){var A=f;return g.rank===1&&(A=A.sum(y)),A.reshape(g.shape)}}},"BatchNormalization",{varianceEpsilon:i},d).reshape(c.shape)}function la(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function ps(){hf("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Z_=N({batchNormalization2d_:function(r,e,t,n,o,i){return n===void 0&&(n=.001),ps(),Kf(r,e,t,i,o,n)}}),J_=N({batchNormalization3d_:function(r,e,t,n,o,i){return n===void 0&&(n=.001),ps(),$f(r,e,t,i,o,n)}}),Q_=N({batchNormalization4d_:function(r,e,t,n,o,i){return n===void 0&&(n=.001),ps(),Yf(r,e,t,i,o,n)}}),eb=N({batchNormalization_:function(r,e,t,n,o,i){return n===void 0&&(n=.001),ps(),Li(r,e,t,i,o,n)}}),Zf=N({batchNorm_:Li}),tb=N({batchNorm2d_:Kf}),nb=N({batchNorm3d_:$f}),rb=N({batchNorm4d_:Yf}),vs=N({logicalAnd_:function(r,e){var t=k(r,"a","logicalAnd","bool"),n=k(e,"b","logicalAnd","bool");return xe(t.shape,n.shape),D.runKernelFunc(function(o){return o.logicalAnd(t,n)},{a:t,b:n},null,"LogicalAnd")}}),ob=N({logicalNot_:function(r){var e=k(r,"x","logicalNot","bool");return D.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),Jf=N({logicalOr_:function(r,e){var t=k(r,"a","logicalOr","bool"),n=k(e,"b","logicalOr","bool");return xe(t.shape,n.shape),D.runKernelFunc(function(o){return o.logicalOr(t,n)},{$a:t,$b:n})}}),ib=N({logicalXor_:function(r,e){var t=k(r,"a","logicalXor","bool"),n=k(e,"b","logicalXor","bool");return xe(t.shape,n.shape),Jf(r,e).logicalAnd(vs(r,e).logicalNot())}}),jr=N({where_:function(r,e,t){var n=k(e,"a","where"),o=k(t,"b","where"),i=k(r,"condition","where","bool");return Ne(n.shape,o.shape,"Error in where: "),i.rank===1?R(i.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Ne(i.shape,o.shape,"Error in where: "),D.runKernelFunc(function(a,s){var u=a.select(i,n,o);return s([i]),u},{$condition:i,$a:n,$b:o},function(a,s){var u=s[0];return{$condition:function(){return Te(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),Qf=function(r){return ne(this,void 0,void 0,function(){var e,t,n;return re(this,function(o){switch(o.label){case 0:return[4,(e=k(r,"condition","whereAsync","bool")).data()];case 1:return t=o.sent(),n=Sc(e.shape,t),r!==e&&e.dispose(),[2,n]}})})},be=N({add_:function(r,e){var t,n=k(r,"a","add"),o=k(e,"b","add");t=Xe(n,o),n=t[0],o=t[1];var i=xe(n.shape,o.shape);return D.runKernelFunc(function(a){return a.add(n,o)},{a:n,b:o},function(a){return{a:function(){var s=a,u=lt(n.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(n.shape)},b:function(){var s=a,u=lt(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),ab=N({addN_:function(r){R(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),R(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var e=r.map(function(o,i){return k(o,"tensors"+i,"addN")}),t=e[0];e.forEach(function(o){if(o.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(o){if(!vt(o.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return D.runKernelFunc(function(o){return o.addN(e)},n,function(o){var i={};return e.forEach(function(a,s){i[s]=function(){return o.clone()}}),i},"AddN")}}),sb=N({addStrict_:function(r,e){var t=k(r,"a","addStrict"),n=k(e,"b","addStrict");return Ne(t.shape,n.shape,"Error in addStrict: "),t.add(n)}}),ub=N({atan2_:function(r,e){var t,n=k(r,"a","atan2"),o=k(e,"b","atan2");t=Xe(n,o),n=t[0],o=t[1];var i=xe(n.shape,o.shape);return D.runKernelFunc(function(a,s){var u=a.atan2(n,o);return s([n,o]),u},{$a:n,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=be(u.square(),c.square()),h=a.mul(c.div(l)),d=lt(u.shape,i);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)},$b:function(){var l=be(u.square(),c.square()),h=Ga(a.mul(u.div(l))),d=lt(c.shape,i);return d.length>0&&(h=h.sum(d)),h.reshape(c.shape)}}})}}),dn=N({div_:function(r,e){var t,n=k(r,"a","div"),o=k(e,"b","div");if(t=Xe(n,o),n=t[0],o=t[1],n.dtype==="int32"&&o.dtype==="int32")return ep(n,o);var i=xe(n.shape,o.shape);return D.runKernelFunc(function(a,s){var u=a.realDivide(n,o);return s([n,o]),u},{a:n,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),h=lt(u.shape,i);return h.length>0?l.sum(h).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),h=lt(c.shape,i);h.length>0&&(l=l.sum(h).reshape(c.shape));var d=c.square();return l.div(d.toFloat()).neg()}}},"Div")}}),cb=N({divNoNan_:function(r,e){var t,n=k(r,"a","div"),o=k(e,"b","div");n=(t=Xe(n,o))[0],o=t[1];var i=dn(n,o),a=Te(i),s=o.equal(a);return jr(s,a,i)}}),lb=N({divStrict_:function(r,e){var t=k(r,"a","div"),n=k(e,"b","div");return Ne(t.shape,n.shape,"Error in divideStrict: "),t.div(n)}}),ep=N({floorDiv_:function(r,e){var t,n=k(r,"a","floorDiv"),o=k(e,"b","floorDiv");t=Xe(n,o),n=t[0],o=t[1];var i=xe(n.shape,o.shape);return D.runKernelFunc(function(a,s){var u=a.floorDiv(n,o);return s([n,o]),u},{a:n,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),h=lt(u.shape,i);return h.length>0?l.sum(h).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),h=lt(c.shape,i);h.length>0&&(l=l.sum(h).reshape(c.shape));var d=c.square();return l.div(d.toFloat()).neg()}}},"FloorDiv")}}),Rc=N({maximum_:function(r,e){var t,n=k(r,"a","maximum"),o=k(e,"b","maximum");return t=Xe(n,o),n=t[0],o=t[1],n.dtype==="bool"&&(n=n.toInt(),o=o.toInt()),xe(n.shape,o.shape),D.runKernelFunc(function(i,a){var s=i.maximum(n,o);return a([n,o]),s},{a:n,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),hb=N({maximumStrict_:function(r,e){var t=k(r,"a","maximumStrict"),n=k(e,"b","maximumStrict");return Ne(t.shape,n.shape,"Error in maximumStrict: "),t.maximum(n)}}),tp=N({minimum_:function(r,e){var t,n=k(r,"a","minimum"),o=k(e,"b","minimum");return t=Xe(n,o),n=t[0],o=t[1],n.dtype==="bool"&&(n=n.toInt(),o=o.toInt()),xe(n.shape,o.shape),D.runKernelFunc(function(i,a){var s=i.minimum(n,o);return a([n,o]),s},{a:n,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),db=N({minimumStrict_:function(r,e){var t=k(r,"a","minimumStrict"),n=k(e,"b","minimumStrict");return Ne(t.shape,n.shape,"Error in minimumStrict: "),t.minimum(n)}}),fb=N({mod_:function(r,e){var t,n=k(r,"a","mod"),o=k(e,"b","mod");t=Xe(n,o),n=t[0],o=t[1];var i=xe(n.shape,o.shape);return D.runKernelFunc(function(a,s){var u=a.mod(n,o);return s([n,o]),u},{$a:n,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=lt(u.shape,i);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),h=lt(c.shape,i);return h.length>0?l.sum(h).reshape(c.shape):l}}})}}),pb=N({modStrict_:function(r,e){var t=k(r,"a","modStrict"),n=k(e,"b","modStrict");return Ne(t.shape,n.shape,"Error in modStrict: "),t.mod(n)}}),It=N({mul_:function(r,e){var t,n=k(r,"a","mul"),o=k(e,"b","mul");t=Xe(n,o),n=t[0],o=t[1];var i=xe(n.shape,o.shape);return D.runKernelFunc(function(a,s){var u=a.multiply(n,o);return s([n,o]),u},{a:n,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.mul(c.toFloat()),h=lt(u.shape,i);return h.length>0?l.sum(h).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),h=lt(c.shape,i);return h.length>0?l.sum(h).reshape(c.shape):l}}},"Mul")}}),vb=N({mulStrict_:function(r,e){var t=k(r,"a","mul"),n=k(e,"b","mul");return Ne(t.shape,n.shape,"Error in multiplyStrict: "),t.mul(n)}}),qa=N({pow_:function(r,e){var t,n=k(r,"base","pow"),o=k(e,"exp","pow");t=Xe(n,o),n=t[0],o=t[1];var i=xe(n.shape,o.shape),a=[n,o];return D.runKernelFunc(function(s,u){var c=s.pow(n,o);return u([n,o,c]),c},{a:n,b:o},function(s,u){var c=u[0],l=u[1],h=u[2];return{a:function(){var d=l.toFloat(),f=s.mul(d.mul(c.pow(d.sub(J(1))))),p=lt(c.shape,i);return p.length>0&&(f=f.sum(p)),f.reshape(c.shape)},b:function(){var d=c.greater(0),f=c.log().where(d,Te(c)),p=s.mul(h.mul(f)),v=lt(l.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(l.shape)}}},"Pow",{},a,[!0])}}),mb=N({powStrict_:function(r,e){return Ne(r.shape,e.shape,"Error in powStrict: "),r.pow(e)}}),gb=N({squaredDifferenceStrict_:function(r,e){var t=k(r,"a","squaredDifferenceStrict"),n=k(e,"b","squaredDifferenceStrict");return Ne(t.shape,n.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(n)}}),ht=N({sub_:function(r,e){var t,n=k(r,"a","sub"),o=k(e,"b","sub");t=Xe(n,o),n=t[0],o=t[1];var i=xe(n.shape,o.shape);return D.runKernelFunc(function(a){return a.subtract(n,o)},{a:n,b:o},function(a){return{a:function(){var s=a,u=lt(n.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(n.shape)},b:function(){var s=a,u=lt(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),yb=N({subStrict_:function(r,e){var t=k(r,"a","subStrict"),n=k(e,"b","subStrict");return Ne(t.shape,n.shape,"Error in subStrict: "),t.sub(n)}}),np=N({equal_:function(r,e){var t,n=k(r,"a","equal"),o=k(e,"b","equal");return t=Xe(n,o),n=t[0],o=t[1],xe(n.shape,o.shape),D.runKernelFunc(function(i){return i.equal(n,o)},{$a:n,$b:o})}}),_b=N({equalStrict_:function(r,e){var t=k(r,"a","equalStrict"),n=k(e,"b","equalStrict");return Ne(t.shape,n.shape,"Error in equalStrict: "),t.equal(n)}}),bb=N({greater_:function(r,e){var t,n=k(r,"a","greater"),o=k(e,"b","greater");return t=Xe(n,o),n=t[0],o=t[1],xe(n.shape,o.shape),D.runKernelFunc(function(i){return i.greater(n,o)},{a:n,b:o},null,"Greater")}}),rp=N({greaterEqual_:function(r,e){var t,n=k(r,"a","greaterEqual"),o=k(e,"b","greaterEqual");return t=Xe(n,o),n=t[0],o=t[1],xe(n.shape,o.shape),D.runKernelFunc(function(i,a){var s=i.greaterEqual(n,o);return a([n,o]),s},{a:n,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return Te(s)},b:function(){return Te(u)}}},"GreaterEqual")}}),xb=N({greaterEqualStrict_:function(r,e){var t=k(r,"a","greaterEqualStrict"),n=k(e,"b","greaterEqualStrict");return Ne(t.shape,n.shape,"Error in greaterEqualStrict: "),t.greaterEqual(n)}}),wb=N({greaterStrict_:function(r,e){var t=k(r,"a","greaterStrict"),n=k(e,"b","greaterStrict");return Ne(t.shape,n.shape,"Error in greaterStrict: "),t.greater(n)}}),Cb=N({less_:function(r,e){var t,n=k(r,"a","less"),o=k(e,"b","less");return t=Xe(n,o),n=t[0],o=t[1],xe(n.shape,o.shape),D.runKernelFunc(function(i){return i.less(n,o)},{a:n,b:o},null,"Less")}}),Eb=N({lessEqual_:function(r,e){var t,n=k(r,"a","lessEqual"),o=k(e,"b","lessEqual");return t=Xe(n,o),n=t[0],o=t[1],xe(n.shape,o.shape),D.runKernelFunc(function(i,a){var s=i.lessEqual(n,o);return a([n,o]),s},{a:n,b:o},null,"LessEqual")}}),Sb=N({lessEqualStrict_:function(r,e){var t=k(r,"a","lessEqualStrict"),n=k(e,"b","lessEqualStrict");return Ne(t.shape,n.shape,"Error in lessEqualStrict: "),t.lessEqual(n)}}),Tb=N({lessStrict_:function(r,e){var t=k(r,"a","lessStrict"),n=k(e,"b","lessStrict");return Ne(t.shape,n.shape,"Error in lessStrict: "),t.less(n)}}),kb=N({notEqual_:function(r,e){var t,n=k(r,"a","notEqual"),o=k(e,"b","notEqual");return t=Xe(n,o),n=t[0],o=t[1],xe(n.shape,o.shape),D.runKernelFunc(function(i){return i.notEqual(n,o)},{a:n,b:o},null,"NotEqual")}}),Ab=N({notEqualStrict_:function(r,e){var t=k(r,"a","notEqualStrict"),n=k(e,"b","notEqualStrict");return Ne(t.shape,n.shape,"Error in notEqualStrict: "),t.notEqual(n)}});function zh(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function Gh(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var Nc=N({gather_:function(r,e,t){t===void 0&&(t=0);var n=k(r,"x","gather"),o=k(e,"indices","gather","int32");t=ft(t,n.shape)[0];var i=function(a,s,u){for(var c=a.shape[u],l=[],h=1,d=1,f=0;f<u;f++)l.push(a.shape[f]),h*=a.shape[f];for(f=0;f<s.rank;f++)l.push(s.shape[f]);for(f=u+1;f<a.rank;f++)l.push(a.shape[f]),d*=a.shape[f];return{batchSize:h,sliceSize:d,dimSize:c,outputShape:l}}(n,o,t);return D.runKernelFunc(function(a,s){var u=a.gather(n,o.flatten(),t);return s([o]),u},{x:n,indices:o},function(a,s){var u=s[0];return{x:function(){var c=n.shape,l=u.size,h=c.slice(0,t),d=h.length,f=c.slice(t,c.length).slice(1),p=f.length,v=zh(0,d),m=zh(d+1,d+1+p),g=Gh([h,[l],f]),_=a.reshape(g),x=u.reshape([l]),b=Gh([[d],v,m]),y=_.transpose(b),w=op(y,x,n.shape[t]),E=gc(b);return w=w.transpose(E)},indices:function(){return u}}},"Gather",{axis:t}).reshape(i.outputShape)}}),op=N({unsortedSegmentSum_:function(r,e,t){var n=k(r,"x","unsortedSegmentSum"),o=k(e,"segmentIds","unsortedSegmentSum","int32");return R(Je(t),function(){return"numSegments must be of dtype int"}),D.runKernelFunc(function(i,a){var s=i.unsortedSegmentSum(n,o,t);return a([o]),s},{$x:n},function(i,a){var s=a[0];return{$x:function(){return function(u,c){for(var l=Rc(c,Te(c)),h=Nc(u,l),d=rp(c,J(0,"int32")),f=h.rank-d.rank,p=0;p<f;++p)d=tn(d,p+1);d=vs(d,jo(h.shape,"bool"));var v=Te(h);return jr(d,h,v)}(i,s)}}})}}),Ib=function(r,e,t){return ne(this,void 0,void 0,function(){var n,o,i,a,s,u,c,l,h,d,f,p,v;return re(this,function(m){switch(m.label){case 0:for(n=k(r,"tensor","boolMask"),o=k(e,"mask","boolMask","bool"),i=t??0,a=o.rank,s=n.shape,R(a>0,function(){return"mask cannot be scalar"}),Ne(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),h=n.reshape(l),d=o.reshape([-1]),[4,Qf(d)];case 1:return f=m.sent(),p=f.squeeze([1]),v=Nc(h,p,i),r!==n&&n.dispose(),e!==o&&o.dispose(),p.dispose(),h.dispose(),d.dispose(),f.dispose(),[2,v]}})})};function ip(r,e,t,n,o,i,a){i===void 0&&(i="NHWC"),R(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,r[0],r[1],r[2]]),R(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),R(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),R(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var l=i==="NHWC"?s[3]:s[1],h=i==="NHWC"?u.shape[3]:u.shape[1];R(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."}),R(h===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[3]+"."}),a!=null&&R(Je(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=wc(i),f=Qr(s,t.shape,n,1,o,a,!1,d),p=D.runKernelFunc(function(v,m){var g=v.conv2dDerInput(u,t,f);return m([t,u]),g},{dy4D:u,filter:t},function(v,m){var g=m[0],_=m[1];return{dy4D:function(){return cn(v,g,n,o,i,1,a)},filter:function(){return Dc(v,_,g.shape,n,o,i,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function fu(r){var e=function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i}(r),t=e[0],n=e[1],o=e[2];return t===1&&n===1&&o===1}function ap(r,e,t,n,o){R(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var i=r,a=e,s=!1;e.rank===4&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=a.shape[4];R(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),R(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),R(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),R(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),R(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[4]+"."});var l=Ua(i,t.shape,n,1,o),h=D.runKernelFunc(function(d){return d.conv3dDerInput(a,t,l)},{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var Rb=N({conv1d_:function(r,e,t,n,o,i,a){o===void 0&&(o="NWC"),i===void 0&&(i=1);var s=k(r,"x","conv1d"),u=k(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),R(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),R(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&R(Je(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}),R(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),R(Gt(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+i+"'"}),R(o==="NWC",function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),f=cn(d,h,[1,t],n,"NHWC",[1,i],a);return l?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),cn=N({conv2d_:function(r,e,t,n,o,i,a){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var s=k(r,"x","conv2d"),u=k(e,"filter","conv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),R(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),R(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&R(Je(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."});var h=o==="NHWC"?c.shape[3]:c.shape[1];R(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),R(Gt(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"});var d=wc(o),f=Qr(c.shape,u.shape,t,i,n,a,!1,d),p=[u,c],v=D.runKernelFunc(function(m,g){var _=m.conv2d(c,u,f);return g([u,c]),_},{x:c,filter:u},function(m,g){var _=g,x=_[0],b=_[1];return R(Mo(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return sp(b.shape,m,x,t,n,o)},filter:function(){return Dc(b,m,x.shape,t,n,o)}}},"Conv2D",f,p);return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Nb=N({conv3d_:function(r,e,t,n,o,i){o===void 0&&(o="NDHWC"),i===void 0&&(i=[1,1,1]);var a=k(r,"x","conv3d"),s=k(e,"filter","conv3d"),u=a,c=!1;a.rank===4&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),R(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),R(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),R(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),R(function(d,f){return fu(d)||fu(f)}(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}),R(o==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var l=Ua(u.shape,s.shape,t,i,n),h=D.runKernelFunc(function(d,f){var p=d.conv3d(u,s,l);return f([u,s]),p},{x:u,$filter:s},function(d,f){R(fu(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=f[0],v=f[1];return{x:function(){return ap(p.shape,d,v,t,n)},$filter:function(){return function(m,g,_,x,b){var y=m;m.rank===4&&(y=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]));var w=g;w.rank===4&&(w=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3])),R(y.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+y.shape+"."}),R(w.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+w.shape+"."}),R(_.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+_+"."}),R(y.shape[4]===_[3],function(){return"Error in conv3dDerFilter: depth of input "+y.shape[4]+") must match input depth in filter ("+_[3]+"."}),R(w.shape[4]===_[4],function(){return"Error in conv3dDerFilter: depth of dy ("+w.shape[4]+") must match output depth for filter ("+_[4]+")."});var E=Ua(y.shape,_,x,1,b);return D.runKernelFunc(function(C){return C.conv3dDerFilter(y,w,E)},{x5D:y,dy5D:w})}(p,d,v.shape,t,n)}}});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Dc=N({conv2dDerFilter_:function(r,e,t,n,o,i,a){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),R(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),R(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),R(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];R(c===t[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+t[2]+"."}),R(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+t[3]+")."}),a!=null&&R(Je(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var h=wc(i),d=Qr(s.shape,t,n,1,o,a,!1,h);return D.runKernelFunc(function(f){return f.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),sp=N({conv2dDerInput_:ip}),ms=N({depthwiseConv2d_:function(r,e,t,n,o,i,a){i===void 0&&(i=[1,1]);var s=k(r,"x","depthwiseConv2d"),u=k(e,"filter","depthwiseConv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),R(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),R(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),R(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),i==null&&(i=[1,1]),R(Gt(t,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}),a!=null&&R(Je(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."});var h=Qr(c.shape,u.shape,t,i,n,a,!0),d=[c,u],f=D.runKernelFunc(function(p,v){var m=p.depthwiseConv2D(c,u,h);return v([c,u]),m},{x:c,filter:u},function(p,v){R(Mo(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var m=v[0],g=v[1];return{x:function(){return up(m.shape,p,g,h)},filter:function(){return cp(m,p,g.shape,h)}}},"DepthwiseConv2dNative",h,d);return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),up=N({depthwiseConv2dDerInput_:function(r,e,t,n){var o=e,i=!1;e.rank===3&&(i=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=D.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,t,n)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),cp=N({depthwiseConv2dDerFilter_:function(r,e,t,n){var o=r;r.rank===3&&(o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=e;return i.rank===3&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),D.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(o,i,n)},{x4D:o,dy4D:i})}}),Oc=N({separableConv2d_:function(r,e,t,n,o,i,a){i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC");var s=k(r,"x","separableConv2d"),u=k(e,"depthwiseFilter","separableConv2d"),c=k(t,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(s.rank===3&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");R(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),R(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),R(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),R(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),R(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var d=u.shape[2],f=u.shape[3];R(c.shape[2]===d*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*f+", but got "+c.shape[2]+"."});var p=ms(l,u,n,o,a,i),v=cn(p,c,1,"valid",a);return h?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Db=N({conv2dTranspose_:function(r,e,t,n,o,i){return ip(t,k(r,"x","conv2dTranspose"),k(e,"filter","conv2dTranspose"),n,o,"NHWC",i)}}),Ob=N({conv3dTranspose_:function(r,e,t,n,o){return ap(t,k(r,"x","conv3dTranspose"),k(e,"filter","conv3dTranspose"),n,o)}}),gs=N({matMul_:function(r,e,t,n){var o;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=k(r,"a","matMul"),a=k(e,"b","matMul");o=Xe(i,a),i=o[0],a=o[1];var s=t?i.shape[i.rank-2]:i.shape[i.rank-1],u=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=t?i.shape[i.rank-1]:i.shape[i.rank-2],l=n?a.shape[a.rank-2]:a.shape[a.rank-1],h=i.shape.slice(0,-2),d=a.shape.slice(0,-2),f=ie(h),p=ie(d);R(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),R(vt(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),R(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+n+" must match."});var v=i.shape.slice(0,-2).concat([c,l]),m=t?i.as3D(f,s,c):i.as3D(f,c,s),g=n?a.as3D(p,l,u):a.as3D(p,u,l),_={transposeA:t,transposeB:n};return D.runKernelFunc(function(x,b){var y=x.batchMatMul(m,g,t,n);return b([m,g]),y},{a:m,b:g},function(x,b){var y=b,w=y[0],E=y[1];return t||n?!t&&n?{a:function(){return x.matMul(E,!1,!1)},b:function(){return x.matMul(w,!0,!1)}}:t&&!n?{a:function(){return E.matMul(x,!1,!0)},b:function(){return w.matMul(x,!1,!1)}}:{a:function(){return E.matMul(x,!0,!0)},b:function(){return x.matMul(w,!0,!0)}}:{a:function(){return x.matMul(E,!1,!0)},b:function(){return w.matMul(x,!0,!1)}}},"BatchMatMul",_).reshape(v)}}),Fb=N({dot_:function(r,e){var t=k(r,"t1","dot"),n=k(e,"t2","dot");R(!(t.rank!==1&&t.rank!==2||n.rank!==1&&n.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+n.rank+"."});var o=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];return R(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),t.rank===1&&n.rank===1?t.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():t.rank===1&&n.rank===2?t.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():t.rank===2&&n.rank===1?t.matMul(n.as2D(-1,1)).as1D():t.matMul(n.as2D(n.shape[0],n.shape[1]))}}),Mb=N({outerProduct_:function(r,e){var t=k(r,"v1","outerProduct"),n=k(e,"v2","outerProduct");return R(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+n.rank+"."}),t.as2D(-1,1).matMul(n.as2D(1,-1))}}),Wi=N({reverse_:function(r,e){var t=k(r,"x","reverse");if(t.rank===0)return t.clone();var n=ft(e,t.shape);return D.runKernelFunc(function(o){return o.reverse(t,n)},{$x:t},function(o){return{$x:function(){return o.reverse(n)}}}).reshapeAs(t)}}),Pb=N({reverse1d_:function(r){var e=k(r,"x","reverse");return R(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Wi(e,0)}}),Bb=N({reverse2d_:function(r,e){var t=k(r,"x","reverse");return R(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Wi(t,e)}}),Lb=N({reverse3d_:function(r,e){var t=k(r,"x","reverse");return R(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Wi(t,e)}}),Wb=N({reverse4d_:function(r,e){var t=k(r,"x","reverse");return R(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Wi(t,e)}});function lp(r,e,t,n,o,i){var a=k(r,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),R(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),R(Gt(t,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"}),i!=null&&R(Je(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=xi(s.shape,e,t,n,o,i);if(c.filterWidth===1&&c.filterHeight===1&&vt(c.inShape,c.outShape))return a.clone();var l=[s],h=D.runKernelFunc(function(d,f){var p=d.maxPool(s,c);return f([s,p]),p},{x:s},function(d,f){var p=f[0],v=f[1];return{x:function(){return function(m,g,_,x,b,y,w,E){var C=k(m,"dy","maxPoolBackprop"),T=k(g,"input","maxPoolBackprop"),S=k(_,"output","maxPoolBackprop");R(T.rank===C.rank,function(){return"Rank of input ("+T.rank+") does not match rank of dy ("+C.rank+")"}),R(Gt(b,y),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+y+"'"}),R(C.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+C.rank+"."}),R(T.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+T.rank+"."});var I=xi(T.shape,x,b,y,w,E);return D.runKernelFunc(function(A){return A.maxPoolBackprop(C,T,S,I)},{$dy:C,$input:T})}(d,p,v,e,t,n,o)}}},"MaxPool",c,l);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function hp(r,e,t,n,o,i){var a=k(r,"x","avgPool","float32");R(Gt(t,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),R(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),i!=null&&R(Je(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=xi(s.shape,e,t,n,o,i);if(c.filterWidth===1&&c.filterHeight===1&&vt(c.inShape,c.outShape))return a.clone();var l=D.runKernelFunc(function(h){return h.avgPool(s,c)},{x:s},function(h){return{x:function(){return function(d,f,p,v,m,g){var _=k(d,"dy","avgPoolBackprop"),x=k(f,"input","avgPoolBackprop");R(x.rank===_.rank,function(){return"Rank of input ("+x.rank+") does not match rank of dy ("+_.rank+")"}),R(Gt(v,m),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+m+"'"});var b=x,y=_,w=!1;x.rank===3&&(w=!0,b=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]),y=_.as4D(1,_.shape[0],_.shape[1],_.shape[2])),R(y.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+y.rank+"."}),R(b.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var E=xi(b.shape,p,v,m,g),C=D.runKernelFunc(function(T){return T.avgPoolBackprop(y,b,E)},{dy4D:y,input4D:b});return w?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}(h,s,e,t,n,o)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var pt=N({maxPool_:function(r,e,t,n,o){return lp(r,e,t,1,n,o)}}),Vi=N({avgPool_:function(r,e,t,n,o){return hp(r,e,t,1,n,o)}}),Vb=N({pool_:function(r,e,t,n,o,i){o==null&&(o=[1,1]),i==null&&(i=1),n===0&&(n="valid");var a=k(r,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),R(Gt(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var c,l=xi(s.shape,e,i,o,n),h=[l.dilationHeight,l.dilationWidth];c=n==="same"?function(b,y){var w=b.map(function(T,S){return T+(T-1)*(y[S]-1)}).map(function(T){return T-1}),E=w.map(function(T){return Math.floor(T/2)}),C=w.map(function(T,S){return T-E[S]});return w.map(function(T,S){return[E[S],C[S]]})}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var d=h[0]===1&&h[1]===1,f=function(b,y,w){var E=w.map(function(O){return O[0]}),C=w.map(function(O){return O[1]}),T=b.concat(E,C),S=y.map(function(O,M){return(O-T[M]%O)%O}),I=C.map(function(O,M){return O+S[M]}),A=y.map(function(O,M){return[E[M],I[M]]}),F=y.map(function(O,M){return[0,S[M]]});return[A,F]}([l.inHeight,l.inWidth],h,c),p=f[0],v=f[1],m=d?n:"valid",g=d?s:gf(s,h,p),_=(t==="avg"?function(){return hp(g,e,i,1,m)}:function(){return lp(g,e,i,1,m)})(),x=d?_:pf(_,h,v);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),Ub=N({maxPool3d_:function(r,e,t,n,o,i,a){i===void 0&&(i="NDHWC");var s=k(r,"x","maxPool3d"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),R(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),R(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),R(Gt(t,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),o!=null&&R(Je(n),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var l=Va(u.shape,e,t,a,n,o,i),h=D.runKernelFunc(function(d,f){var p=d.maxPool3d(u,l);return f([u,p]),p},{x:u},function(d,f){var p=f[0],v=f[1];return{x:function(){return function(m,g,_,x,b,y,w,E){var C=k(m,"dy","maxPool3dBackprop"),T=k(g,"input","maxPool3dBackprop"),S=k(_,"output","maxPool3dBackprop"),I=C,A=T,F=S,O=!1;T.rank===4&&(O=!0,I=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),A=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3]),F=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3])),R(I.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+I.rank+"."}),R(A.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+A.rank+"."}),R(F.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+F.rank+"."}),y==null&&(y=[1,1,1]),R(Gt(b,y),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+y+"'"}),E!=null&&R(Je(w),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+E+" but got pad "+w+"."});var M=Va(A.shape,x,b,y,w,E),B=D.runKernelFunc(function(P){return P.maxPool3dBackprop(I,A,F,M)},{dy5D:I,input5D:A});return O?B.as4D(B.shape[1],B.shape[2],B.shape[3],B.shape[4]):B}(d,p,v,e,t,a,n,o)}}});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),zb=N({avgPool3d_:function(r,e,t,n,o,i,a){i===void 0&&(i="NDHWC");var s=k(r,"x","avgPool3d","float32"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),R(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),R(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),R(Gt(t,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),o!=null&&R(Je(n),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var l=Va(u.shape,e,t,a,n,o,i),h=D.runKernelFunc(function(d){return d.avgPool3d(u,l)},{x:u},function(d){return{x:function(){return function(f,p,v,m,g,_,x){var b=k(f,"dy","avgPool3dBackprop"),y=k(p,"input","avgPool3dBackprop"),w=b,E=y,C=!1;y.rank===4&&(C=!0,w=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),E=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3])),R(w.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+w.rank+"."}),R(E.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+E.rank+"."}),g==null&&(g=[1,1,1]),R(Gt(m,g),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"}),x!=null&&R(Je(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+_+"."});var T=Va(E.shape,v,m,g,_,x),S=D.runKernelFunc(function(I){return I.avgPool3dBackprop(w,E,T)},{dy5D:w,input5D:E});return C?S.as4D(S.shape[1],S.shape[2],S.shape[3],S.shape[4]):S}(d,u,e,t,a,n,o)}}});return h=h.cast(u.dtype),c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Wn=N({slice_:function(r,e,t){var n,o,i=k(r,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(n=typeof e=="number"?[e].concat(new Array(i.rank-1).fill(0)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(0)):e.slice()).forEach(function(u){R(u!==-1,function(){return"slice() does not support negative begin indexing."})}),o=(o=t==null?new Array(i.rank).fill(-1):typeof t=="number"?[t].concat(new Array(i.rank-1).fill(-1)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(-1)):t).map(function(u,c){return u>=0?u:(R(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),i.shape[c]-n[c])}),my(i,n,o);var a=i.shape,s={begin:n,size:o};return D.runKernelFunc(function(u){return u.slice(i,n,o)},{x:i},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([n[l],a[l]-n[l]-o[l]]);return{x:function(){return u.pad(c)}}},"Slice",s)}}),Gb=N({slice1d_:function(r,e,t){var n=k(r,"x","slice1d");return R(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),Wn(n,[e],[t])}}),qb=N({slice2d_:function(r,e,t){var n=k(r,"x","slice2d");return R(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),Wn(n,e,t)}}),dp=N({slice3d_:function(r,e,t){var n=k(r,"x","slice3d");return R(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),Wn(n,e,t)}}),Hb=N({slice4d_:function(r,e,t){var n=k(r,"x","slice4d");return R(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),Wn(n,e,t)}});function fp(r,e,t,n,o){return e.rank<t.rank&&(e=e.reshape(zt(e.shape,n))),r.rank<t.rank&&(r=r.reshape(zt(r.shape,n))),{x:function(){var i=r.mul(t.equal(e).cast(r.dtype));return o==null?i:i.transpose(o)}}}var jb=N({all_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","all","bool"),o=ft(e,n.shape),i=o,a=qn(i,n.rank);a!=null&&(n=n.transpose(a),i=Hn(i.length,n.rank));var s=D.runKernelFunc(function(c){return c.all(n,i)},{$x:n});if(t){var u=zt(s.shape,o);return s.reshape(u)}return s}}),Xb=N({any_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","any","bool"),o=ft(e,n.shape),i=o,a=qn(i,n.rank);a!=null&&(n=n.transpose(a),i=Hn(i.length,n.rank));var s=D.runKernelFunc(function(c){return c.any(n,i)},{$x:n});if(t){var u=zt(s.shape,o);return s.reshape(u)}return s}}),Kb=N({argMax_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","argMax");e==null&&(e=0);var n=ft(e,t.shape),o=qn(n,t.rank);o!=null&&(t=t.transpose(o),n=Hn(n.length,t.rank));var i={axis:n[0]},a=[t];return D.runKernelFunc(function(s,u){var c=s.argMax(t,n[0]);return u([t]),c},{x:t},function(s,u){var c=u[0];return{x:function(){return Te(c)}}},"ArgMax",i,a)}}),$b=N({argMin_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","argMin");e==null&&(e=0);var n=ft(e,t.shape),o=qn(n,t.rank);return o!=null&&(t=t.transpose(o),n=Hn(n.length,t.rank)),D.runKernelFunc(function(i,a){var s=i.argMin(t,n[0]);return a([t]),s},{$x:t},function(i,a){var s=a[0];return{$x:function(){return Te(s)}}})}}),Yb=N({logSumExp_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","logSumExp"),o=ft(e,n.shape),i=n.max(o,!0),a=n.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(t){var u=zt(s.shape,o);return s.reshape(u)}return s}}),ys=N({max_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","max"),o=n,i=ft(e,n.shape),a=i,s=qn(a,n.rank);s!=null&&(n=n.transpose(s),a=Hn(a.length,n.rank));var u=[n],c=D.runKernelFunc(function(h,d){var f=h.max(n,a);return d([o,f]),f},{x:n},function(h,d){return fp(h,d[1],d[0],i,s)},"Max",{axes:a},u,[!0]);if(t){var l=zt(c.shape,i);c=c.reshape(l)}return c}}),Zb=N({mean_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","mean"),o=ft(e,n.shape),i=ie(St(n.shape,o)[1]);return fs(function(a){var s=J(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var c=a.shape.slice();return o.forEach(function(l){c[l]=1}),u.reshape(c).mul(jo(a.shape,"float32")).div(i)}}})(n)}}),Jb=N({min_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","min"),o=n,i=ft(e,n.shape),a=i,s=qn(a,n.rank);s!=null&&(n=n.transpose(s),a=Hn(a.length,n.rank));var u=[n],c=D.runKernelFunc(function(h,d){var f=h.min(n,a);return d([o,f]),f},{x:n},function(h,d){return fp(h,d[1],d[0],i,s)},"Min",{axes:a},u,[!0]);if(t){var l=zt(c.shape,i);c=c.reshape(l)}return c}}),Qb=N({moments_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=ft(e,(r=k(r,"x","moments")).shape),o=r.mean(n,t),i=o.shape;t||(i=zt(o.shape,n));var a=r.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(n,t)}}}),pp=N({sum_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var o=ft(e,n.shape);return fs(function(i){var a=qn(o,i.rank),s=o,u=i;a!=null&&(u=i.transpose(a),s=Hn(s.length,i.rank));var c=function(f){var p=i.shape.slice();return o.forEach(function(v){p[v]=1}),f.reshape(p).mul(jo(i.shape,"float32"))},l={axes:s},h=D.runKernelFunc(function(f){return f.sum(u,s)},{x:u},function(f){return{x:function(){return c(f)}}},"Sum",l);if(t){var d=zt(h.shape,o);h=h.reshape(d)}return{value:h,gradFunc:c}})(n)}}),ex=N({prod_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var o=ft(e,n.shape),i=qn(o,n.rank),a=o,s=n;i!=null&&(s=n.transpose(i),a=Hn(a.length,n.rank));var u=D.runKernelFunc(function(l){return l.prod(s,a)},{permutedX:s});if(t){var c=zt(u.shape,o);u=u.reshape(c)}return u}}),vp=N({elu_:function(r){var e=k(r,"x","elu");return D.runKernelFunc(function(t,n){var o=t.elu(e);return n([o]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){return D.runKernelFunc(function(i){return i.eluDer(t,o)},{dy:t,y:o})}}})}}),tx=N({leakyRelu_:function(r,e){e===void 0&&(e=.2);var t=k(r,"x","leakyRelu");return Rc(J(e).mul(t),t)}}),mp=N({prelu_:function(r,e){var t=k(r,"x","prelu"),n=k(e,"alpha","prelu");return D.runKernelFunc(function(o,i){var a=o.prelu(t,n);return i([t,n]),a},{x:t,alpha:n},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return jr(u,o,o.mul(s))},alpha:function(){var c=jr(u,Te(o),o.mul(a)),l=lt(s.shape,o.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}},"Prelu")}}),je=N({relu_:function(r){var e=k(r,"x","relu");return e.dtype==="bool"?e.toInt():D.runKernelFunc(function(t,n){var o=t.relu(e);return n([e]),o},{x:e},function(t,n){var o=n[0];return{x:function(){return t.mulStrict(o.step().toFloat())}}},"Relu")}}),gp=N({relu6_:function(r){var e=k(r,"x","relu6");return e.dtype==="bool"?e.toInt():D.runKernelFunc(function(t,n){var o=t.relu6(e);return n([e]),o},{x:e},function(t,n){var o=n[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return t.mulStrict(i.toFloat())}}},"Relu6")}}),nx=N({selu_:function(r){var e=k(r,"x","selu");return D.runKernelFunc(function(t,n){var o=t.selu(e);return n([e]),o},{$x:e},function(t,n){var o=n[0];return{$x:function(){var i=o.greater(J(0)),a=J(kc),s=J(Ac),u=t.mul(s),c=t.mul(a).mul(o.toFloat().exp());return jr(i,u,c)}}})}}),wr=N({transpose_:function(r,e){var t=k(r,"x","transpose");if(e==null&&(e=t.shape.map(function(o,i){return i}).reverse()),R(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(o){R(o>=0&&o<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1)return t.clone();var n={perm:e};return D.runKernelFunc(function(o){return o.transpose(t,e)},{x:t},function(o){var i=gc(e);return{x:function(){return o.transpose(i)}}},"Transpose",n)}}),rx=N({localResponseNormalization_:function(r,e,t,n,o){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),o===void 0&&(o=.5);var i=k(r,"x","localResponseNormalization");R(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),R(Je(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=i,s=!1;i.rank===3&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=D.runKernelFunc(function(c,l){var h=c.localResponseNormalization4D(a,e,t,n,o);return l([a,h]),h},{x4D:a},function(c,l){var h=l[0],d=l[1];return{x4D:function(){return D.runKernelFunc(function(f){return f.LRNGrad(c,h,d,e,t,n,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),yp=N({norm_:function(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1);var o=function s(u,c,l){if(l===void 0&&(l=null),u.rank===0)return u.abs();if(u.rank!==1&&l===null)return s(u.reshape([-1]),c,l);if(u.rank===1||typeof l=="number"||Array.isArray(l)&&l.length===1){if(c===1)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if(c==="euclidean"||c===2)return u.abs().pow(J(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&l.length===2){if(c===1)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if(c==="fro"||c==="euclidean")return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(r=k(r,"x","norm"),e,t),i=o.shape;if(n){var a=ft(t,r.shape);i=zt(o.shape,a)}return o.reshape(i)}}),ox=N({basicLSTMCell_:function(r,e,t,n,o,i){var a=k(r,"forgetBias","basicLSTMCell"),s=k(e,"lstmKernel","basicLSTMCell"),u=k(t,"lstmBias","basicLSTMCell"),c=k(n,"data","basicLSTMCell"),l=k(o,"c","basicLSTMCell"),h=k(i,"h","basicLSTMCell"),d=c.concat(h,1).matMul(s).add(u),f=d.shape[0],p=d.shape[1]/4,v=[f,p],m=d.slice([0,0],v),g=d.slice([0,p],v),_=d.slice([0,2*p],v),x=d.slice([0,3*p],v),b=m.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(a.add(_).sigmoid())),y=b.tanh().mulStrict(x.sigmoid());return[b,y]}}),ix=N({multiRNNCell_:function(r,e,t,n){for(var o=k(e,"data","multiRNNCell"),i=Fa(t,"c","multiRNNCell"),a=Fa(n,"h","multiRNNCell"),s=o,u=[],c=0;c<r.length;c++){var l=r[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var h=[],d=[];for(c=0;c<u.length;c+=2)h.push(u[c]),d.push(u[c+1]);return[h,d]}}),ax=N({movingAverage_:function(r,e,t,n,o){o===void 0&&(o=!0);var i=k(r,"v","movingAverage"),a=k(e,"x","movingAverage"),s=k(t,"decay","movingAverage");rg(i,a),R(vt(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=J(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){R(n!=null,function(){return"When using zeroDebias: true, step is required."});var h=k(n,"step","movingAverage");l=l.div(u.sub(qa(s,h)))}return i.add(l)}}),sx=N({stridedSlice_:function(r,e,t,n,o,i,a,s,u){if(o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),n==null&&(n=new Array(e.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var c=k(r,"x","stridedSlice"),l=wh(s),h=c.shape.slice();l.forEach(function(m){e[m]=0,t[m]=1,h.splice(m,0,1)}),c=c.reshape(h);for(var d=0;d<c.rank;d++)e[d]=gy(o,e,n,c.shape,d),t[d]=yy(i,t,n,c.shape,d),n[d]=n[d]||1;var f=wh(u);f.forEach(function(m){t[m]=e[m]+1,n[m]=1});var p=xc(e,t,n),v=p.filter(function(m,g){return f.indexOf(g)===-1});return n.every(function(m){return m===1})?Wn(c,e,p).reshape(v):D.runKernelFunc(function(m){return m.stridedSlice(c,e,t,n)},{$x:c}).reshape(v)}}),ux=N({topk_:function(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=k(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=n.shape[n.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var i=D.runKernelFunc(function(a){return a.topk(n,e,t)},{$x:n});return{values:i[0],indices:i[1]}}}),cx=N({scatterND_:function(r,e,t){var n=k(r,"indices","scatterND","int32"),o=k(e,"updates","scatterND");return vy(o,n,t),D.runKernelFunc(function(i){return i.scatterND(n,o,t)},{indices:n,updates:o},null,"ScatterNd",{shape:t})}}),Fc=N({fft_:function(r){R(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return D.runKernelFunc(function(o){return o.fft(n)},{input:r}).reshape(r.shape)}}),Ha=N({ifft_:function(r){R(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return D.runKernelFunc(function(o){return o.ifft(n)},{input:r}).reshape(r.shape)}}),Mc=N({rfft_:function(r,e){R(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t,n=r.shape[r.shape.length-1],o=r.size/n;if(e!=null&&e<n){var i=r.shape.map(function(g){return 0}),a=r.shape.map(function(g){return g});a[r.shape.length-1]=e,t=r.slice(i,a),n=e}else if(e!=null&&e>n){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-n,t=r.concat(Ve(s),r.shape.length-1),n=e}else t=r;var u=t.zerosLike(),c=xt(t,u).as2D(o,n),l=Fc(c),h=Math.floor(n/2)+1,d=nn(l),f=Fn(l),p=d.split([h,n-h],d.shape.length-1),v=f.split([h,n-h],f.shape.length-1),m=t.shape.slice();return m[t.shape.length-1]=h,xt(p[0],v[0]).reshape(m)}}),_p=N({irfft_:function(r){var e=r.shape[r.shape.length-1],t=r.size/e;if(e<=2){var n=r.as2D(t,e),o=Ha(n);return nn(o)}var i=[t,2*(e-1)],a=nn(r).as2D(t,e),s=Fn(r).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),c=s.slice([0,1],[t,e-2]).reverse(1).mul(J(-1)),l=a.concat(u,1),h=s.concat(c,1);return n=xt(l,h).as2D(i[0],i[1]),o=Ha(n),nn(o)}}),lx=Object.freeze({fft:Fc,ifft:Ha,rfft:Mc,irfft:_p}),hx=N({sparseToDense_:function(r,e,t,n){n===void 0&&(n=0);var o=k(r,"sparseIndices","sparseToDense","int32"),i=k(e,"sparseValues","sparseToDense"),a=k(n,"defaultValue","sparseToDense",i.dtype);return function(s,u,c,l){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var h=s.rank>0?s.shape[0]:1,d=s.rank>1?s.shape[1]:1;if(c.length!==d)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+d+".");var f=u.size;if(u.rank!==0&&(u.rank!==1||f!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,t,a),D.runKernelFunc(function(s){return s.sparseToDense(o,i,t,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),dx=N({gatherND_:function(r,e){var t=k(e,"indices","gatherND","int32"),n=k(r,"x","gatherND");return D.runKernelFunc(function(o){return o.gatherND(n,t)},{x:n,indices:t},null,"GatherNd")}}),fx=N({diag_:function(r){var e=k(r,"x","diag").flatten(),t=r.shape.concat(r.shape);return D.runKernelFunc(function(n){return n.diag(e)},{$x:e}).reshape(t)}}),px=N({dropout_:function(r,e,t,n){var o=k(r,"x","dropout");if(R(o.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),R(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof He?o.clone():o;var i=function(u,c){if(c==null)return u.shape.slice();if(vt(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],h=0;h<u.shape.length;h++)c[h]==null&&u.shape[h]!=null?l.push(u.shape[h]):l.push(c[h]);return l}return c}(o,t),a=1-e,s=mf(i,0,1,"float32",n).add(a).floor().div(a);return o.mul(s)}});function bp(r,e,t){for(var n=1-r%2,o=new Float32Array(r),i=0;i<r;++i){var a=2*Math.PI*i/(r+n-1);o[i]=e-t*Math.cos(a)}return rt(o,"float32")}var Pc=N({hannWindow_:function(r){return bp(r,.5,.5)}}),xp=N({hammingWindow_:function(r){return bp(r,.54,.46)}}),Bc=N({frame_:function(r,e,t,n,o){n===void 0&&(n=!1),o===void 0&&(o=0);for(var i=0,a=[];i+e<=r.size;)a.push(Wn(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=st([Wn(r,i,e-s),Ln([s],o)]);a.push(u),i+=t}return a.length===0?yr([],[0,e]):st(a).as2D(a.length,e)}}),wp=N({stft_:function(r,e,t,n,o){var i;o===void 0&&(o=Pc),n==null&&(i=e,n=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var a=Bc(r,e,t),s=It(a,o(e)),u=[],c=0;c<a.shape[0];c++)u.push(Mc(s.slice([c,0],[1,e]),n));return st(u)}}),vx=Object.freeze({hannWindow:Pc,hammingWindow:xp,frame:Bc,stft:wp}),At,mx=function(r,e,t){return t===void 0&&(t=1),ne(this,void 0,void 0,function(){var n,o,i,a,s,u,c,l,h,d,f,p,v,m;return re(this,function(g){switch(g.label){case 0:return n=k(r,"predictions","inTopK"),o=k(e,"targets","inTopK"),R(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank}),R(n.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+o.rank}),Ne(n.shape.slice(0,n.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],R(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+t}),[4,n.data()];case 1:return a=g.sent(),[4,o.data()];case 2:for(s=g.sent(),u=[a.length/i,i],l=u[1],h=yi("bool",c=u[0]),d=0;d<c;d++){for(f=d*l,p=a.subarray(f,f+l),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort(function(_,x){return x.value-_.value}),h[d]=0,m=0;m<t;m++)if(v[m].index===s[d]){h[d]=1;break}}return r!==n&&n.dispose(),e!==o&&o.dispose(),[2,Ct(h,o.shape,"bool")]}})})};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(At||(At={}));var gx=N({absoluteDifference_:function(r,e,t,n){n===void 0&&(n=At.SUM_BY_NONZERO_WEIGHTS);var o=k(r,"labels","absoluteDifference"),i=k(e,"predictions","absoluteDifference"),a=null;t!=null&&(a=k(t,"weights","absoluteDifference")),Ne(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return or(s,a,n)}}),or=N({computeWeightedLoss_:function(r,e,t){t===void 0&&(t=At.SUM_BY_NONZERO_WEIGHTS);var n=k(r,"losses","computeWeightedLoss"),o=null;e!=null&&(o=k(e,"weights","computeWeightedLoss"));var i=o==null?n:n.mul(o);if(t===At.NONE)return i;if(t===At.SUM)return i.sum();if(t===At.MEAN){if(o==null)return i.mean();var a=n.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(J(a)):s}if(t===At.SUM_BY_NONZERO_WEIGHTS){if(o==null)return i.sum().div(J(n.size));var u=o.mul(jo(n.shape)).notEqual(J(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+t)}}),yx=N({cosineDistance_:function(r,e,t,n,o){o===void 0&&(o=At.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"labels","cosineDistance"),a=k(e,"predictions","cosineDistance"),s=null;n!=null&&(s=k(n,"weights","cosineDistance")),Ne(i.shape,a.shape,"Error in cosineDistance: ");var u=J(1).sub(i.mul(a).sum(t,!0));return or(u,s,o)}}),_x=N({hingeLoss_:function(r,e,t,n){n===void 0&&(n=At.SUM_BY_NONZERO_WEIGHTS);var o=k(r,"labels","hingeLoss"),i=k(e,"predictions","hingeLoss"),a=null;t!=null&&(a=k(t,"weights","hingeLoss")),Ne(o.shape,i.shape,"Error in hingeLoss: ");var s=J(1);o=J(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return or(u,a,n)}}),bx=N({huberLoss_:function(r,e,t,n,o){n===void 0&&(n=1),o===void 0&&(o=At.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"labels","huberLoss"),a=k(e,"predictions","huberLoss"),s=null;t!=null&&(s=k(t,"weights","huberLoss")),Ne(i.shape,a.shape,"Error in huberLoss: ");var u=J(n),c=a.sub(i).abs(),l=tp(c,u),h=c.sub(l),d=J(.5).mul(l.square()).add(u.mul(h));return or(d,s,o)}}),xx=N({logLoss_:function(r,e,t,n,o){n===void 0&&(n=1e-7),o===void 0&&(o=At.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"labels","logLoss"),a=k(e,"predictions","logLoss"),s=null;t!=null&&(s=k(t,"weights","logLoss")),Ne(i.shape,a.shape,"Error in logLoss: ");var u=J(1),c=J(n),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return or(l,s,o)}}),wx=N({meanSquaredError_:function(r,e,t,n){n===void 0&&(n=At.SUM_BY_NONZERO_WEIGHTS);var o=k(r,"labels","meanSquaredError"),i=k(e,"predictions","meanSquaredError"),a=null;t!=null&&(a=k(t,"weights","meanSquaredError")),Ne(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return or(s,a,n)}}),Cx=N({sigmoidCrossEntropy_:function(r,e,t,n,o){n===void 0&&(n=0),o===void 0&&(o=At.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"multiClassLabels","sigmoidCrossEntropy"),a=k(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=k(t,"weights","sigmoidCrossEntropy")),Ne(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=J(n),c=J(1),l=J(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var h=function(d,f){var p=k(d,"labels","sigmoidCrossEntropyWithLogits"),v=k(f,"logits","sigmoidCrossEntropyWithLogits");Ne(p.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var m=v.relu(),g=v.mul(p),_=v.abs().neg().exp().log1p();return m.sub(g).add(_)}(i,a);return or(h,s,o)}}),Ex=N({softmaxCrossEntropy_:function(r,e,t,n,o){n===void 0&&(n=0),o===void 0&&(o=At.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"onehotLabels","softmaxCrossEntropy"),a=k(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=k(t,"weights","softmaxCrossEntropy")),Ne(i.shape,a.shape,"Error in softmaxCrossEntropy: "),n>0){var u=J(n),c=J(1),l=J(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var h=function(d,f,p){if(p===void 0&&(p=-1),p===-1&&(p=f.rank-1),p!==f.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+f.rank+" and dim was "+p);return fs(function(v,m,g){var _=m.logSumExp([p],!0),x=m.toFloat().sub(_);return g([v,x]),{value:x.mul(v).neg().sum([p]),gradFunc:function(b,y){var w=y[0],E=y[1],C=zt(b.shape,[p]);return[b.reshape(C).mul(w.toFloat().sub(E.exp())),b.reshape(C).mul(E.exp().sub(w.toFloat()))]}}})(d,f)}(i,a);return or(h,s,o)}}),Sx=Object.freeze({get Reduction(){return At},absoluteDifference:gx,computeWeightedLoss:or,cosineDistance:yx,hingeLoss:_x,huberLoss:bx,logLoss:xx,meanSquaredError:wx,sigmoidCrossEntropy:Cx,softmaxCrossEntropy:Ex});function qh(r,e){return e===void 0&&(e=!1),D.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var t=r.shape[0],n=r.shape[1],o=vf(t),i=r.clone(),a=yr([[1]],[1,1]),s=a.clone(),u=t>=n?n:t,c=function(h){var d,f=i,p=s,v=o;d=D.tidy(function(){var m=i.slice([h,h],[t-h,1]),g=m.norm(),_=i.slice([h,h],[1,1]),x=yr([[-1]]).where(_.greater(0),yr([[1]])),b=_.sub(x.mul(g)),y=m.div(b);s=y.shape[0]===1?a.clone():a.concat(y.slice([1,0],[y.shape[0]-1,y.shape[1]]),0);var w=x.matMul(b).div(g).neg(),E=i.slice([h,0],[t-h,n]),C=w.mul(s);if(h===0)i=E.sub(C.matMul(s.transpose().matMul(E)));else{var T=E.sub(C.matMul(s.transpose().matMul(E)));i=i.slice([0,0],[h,n]).concat(T,0)}var S=o.slice([0,h],[t,o.shape[1]-h]);if(h===0)o=S.sub(S.matMul(s).matMul(C.transpose()));else{var I=S.sub(S.matMul(s).matMul(C.transpose()));o=o.slice([0,0],[t,h]).concat(I,1)}return[s,i,o]}),s=d[0],i=d[1],o=d[2],Vt([f,p,v])},l=0;l<u;++l)c(l);return!e&&t>n&&(o=o.slice([0,0],[t,n]),i=i.slice([0,0],[n,n])),[o,i]})}var Tx=N({bandPart_:function(r,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var n=k(r,"a","bandPart");if(n.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+n.rank+".");var o=n.shape,i=n.shape.slice(-2),a=i[0],s=i[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),t<0&&(t=s);var u=Ma(0,a,1,"int32").reshape([-1,1]),c=Ma(0,s,1,"int32"),l=ht(u,c),h=vs(l.lessEqual(J(+e,"int32")),l.greaterEqual(J(-t,"int32"))),d=Ve([a,s],n.dtype);return Jt(ut(n.reshape([-1,a,s])).map(function(f){return jr(h,f,d)})).reshape(o)}}),kx=N({gramSchmidt_:function(r){var e;if(Array.isArray(r)){e=!1,R(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){R(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[u].shape[0]+" vs. "+t+")"})},o=1;o<r.length;++o)n(o)}else e=!0,r=_c(r,r.shape[0],0).map(function(u){return yf(u,[0])});R(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var i=[],a=r,s=function(u){i.push(D.tidy(function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var h=pp(i[l].mulStrict(c)).mul(i[l]);c=c.sub(h)}return c.div(yp(c,"euclidean"))}))};for(o=0;o<r.length;++o)s(o);return e?Jt(i,0):i}}),Ax=N({qr_:function(r,e){if(e===void 0&&(e=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return qh(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(a,s){return a*s}),n=ut(r.reshape([t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),o=[],i=[];return n.forEach(function(a){var s=qh(a,e),u=s[0],c=s[1];o.push(u),i.push(c)}),[Jt(o,0).reshape(r.shape),Jt(i,0).reshape(r.shape)]}}),Ix=Object.freeze({bandPart:Tx,gramSchmidt:kx,qr:Ax});function _s(r,e,t,n,o,i){n==null&&(n=.5),o==null&&(o=Number.NEGATIVE_INFINITY),i==null&&(i=0);var a=r.shape[0];return t=Math.min(t,a),R(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),R(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),R(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),R(e.rank===1,function(){return"scores must be a 1D tensor"}),R(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),R(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:o,softNmsSigma:i}}var Rx=N({resizeBilinear_:function(r,e,t){t===void 0&&(t=!1);var n=k(r,"images","resizeBilinear");R(n.rank===3||n.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),R(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var o=n,i=!1;n.rank===3&&(i=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e[0],s=e[1],u=D.runKernelFunc(function(c,l){return l([o]),c.resizeBilinear(o,a,s,t)},{x:o},function(c,l){return{x:function(){return D.runKernelFunc(function(h){return h.resizeBilinearBackprop(c,l[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Nx=N({resizeNearestNeighbor_:function(r,e,t){t===void 0&&(t=!1);var n=k(r,"images","resizeNearestNeighbor");R(n.rank===3||n.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),R(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),R(n.dtype==="float32"||n.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var o=n,i=!1;n.rank===3&&(i=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e[0],s=e[1],u=D.runKernelFunc(function(c,l){return l([o]),c.resizeNearestNeighbor(o,a,s,t)},{batchImages:o},function(c,l){return{batchImages:function(){return D.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(c,l[0],t)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Dx=N({nonMaxSuppression_:function(r,e,t,n,o){n===void 0&&(n=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var i=k(r,"boxes","nonMaxSuppression"),a=k(e,"scores","nonMaxSuppression"),s=_s(i,a,t,n,o);t=s.maxOutputSize,n=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:o};return D.runKernelFunc(function(c){return c.nonMaxSuppression(i,a,t,n,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",u)}}),Ox=function(r,e,t,n,o){return n===void 0&&(n=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),ne(this,void 0,void 0,function(){var i,a,s,u,c,l,h;return re(this,function(d){switch(d.label){case 0:return i=k(r,"boxes","nonMaxSuppressionAsync"),a=k(e,"scores","nonMaxSuppressionAsync"),s=_s(i,a,t,n,o),t=s.maxOutputSize,n=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=d.sent(),c=u[0],l=u[1],h=Cc(c,l,t,n,o),i!==r&&i.dispose(),a!==e&&a.dispose(),[2,h]}})})},Fx=N({nonMaxSuppressionWithScore_:function(r,e,t,n,o,i){n===void 0&&(n=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var a=k(r,"boxes","nonMaxSuppression"),s=k(e,"scores","nonMaxSuppression"),u=_s(a,s,t,n,o,i),c={maxOutputSize:t=u.maxOutputSize,iouThreshold:n=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=D.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),Mx=function(r,e,t,n,o,i){return n===void 0&&(n=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),ne(this,void 0,void 0,function(){var a,s,u,c,l,h,d;return re(this,function(f){switch(f.label){case 0:return a=k(r,"boxes","nonMaxSuppressionAsync"),s=k(e,"scores","nonMaxSuppressionAsync"),u=_s(a,s,t,n,o,i),t=u.maxOutputSize,n=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=f.sent(),l=c[0],h=c[1],d=Ec(l,h,t,n,o,i),a!==r&&a.dispose(),s!==e&&s.dispose(),[2,d]}})})},Px=N({cropAndResize_:function(r,e,t,n,o,i){var a=k(r,"image","cropAndResize"),s=k(e,"boxes","cropAndResize","float32"),u=k(t,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return R(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),R(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),R(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),R(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),R(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),R(o==="bilinear"||o==="nearest",function(){return"method must be bilinear or nearest, but was "+o}),D.runKernelFunc(function(l,h){return l.cropAndResize(a,s,u,n,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:n})}}),Lc=Object.freeze({resizeBilinear:Rx,resizeNearestNeighbor:Nx,nonMaxSuppression:Dx,nonMaxSuppressionAsync:Ox,nonMaxSuppressionWithScore:Fx,nonMaxSuppressionWithScoreAsync:Mx,cropAndResize:Px}),Wc=function(r,e){return!(r>0)||e==="linear"},Vc=function(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return r.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},Uc=function(r,e){var t=e,n=lt(r.shape,e.shape);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},zc=function(r,e,t){if(e==="linear")return r;if(e==="relu")return je(r);if(e==="elu")return vp(r);if(e==="relu6")return gp(r);if(e==="prelu")return mp(r,t);throw new Error("Unknown fused activation "+e+".")},Bx=N({fusedMatMul_:function(r){var e,t=r.a,n=r.b,o=r.transposeA,i=o!==void 0&&o,a=r.transposeB,s=a!==void 0&&a,u=r.bias,c=r.activation,l=c===void 0?"linear":c,h=r.preluActivationWeights;if(Wc(D.state.gradientDepth,l)===!1){var d=gs(t,n,i,s);return u!=null&&(d=be(d,u)),zc(d,l,h)}var f=k(t,"a","fused matMul"),p=k(n,"b","fused matMul");e=Xe(f,p),f=e[0],p=e[1];var v=i?f.shape[f.rank-2]:f.shape[f.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=i?f.shape[f.rank-1]:f.shape[f.rank-2],_=s?p.shape[p.rank-2]:p.shape[p.rank-1],x=f.shape.slice(0,-2),b=p.shape.slice(0,-2),y=ie(x),w=ie(b);R(f.rank>=2&&p.rank>=2&&f.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."}),R(vt(x,b),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+b+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."}),R(v===m,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var E,C,T=f.shape.slice(0,-2).concat([g,_]),S=i?f.as3D(y,v,g):f.as3D(y,g,v),I=s?p.as3D(w,_,m):p.as3D(w,m,_);u!=null&&xe(T,(E=Xe(E=k(u,"bias","fused matMul"),f)[0]).shape),h!=null&&(C=k(h,"prelu weights","fused matMul"));var A={a:S,b:I};u!=null&&(A.bias=E),h!=null&&(A.preluActivationWeights=C);var F=[S,I];return D.runKernelFunc(function(O,M){var B=O.fusedBatchMatMul({a:S,b:I,transposeA:i,transposeB:s,bias:E,activation:l,preluActivationWeights:C});return M([S,I,B]),B},A,function(O,M){var B=M[0],P=M[1],L=M[2],W=Vc(O,L,l),z={};return u!=null&&(z={bias:function(){return Uc(E,W)}}),Object.assign(i||s?!i&&s?{a:function(){return W.matMul(P,!1,!1)},b:function(){return W.matMul(B,!0,!1)}}:i&&!s?{a:function(){return P.matMul(W,!1,!0)},b:function(){return B.matMul(W,!1,!1)}}:{a:function(){return P.matMul(W,!0,!0)},b:function(){return W.matMul(B,!0,!0)}}:{a:function(){return W.matMul(P,!1,!0)},b:function(){return B.matMul(W,!0,!1)}},z)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},F,[!0]).reshape(T)}}),Lx=N({fusedConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,o=r.pad,i=r.dataFormat,a=i===void 0?"NHWC":i,s=r.dilations,u=s===void 0?[1,1]:s,c=r.dimRoundingMode,l=r.bias,h=r.activation,d=h===void 0?"linear":h,f=r.preluActivationWeights;if(d=d||"linear",Wc(D.state.gradientDepth,d)===!1){var p=cn(e,t,n,o,a,u,c);return l!=null&&(p=be(p,l)),zc(p,d,f)}var v=k(e,"x","conv2d"),m=k(t,"filter","conv2d"),g=v,_=!1;v.rank===3&&(_=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),R(g.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),R(m.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),c!=null&&R(Je(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),R(g.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),R(Gt(n,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"}),R(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var x,b,y=Qr(g.shape,m.shape,n,u,o,c);l!=null&&(x=Xe(x=k(l,"bias","fused conv2d"),v)[0],xe(y.outShape,x.shape)),f!=null&&(b=k(f,"prelu weights","fused conv2d"));var w={x:g,filter:m};l!=null&&(w.bias=x),f!=null&&(w.preluActivationWeights=b);var E=[m,g],C=D.runKernelFunc(function(T,S){var I=T.fusedConv2d({input:g,filter:m,convInfo:y,bias:x,activation:d,preluActivationWeights:b});return S([m,g,I]),I},w,function(T,S){var I=S,A=I[0],F=I[1],O=I[2],M=Vc(T,O,d);R(Mo(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var B={};return l!=null&&(B={bias:function(){return Uc(x,M)}}),Object.assign({x:function(){return sp(F.shape,M,A,n,o)},filter:function(){return Dc(F,M,A.shape,n,o)}},B)},"FusedConv2D",{convInfo:y,activation:d},E,[!0]);return _?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Wx=N({fusedDepthwiseConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,o=r.pad,i=r.dataFormat,a=i===void 0?"NHWC":i,s=r.dilations,u=s===void 0?[1,1]:s,c=r.dimRoundingMode,l=r.bias,h=r.activation,d=h===void 0?"linear":h,f=r.preluActivationWeights;if(Wc(D.state.gradientDepth,d)===!1){var p=ms(e,t,n,o,a,u,c);return l!=null&&(p=be(p,l)),zc(p,d,f)}var v=k(e,"x","depthwiseConv2d"),m=k(t,"filter","depthwiseConv2d"),g=v,_=!1;v.rank===3&&(_=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),R(g.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),R(m.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),R(g.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),u==null&&(u=[1,1]),R(Gt(n,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"}),c!=null&&R(Je(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var x,b,y=Qr(g.shape,m.shape,n,u,o,c,!0);l!=null&&(x=Xe(x=k(l,"bias","fused conv2d"),v)[0],xe(y.outShape,x.shape)),f!=null&&(b=k(f,"prelu weights","fused depthwiseConv2d"));var w={x:g,filter:m};l!=null&&(w.bias=x),f!=null&&(w.preluActivationWeights=b);var E=[m,g],C=D.runKernelFunc(function(T,S){var I=T.fusedDepthwiseConv2D({input:g,filter:m,convInfo:y,bias:x,activation:d,preluActivationWeights:b});return S([m,g,I]),I},w,function(T,S){R(Mo(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var I=S[0],A=S[1],F=S[2],O=Vc(T,F,d),M={};return l!=null&&(M={bias:function(){return Uc(x,O)}}),Object.assign({x:function(){return up(A.shape,O,I,y)},filter:function(){return cp(A,O,I.shape,y)}},M)},"FusedDepthwiseConv2D",{convInfo:y,activation:d},E,[!0]);return _?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Vx=Object.freeze({matMul:Bx,conv2d:Lx,depthwiseConv2d:Wx}),Ux=Object.freeze({image:Lc,linalg:Ix,losses:Sx,spectral:lx,fused:Vx,signal:vx,square:x_,squaredDifference:Hf,conv1d:Rb,conv2d:cn,conv3d:Nb,depthwiseConv2d:ms,separableConv2d:Oc,conv2dTranspose:Db,conv3dTranspose:Ob,op:N,batchNormalization2d:Z_,batchNormalization3d:J_,batchNormalization4d:Q_,batchNormalization:eb,batchNorm:Zf,batchNorm2d:tb,batchNorm3d:nb,batchNorm4d:rb,booleanMaskAsync:Ib,complex:xt,real:nn,imag:Fn,concat:st,concat1d:Vg,concat2d:Ug,concat3d:zg,concat4d:Gg,split:_c,matMul:gs,dot:Fb,outerProduct:Mb,reverse:Wi,reverse1d:Pb,reverse2d:Bb,reverse3d:Lb,reverse4d:Wb,maxPool:pt,avgPool:Vi,pool:Vb,maxPool3d:Ub,avgPool3d:zb,slice:Wn,slice1d:Gb,slice2d:qb,slice3d:dp,slice4d:Hb,abs:w_,acos:C_,acosh:E_,asin:S_,asinh:T_,atan:k_,atanh:A_,ceil:I_,clipByValue:Ic,cos:R_,cosh:N_,erf:D_,exp:Uu,expm1:O_,floor:F_,log:M_,log1p:P_,logSigmoid:B_,neg:Ga,reciprocal:L_,round:W_,rsqrt:jf,sigmoid:Xf,sign:V_,isNaN:U_,isInf:z_,isFinite:G_,sin:q_,sinh:H_,softplus:j_,sqrt:X_,step:K_,tan:$_,tanh:Y_,all:jb,any:Xb,argMax:Kb,argMin:$b,logSumExp:Yb,max:ys,mean:Zb,min:Jb,moments:Qb,sum:pp,prod:ex,equal:np,equalStrict:_b,greater:bb,greaterEqual:rp,greaterEqualStrict:xb,greaterStrict:wb,less:Cb,lessEqual:Eb,lessEqualStrict:Sb,lessStrict:Tb,notEqual:kb,notEqualStrict:Ab,add:be,addN:ab,addStrict:sb,atan2:ub,div:dn,divNoNan:cb,divStrict:lb,floorDiv:ep,maximum:Rc,maximumStrict:hb,minimum:tp,minimumStrict:db,mod:fb,modStrict:pb,mul:It,mulStrict:vb,pow:qa,powStrict:mb,squaredDifferenceStrict:gb,sub:ht,subStrict:yb,elu:vp,leakyRelu:tx,prelu:mp,relu:je,relu6:gp,selu:nx,logicalAnd:vs,logicalNot:ob,logicalOr:Jf,logicalXor:ib,where:jr,whereAsync:Qf,buffer:pe,print:Jg,batchToSpaceND:pf,broadcastTo:Qg,cast:ey,clone:ty,cumsum:ny,depthToSpace:ry,expandDims:tn,eye:vf,multinomial:oy,oneHot:Bu,pad:Jr,pad1d:iy,pad2d:ay,pad3d:sy,pad4d:uy,rand:cy,randomNormal:ly,randomGamma:hy,randomUniform:mf,reshape:pn,spaceToBatchND:gf,squeeze:yf,stack:Jt,tile:Eo,truncatedNormal:dy,unstack:ut,setdiff1dAsync:fy,fill:Ln,linspace:Wg,ones:jo,range:Ma,scalar:J,tensor:Ct,tensor1d:rt,tensor2d:yr,tensor3d:yc,tensor4d:Bt,tensor5d:Pg,tensor6d:Bg,variable:Lg,zeros:Ve,onesLike:ff,zerosLike:Te,transpose:wr,softmax:rr,logSoftmax:by,localResponseNormalization:rx,norm:yp,gather:Nc,unsortedSegmentSum:op,basicLSTMCell:ox,multiRNNCell:ix,movingAverage:ax,stridedSlice:sx,topk:ux,scatterND:cx,fft:Fc,ifft:Ha,rfft:Mc,irfft:_p,sparseToDense:hx,gatherND:dx,diag:fx,dropout:px,hannWindow:Pc,hammingWindow:xp,frame:Bc,stft:wp,inTopKAsync:mx});function X(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&R(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function pu(r,e,t,n){if(t==="linear")return r.linear(e);if(t==="relu")return r.relu(e);if(t==="elu")return r.elu(e);if(t==="relu6")return r.relu6(e);if(t==="prelu")return r.prelu(e,n);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var zx=function(r){function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Sf(t,D),t}return _n(e,r),e.prototype.write=function(t,n,o){this.firstUse&&(this.firstUse=!1,q().get("IS_NODE")&&Oa(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:t,dtype:o}),i},e.prototype.move=function(t,n,o,i){this.data.set(t,{values:n,dtype:i})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return ne(this,void 0,void 0,function(){return re(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),o=n.dtype,i=n.complexTensors;return o==="complex64"?Vu(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId),o=n;if(t.dtype==="string")try{o=n.map(function(i){return Ra(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return pe(t.shape,t.dtype,o)},e.prototype.makeOutput=function(t,n,o){var i=this.write(t,n,o);return D.makeTensorFromDataId(i,n,o,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var n=this.data.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return ne(this,void 0,void 0,function(){var n;return re(this,function(o){return n=Nn(),t(),[2,{kernelMs:Nn()-n}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,n){var o=this.makeOutput(null,t.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:D.keep(t.clone()),imag:D.keep(n.clone())},o},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,o){if(X(t,"slice"),Cf(t.shape,n,o)){var i=Ef(n,t.strides),a=ie(o);return Ct(this.readSync(t.dataId).subarray(i,i+a),o,t.dtype)}for(var s=pe(o,t.dtype),u=this.bufferSync(t),c=0;c<s.size;++c){var l=s.indexToLoc(c).map(function(h,d){return h+n[d]});s.values[c]=u.get.apply(u,l)}return s.toTensor()},e.prototype.stridedSlice=function(t,n,o,i){X(t,"stridedSlice");var a=xc(n,o,i);if(a.some(function(f){return f===0}))return Ct([],a);for(var s=pe(a,t.dtype),u=this.bufferSync(t),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),h=new Array(l.length),d=0;d<h.length;d++)h[d]=l[d]*i[d]+n[d];s.set.apply(s,[u.get.apply(u,h)].concat(l))}return s.toTensor()},e.prototype.diag=function(t){for(var n=this.readSync(t.dataId),o=pe([t.size,t.size],t.dtype),i=o.values,a=0;a<n.length;a++)i[a*t.size+a]=n[a];return o.toTensor()},e.prototype.unstack=function(t,n){for(var o=t.shape[n],i=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==n&&(i[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[n]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[n]=s,l[s]=this.slice(t,u,c).reshape(i);return l},e.prototype.reverse=function(t,n){X(t,"reverse");for(var o=pe(t.shape,t.dtype),i=this.bufferSync(t),a=function(u){var c=o.indexToLoc(u),l=c.slice();n.forEach(function(h){return l[h]=t.shape[h]-1-l[h]}),o.set.apply(o,[i.get.apply(i,l)].concat(c))},s=0;s<o.size;s++)a(s);return o.toTensor()},e.prototype.concat=function(t,n){var o=this;if(t[0].dtype==="complex64"){var i=t.map(function(f){return nn(f)}),a=t.map(function(f){return Fn(f)});return xt(this.concat(i,n),this.concat(a,n))}var s=t.map(function(f){var p=ie(f.shape.slice(n));return f.as2D(-1,p)}),u=Fo(s.map(function(f){return f.shape}),1),c=pe(u,t[0].dtype).values;if(s[0].shape[0]===1){var l=0;s.forEach(function(f){c.set(o.readSync(f.dataId),l),l+=f.size})}else{var h=0;s.forEach(function(f){for(var p=o.readSync(f.dataId),v=0,m=0;m<f.shape[0];++m)for(var g=m*u[1]+h,_=0;_<f.shape[1];++_)c[g+_]=p[v++];h+=f.shape[1]})}var d=Fo(t.map(function(f){return f.shape}),n);return Ct(c,d,t[0].dtype)},e.prototype.neg=function(t){return X(t,"neg"),this.multiply(J(-1),t)},e.prototype.add=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(o,i,a,s){return{real:o+a,imag:i+s}}):this.broadcastedBinaryOp(t,n,wt(t.dtype,n.dtype),function(o,i){return o+i})},e.prototype.addN=function(t){var n=this;X(t,"addN");for(var o=t.map(function(l){return n.readSync(l.dataId)}),i=pe(t[0].shape,t[0].dtype),a=i.values,s=0;s<t.length;s++)for(var u=o[s],c=0;c<a.length;c++)a[c]+=u[c];return i.toTensor()},e.prototype.softmax=function(t,n){var o=ft([n],t.shape),i=this.max(t,o),a=zt(i.shape,o),s=this.subtract(t,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},e.prototype.subtract=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(o,i,a,s){return{real:o-a,imag:i-s}}):this.broadcastedBinaryOp(t,n,wt(t.dtype,n.dtype),function(o,i){return o-i})},e.prototype.pow=function(t,n){return X([t,n],"pow"),this.broadcastedBinaryOp(t,n,t.dtype,function(o,i){return Math.pow(o,i)})},e.prototype.batchMatMul=function(t,n,o,i){X([t,n],"matMul");for(var a=o?t.shape[1]:t.shape[2],s=o?t.shape[2]:t.shape[1],u=i?n.shape[1]:n.shape[2],c=t.shape[0],l=this.readSync(t.dataId),h=this.readSync(n.dataId),d=o?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],f=d[0],p=d[1],v=d[2],m=i?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],g=m[0],_=m[1],x=m[2],b=s*u,y=pe([c,s,u],t.dtype),w=y.values,E=this.blockSize,C=0;C<c;C++)for(var T=0;T<s;T+=E)for(var S=0;S<u;S+=E)for(var I=0;I<a;I+=E)for(var A=Math.min(T+E,s),F=Math.min(S+E,u),O=Math.min(I+E,a),M=T;M<A;M++)for(var B=S;B<F;B++){for(var P=0,L=I;L<O;L++)P+=l[C*f+M*p+L*v]*h[L*g+B*_+C*x];w[C*b+(M*u+B)]+=P}return y.toTensor()},e.prototype.fusedBatchMatMul=function(t){var n=t.a,o=t.b,i=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=this.batchMatMul(n,o,i,a);return s&&(l=this.add(l,s)),u&&(l=pu(this,l,u,c)),l},e.prototype.multiply=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}}):this.broadcastedBinaryOp(t,n,wt(t.dtype,n.dtype),function(o,i){return o*i})},e.prototype.realDivide=function(t,n){return X([t,n],"realDivide"),this.broadcastedBinaryOp(t,n,"float32",function(o,i){return o/i})},e.prototype.floorDiv=function(t,n){return X([t,n],"floorDiv"),this.broadcastedBinaryOp(t,n,"int32",function(o,i){return Math.floor(o/i)})},e.prototype.sum=function(t,n){X(t,"sum"),jt("sum",n,t.rank);for(var o=St(t.shape,n),i=o[0],a=o[1],s=Ve(i,wt(t.dtype,"int32")),u=ie(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=0,p=0;p<u;++p)f+=l[d+p];c[h]=f}return s},e.prototype.prod=function(t,n){X(t,"sum");for(var o=St(t.shape,n),i=o[0],a=o[1],s=Ve(i,wt(t.dtype,"int32")),u=ie(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=1,p=0;p<u;++p)f*=l[d+p];c[h]=f}return s},e.prototype.unsortedSegmentSum=function(t,n,o){X(t,"unsortedSegmentSum");for(var i=[],a=t.rank-n.rank,s=0;s<a;++s)n=n.expandDims(s+1);for(s=0;s<o;++s){var u=J(s,"int32"),c=np(u,n).asType("float32").mul(t).sum(0);i.push(c)}return Jt(i)},e.prototype.argMin=function(t,n){X(t,"argMin");var o=[n];jt("argMin",o,t.rank);for(var i=St(t.shape,o),a=i[0],s=i[1],u=Ve(a,"int32"),c=ie(s),l=this.readSync(u.dataId),h=this.readSync(t.dataId),d=0;d<l.length;++d){for(var f=d*c,p=h[f],v=0,m=0;m<c;++m){var g=h[f+m];g<p&&(p=g,v=m)}l[d]=v}return u},e.prototype.argMax=function(t,n){X(t,"argMax");var o=[n];jt("argMax",o,t.rank);for(var i=St(t.shape,o),a=i[0],s=i[1],u=Ve(a,"int32"),c=ie(s),l=this.readSync(u.dataId),h=this.readSync(t.dataId),d=0;d<l.length;++d){for(var f=d*c,p=h[f],v=0,m=0;m<c;++m){var g=h[f+m];g>p&&(p=g,v=m)}l[d]=v}return u},e.prototype.cumsum=function(t,n,o,i){if(X(t,"cumsum"),n!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+n);for(var a=wt(t.dtype,"int32"),s=Ve(t.shape,a),u=this.readSync(s.dataId),c=this.readSync(t.dataId),l=t.shape[t.rank-1],h=i?function(m,g){return m+l-g-1}:function(m,g){return m+g},d=0;d<c.length;d+=l)for(var f=0;f<l;f++){var p=h(d,f);if(f===0)u[p]=o?0:c[p];else{var v=h(d,f-1);u[p]=o?c[v]+u[v]:c[p]+u[v]}}return s},e.prototype.equal=function(t,n){return X([t,n],"equal"),this.broadcastedBinaryOp(t,n,"bool",function(o,i){return o===i?1:0})},e.prototype.notEqual=function(t,n){return X([t,n],"notEqual"),this.broadcastedBinaryOp(t,n,"bool",function(o,i){return o!==i?1:0})},e.prototype.less=function(t,n){return X([t,n],"less"),this.broadcastedBinaryOp(t,n,"bool",function(o,i){return o<i?1:0})},e.prototype.lessEqual=function(t,n){return X([t,n],"lessEqual"),this.broadcastedBinaryOp(t,n,"bool",function(o,i){return o<=i?1:0})},e.prototype.greater=function(t,n){return X([t,n],"greater"),this.broadcastedBinaryOp(t,n,"bool",function(o,i){return o>i?1:0})},e.prototype.greaterEqual=function(t,n){return X([t,n],"greaterEqual"),this.broadcastedBinaryOp(t,n,"bool",function(o,i){return o>=i?1:0})},e.prototype.logicalNot=function(t){X(t,"logicalNot");for(var n=this.readSync(t.dataId),o=new Uint8Array(n.length),i=0;i<n.length;++i)o[i]=n[i]?0:1;return this.makeOutput(o,t.shape,"bool")},e.prototype.logicalAnd=function(t,n){return X([t,n],"logicalAnd"),this.broadcastedBinaryOp(t,n,"bool",function(o,i){return o&&i})},e.prototype.logicalOr=function(t,n){return X([t,n],"logicalOr"),this.broadcastedBinaryOp(t,n,"bool",function(o,i){return o||i})},e.prototype.select=function(t,n,o){X([t,n,o],"select");for(var i=this.readSync(t.dataId),a=this.readSync(n.dataId),s=this.readSync(o.dataId),u=Ve(n.shape,wt(n.dtype,o.dtype)),c=this.readSync(u.dataId),l=0,h=t.rank===0||t.rank>1||n.rank===1?1:ie(n.shape.slice(1)),d=0;d<i.length;d++)for(var f=0;f<h;f++)i[d]===1?c[l++]=a[d]:c[l++]=s[d];return u},e.prototype.where=function(t){X([t],"where");var n=this.readSync(t.dataId);return Sc(t.shape,n)},e.prototype.topk=function(t,n,o){return X(t,"topk"),Of(this.readSync(t.dataId),t.shape,t.dtype,n)},e.prototype.min=function(t,n){X(t,"min"),jt("min",n,t.rank);for(var o=St(t.shape,n),i=o[0],a=o[1],s=Ve(i,t.dtype),u=ie(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=l[d],p=0;p<u;++p){var v=l[d+p];v<f&&(f=v)}c[h]=f}return s},e.prototype.minimum=function(t,n){return X([t,n],"minimum"),this.broadcastedBinaryOp(t,n,t.dtype,function(o,i){return Math.min(o,i)})},e.prototype.mod=function(t,n){return X([t,n],"mod"),this.broadcastedBinaryOp(t,n,t.dtype,function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i})},e.prototype.max=function(t,n){X(t,"max"),jt("max",n,t.rank);for(var o=St(t.shape,n),i=o[0],a=o[1],s=Ve(i,t.dtype),u=ie(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=l[d],p=0;p<u;++p){var v=l[d+p];v>f&&(f=v)}c[h]=f}return s},e.prototype.maximum=function(t,n){return X([t,n],"maximum"),this.broadcastedBinaryOp(t,n,t.dtype,function(o,i){return Math.max(o,i)})},e.prototype.all=function(t,n){X(t,"all"),jt("all",n,t.rank);for(var o=St(t.shape,n),i=o[0],a=o[1],s=Ve(i,t.dtype),u=ie(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=l[d],p=0;p<u;++p){var v=l[d+p];f=f&&v}c[h]=f}return s},e.prototype.any=function(t,n){X(t,"any"),jt("any",n,t.rank);for(var o=St(t.shape,n),i=o[0],a=o[1],s=Ve(i,t.dtype),u=ie(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=l[d],p=0;p<u;++p){var v=l[d+p];f=f||v}c[h]=f}return s},e.prototype.squaredDifference=function(t,n){return X([t,n],"squaredDifference"),this.broadcastedBinaryOp(t,n,t.dtype,function(o,i){var a=o-i;return a*a})},e.prototype.ceil=function(t){X(t,"ceil");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i)o[i]=Math.ceil(n[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.floor=function(t){X(t,"floor");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i)o[i]=Math.floor(n[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.sign=function(t){X(t,"x");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i)n[i]<0?o[i]=-1:n[i]>0?o[i]=1:o[i]=0;return this.makeOutput(o,t.shape,"float32")},e.prototype.isNaN=function(t){X(t,"x");for(var n=this.readSync(t.dataId),o=new Uint8Array(n.length),i=0;i<n.length;++i)Number.isNaN(n[i])&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},e.prototype.isInf=function(t){X(t,"x");for(var n=this.readSync(t.dataId),o=new Uint8Array(n.length),i=0;i<n.length;++i)Math.abs(n[i])===1/0&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},e.prototype.isFinite=function(t){X(t,"x");for(var n=this.readSync(t.dataId),o=new Uint8Array(n.length),i=0;i<n.length;++i)Number.isFinite(n[i])&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},e.prototype.round=function(t){X(t,"round");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i){var a=Math.floor(n[i]);n[i]-a<.5?o[i]=Math.floor(n[i]):n[i]-a>.5?o[i]=Math.ceil(n[i]):o[i]=a%2==0?a:a+1}return this.makeOutput(o,t.shape,"float32")},e.prototype.exp=function(t){X(t,"exp");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i)o[i]=Math.exp(n[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.expm1=function(t){X(t,"expm1");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i)o[i]=Math.expm1(n[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.log=function(t){X(t,"log");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i){var a=n[i];o[i]=Math.log(a)}return this.makeOutput(o,t.shape,"float32")},e.prototype.log1p=function(t){X(t,"log1p");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i){var a=n[i];o[i]=Math.log1p(a)}return this.makeOutput(o,t.shape,"float32")},e.prototype.sqrt=function(t){X(t,"sqrt");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i){var a=n[i];o[i]=Math.sqrt(a)}return this.makeOutput(o,t.shape,"float32")},e.prototype.rsqrt=function(t){X(t,"rsqrt");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i){var a=n[i];o[i]=1/Math.sqrt(a)}return this.makeOutput(o,t.shape,"float32")},e.prototype.reciprocal=function(t){X(t,"reciprocal");for(var n=this.readSync(t.dataId),o=new Float32Array(n.length),i=0;i<n.length;++i)o[i]=1/n[i];return this.makeOutput(o,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){X(t,"relu");for(var n=Ve(t.shape,t.dtype),o=this.readSync(n.dataId),i=this.readSync(t.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return n},e.prototype.relu6=function(t){X(t,"relu");for(var n=Ve(t.shape,t.dtype),o=this.readSync(n.dataId),i=this.readSync(t.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return n},e.prototype.prelu=function(t,n){return X([t,n],"prelu"),this.broadcastedBinaryOp(t,n,t.dtype,function(o,i){return o<0?i*o:o})},e.prototype.elu=function(t){X(t,"elu");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i];n[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(n,t.shape,"float32")},e.prototype.eluDer=function(t,n){X([t,n],"eluDer");for(var o=new Float32Array(n.size),i=this.readSync(n.dataId),a=this.readSync(t.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,n.shape,"float32")},e.prototype.selu=function(t){X(t,"selu");for(var n=kc,o=Ac,i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?o*u:n*(Math.exp(u)-1)}return this.makeOutput(i,t.shape,"float32")},e.prototype.clip=function(t,n,o){X(t,"clip");for(var i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<n?n:u}return this.makeOutput(i,t.shape,"float32")},e.prototype.abs=function(t){for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.abs(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<t.size;++i){var a=o[2*i],s=o[2*i+1];n[i]=Math.hypot(a,s)}return this.makeOutput(n,t.shape,"float32")},e.prototype.int=function(t){X(t,"int");for(var n=new Int32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=o[i];return this.makeOutput(n,t.shape,"int32")},e.prototype.sigmoid=function(t){X(t,"sigmoid");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(n,t.shape,"float32")},e.prototype.softplus=function(t){X(t,"softplus");for(var n=Math.log(11920928955078125e-23)+2,o=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=i[a]>-n,u=i[a]<n,c=Math.exp(i[a]),l=void 0;l=u?c:s?i[a]:Math.log(1+c),o[a]=l}return this.makeOutput(o,t.shape,"float32")},e.prototype.sin=function(t){X(t,"sin");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.sin(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cos=function(t){X(t,"cos");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.cos(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tan=function(t){X(t,"tan");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.tan(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asin=function(t){X(t,"asin");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.asin(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acos=function(t){X(t,"acos");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.acos(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan=function(t){X(t,"atan");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.atan(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan2=function(t,n){return X([t,n],"atan2"),this.broadcastedBinaryOp(t,n,t.dtype,function(o,i){return Math.atan2(o,i)})},e.prototype.sinh=function(t){X(t,"sinh");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.sinh(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cosh=function(t){X(t,"cosh");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.cosh(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tanh=function(t){X(t,"tanh");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Gm(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asinh=function(t){X(t,"asinh");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.asinh(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acosh=function(t){X(t,"acosh");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.acosh(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atanh=function(t){X(t,"atanh");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)n[i]=Math.atanh(o[i]);return this.makeOutput(n,t.shape,"float32")},e.prototype.erf=function(t){X(t,"erf");for(var n=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);n[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(n,t.shape,"float32")},e.prototype.step=function(t,n){n===void 0&&(n=0),X(t,"step");for(var o=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=i[a];isNaN(s)?o[a]=NaN:o[a]=s>0?1:n}return this.makeOutput(o,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var n=t.input,o=t.filter,i=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,c=this.conv2d(n,o,i);return a&&(c=this.add(c,a)),s&&(c=pu(this,c,s,u)),c},e.prototype.conv2d=function(t,n,o){X([t,n],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,h=o.dataFormat==="channelsLast",d=pe(o.outShape,t.dtype),f=t.strides[0],p=h?t.strides[1]:t.strides[2],v=h?t.strides[2]:1,m=h?1:t.strides[1],g=d.strides[0],_=h?d.strides[1]:d.strides[2],x=h?d.strides[2]:1,b=h?1:d.strides[1],y=this.readSync(t.dataId),w=this.readSync(n.dataId),E=d.values,C=0;C<o.batchSize;++C)for(var T=C*f,S=C*g,I=0;I<o.outHeight;++I)for(var A=S+I*_,F=I*o.strideHeight-l,O=0;O<i;O++){var M=F+O*s;if(!(M<0||M>=o.inHeight))for(var B=O*n.strides[0],P=T+M*p,L=0;L<o.outWidth;++L)for(var W=A+L*x,z=L*o.strideWidth-c,H=0;H<a;H++){var Y=z+H*u;if(!(Y<0||Y>=o.inWidth))for(var te=P+Y*v,ce=B+H*n.strides[1],Z=0;Z<o.inChannels;++Z){for(var oe=y[te+Z*m],le=0;le<o.outChannels;++le)E[W+le*b]+=oe*w[ce+le];ce+=o.outChannels}}}return d.toTensor()},e.prototype.conv3d=function(t,n,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,c=o.dilationHeight,l=o.dilationWidth,h=o.padInfo.front,d=o.padInfo.left,f=o.padInfo.top,p=pe(o.outShape,t.dtype),v=this.readSync(t.dataId),m=this.readSync(n.dataId),g=p.values,_=0;_<o.batchSize;++_)for(var x=_*t.strides[0],b=_*p.strides[0],y=0;y<o.outDepth;++y)for(var w=b+y*p.strides[1],E=y*o.strideDepth-h,C=0;C<i;C++){var T=E+C*u;if(!(T<0||T>=o.inDepth))for(var S=C*n.strides[0],I=x+T*t.strides[1],A=0;A<o.outHeight;++A)for(var F=w+A*p.strides[2],O=A*o.strideHeight-f,M=0;M<a;M++){var B=O+M*c;if(!(B<0||B>=o.inHeight))for(var P=S+M*n.strides[1],L=I+B*t.strides[2],W=0;W<o.outWidth;++W)for(var z=F+W*o.outChannels,H=W*o.strideWidth-d,Y=0;Y<s;Y++){var te=H+Y*l;if(!(te<0||te>=o.inWidth))for(var ce=P+Y*n.strides[2],Z=L+te*o.inChannels,oe=ce,le=0;le<o.inChannels;++le){for(var $=v[Z+le],ve=0;ve<o.outChannels;++ve)g[z+ve]+=$*m[oe+ve];oe+=o.outChannels}}}}return p.toTensor()},e.prototype.conv2dDerInput=function(t,n,o){X([t,n],"conv2dDerInput");for(var i=pe(o.inShape,"float32"),a=i.values,s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=n.strides,l=c[0],h=c[1],d=c[2],f=o.batchSize,p=o.filterHeight,v=o.filterWidth,m=o.inChannels,g=o.inHeight,_=o.inWidth,x=o.outChannels,b=o.outHeight,y=o.outWidth,w=o.strideHeight,E=o.strideWidth,C=o.dataFormat,T=p-1-o.padInfo.top,S=v-1-o.padInfo.left,I=C==="channelsLast",A=i.strides[0],F=I?i.strides[1]:i.strides[2],O=I?i.strides[2]:1,M=I?1:i.strides[1],B=t.strides[0],P=I?t.strides[1]:t.strides[2],L=I?t.strides[2]:1,W=I?1:t.strides[1],z=0;z<f;++z)for(var H=0;H<m;++H)for(var Y=0;Y<g;++Y)for(var te=Y-T,ce=Math.max(0,Math.ceil(te/w)),Z=Math.min(b,(p+te)/w),oe=0;oe<_;++oe){for(var le=oe-S,$=Math.max(0,Math.ceil(le/E)),ve=Math.min(y,(v+le)/E),De=0,me=ce;me<Z;++me)for(var Ee=me*w-te,ke=$;ke<ve;++ke)for(var ze=B*z+P*me+L*ke,K=l*(p-1-Ee)+h*(v-1-(ke*E-le))+d*H,Q=0;Q<x;++Q)De+=s[ze+W*Q]*u[K+Q];a[A*z+F*Y+O*oe+M*H]=De}return i.toTensor()},e.prototype.conv3dDerInput=function(t,n,o){for(var i=pe(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],h=s[3],d=this.readSync(t.dataId),f=t.strides,p=f[0],v=f[1],m=f[2],g=f[3],_=this.readSync(n.dataId),x=n.strides,b=x[0],y=x[1],w=x[2],E=x[3],C=o.batchSize,T=o.filterDepth,S=o.filterHeight,I=o.filterWidth,A=o.inChannels,F=o.inDepth,O=o.inHeight,M=o.inWidth,B=o.outChannels,P=o.outDepth,L=o.outHeight,W=o.outWidth,z=o.strideDepth,H=o.strideHeight,Y=o.strideWidth,te=T-1-o.padInfo.front,ce=S-1-o.padInfo.top,Z=I-1-o.padInfo.left,oe=0;oe<C;++oe)for(var le=0;le<A;++le)for(var $=0;$<F;++$)for(var ve=$-te,De=Math.max(0,Math.ceil(ve/z)),me=Math.min(P,(T+ve)/z),Ee=0;Ee<O;++Ee)for(var ke=Ee-ce,ze=Math.max(0,Math.ceil(ke/H)),K=Math.min(L,(S+ke)/H),Q=0;Q<M;++Q){for(var Ie=Q-Z,Se=Math.max(0,Math.ceil(Ie/Y)),de=Math.min(W,(I+Ie)/Y),Oe=0,Ke=De;Ke<me;++Ke)for(var _t=Ke*z-ve,Ot=ze;Ot<K;++Ot)for(var Tn=Ot*H-ke,ln=Se;ln<de;++ln)for(var ei=p*oe+v*Ke+m*Ot+g*ln,io=b*(T-1-_t)+y*(S-1-Tn)+w*(I-1-(ln*Y-Ie))+E*le,kn=0;kn<B;++kn)Oe+=d[ei+kn]*_[io+kn];a[u*oe+c*$+l*Ee+h*Q+le]=Oe}return i.toTensor()},e.prototype.conv2dDerFilter=function(t,n,o){X([t,n],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dataFormat==="channelsLast",l=pe(o.filterShape,"float32"),h=o.padInfo.left,d=o.padInfo.top,f=this.bufferSync(t),p=this.bufferSync(n),v=0;v<s;++v)for(var m=Math.max(0,Math.ceil((d-v)/i)),g=Math.min(o.outHeight,(o.inHeight+d-v)/i),_=0;_<u;++_)for(var x=Math.max(0,Math.ceil((h-_)/a)),b=Math.min(o.outWidth,(o.inWidth+h-_)/a),y=0;y<o.inChannels;++y)for(var w=0;w<o.outChannels;++w){for(var E=0,C=0;C<o.batchSize;++C)for(var T=m;T<g;++T)for(var S=v+T*i-d,I=x;I<b;++I){var A=_+I*a-h;E+=c?f.get(C,S,A,y)*p.get(C,T,I,w):f.get(C,y,S,A)*p.get(C,w,T,I)}l.set(E,v,_,y,w)}return l.toTensor()},e.prototype.conv3dDerFilter=function(t,n,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,h=pe(o.filterShape,"float32"),d=h.values,f=h.strides,p=f[0],v=f[1],m=f[2],g=f[3],_=this.readSync(n.dataId),x=n.strides,b=x[0],y=x[1],w=x[2],E=x[3],C=this.readSync(t.dataId),T=t.strides,S=T[0],I=T[1],A=T[2],F=T[3],O=o.padInfo.front,M=o.padInfo.left,B=o.padInfo.top,P=0;P<u;++P)for(var L=Math.max(0,Math.ceil((O-P)/i)),W=Math.min(o.outDepth,(o.inDepth+O-P)/i),z=P*p,H=0;H<c;++H)for(var Y=Math.max(0,Math.ceil((B-H)/a)),te=Math.min(o.outHeight,(o.inHeight+B-H)/a),ce=H*v+z,Z=0;Z<l;++Z)for(var oe=Math.max(0,Math.ceil((M-Z)/s)),le=Math.min(o.outWidth,(o.inWidth+M-Z)/s),$=Z*m+ce,ve=0;ve<o.inChannels;++ve)for(var De=ve*g+$,me=0;me<o.outChannels;++me){for(var Ee=0,ke=0;ke<o.batchSize;++ke)for(var ze=ke*S,K=ke*b,Q=L;Q<W;++Q)for(var Ie=(P+Q*i-O)*I+ze,Se=Q*y+K,de=Y;de<te;++de)for(var Oe=(H+de*a-B)*A+Ie,Ke=de*w+Se,_t=oe;_t<le;++_t){var Ot=_t*E+Ke;Ee+=C[(Z+_t*s-M)*F+Oe+ve]*_[Ot+me]}d[De+me]=Ee}return h.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var n=t.input,o=t.filter,i=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,c=this.depthwiseConv2D(n,o,i);return a&&(c=this.add(c,a)),s&&(c=pu(this,c,s,u)),c},e.prototype.depthwiseConv2D=function(t,n,o){X([t,n],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,h=o.outChannels/o.inChannels,d=pe(o.outShape,t.dtype),f=this.readSync(t.dataId),p=this.readSync(n.dataId),v=d.values,m=0;m<o.batchSize;++m)for(var g=m*t.strides[0],_=m*d.strides[0],x=0;x<o.outHeight;++x)for(var b=_+x*d.strides[1],y=x*o.strideHeight-c,w=0;w<i;++w){var E=y+w*s;if(!(E<0||E>=o.inHeight))for(var C=w*n.strides[0],T=g+E*t.strides[1],S=0;S<o.outWidth;++S)for(var I=b+S*d.strides[2],A=S*o.strideWidth-l,F=0;F<a;++F){var O=A+F*u;if(!(O<0||O>=o.inWidth))for(var M=C+F*n.strides[1],B=T+O*o.inChannels,P=I,L=M,W=0;W<o.inChannels;++W){for(var z=f[B+W],H=0;H<h;++H)v[P+H]+=z*p[L+H];P+=h,L+=h}}}return d.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,n,o){X([t,n],"depthwiseConv2DDerInput");for(var i=pe(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],h=this.readSync(t.dataId),d=t.strides,f=d[0],p=d[1],v=d[2],m=this.readSync(n.dataId),g=n.strides,_=g[0],x=g[1],b=g[2],y=o.batchSize,w=o.filterHeight,E=o.filterWidth,C=o.inChannels,T=o.inHeight,S=o.inWidth,I=o.outChannels,A=o.outHeight,F=o.outWidth,O=o.strideHeight,M=o.strideWidth,B=w-1-o.padInfo.top,P=E-1-o.padInfo.left,L=I/C,W=0;W<y;++W)for(var z=0;z<C;++z)for(var H=0;H<T;++H)for(var Y=H-B,te=Math.max(0,Math.ceil(Y/O)),ce=Math.min(A,(w+Y)/O),Z=0;Z<S;++Z){for(var oe=Z-P,le=Math.max(0,Math.ceil(oe/M)),$=Math.min(F,(E+oe)/M),ve=0,De=te;De<ce;++De)for(var me=De*O-Y,Ee=le;Ee<$;++Ee)for(var ke=f*W+p*De+v*Ee,ze=_*(w-1-me)+x*(E-1-(Ee*M-oe))+b*z,K=0;K<L;++K)ve+=h[ke+(z*L+K)]*m[ze+K];a[u*W+c*H+l*Z+z]=ve}return i.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,n,o){X([t,n],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=pe(o.filterShape,"float32"),l=o.padInfo.left,h=o.padInfo.top,d=o.outChannels/o.inChannels,f=this.bufferSync(t),p=this.bufferSync(n),v=0;v<s;++v)for(var m=Math.max(0,Math.ceil((h-v)/i)),g=Math.min(o.outHeight,(o.inHeight+h-v)/i),_=0;_<u;++_)for(var x=Math.max(0,Math.ceil((l-_)/a)),b=Math.min(o.outWidth,(o.inWidth+l-_)/a),y=0;y<o.outChannels;++y){for(var w=Math.trunc(y/d),E=y%d,C=0,T=0;T<o.batchSize;++T)for(var S=m;S<g;++S)for(var I=v+S*i-h,A=x;A<b;++A){var F=_+A*a-l;C+=f.get(T,I,F,w)*p.get(T,S,A,y)}c.set(C,v,_,w,E)}return c.toTensor()},e.prototype.tile=function(t,n){return X(t,"tile"),Df(this.bufferSync(t),n)},e.prototype.pad=function(t,n,o){X(t,"pad");var i=n.map(function(d,f){return d[0]+t.shape[f]+d[1]}),a=n.map(function(d){return d[0]}),s=this.bufferSync(t),u=pe(i,t.dtype);o!==0&&u.values.fill(o);for(var c=0;c<t.size;c++){var l=s.indexToLoc(c),h=l.map(function(d,f){return d+a[f]});u.set.apply(u,[s.get.apply(s,l)].concat(h))}return u.toTensor()},e.prototype.transpose=function(t,n){X(t,"transpose");for(var o=new Array(t.rank),i=0;i<o.length;i++)o[i]=t.shape[n[i]];var a=this.readSync(t.dataId),s=pe(o,t.dtype),u=this.bufferSync(t);for(i=0;i<t.size;++i){for(var c=u.indexToLoc(i),l=new Array(c.length),h=0;h<l.length;h++)l[h]=c[n[h]];var d=s.locToIndex(l);s.values[d]=a[i]}return s.toTensor()},e.prototype.gather=function(t,n,o){X([t,n],"gather");var i=t.shape.slice(),a=this.readSync(n.dataId);i[o]=a.length;for(var s=pe(i,t.dtype),u=this.bufferSync(t),c=0;c<s.size;++c){var l=s.indexToLoc(c),h=l.slice();h[o]=a[l[o]];var d=u.locToIndex(h);s.values[c]=u.values[d]}return s.toTensor()},e.prototype.batchToSpaceND=function(t,n,o){X([t],"batchToSpaceND");var i=n.reduce(function(h,d){return h*d}),a=Pa(t.shape,n,i),s=Ba(a.length,n.length),u=La(t.shape,n,i),c=_f(o,n.length),l=bf(u,o,n.length);return t.reshape(a).transpose(s).reshape(u).slice(c,l)},e.prototype.spaceToBatchND=function(t,n,o){X([t],"spaceToBatchND");var i=n.reduce(function(d,f){return d*f}),a=[[0,0]];a.push.apply(a,o);for(var s=1+n.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),c=Pa(u.shape,n,i,!1),l=Ba(c.length,n.length,!1),h=La(u.shape,n,i,!1);return u.reshape(c).transpose(l).reshape(h)},e.prototype.pool=function(t,n,o){X(t,"pool");for(var i=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=n.padInfo.top,d=n.padInfo.left,f=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(t.dataId),v=pe(n.outShape,t.dtype),m=v.values,g=n.outShape[1]*n.outShape[2]*n.outShape[3],_=n.outShape[2]*n.outShape[3],x=n.outShape[3],b=0;b<n.batchSize;++b)for(var y=b*g,w=b*t.strides[0],E=0;E<n.inChannels;++E)for(var C=0;C<n.outHeight;++C)for(var T=C*i-h,S=Math.max(0,T),I=Math.min(n.inHeight,c+T),A=y+C*_,F=0;F<n.outWidth;++F){for(var O=F*a-d,M=Math.max(0,O),B=Math.min(n.inWidth,l+O),P=f,L=0,W=0,z=S;z<I;z+=s){for(var H=w+z*t.strides[1],Y=M;Y<B;Y+=u){var te=p[H+Y*t.strides[2]+E];o==="max"&&te>P?P=te:o==="avg"&&(L+=te,W++)}if(isNaN(P))break}m[A+F*x+E]=o==="avg"?L/W:P}return v.toTensor()},e.prototype.maxPool=function(t,n){return this.pool(t,n,"max")},e.prototype.maxPoolPositions=function(t,n){for(var o=pe(n.outShape,"int32"),i=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=n.padInfo.top,d=n.padInfo.left,f=this.bufferSync(t),p=0;p<n.batchSize;++p)for(var v=0;v<n.inChannels;++v)for(var m=0;m<n.outHeight;++m){for(var g=m*i-h,_=g;_<0;)_+=s;for(var x=Math.min(n.inHeight,c+g),b=0;b<n.outWidth;++b){for(var y=b*a-d,w=y;w<0;)w+=u;for(var E=Math.min(n.inWidth,l+y),C=Number.NEGATIVE_INFINITY,T=-1,S=_;S<x;S+=s)for(var I=S-g,A=w;A<E;A+=u){var F=A-y,O=f.get(p,S,A,v);O>C&&(C=O,T=I*l+F)}o.set(T,p,m,b,v)}}return o.toTensor()},e.prototype.maxPoolBackprop=function(t,n,o,i){X([n,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(n,i),s=i.strideHeight,u=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,h=i.effectiveFilterHeight,d=i.effectiveFilterWidth,f=d-1-i.padInfo.left,p=h-1-i.padInfo.top,v=pe(n.shape,"float32"),m=this.bufferSync(a),g=this.bufferSync(t),_=0;_<i.batchSize;++_)for(var x=0;x<i.inChannels;++x)for(var b=0;b<i.inHeight;++b)for(var y=0;y<i.inWidth;++y){for(var w=b-p,E=y-f,C=0,T=0;T<h;T+=c){var S=(w+T)/s;if(!(S<0||S>=i.outHeight||Math.floor(S)!==S))for(var I=0;I<d;I+=l){var A=(E+I)/u;if(!(A<0||A>=i.outWidth||Math.floor(A)!==A)){var F=h*d-1-m.get(_,S,A,x)===T*d+I?1:0;F!==0&&(C+=g.get(_,S,A,x)*F)}}}v.set(C,_,b,y,x)}return v.toTensor()},e.prototype.avgPoolBackprop=function(t,n,o){X([t,n],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dilationHeight,l=o.dilationWidth,h=o.effectiveFilterHeight,d=o.effectiveFilterWidth,f=d-1-o.padInfo.left,p=h-1-o.padInfo.top,v=pe(n.shape,"float32"),m=1/(s*u),g=this.bufferSync(t),_=0;_<o.batchSize;++_)for(var x=0;x<o.inChannels;++x)for(var b=0;b<o.inHeight;++b)for(var y=0;y<o.inWidth;++y){for(var w=b-p,E=y-f,C=0,T=0;T<h;T+=c){var S=(w+T)/i;if(!(S<0||S>=o.outHeight||Math.floor(S)!==S))for(var I=0;I<d;I+=l){var A=(E+I)/a;A<0||A>=o.outWidth||Math.floor(A)!==A||(C+=g.get(_,S,A,x))}}v.set(C*m,_,b,y,x)}return v.toTensor()},e.prototype.pool3d=function(t,n,o){X(t,"pool3d");for(var i=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,l=n.dilationWidth,h=n.effectiveFilterDepth,d=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=n.padInfo.front,v=n.padInfo.top,m=n.padInfo.left,g=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,_=this.readSync(t.dataId),x=pe(n.outShape,t.dtype),b=x.values,y=n.outShape[1]*n.outShape[2]*n.outShape[3]*n.outShape[4],w=n.outShape[2]*n.outShape[3]*n.outShape[4],E=n.outShape[3]*n.outShape[4],C=n.outShape[4],T=0;T<n.batchSize;++T)for(var S=T*y,I=T*t.strides[0],A=0;A<n.inChannels;++A)for(var F=0;F<n.outDepth;++F){for(var O=F*i-p,M=O;M<0;)M+=u;for(var B=Math.min(n.inDepth,h+O),P=S+F*w,L=0;L<n.outHeight;++L){for(var W=L*a-v,z=W;z<0;)z+=c;for(var H=Math.min(n.inHeight,d+W),Y=P+L*E,te=0;te<n.outWidth;++te){for(var ce=te*s-m,Z=ce;Z<0;)Z+=l;for(var oe=Math.min(n.inWidth,f+ce),le=Y+te*C,$=g,ve=0,De=0,me=M;me<B;me+=u){for(var Ee=I+me*t.strides[1],ke=z;ke<H;ke+=c){for(var ze=Ee+ke*t.strides[2],K=Z;K<oe;K+=l){var Q=_[ze+K*t.strides[3]+A];if(o==="max"&&Q>$?$=Q:o==="avg"&&(ve+=Q,De++),isNaN($))break}if(isNaN($))break}if(isNaN($))break}b[le+A]=o==="avg"?ve/De:$}}}return x.toTensor()},e.prototype.avgPool3d=function(t,n){return X(t,"avgPool3d"),this.pool3d(t,n,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,n,o){X([t,n],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,h=o.dilationDepth,d=o.dilationHeight,f=o.dilationWidth,p=o.effectiveFilterDepth,v=o.effectiveFilterHeight,m=o.effectiveFilterWidth,g=p-1-o.padInfo.front,_=m-1-o.padInfo.left,x=v-1-o.padInfo.top,b=pe(n.shape,"float32"),y=1/(u*c*l),w=this.bufferSync(t),E=0;E<o.batchSize;++E)for(var C=0;C<o.inChannels;++C)for(var T=0;T<o.inDepth;++T)for(var S=0;S<o.inHeight;++S)for(var I=0;I<o.inWidth;++I){for(var A=T-g,F=S-x,O=I-_,M=0,B=0;B<p;B+=h){var P=(A+B)/i;if(!(P<0||P>=o.outDepth||Math.floor(P)!==P))for(var L=0;L<v;L+=d){var W=(F+L)/a;if(!(W<0||W>=o.outHeight||Math.floor(W)!==W))for(var z=0;z<m;z+=f){var H=(O+z)/s;H<0||H>=o.outWidth||Math.floor(H)!==H||(M+=w.get(E,P,W,H,C))}}}b.set(M*y,E,T,S,I,C)}return b.toTensor()},e.prototype.maxPool3d=function(t,n){return X(t,"maxPool3d"),this.pool3d(t,n,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,n){for(var o=pe(n.outShape,"int32"),i=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,l=n.dilationWidth,h=n.effectiveFilterDepth,d=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=n.padInfo.front,v=n.padInfo.top,m=n.padInfo.left,g=this.bufferSync(t),_=0;_<n.batchSize;++_)for(var x=0;x<n.inChannels;++x)for(var b=0;b<n.outDepth;++b){for(var y=b*i-p,w=y;w<0;)w+=u;for(var E=Math.min(n.inDepth,h+y),C=0;C<n.outHeight;++C){for(var T=C*a-v,S=T;S<0;)S+=c;for(var I=Math.min(n.inHeight,d+T),A=0;A<n.outWidth;++A){for(var F=A*s-m,O=F;O<0;)O+=l;for(var M=Math.min(n.inWidth,f+F),B=Number.NEGATIVE_INFINITY,P=-1,L=w;L<E;L+=u)for(var W=L-y,z=S;z<I;z+=c)for(var H=z-T,Y=O;Y<M;Y+=l){var te=Y-F,ce=g.get(_,L,z,Y,x);ce>=B&&(B=ce,P=W*d*f+H*d+te)}o.set(P,_,b,C,A,x)}}}return o.toTensor()},e.prototype.maxPool3dBackprop=function(t,n,o,i){X([n,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(n,i),s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,h=i.dilationHeight,d=i.dilationWidth,f=i.effectiveFilterDepth,p=i.effectiveFilterHeight,v=i.effectiveFilterWidth,m=f-1-i.padInfo.front,g=v-1-i.padInfo.left,_=p-1-i.padInfo.top,x=pe(n.shape,"float32"),b=this.bufferSync(a),y=this.bufferSync(t),w=0;w<i.batchSize;++w)for(var E=0;E<i.inChannels;++E)for(var C=0;C<i.inDepth;++C)for(var T=0;T<i.inHeight;++T)for(var S=0;S<i.inWidth;++S){for(var I=C-m,A=T-_,F=S-g,O=0,M=0;M<f;M+=l){var B=(I+M)/s;if(!(B<0||B>=i.outDepth||Math.floor(B)!==B))for(var P=0;P<p;P+=h){var L=(A+P)/u;if(!(L<0||L>=i.outHeight||Math.floor(L)!==L))for(var W=0;W<v;W+=d){var z=(F+W)/c;if(!(z<0||z>=i.outWidth||Math.floor(z)!==z)){var H=f*p*v-1-b.get(w,B,L,z,E)===M*p*v+P*v+W?1:0;H!==0&&(O+=y.get(w,B,L,z,E)*H)}}}}x.set(O,w,C,T,S,E)}return x.toTensor()},e.prototype.cast=function(t,n){return Af(t,n,this)},e.prototype.reshape=function(t,n){return Wu(t,n)},e.prototype.avgPool=function(t,n){return X(t,"avgPool"),this.pool(t,n,"avg").toFloat()},e.prototype.resizeBilinear=function(t,n,o,i){X(t,"resizeBilinear");for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],h=this.readSync(t.dataId),d=new Float32Array(ie([s,n,o,l])),f=[i&&n>1?u-1:u,i&&o>1?c-1:c],p=[i&&n>1?n-1:n,i&&o>1?o-1:o],v=0,m=f[0]/p[0],g=f[1]/p[1],_=0;_<s;_++)for(var x=0;x<n;x++)for(var b=m*x,y=Math.floor(b),w=b-y,E=Math.min(u-1,Math.ceil(b)),C=_*t.strides[0]+y*t.strides[1],T=_*t.strides[0]+E*t.strides[1],S=0;S<o;S++)for(var I=g*S,A=Math.floor(I),F=I-A,O=Math.min(c-1,Math.ceil(I)),M=C+A*t.strides[2],B=T+A*t.strides[2],P=C+O*t.strides[2],L=T+O*t.strides[2],W=0;W<l;W++){var z=h[M+W],H=h[B+W],Y=z+(h[P+W]-z)*F,te=Y+(H+(h[L+W]-H)*F-Y)*w;d[v++]=te}return Ct(d,[s,n,o,l])},e.prototype.resizeBilinearBackprop=function(t,n,o){X([t,n],"resizeBilinearBackprop");for(var i=n.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=t.shape,h=l[1],d=l[2],f=new Float32Array(a*s*u*c),p=[o&&h>1?s-1:s,o&&d>1?u-1:u],v=[o&&h>1?h-1:h,o&&d>1?d-1:d],m=p[0]/v[0],g=p[1]/v[1],_=this.readSync(t.dataId),x=0,b=0;b<a;b++)for(var y=b*n.strides[0],w=0;w<h;w++)for(var E=w*m,C=Math.floor(E),T=Math.min(Math.ceil(E),s-1),S=y+C*n.strides[1],I=y+T*n.strides[1],A=E-C,F=1-A,O=0;O<d;O++)for(var M=O*g,B=Math.floor(M),P=Math.min(Math.ceil(M),u-1),L=M-B,W=1-L,z=S+B*n.strides[2],H=S+P*n.strides[2],Y=I+B*n.strides[2],te=I+P*n.strides[2],ce=F*W,Z=F*L,oe=A*W,le=A*L,$=0;$<c;$++){var ve=_[x++];f[z+$]+=ve*ce,f[H+$]+=ve*Z,f[Y+$]+=ve*oe,f[te+$]+=ve*le}return Bt(f,[a,u,s,c],n.dtype)},e.prototype.resizeNearestNeighbor=function(t,n,o,i){X(t,"resizeNearestNeighbor");for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],h=this.readSync(t.dataId),d=new Float32Array(s*n*o*l),f=[i&&n>1?u-1:u,i&&o>1?c-1:c],p=[i&&n>1?n-1:n,i&&o>1?o-1:o],v=f[0]/p[0],m=f[1]/p[1],g=0,_=0;_<s;_++)for(var x=_*t.strides[0],b=0;b<n;b++)for(var y=v*b,w=x+Math.min(u-1,i?Math.round(y):Math.floor(y))*t.strides[1],E=0;E<o;E++)for(var C=m*E,T=w+Math.min(c-1,i?Math.round(C):Math.floor(C))*t.strides[2],S=0;S<l;S++){var I=h[T+S];d[g++]=I}return Ct(d,[s,n,o,l],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,n,o){X([t,n],"resizeNearestNeighborBackprop");for(var i=n.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=t.shape,h=l[1],d=l[2],f=new Float32Array(a*s*u*c),p=this.readSync(t.dataId),v=[o&&h>1?s-1:s,o&&d>1?u-1:u],m=[o&&h>1?h-1:h,o&&d>1?d-1:d],g=v[0]/m[0],_=v[1]/m[1],x=1/g,b=1/_,y=2*Math.ceil(x)+2,w=2*Math.ceil(b)+2,E=0;E<a;E++)for(var C=E*n.strides[0],T=0;T<s;T++)for(var S=C+T*n.strides[1],I=Math.floor(T*x),A=Math.floor(I-y/2),F=0;F<u;F++)for(var O=S+F*n.strides[2],M=Math.floor(F*b),B=Math.floor(M-w/2),P=0;P<c;P++){for(var L=0,W=0;W<y;W++){var z=W+A;if(!(z<0||z>=h)){var H=C+z*t.strides[1],Y=z*g;if(T===Math.min(s-1,o?Math.round(Y):Math.floor(Y)))for(var te=0;te<w;te++){var ce=te+B;if(!(ce<0||ce>=d)){var Z=H+ce*t.strides[2],oe=ce*_;F===Math.min(u-1,o?Math.round(oe):Math.floor(oe))&&(L+=p[Z+P])}}}}f[O+P]=L}return Bt(f,n.shape,n.dtype)},e.prototype.batchNormalization=function(t,n,o,i,a,s){X([t,n,o,a,s],"batchNorm");for(var u=this.readSync(t.dataId),c=this.readSync(n.dataId),l=this.readSync(o.dataId),h=a?this.readSync(a.dataId):new Float32Array([1]),d=s?this.readSync(s.dataId):new Float32Array([0]),f=new Float32Array(u.length),p=d.length,v=h.length,m=l.length,g=c.length,_=0,x=0,b=0,y=0,w=0;w<u.length;++w)f[w]=d[_++]+(u[w]-c[x++])*h[b++]/Math.sqrt(l[y++]+i),_>=p&&(_=0),x>=g&&(x=0),b>=v&&(b=0),y>=m&&(y=0);return Bt(f,t.shape)},e.prototype.localResponseNormalization4D=function(t,n,o,i,a){X(t,"localResponseNormalization4D");var s=t.shape[3],u=s-1,c=this.readSync(t.dataId),l=t.size,h=new Float32Array(l);function d(m){for(var g=m%s,_=m-g+Math.max(0,g-n),x=m-g+Math.min(g+n,u),b=0;_<=x;_++){var y=c[_];b+=y*y}return b}for(var f=0;f<l;f++){var p=d(f),v=c[f]*Math.pow(o+i*p,-a);h[f]=v}return Bt(h,t.shape)},e.prototype.LRNGrad=function(t,n,o,i,a,s,u){X(t,"LRNGrad");for(var c=t.shape[3],l=this.readSync(t.dataId),h=this.readSync(n.dataId),d=this.readSync(o.dataId),f=new Float32Array(t.size),p=t.size,v=0;v<p;v++){for(var m=v%c,g=v-m+Math.max(0,m-i),_=v-m+Math.min(c,m+i+1),x=0,b=g;b<_;b++)x+=Math.pow(h[b],2);for(x=s*x+a,b=g;b<_;b++){var y=-2*s*u*h[b]*d[v]/x;v===b&&(y+=Math.pow(x,-u)),y*=l[v],f[b]+=y}}return Bt(f,t.shape)},e.prototype.multinomial=function(t,n,o,i){X(t,"multinomial");for(var a=n?t:rr(t),s=a.shape[0],u=a.shape[1],c=Ve([s,o],"int32"),l=this.readSync(c.dataId),h=this.readSync(a.dataId),d=0;d<s;++d){var f=d*u,p=new Float32Array(u-1);p[0]=h[f];for(var v=1;v<p.length;++v)p[v]=p[v-1]+h[f+v];for(var m=ds(i.toString()),g=d*o,_=0;_<o;++_){var x=m();l[g+_]=p.length;for(var b=0;b<p.length;b++)if(x<p[b]){l[g+_]=b;break}}}return c},e.prototype.oneHot=function(t,n,o,i){X(t,"oneHot");var a=new Float32Array(t.size*n);a.fill(i);for(var s=this.readSync(t.dataId),u=0;u<t.size;++u)s[u]>=0&&s[u]<n&&(a[u*n+s[u]]=o);return yr(a,[t.size,n],"int32")},e.prototype.nonMaxSuppression=function(t,n,o,i,a){return X(t,"nonMaxSuppression"),Cc(this.readSync(t.dataId),this.readSync(n.dataId),o,i,a)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,n){for(var o=t.shape[0],i=t.shape[1],a=pe(t.shape,"float32"),s=pe(t.shape,"float32"),u=nn(t).as2D(o,i),c=Fn(t).as2D(o,i),l=0;l<o;l++)for(var h=u.slice([l,0],[1,i]),d=c.slice([l,0],[1,i]),f=xt(h,d),p=this.readSync(this.fftImpl(f,n).dataId),v=0;v<i;v++){var m=Ch(p,v);a.values[l*i+v]=m.real,s.values[l*i+v]=m.imag}return xt(a.toTensor(),s.toTensor()).as2D(o,i)},e.prototype.fftImpl=function(t,n){var o=t.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,n).as2D(t.shape[0],t.shape[1]);return n&&(a=xt(nn(a).div(J(i)),Fn(a).div(J(i)))),a}var s=this.readSync(t.dataId),u=function(c){for(var l=new Float32Array(c.length/2),h=new Float32Array(c.length/2),d=0;d<c.length;d+=2)l[d/2]=c[d],h[d/2]=c[d+1];return{real:l,imag:h}}(this.fourierTransformByMatmul(s,i,n));return xt(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,n,o){if(n===1)return t;var i=this.readSync(t.dataId),a=n/2,s=function(g){for(var _=Math.ceil(g.length/4),x=new Float32Array(_),b=new Float32Array(_),y=0;y<g.length;y+=4)x[Math.floor(y/4)]=g[y],b[Math.floor(y/4)]=g[y+1];return{real:x,imag:b}}(i),u=xt(s.real,s.imag).as1D(),c=function(g){for(var _=Math.floor(g.length/4),x=new Float32Array(_),b=new Float32Array(_),y=2;y<g.length;y+=4)x[Math.floor(y/4)]=g[y],b[Math.floor(y/4)]=g[y+1];return{real:x,imag:b}}(i),l=xt(c.real,c.imag).as1D();u=this.fftRadix2(u,a,o),l=this.fftRadix2(l,a,o);var h=function(g,_){for(var x=new Float32Array(g/2),b=new Float32Array(g/2),y=0;y<Math.ceil(g/2);y++){var w=(_?2:-2)*Math.PI*(y/g);x[y]=Math.cos(w),b[y]=Math.sin(w)}return{real:x,imag:b}}(n,o),d=xt(h.real,h.imag).mul(l),f=u.add(d),p=u.sub(d),v=nn(f).concat(nn(p)),m=Fn(f).concat(Fn(p));return xt(v,m).as1D()},e.prototype.fourierTransformByMatmul=function(t,n,o){for(var i=new Float32Array(2*n),a=0;a<n;a++){for(var s=0,u=0,c=0;c<n;c++){var l=wy(a*c,n,o),h=Ch(t,c);s+=h.real*l.real-h.imag*l.imag,u+=h.real*l.imag+h.imag*l.real}o&&(s/=n,u/=n),xy(i,s,u,a)}return i},e.prototype.depthToSpace=function(t,n,o){R(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),R(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});for(var i=t.shape[0],a=t.shape[1],s=t.shape[2],u=t.shape[3],c=a*n,l=s*n,h=u/(n*n),d=this.readSync(t.dataId),f=new Float32Array(i*c*l*h),p=0,v=0;v<i;++v)for(var m=0;m<c;++m)for(var g=Math.floor(m/n),_=m%n,x=0;x<l;++x)for(var b=Math.floor(x/n),y=(_*n+x%n)*h,w=0;w<h;++w){var E=w+y+u*(b+s*(g+a*v));f[p++]=d[E]}return Bt(f,[i,c,l,h])},e.prototype.broadcastedBinaryOp=function(t,n,o,i){var a=xe(t.shape,n.shape),s=pe(a,o),u=this.readSync(t.dataId),c=this.readSync(n.dataId),l=vr(t.shape,a),h=vr(n.shape,a),d=s.values;if(l.length+h.length===0)for(var f=0;f<d.length;++f)d[f]=i(u[f%u.length],c[f%c.length]);else{var p=this.bufferSync(t),v=this.bufferSync(n),m=function(g){var _=s.indexToLoc(g),x=_.slice(-t.rank);l.forEach(function(E){return x[E]=0});var b=p.locToIndex(x),y=_.slice(-n.rank);h.forEach(function(E){return y[E]=0});var w=v.locToIndex(y);d[g]=i(u[b],c[w])};for(f=0;f<d.length;++f)m(f)}return s.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,n,o){var i=xe(t.shape,n.shape),a=pe(i,"float32"),s=pe(i,"float32"),u=this.readSync(t.dataId),c=this.readSync(n.dataId),l=vr(t.shape,i),h=vr(n.shape,i),d=a.values,f=s.values;if(l.length+h.length===0)for(var p=0;p<d.length;p++){var v=p%u.length,m=p%c.length,g=o(u[2*v],u[2*v+1],c[2*m],c[2*m+1]);d[p]=g.real,f[p]=g.imag}else{var _=this.bufferSync(this.data.get(t.dataId).complexTensors.real),x=this.bufferSync(this.data.get(n.dataId).complexTensors.real),b=function(y){var w=a.indexToLoc(y),E=w.slice(-t.rank);l.forEach(function(A){return E[A]=0});var C=_.locToIndex(E),T=w.slice(-n.rank);h.forEach(function(A){return T[A]=0});var S=x.locToIndex(T),I=o(u[2*C],u[2*C+1],c[2*S],c[2*S+1]);d[y]=I.real,f[y]=I.imag};for(p=0;p<d.length;p++)b(p)}return this.complex(a.toTensor(),s.toTensor())},e.prototype.split=function(t,n,o){return Nf(t,n,o)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,n,o,i,a,s){for(var u=t.shape,c=u[0],l=u[1],h=u[2],d=u[3],f=n.shape[0],p=i[0],v=i[1],m=pe([f,p,v,d],"float32"),g=this.readSync(n.dataId),_=this.readSync(o.dataId),x=this.readSync(t.dataId),b=t.strides,y=m.strides,w=0;w<f;w++){var E=4*w,C=g[E],T=g[E+1],S=g[E+2],I=g[E+3],A=_[w];if(!(A>=c))for(var F=p>1?(S-C)*(l-1)/(p-1):0,O=v>1?(I-T)*(h-1)/(v-1):0,M=0;M<p;M++){var B=p>1?C*(l-1)+M*F:.5*(C+S)*(l-1);if(B<0||B>l-1)for(var P=0;P<v;P++)for(var L=0;L<d;L++){var W=L+P*y[2]+M*y[1]+w*y[0];m.values[W]=s}else if(a==="bilinear"){var z=Math.floor(B),H=Math.ceil(B),Y=B-z;for(P=0;P<v;P++)if((me=v>1?T*(h-1)+P*O:.5*(T+I)*(h-1))<0||me>h-1)for(L=0;L<d;L++)W=L+P*y[2]+M*y[1]+w*y[0],m.values[W]=s;else{var te=Math.floor(me),ce=Math.ceil(me),Z=me-te;for(L=0;L<d;L++){var oe=x[W=L+te*b[2]+z*b[1]+A*b[0]],le=x[W=L+ce*b[2]+z*b[1]+A*b[0]],$=x[W=L+te*b[2]+H*b[1]+A*b[0]],ve=oe+(le-oe)*Z,De=$+(x[W=L+ce*b[2]+H*b[1]+A*b[0]]-$)*Z;W=L+P*y[2]+M*y[1]+w*y[0],m.values[W]=ve+(De-ve)*Y}}}else for(P=0;P<v;++P){var me;if((me=v>1?T*(h-1)+P*O:.5*(T+I)*(h-1))<0||me>h-1)for(L=0;L<d;L++)W=L+P*y[2]+M*y[1]+w*y[0],m.values[W]=s;else{var Ee=Math.round(me),ke=Math.round(B);for(L=0;L<d;L++){var ze=L+Ee*b[2]+ke*b[1]+A*b[0],K=L+P*y[2]+M*y[1]+w*y[0];m.values[K]=x[ze]}}}}}return m.toTensor()},e.prototype.sparseToDense=function(t,n,o,i){var a=Wa(0,t,o),s=a.sliceRank,u=a.numUpdates,c=a.sliceSize,l=a.strides,h=a.outputSize;return this.scatter(t,n,o,h,c,u,s,l,i,!1)},e.prototype.gatherND=function(t,n){var o=n.shape,i=o[o.length-1],a=xf(t,n),s=a[0],u=a[1],c=a[2],l=a[3];if(u===0)return Ct([],s,t.dtype);for(var h=new _i([u,c],t.dtype),d=this.readSync(n.dataId),f=this.readSync(t.dataId),p=0;p<u;p++){for(var v=[],m=0,g=0;g<i;g++){var _=d[p*i+g];m+=_*l[g],v.push(_)}if(m<0||m>=t.size/c)throw new Error("Invalid indices: "+v+" does not index into "+t.shape);for(var x=0;x<c;x++)h.values[p*c+x]=f[m*c+x]}return h.toTensor().reshape(s)},e.prototype.scatterND=function(t,n,o){var i=Wa(0,t,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,h=J(0);return this.scatter(t,n,o,l,u,s,a,c,h,!0)},e.prototype.fill=function(t,n,o){var i=Ia(o=o||Fi(n),ie(t));return i.fill(n),D.makeTensor(i,t,o,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var n=Ia(t.dtype,ie(t.shape));return this.makeOutput(n,t.shape,t.dtype)},e.prototype.linspace=function(t,n,o){return If(t,n,o)},e.prototype.scatter=function(t,n,o,i,a,s,u,c,l,h){var d=[i/a,a],f=this.readSync(t.dataId),p=this.readSync(n.dataId);if(i===0)return Ct([],o,n.dtype);var v=new _i(d,n.dtype);v.values.fill(this.readSync(l.dataId)[0]);for(var m=0;m<s;m++){for(var g=[],_=0,x=0;x<u;x++){var b=f[m*u+x];g.push(b),_+=b*c[x]}if(_<0||_>=i/a)throw new Error("Invalid indices: "+g+" does not index into "+o);for(var y=0;y<a;y++)h?v.values[_*a+y]+=p[m*a+y]:v.values[_*a+y]=n.rank===0?p[0]:p[m*a+y]}return v.toTensor().reshape(o)},e}(Tf);D.registerBackend("cpu",function(){return new zx},1);for(var vu=0,Hh=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,o=e,i=o.boxes,a=o.scores,s=n,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=t;X(i,"NonMaxSuppressionWithScore");var f=Ec(d.data.get(i.dataId).values,d.data.get(a.dataId).values,u,c,l,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,o=t;X(n,"square");for(var i=o.data.get(n.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},{kernelName:wi,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e,o=n.a,i=n.b,a=t;X([o,i],wi);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,c=function(d,f,p,v,m,g){var _=xe(d,f),x=_.length,b=Bn(_),y=yi(m,ie(_)),w=d.length,E=f.length,C=Bn(d),T=Bn(f),S=vr(d,_),I=vr(f,_);if(S.length+I.length===0)for(var A=0;A<y.length;++A)y[A]=g(p[A%p.length],v[A%v.length]);else{var F=function(O){var M=Jm(O,x,b),B=M.slice(-w);S.forEach(function(z){return B[z]=0});var P=ph(B,w,C),L=M.slice(-E);I.forEach(function(z){return L[z]=0});var W=ph(L,E,T);y[O]=g(p[P],v[W])};for(A=0;A<y.length;++A)F(A)}return[y,_]}(o.shape,i.shape,s,u,o.dtype,function(d,f){var p=d-f;return p*p}),l=c[0],h=c[1];return{dataId:a.write(l,h,o.dtype),shape:h,dtype:o.dtype}}}];vu<Hh.length;vu++)Qd(Hh[vu]);var so,Gx=function(r){this.variableNames=["A"];var e=kt(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},qx=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=kt(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+n+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var mu=0,jh=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,o=e.pixels,i=n.numChannels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],h=[l,c],d=[l,c,i];(s||a)&&(so==null&&(so=document.createElement("canvas").getContext("2d")),so.canvas.width=c,so.canvas.height=l,so.drawImage(o,0,0,c,l),o=so.canvas);var f=t.makeTensorInfo(h,"int32");t.texData.get(f.dataId).usage=$t.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),o);var p=q().getBool("WEBGL_PACK")?new qx(d):new Gx(d),v=t.runWebGLProgram(p,[f],"int32");return t.disposeData(f.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs;Oa("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=e,i=o.boxes,a=o.scores,s=n,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=t,f=Ec(d.readSync(i.dataId),d.readSync(a.dataId),u,c,l,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,o=t,i=new ge(n.shape,"return x * x;");return o.runWebGLProgram(i,[n],n.dtype)}},{kernelName:wi,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e,o=n.a,i=n.b,a=t,s=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yn("return (a - b) * (a - b);",o.shape,i.shape):new $e("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];mu<jh.length;mu++)Qd(jh[mu]);for(var gu=0,Xh=[{kernelName:"Square",gradFunc:function(r,e){var t=e[0];return{x:function(){return r.mul(t.toFloat().mul(2))}}}},{kernelName:wi,gradFunc:function(r,e){var t=e[0],n=e[1],o=J(2);return{a:function(){return It(r,It(o,ht(t,n)))},b:function(){return It(r,It(o,ht(n,t)))}}}}];gu<Xh.length;gu++)Um(Xh[gu]);var Hx=function(){function r(){}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r}();q().get("IS_BROWSER")&&q().setPlatform("browser",new Hx);var yu,jx=function(){return require("node-fetch")},Xx=function(){function r(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return q().global.fetch!=null?q().global.fetch(e,t):(yu==null&&(yu=jx()),yu(e,t))},r.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r}();q().get("IS_NODE")&&q().setPlatform("node",new Xx);var zu={float32:4,int32:4,uint16:2,uint8:1,bool:1},ja=4;function Cp(r,e){for(var t={},n=0,o=function(s){var u=s.name,c=s.dtype,l=s.shape,h=ie(l),d=void 0;if("quantization"in s){var f=s.quantization;if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+f.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=zu[f.dtype],v=r.slice(n,n+h*p),m=f.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(c==="float32")d=Float32Array.from(m,function(w){return w*f.scale+f.min});else{if(c!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=Int32Array.from(m,function(w){return Math.round(w*f.scale+f.min)})}n+=h*p}else if(c==="string"){var g=ie(s.shape);d=[];for(var _=0;_<g;_++){var x=new Uint32Array(r.slice(n,n+ja))[0];n+=ja;var b=new Uint8Array(r.slice(n,n+x));d.push(b),n+=x}}else{var y=zu[c];if(v=r.slice(n,n+h*y),c==="float32")d=new Float32Array(v);else if(c==="int32")d=new Int32Array(v);else{if(c!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=new Uint8Array(v)}n+=h*y}t[u]=Ct(d,l,c)},i=0,a=e;i<a.length;i++)o(a[i]);return t}function Kx(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var e=0,t=[];r.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var n=new Uint8Array(e),o=0;return t.forEach(function(i){n.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),n.buffer}var Gu=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Kh(r){return Gu?Buffer.byteLength(r):new Blob([r]).size}function Gc(r){var e=0;r.forEach(function(o){e+=o.byteLength});var t=new Uint8Array(e),n=0;return r.forEach(function(o){t.set(new Uint8Array(o),n),n+=o.byteLength}),t.buffer}function $h(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var e=r.split("/");return e[e.length-1]}function Ui(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:Kh(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:Kh(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var Yt=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var o=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(i){var a=i(e,n);a!==null&&o.push(a)}),o},r}(),To="://",_r=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){R(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(To)&&(e=e.slice(0,e.indexOf(To))),R(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();R(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),n.managers[e]=t},r.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function Ea(r){if(r.indexOf(To)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+_r.getSchemes().join(","));return{scheme:r.split(To)[0],path:r.split(To)[1]}}function Yh(r,e,t){return t===void 0&&(t=!1),ne(this,void 0,void 0,function(){var n,o,i,a,s,u,c,l,h;return re(this,function(d){switch(d.label){case 0:return R(r!==e,function(){return"Old path and new path are the same: '"+r+"'"}),R((n=Yt.getLoadHandlers(r)).length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),R(n.length<2,function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+r+"."}),o=n[0],R((i=Yt.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),R(i.length<2,function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+e+"."}),a=i[0],s=Ea(r).scheme,u=Ea(r).path,c=s===Ea(r).scheme,[4,o.load()];case 1:return l=d.sent(),t&&c?[4,_r.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(l)];case 4:return h=d.sent(),!t||c?[3,6]:[4,_r.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var Ur="models_store",mr="model_info_store";function Ep(){if(!q().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function qu(r){var e=r.result;e.createObjectStore(Ur,{keyPath:"modelPath"}),e.createObjectStore(mr,{keyPath:"modelPath"})}var ko=function(){function r(e){if(this.indexedDB=Ep(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return ne(this,void 0,void 0,function(){return re(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return ne(this,void 0,void 0,function(){return re(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(o,i){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return qu(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(Ur,"readonly"),c=u.objectStore(Ur).get(n.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(v){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,h=Ui(t),d=s.transaction(mr,"readwrite"),f=d.objectStore(mr),p=f.put({modelPath:n.modelPath,modelArtifactsInfo:h});p.onsuccess=function(){var v=(l=s.transaction(Ur,"readwrite")).objectStore(Ur).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:h});v.onsuccess=function(){return o({modelArtifactsInfo:h})},v.onerror=function(m){var g=(f=d.objectStore(mr)).delete(n.modelPath);g.onsuccess=function(){return s.close(),i(v.error)},g.onerror=function(_){return s.close(),i(v.error)}}},p.onerror=function(v){return s.close(),i(p.error)},d.oncomplete=function(){l==null?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},r.URL_SCHEME="indexeddb://",r}(),Zh=function(r){return q().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ko.URL_SCHEME)?(e=r.slice(ko.URL_SCHEME.length),new ko(e)):null;var e};Yt.registerSaveRouter(Zh),Yt.registerLoadRouter(Zh);var $x=function(){function r(){this.indexedDB=Ep()}return r.prototype.listModels=function(){return ne(this,void 0,void 0,function(){var e=this;return re(this,function(t){return[2,new Promise(function(n,o){var i=e.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return qu(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(mr,"readonly"),u=s.objectStore(mr).getAll();u.onsuccess=function(){for(var c={},l=0,h=u.result;l<h.length;l++){var d=h[l];c[d.modelPath]=d.modelArtifactsInfo}n(c)},u.onerror=function(c){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},r.prototype.removeModel=function(e){return ne(this,void 0,void 0,function(){var t=this;return re(this,function(n){var o;return e=(o=e).startsWith(ko.URL_SCHEME)?o.slice(ko.URL_SCHEME.length):o,[2,new Promise(function(i,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return qu(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(mr,"readwrite"),h=l.objectStore(mr),d=h.get(e);d.onsuccess=function(){if(d.result==null)return c.close(),a(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var f=h.delete(e),p=function(){var v=(u=c.transaction(Ur,"readwrite")).objectStore(Ur).delete(e);v.onsuccess=function(){return i(d.result.modelArtifactsInfo)},v.onerror=function(m){return a(d.error)}};f.onsuccess=p,f.onerror=function(v){return p(),c.close(),a(d.error)}},d.onerror=function(f){return c.close(),a(d.error)},l.oncomplete=function(){u==null?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}})]})})},r}();if(q().getBool("IS_BROWSER"))try{_r.registerManager(ko.URL_SCHEME,new $x)}catch{}var Qn="/",po="tensorflowjs_models",Sp="info",Yx="model_topology",Zx="weight_specs",Jx="weight_data",Qx="model_metadata";function Tp(r){return{info:[po,r,Sp].join(Qn),topology:[po,r,Yx].join(Qn),weightSpecs:[po,r,Zx].join(Qn),weightData:[po,r,Jx].join(Qn),modelMetadata:[po,r,Qx].join(Qn)}}function e1(r){var e=r.split(Qn);if(e.length<3)throw new Error("Invalid key format: "+r);return e.slice(1,e.length-1).join(Qn)}var Ao=function(){function r(e){if(!q().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Tp(this.modelPath)}return r.prototype.save=function(e){return ne(this,void 0,void 0,function(){var t,n,o;return re(this,function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),o=Ui(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(a){if(Gu)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},r.prototype.load=function(){return ne(this,void 0,void 0,function(){var e,t,n,o,i,a,s;return re(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=o,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(i),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(c){if(Gu){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var h=atob(c),d=new Uint8Array(h.length),f=0;f<h.length;++f)d.set([h.charCodeAt(f)],f);return d.buffer}(s),[2,t]})})},r.URL_SCHEME="localstorage://",r}(),Jh=function(r){return q().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Ao.URL_SCHEME)?(e=r.slice(Ao.URL_SCHEME.length),new Ao(e)):null;var e};Yt.registerSaveRouter(Jh),Yt.registerLoadRouter(Jh);var t1=function(){function r(){R(q().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),R(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return ne(this,void 0,void 0,function(){var e,t,n,o,i,a;return re(this,function(s){for(e={},t=po+Qn,n=Qn+Sp,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(t)&&i.endsWith(n)&&(a=e1(i),e[a]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},r.prototype.removeModel=function(e){return ne(this,void 0,void 0,function(){var t,n;return re(this,function(o){var i;if(e=(i=e).startsWith(Ao.URL_SCHEME)?i.slice(Ao.URL_SCHEME.length):i,t=Tp(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},r}();if(q().getBool("IS_BROWSER"))try{_r.registerManager(Ao.URL_SCHEME,new t1)}catch{}var n1="model",r1=".json",o1=".weights.bin";function Qh(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var _u=function(){function r(e){if(!q().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),e!=null&&e.length!==0||(e=n1),this.modelTopologyFileName=e+r1,this.weightDataFileName=e+o1}return r.prototype.save=function(e){return ne(this,void 0,void 0,function(){var t,n,o,i,a,s;return re(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],o={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,Qh(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,Qh(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Ui(e)}]}})})},r.URL_SCHEME="downloads://",r}(),i1=function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return r.prototype.load=function(){return ne(this,void 0,void 0,function(){var e,t,n=this;return re(this,function(o){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(l!=null){t.length===0&&i({modelTopology:l});var h=c.weightsManifest;if(h!=null){var d;try{d=n.checkManifestAndWeightFiles(h,t)}catch(m){return void a(m)}var f=[],p=[],v=[];h.forEach(function(m){m.paths.forEach(function(g){p.push(g),v.push(null)}),f.push.apply(f,m.weights)}),h.forEach(function(m){m.paths.forEach(function(g){var _=new FileReader;_.onload=function(x){var b=x.target.result,y=p.indexOf(g);v[y]=b,v.indexOf(null)===-1&&i({modelTopology:l,weightSpecs:f,weightData:Gc(v),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},_.onerror=function(x){return a("Failed to weights data from file of path '"+g+"'.")},_.readAsArrayBuffer(d[g])})})}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(e)})]})})},r.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],o=t.map(function(u){return $h(u.name)}),i={},a=0,s=e;a<s.length;a++)s[a].paths.forEach(function(u){var c=$h(u);if(n.indexOf(c)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(n.push(c),o.indexOf(c)===-1)throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=t[o.indexOf(c)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return i},r}();function ed(r,e,t,n){(function(i){R(i!=null&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"})})(r),function(i,a){R(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),R(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),R(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(t=t??0,n=n??1);var o=0;return Promise.all(r.map(function(i){return i.then(function(a){var s=t+ ++o/r.length*(n-t);return e(s),a}),i}))}function kp(r,e){return ne(this,void 0,void 0,function(){var t,n,o,i,a,s,u,c,l;return re(this,function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?q().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),o=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return a=h.sent(),[3,4];case 2:return[4,ed(n,e.onProgress,o,i)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(d){return d.arrayBuffer()}),u=.5,c=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return l=h.sent(),[3,8];case 6:return[4,ed(s,e.onProgress,u,c)];case 7:l=h.sent(),h.label=8;case 8:return[2,l]}})})}function td(r){var e=this;return function(t,n,o){return n===void 0&&(n=""),ne(e,void 0,void 0,function(){var i,a,s,u,c,l,h,d,f,p;return re(this,function(v){switch(v.label){case 0:if(i=t.map(function(){return!1}),a={},s=o!=null?o.map(function(){return!1}):[],u=[],t.forEach(function(m,g){var _=0;m.weights.forEach(function(x){var b="quantization"in x?x.quantization.dtype:x.dtype,y=zu[b]*ie(x.shape),w=function(){i[g]=!0,a[g]==null&&(a[g]=[]),a[g].push({manifestEntry:x,groupOffset:_,sizeBytes:y})};o!=null?o.forEach(function(E,C){E===x.name&&(w(),s[C]=!0)}):w(),u.push(x.name),_+=y})}),!s.every(function(m){return m}))throw c=o.filter(function(m,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return l=i.reduce(function(m,g,_){return g&&m.push(_),m},[]),h=[],l.forEach(function(m){t[m].paths.forEach(function(g){var _=n+(n.endsWith("/")?"":"/")+g;h.push(_)})}),[4,r(h)];case 1:return d=v.sent(),f={},p=0,l.forEach(function(m){for(var g=t[m].paths.length,_=0,x=0;x<g;x++)_+=d[p+x].byteLength;for(var b=new ArrayBuffer(_),y=new Uint8Array(b),w=0,E=0;E<g;E++){var C=new Uint8Array(d[p+E]);y.set(C,w),w+=C.byteLength}a[m].forEach(function(T){var S=Cp(b.slice(T.groupOffset,T.groupOffset+T.sizeBytes),[T.manifestEntry]);for(var I in S)f[I]=S[I]}),p+=g}),[2,f]}})})}}Yt.registerSaveRouter(function(r){return q().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(_u.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new _u(e)}(r.slice(_u.URL_SCHEME.length)):null});var Ap=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(R(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=q().platform.fetch,R(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&R(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return ne(this,void 0,void 0,function(){var t,n,o,i;return re(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],o={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:Ui(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},r.prototype.load=function(){return ne(this,void 0,void 0,function(){var e,t,n,o,i,a,s,u,c,l,h,d;return re(this,function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,e.json()];case 3:return t=f.sent(),[3,5];case 4:throw f.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(o=t.modelTopology,i=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,u=t.format,c=t.userDefinedMetadata,o==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:d=f.sent(),l=d[0],h=d[1],f.label=7;case 7:return[2,{modelTopology:o,weightSpecs:l,weightData:h,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}})})},r.prototype.loadWeights=function(e){return ne(this,void 0,void 0,function(){var t,n,o,i,a,s,u,c,l,h,d;return re(this,function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(p){var v=p.lastIndexOf("/"),m=p.lastIndexOf("?"),g=p.substring(0,v),_=m>v?p.substring(m):"";return[g+"/",_]}(t),o=n[0],i=n[1],a=this.weightPathPrefix||o,s=[],u=0,c=e;u<c.length;u++)l=c[u],s.push.apply(s,l.weights);return h=[],e.forEach(function(p){p.paths.forEach(function(v){h.push(a+v+i)})}),[4,kp(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=f.sent(),[2,[s,Gc(d)]]}})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r}();function Hu(r){return r.match(Ap.URL_SCHEME_REGEX)!=null}var nd=function(r,e){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(t){return Hu(t)}):Hu(r))?ju(r,{onProgress:e}):null};function ju(r,e){return new Ap(r,e)}Yt.registerSaveRouter(nd),Yt.registerLoadRouter(nd);var bu=function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return ne(this,void 0,void 0,function(){return re(this,function(e){return[2,this.modelArtifacts]})})},r}(),a1=function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return ne(this,void 0,void 0,function(){return re(this,function(t){return[2,this.saveHandler(e)]})})},r}(),Ip=Object.freeze({browserFiles:function(r){return new i1(r)},browserHTTPRequest:function(r,e){return ju(r,e)},concatenateArrayBuffers:Gc,decodeWeights:Cp,encodeWeights:function(r,e){return ne(this,void 0,void 0,function(){var t,n,o,i,a,s=this;return re(this,function(u){switch(u.label){case 0:for(t=[],n=[],o=Array.isArray(r)?r.map(function(c){return c.name}):Object.keys(r),i=function(c){var l=o[c],h=Array.isArray(r)?r[c].tensor:r[l];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+l+"': "+h.dtype);var d={name:l,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var f=new Promise(function(p){return ne(s,void 0,void 0,function(){var v,m,g,_,x,b,y;return re(this,function(w){switch(w.label){case 0:return[4,h.bytes()];case 1:for(v=w.sent(),m=v.reduce(function(E,C){return E+C.length},0)+ja*v.length,g=new Uint8Array(m),_=0,x=0;x<v.length;x++)b=v[x],y=new Uint8Array(new Uint32Array([b.length]).buffer),g.set(y,_),_+=ja,g.set(b,_),_+=b.length;return p(g),[2]}})})});n.push(f)}else n.push(h.data());e!=null&&(d.group=e),t.push(d)},a=0;a<o.length;++a)i(a);return[4,Promise.all(n)];case 1:return[2,{data:Kx(u.sent()),specs:t}]}})})},fromMemory:function(r,e,t,n){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new bu(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new bu({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new bu({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n}))},getLoadHandlers:function(r,e){return Yt.getLoadHandlers(r,e)},getModelArtifactsInfoForJSON:Ui,getSaveHandlers:function(r){return Yt.getSaveHandlers(r)},http:ju,isHTTPScheme:Hu,loadWeights:function(r,e,t,n){return e===void 0&&(e=""),ne(this,void 0,void 0,function(){return re(this,function(o){return[2,td(function(i){return kp(i,{requestInit:n})})(r,e,t)]})})},registerLoadRouter:function(r){return Yt.registerLoadRouter(r)},registerSaveRouter:function(r){return Yt.registerSaveRouter(r)},weightsLoaderFactory:td,withSaveHandler:function(r){return new a1(r)},copyModel:function(r,e){return ne(this,void 0,void 0,function(){return re(this,function(t){return[2,Yh(r,e,!1)]})})},listModels:function(){return ne(this,void 0,void 0,function(){var r,e,t,n,o,i,a;return re(this,function(s){switch(s.label){case 0:r=_r.getSchemes(),e={},t=0,n=r,s.label=1;case 1:return t<n.length?(o=n[t],[4,_r.getManager(o).listModels()]):[3,4];case 2:for(a in i=s.sent())e[o+To+a]=i[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(r,e){return ne(this,void 0,void 0,function(){return re(this,function(t){return[2,Yh(r,e,!0)]})})},removeModel:function(r){return ne(this,void 0,void 0,function(){var e;return re(this,function(t){return e=Ea(r),[2,_r.getManager(e.scheme).removeModel(e.path)]})})}}),uo;N({confusionMatrix_:function(r,e,t){var n=k(r,"labels","confusionMatrix"),o=k(e,"predictions","confusionMatrix");R(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),R(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),R(o.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),R(n.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),R(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var i=Bu(n.asType("int32"),t),a=Bu(o.asType("int32"),t);return i.transpose().matMul(a).asType("int32")}});var s1=N({fromPixels_:function(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,o=!1,i=!1,a=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else{if(r.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);a=!0}if(o&&o&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Jd("FromPixels",D.backendName)!=null)return D.runKernel("FromPixels",{pixels:r},{numChannels:e});var s,u,c=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],l=c[0],h=c[1];if(a?s=r.getContext("2d").getImageData(0,0,l,h).data:n||t?s=r.data:(i||o)&&(uo==null&&(uo=document.createElement("canvas").getContext("2d")),uo.canvas.width=l,uo.canvas.height=h,uo.drawImage(r,0,0,l,h),s=uo.getImageData(0,0,l,h).data),e===4)u=new Int32Array(s);else{var d=l*h;u=new Int32Array(d*e);for(var f=0;f<d;f++)for(var p=0;p<e;++p)u[f*e+p]=s[4*f+p]}return yc(u,[h,l,e],"int32")}}),qc=Object.freeze({toPixels:function(r,e){return ne(this,void 0,void 0,function(){var t,n,o,i,a,s,u,c,l,h,d,f,p,v,m,g,_,x,b,y,w,E,C;return re(this,function(T){switch(T.label){case 0:if(t=k(r,"img","toPixels"),r instanceof He||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(n=t.shape.slice(0,2),o=n[0],i=n[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=T.sent(),u=t.min(),c=t.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=T.sent(),h=l[0],d=l[1],f=h[0],p=d[0],u.dispose(),c.dispose(),t.dtype==="float32"){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(v=t.dtype==="float32"?255:1,m=new Uint8ClampedArray(i*o*4),g=0;g<o*i;++g)_=void 0,x=void 0,b=void 0,y=void 0,a===1?(_=s[g]*v,x=s[g]*v,b=s[g]*v,y=255):a===3?(_=s[3*g]*v,x=s[3*g+1]*v,b=s[3*g+2]*v,y=255):a===4&&(_=s[4*g]*v,x=s[4*g+1]*v,b=s[4*g+2]*v,y=s[4*g+3]*v),m[(w=4*g)+0]=Math.round(_),m[w+1]=Math.round(x),m[w+2]=Math.round(b),m[w+3]=Math.round(y);return e!=null&&(e.width=i,e.height=o,E=e.getContext("2d"),C=new ImageData(m,i,o),E.putImageData(C,0,0)),t!==r&&t.dispose(),[2,m]}})})},fromPixels:s1}),u1=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}(),c1=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r}();function eo(r){R(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),R(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),R(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),c1.register(r)}var to=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return _n(e,r),e.prototype.minimize=function(t,n,o){n===void 0&&(n=!1);var i=this.computeGradients(t,o),a=i.value,s=i.grads;if(o!=null){var u=o.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Vt(s),n?a:(a.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return _y(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&Vt(this.iterations_)},e.prototype.saveIterations=function(){return ne(this,void 0,void 0,function(){return re(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:J(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){return re(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return ne(this,void 0,void 0,function(){return re(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return ne(this,void 0,void 0,function(){var n;return re(this,function(o){switch(o.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=o.sent()[0],[2,t.slice(1)]}})})},e}(u1);Object.defineProperty(to,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var l1=function(r){function e(t,n,o){o===void 0&&(o=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],o==null&&(i.epsilon=D.backend.epsilon()),i}return _n(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t)).forEach(function(o,i){var a=D.registeredVariables[o];n.accumulatedGrads[i]==null&&(n.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:ee(function(){return Te(a).variable(!1)})}),n.accumulatedUpdates[i]==null&&(n.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:ee(function(){return Te(a).variable(!1)})});var s=Array.isArray(t)?t[i].tensor:t[o];if(s!=null){var u=n.accumulatedGrads[i].variable,c=n.accumulatedUpdates[i].variable;ee(function(){var l=u.mul(n.rho).add(s.square().mul(1-n.rho)),h=c.add(n.epsilon).sqrt().div(u.add(n.epsilon).sqrt()).mul(s),d=c.mul(n.rho).add(h.square().mul(1-n.rho));u.assign(l),c.assign(d);var f=h.mul(-n.learningRate).add(a);a.assign(f)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Vt(this.accumulatedGrads.map(function(t){return t.variable})),Vt(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){var t;return re(this,function(n){switch(n.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},e.prototype.setWeights=function(t){return ne(this,void 0,void 0,function(){var n;return re(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),n=t.length/2,this.accumulatedGrads=t.slice(0,n).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(n,2*n).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e.className="Adadelta",e}(to);eo(l1);var h1=function(r){function e(t,n){n===void 0&&(n=.1);var o=r.call(this)||this;return o.learningRate=t,o.initialAccumulatorValue=n,o.accumulatedGrads=[],o}return _n(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t)).forEach(function(o,i){var a=D.registeredVariables[o];n.accumulatedGrads[i]==null&&(n.accumulatedGrads[i]={originalName:o+"/accumulator",variable:ee(function(){return Ln(a.shape,n.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(t)?t[i].tensor:t[o];if(s!=null){var u=n.accumulatedGrads[i].variable;ee(function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(D.backend.epsilon()).sqrt()).mul(-n.learningRate).add(a);a.assign(l)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Vt(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){return re(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return ne(this,void 0,void 0,function(){return re(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedGrads=t.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e.className="Adagrad",e}(to);eo(h1);var d1=function(r){function e(t,n,o,i){i===void 0&&(i=null);var a=r.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],ee(function(){a.accBeta1=J(n).variable(),a.accBeta2=J(o).variable()}),i==null&&(a.epsilon=D.backend.epsilon()),a}return _n(e,r),e.prototype.applyGradients=function(t){var n=this,o=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);ee(function(){var i=ht(1,n.accBeta1),a=ht(1,n.accBeta2);o.forEach(function(s,u){var c=D.registeredVariables[s];n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ee(function(){return Te(c).variable(!1)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:s+"/v",variable:ee(function(){return Te(c).variable(!1)})});var l=Array.isArray(t)?t[u].tensor:t[s];if(l!=null){var h=n.accumulatedFirstMoment[u].variable,d=n.accumulatedSecondMoment[u].variable,f=h.mul(n.beta1).add(l.mul(1-n.beta1)),p=d.mul(n.beta2).add(l.square().mul(1-n.beta2)),v=f.div(i),m=p.div(a);h.assign(f),d.assign(p);var g=v.div(m.sqrt().add(n.epsilon)).mul(-n.learningRate).add(c);c.assign(g)}}),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Vt(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Vt(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){var t;return re(this,function(n){switch(n.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},e.prototype.setWeights=function(t){return ne(this,void 0,void 0,function(){var n,o=this;return re(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),ee(function(){o.accBeta1.assign(qa(o.beta1,o.iterations_+1)),o.accBeta2.assign(qa(o.beta2,o.iterations_+1))}),n=t.length/2,this.accumulatedFirstMoment=t.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e.className="Adam",e}(to);eo(d1);var f1=function(r){function e(t,n,o,i,a){i===void 0&&(i=null),a===void 0&&(a=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],ee(function(){s.iteration=J(0).variable(),s.accBeta1=J(n).variable()}),i==null&&(s.epsilon=D.backend.epsilon()),s}return _n(e,r),e.prototype.applyGradients=function(t){var n=this,o=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);ee(function(){var i=ht(1,n.accBeta1),a=dn(-n.learningRate,n.iteration.mul(n.decay).add(1));o.forEach(function(s,u){var c=D.registeredVariables[s];n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Te(c).variable(!1)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Te(c).variable(!1)});var l=Array.isArray(t)?t[u].tensor:t[s];if(l!=null){var h=n.accumulatedFirstMoment[u].variable,d=n.accumulatedWeightedInfNorm[u].variable,f=h.mul(n.beta1).add(l.mul(1-n.beta1)),p=d.mul(n.beta2),v=l.abs(),m=p.maximum(v);h.assign(f),d.assign(m);var g=a.div(i).mul(f.div(m.add(n.epsilon))).add(c);c.assign(g)}}),n.iteration.assign(n.iteration.add(1)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Vt(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Vt(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){return re(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return ne(this,void 0,void 0,function(){return re(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e.className="Adamax",e}(to);eo(f1);var Rp=function(r){function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return _n(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t)).forEach(function(o,i){var a=Array.isArray(t)?t[i].tensor:t[o];if(a!=null){var s=D.registeredVariables[o];ee(function(){var u=n.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Og(J(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){return re(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return ne(this,void 0,void 0,function(){return re(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=n.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e.className="SGD",e}(to);eo(Rp);var p1=function(r){function e(t,n,o){o===void 0&&(o=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=o,i.accumulations=[],i.m=J(i.momentum),i}return _n(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t)).forEach(function(o,i){var a=D.registeredVariables[o];n.accumulations[i]==null&&(n.accumulations[i]={originalName:o+"/momentum",variable:ee(function(){return Te(a).variable(!1)})});var s=n.accumulations[i].variable,u=Array.isArray(t)?t[i].tensor:t[o];u!=null&&ee(function(){var c,l=n.m.mul(s).add(u);c=n.useNesterov?n.c.mul(u.add(l.mul(n.m))).add(a):n.c.mul(l).add(a),s.assign(l),a.assign(c)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Vt(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){return re(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return ne(this,void 0,void 0,function(){return re(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulations=t.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e.className="Momentum",e}(Rp);eo(p1);var v1=function(r){function e(t,n,o,i,a){n===void 0&&(n=.9),o===void 0&&(o=0),i===void 0&&(i=null),a===void 0&&(a=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,i==null&&(s.epsilon=D.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return _n(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t)).forEach(function(o,i){var a=D.registeredVariables[o];n.accumulatedMeanSquares[i]==null&&(n.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:ee(function(){return Te(a).variable(!1)})}),n.accumulatedMoments[i]==null&&(n.accumulatedMoments[i]={originalName:o+"/momentum",variable:ee(function(){return Te(a).variable(!1)})}),n.accumulatedMeanGrads[i]==null&&n.centered&&(n.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:ee(function(){return Te(a).variable(!1)})});var s=Array.isArray(t)?t[i].tensor:t[o];if(s!=null){var u=n.accumulatedMeanSquares[i].variable,c=n.accumulatedMoments[i].variable;ee(function(){var l=u.mul(n.decay).add(s.square().mul(1-n.decay));if(n.centered){var h=n.accumulatedMeanGrads[i].variable,d=h.mul(n.decay).add(s.mul(1-n.decay)),f=c.mul(n.momentum).add(s.mul(n.learningRate).div(l.sub(d.square().add(n.epsilon)).sqrt()));u.assign(l),h.assign(d),c.assign(f);var p=a.sub(f);a.assign(p)}else{var v=u.mul(n.decay).add(s.square().mul(1-n.decay));f=c.mul(n.momentum).add(s.mul(n.learningRate).div(v.add(n.epsilon).sqrt())),u.assign(v),c.assign(f),p=a.sub(f),a.assign(p)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Vt(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Vt(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Vt(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){var t;return re(this,function(n){switch(n.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},e.prototype.setWeights=function(t){return ne(this,void 0,void 0,function(){var n;return re(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),n=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,n).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(n,2*n).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e.className="RMSProp",e}(to);eo(v1);He.prototype.squaredDifference=function(r){return Hf(this,r)},G=Ux;function Pr(r,e,t){if(t===void 0&&(t=!1),r.beginPath(),e.slice(1).forEach(function(i,a){var s=i.x,u=i.y,c=e[a];r.moveTo(c.x,c.y),r.lineTo(s,u)}),t){var n=e[e.length-1],o=e[0];if(!n||!o)return;r.moveTo(n.x,n.y),r.lineTo(o.x,o.y)}r.stroke()}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Xu=function(r,e){return Xu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])},Xu(r,e)};function fe(r,e){Xu(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Tt=function(){return Tt=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Tt.apply(this,arguments)};function se(r,e,t,n){function o(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function s(l){try{c(n.next(l))}catch(h){a(h)}}function u(l){try{c(n.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):o(l.value).then(s,u)}c((n=n.apply(r,[])).next())})}function ue(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(i=c[0]&2?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,o=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],o=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function di(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var n=Array(r),o=0,e=0;e<t;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n}var zr=function(){function r(e,t){if(!Gr(e)||!Gr(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r}();function bs(r,e){return r instanceof He&&r.shape.length===e}function m1(r){return bs(r,2)}function xs(r){return bs(r,3)}function br(r){return bs(r,4)}function g1(r){return r%1!==0}function rd(r){return r%2===0}function Hc(r,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(r*t)/t}function od(r){return r&&r.width&&r.height}function y1(r,e){var t=r.width,n=r.height,o=e/Math.max(n,t);return new zr(Math.round(t*o),Math.round(n*o))}function jc(r){return r.reduce(function(e,t){return e.add(t)},new Ae(0,0)).div(new Ae(r.length,r.length))}function Ci(r,e,t){return Array(r).fill(0).map(function(n,o){return e+o*t})}function Gr(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function id(r){return Gr(r)&&0<=r&&r<=1}var Ae=function(){function r(e,t){this._x=e,this._y=t}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(e){return new r(this.x+e.x,this.y+e.y)},r.prototype.sub=function(e){return new r(this.x-e.x,this.y-e.y)},r.prototype.mul=function(e){return new r(this.x*e.x,this.y*e.y)},r.prototype.div=function(e){return new r(this.x/e.x,this.y/e.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r}(),Vn=function(){function r(e,t){t===void 0&&(t=!0);var n=e||{},o=[n.left,n.top,n.right,n.bottom].every(Gr),i=[n.x,n.y,n.width,n.height].every(Gr);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(n));var a=i?[n.x,n.y,n.width,n.height]:[n.left,n.top,n.right-n.left,n.bottom-n.top],s=a[0],u=a[1],c=a[2],l=a[3];r.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",t),this._x=s,this._y=u,this._width=c,this._height=l}return r.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Gr)},r.assertIsValidBox=function(e,t,n){if(n===void 0&&(n=!1),!r.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!n&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new Ae(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new Ae(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new Ae(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new Ae(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),t=e[0],n=e[1],o=e[2],i=e[3];return new r({x:t,y:n,width:o,height:i})},r.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),t=e[0],n=e[1],o=e[2],i=e[3];return new r({x:t,y:n,width:o,height:i})},r.prototype.toSquare=function(){var e=this,t=e.x,n=e.y,o=e.width,i=e.height,a=Math.abs(o-i);return o<i&&(t-=a/2,o+=a),i<o&&(n-=a/2,i+=a),new r({x:t,y:n,width:o,height:i})},r.prototype.rescale=function(e){var t=od(e)?e.width:e,n=od(e)?e.height:e;return new r({x:this.x*t,y:this.y*n,width:this.width*t,height:this.height*n})},r.prototype.pad=function(e,t){var n=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],o=n[0],i=n[1],a=n[2],s=n[3];return new r({x:o,y:i,width:a,height:s})},r.prototype.clipAtImageBorders=function(e,t){var n=this,o=n.x,i=n.y,a=n.right,s=n.bottom,u=Math.max(o,0),c=Math.max(i,0),l=a-u,h=s-c,d=Math.min(l,e-u),f=Math.min(h,t-c);return new r({x:u,y:c,width:d,height:f}).floor()},r.prototype.shift=function(e,t){var n=this,o=n.width,i=n.height,a=this.x+e,s=this.y+t;return new r({x:a,y:s,width:o,height:i})},r.prototype.padAtBorders=function(e,t){var n=this.width+1,o=this.height+1,i=1,a=1,s=n,u=o,c=this.left,l=this.top,h=this.right,d=this.bottom;return h>t&&(s=-h+t+n,h=t),d>e&&(u=-d+e+o,d=e),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:a,edy:u,dx:i,edx:s,y:l,ey:d,x:c,ex:h,w:n,h:o}},r.prototype.calibrate=function(e){return new r({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},r}(),ws=function(r){fe(e,r);function e(t,n,o,i,a){return a===void 0&&(a=!1),r.call(this,{left:t,top:n,right:o,bottom:i},a)||this}return e}(Vn),Np=function(){function r(e,t,n,o,i){this._imageDims=new zr(i.width,i.height),this._score=e,this._classScore=t,this._className=n,this._box=new Vn(o).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new Vn(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(e,t){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},r}(),Qt=function(r){fe(e,r);function e(t,n,o){return r.call(this,t,t,"",n,o)||this}return e.prototype.forSize=function(t,n){var o=r.prototype.forSize.call(this,t,n),i=o.score,a=o.relativeBox,s=o.imageDims;return new e(i,a,s)},e}(Np);function _1(r,e,t){t===void 0&&(t=!0);var n=Math.max(0,Math.min(r.right,e.right)-Math.max(r.left,e.left)),o=Math.max(0,Math.min(r.bottom,e.bottom)-Math.max(r.top,e.top)),i=n*o;return t?i/(r.area+e.area-i):i/Math.min(r.area,e.area)}function b1(r){var e=r.map(function(s){return s.x}),t=r.map(function(s){return s.y}),n=e.reduce(function(s,u){return u<s?u:s},1/0),o=t.reduce(function(s,u){return u<s?u:s},1/0),i=e.reduce(function(s,u){return s<u?u:s},0),a=t.reduce(function(s,u){return s<u?u:s},0);return new ws(n,o,i,a)}function Ei(r,e,t,n){n===void 0&&(n=!0);for(var o=e.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,c=[],l=0;l<u.length;l++){var h=u[l],d=r[s],f=r[h];c.push(_1(d,f,n))}o=o.filter(function(p,v){return c[v]<=t})};o.length>0;)a();return i}function zi(r,e){return ee(function(){var t=e[0],n=e[1],o=e[2],i=Ln(di(r.shape.slice(0,3),[1]),t),a=Ln(di(r.shape.slice(0,3),[1]),n),s=Ln(di(r.shape.slice(0,3),[1]),o),u=st([i,a,s],3);return ht(r,u)})}function x1(r,e){return e===void 0&&(e=!1),ee(function(){var t=r.shape.slice(1),n=t[0],o=t[1];if(n===o)return r;var i=Math.abs(n-o),a=Math.round(i*(e?.5:1)),s=n>o?2:1,u=function(f){var p=r.shape.slice();return p[s]=f,Ln(p,0)},c=u(a),l=i-c.shape[s],h=e&&l?u(l):null,d=[h,r,c].filter(function(f){return!!f}).map(function(f){return f.toFloat()});return st(d,s)})}function xu(r){return 1/(1+Math.exp(-r))}var Xc=function(r){fe(e,r);function e(t,n,o,i,a){return a===void 0&&(a=!1),r.call(this,{x:t,y:n,width:o,height:i},a)||this}return e}(Vn),w1=.5,C1=.43,E1=.45,Po=function(){function r(e,t,n){n===void 0&&(n=new Ae(0,0));var o=t.width,i=t.height;this._imgDims=new zr(o,i),this._shift=n,this._positions=e.map(function(a){return a.mul(new Ae(o,i)).add(n)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new Ae(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Ae(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},r.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Ae(e,t))},r.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},r.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var n=e instanceof Qt?e.box.floor():new Vn(e);return this.shiftBy(n.x,n.y).align(null,t)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),i=o.useDlibAlignment,a=o.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(a)},r.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],o=e[2],i=function(h){return o.sub(h).magnitude()},a=(i(t)+i(n))/2,s=Math.floor(a/E1),u=jc(e),c=Math.floor(Math.max(0,u.x-w1*s)),l=Math.floor(Math.max(0,u.y-C1*s));return new Xc(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},r.prototype.alignMinBbox=function(e){var t=b1(this.positions);return t.pad(t.width*e,t.height*e)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r}(),S1=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],jc([t[3],t[4]])]},e}(Po),Dp=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(jc)},e}(Po),ad=function(){function r(e,t){this._label=e,this._distance=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+Hc(this.distance)+")":"")},r}(),sd=function(r){fe(e,r);function e(t,n){var o=r.call(this,t)||this;return o._label=n,o}return e.assertIsValidLabeledBox=function(t,n){if(Vn.assertIsValidBox(t,n),!Gr(t.label))throw new Error(n+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(Vn),ha=function(){function r(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(n){return!(n instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},r.fromJSON=function(e){var t=e.descriptors.map(function(n){return new Float32Array(n)});return new r(e.label,t)},r}();(function(r){fe(e,r);function e(t,n,o,i){var a=r.call(this,t,n)||this;return a._score=o,a._classScore=i,a}return e.assertIsValidPredictedBox=function(t,n){if(sd.assertIsValidLabeledBox(t,n),!id(t.score)||!id(t.classScore))throw new Error(n+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(sd);function Si(r){return r.detection instanceof Qt}function Ti(r,e){var t={detection:e};return Object.assign({},r,t)}function Op(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:e}}function Fp(r){var e="";if(!r)try{r=require("fs")}catch(n){e=n.toString()}var t=r?function(n){return new Promise(function(o,i){r.readFile(n,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function Mp(){var r=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},n=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=Fp();return Tt({Canvas:r||function(){function a(){}return a}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function a(){}return a}(),Image:e||function(){function a(){}return a}(),ImageData:global.ImageData||function(){function a(){}return a}(),Video:global.HTMLVideoElement||function(){function a(){}return a}(),createCanvasElement:t,createImageElement:n,fetch:o},i)}function Pp(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function Bp(){return typeof global=="object"&&typeof require=="function"&&typeof Om<"u"&&typeof process<"u"&&!!process.version}var it;function T1(){if(!it)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return it}function Ku(r){it=r}function Kc(){Pp()&&Ku(Op()),Bp()&&Ku(Mp())}function k1(r){if(it||Kc(),!it)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=r.Canvas,t=e===void 0?it.Canvas:e,n=r.Image,o=n===void 0?it.Image:n;it.Canvas=t,it.Image=o,it.createCanvasElement=r.createCanvasElement||function(){return new t},it.createImageElement=r.createImageElement||function(){return new o},it.ImageData=r.ImageData||it.ImageData,it.Video=r.Video||it.Video,it.fetch=r.fetch||it.fetch,it.readFile=r.readFile||it.readFile}var Nt={getEnv:T1,setEnv:Ku,initialize:Kc,createBrowserEnv:Op,createFileSystem:Fp,createNodejsEnv:Mp,monkeyPatch:k1,isBrowser:Pp,isNodejs:Bp};Kc();function $c(r){return!Nt.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function Un(r){var e=Nt.getEnv(),t=e.Canvas,n=e.CanvasRenderingContext2D;if(r instanceof n)return r;var o=$c(r);if(!(o instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var gr;(function(r){r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT"})(gr||(gr={}));var Lp=function(){function r(e){e===void 0&&(e={});var t=e.anchorPosition,n=e.backgroundColor,o=e.fontColor,i=e.fontSize,a=e.fontStyle,s=e.padding;this.anchorPosition=t||gr.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4}return r}(),Wp=function(){function r(e,t,n){n===void 0&&(n={}),this.text=typeof e=="string"?[e]:e instanceof r?e.text:e,this.anchor=t,this.options=new Lp(n)}return r.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(n){return e.measureText(n).width}).reduce(function(n,o){return n<o?o:n},0)+2*t},r.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},r.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,o=n===gr.BOTTOM_RIGHT||n===gr.TOP_RIGHT,i=n===gr.BOTTOM_LEFT||n===gr.BOTTOM_RIGHT,a=this.measureWidth(e),s=this.measureHeight(),u=o?this.anchor.x-a:this.anchor.x,c=i?this.anchor.y-s:this.anchor.y;if(t){var l=t.width,h=t.height,d=Math.max(Math.min(u,l-a),0),f=Math.max(Math.min(c,h-s),0);return{x:d,y:f}}return{x:u,y:c}},r.prototype.draw=function(e){var t=$c(e),n=Un(t),o=this.options,i=o.backgroundColor,a=o.fontColor,s=o.fontSize,u=o.fontStyle,c=o.padding;n.font=s+"px "+u;var l=this.measureWidth(n),h=this.measureHeight();n.fillStyle=i;var d=this.getUpperLeft(n,t);n.fillRect(d.x,d.y,l,h),n.fillStyle=a,this.text.forEach(function(f,p){var v=c+d.x,m=c+d.y+(p+1)*s;n.fillText(f,v,m)})},r}(),A1=function(){function r(e){e===void 0&&(e={});var t=e.boxColor,n=e.lineWidth,o=e.label,i=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=o;var a={anchorPosition:gr.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Lp(Object.assign({},a,i))}return r}(),I1=function(){function r(e,t){t===void 0&&(t={}),this.box=new Vn(e),this.options=new A1(t)}return r.prototype.draw=function(e){var t=Un(e),n=this.options,o=n.boxColor,i=n.lineWidth,a=this.box,s=a.x,u=a.y,c=a.width,l=a.height;t.strokeStyle=o,t.lineWidth=i,t.strokeRect(s,u,c,l);var h=this.options.label;h&&new Wp([h],{x:s-i/2,y:u},this.options.drawLabelOptions).draw(e)},r}();function R1(r,e){var t=Array.isArray(e)?e:[e];t.forEach(function(n){var o=n instanceof Qt?n.score:Si(n)?n.detection.score:void 0,i=n instanceof Qt?n.box:Si(n)?n.detection.box:new Vn(n),a=o?""+Hc(o):void 0;new I1(i,{label:a}).draw(r)})}function Vp(r){var e=Nt.getEnv(),t=e.Image,n=e.Video;return r instanceof t&&r.complete||r instanceof n&&r.readyState>=3}function N1(r){return new Promise(function(e,t){if(r instanceof Nt.getEnv().Canvas||Vp(r))return e();function n(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",n),i.currentTarget.removeEventListener("error",o),e(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",n),i.currentTarget.removeEventListener("error",o),t(i))}r.addEventListener("load",n),r.addEventListener("error",o)})}function Yc(r){var e=Nt.getEnv(),t=e.Image,n=e.Video;return r instanceof t?new zr(r.naturalWidth,r.naturalHeight):r instanceof n?new zr(r.videoWidth,r.videoHeight):new zr(r.width,r.height)}function Cs(r){var e=r.width,t=r.height,n=Nt.getEnv().createCanvasElement,o=n();return o.width=e,o.height=t,o}function Zc(r,e){var t=Nt.getEnv().ImageData;if(!(r instanceof t)&&!Vp(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var n=Yc(r),o=n.width,i=n.height,a=Cs({width:o,height:i});return r instanceof t?Un(a).putImageData(r,0,0):Un(a).drawImage(r,0,0,o,i),a}function D1(r,e){return se(this,void 0,void 0,function(){var t,n,o,i,a,s;return ue(this,function(u){switch(u.label){case 0:return t=Nt.getEnv().createCanvasElement(),n=r.shape.slice(br(r)?1:0),o=n[0],i=n[1],a=n[2],s=ee(function(){return r.as3D(o,i,a).toInt()}),[4,qc.toPixels(s,t)];case 1:return u.sent(),s.dispose(),[2,t]}})})}function ud(r){var e=Nt.getEnv(),t=e.Image,n=e.Canvas,o=e.Video;return r instanceof t||r instanceof n||r instanceof o}function O1(r,e,t){t===void 0&&(t=!1);var n=Nt.getEnv(),o=n.Image,i=n.Canvas;if(!(r instanceof o||r instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=Yc(r),s=e/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=Cs({width:e,height:e}),h=r instanceof i?r:Zc(r),d=Math.abs(u-c)/2,f=t&&u<c?d:0,p=t&&c<u?d:0;return Un(l).drawImage(h,f,p,u,c),l}var Xa=function(){function r(e,t){var n=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(o,i){if(xs(o)){n._imageTensors[i]=o,n._inputDimensions[i]=o.shape;return}if(br(o)){var a=o.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");n._imageTensors[i]=o,n._inputDimensions[i]=o.shape.slice(1);return}var s=o instanceof Nt.getEnv().Canvas?o:Zc(o);n._canvases[i]=s,n._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Ci(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},r.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},r.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},r.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},r.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),n=this.getInputHeight(e);return y1({width:t,height:n},this.inputSize)},r.prototype.toBatchTensor=function(e,t){var n=this;return t===void 0&&(t=!0),this._inputSize=e,ee(function(){var o=Ci(n.batchSize,0,1).map(function(a){var s=n.getInput(a);if(s instanceof He){var u=br(s)?s:s.expandDims();return u=x1(u,t),(u.shape[1]!==e||u.shape[2]!==e)&&(u=Lc.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(s instanceof Nt.getEnv().Canvas)return qc.fromPixels(O1(s,e,t));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),i=Jt(o.map(function(a){return a.toFloat()})).as4D(n.batchSize,e,e,3);return i})},r}();function gt(r){return se(this,void 0,void 0,function(){var e,t,n;return ue(this,function(o){switch(o.label){case 0:if(r instanceof Xa)return[2,r];if(e=Array.isArray(r)?r:[r],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(i){return Array.isArray(r)?" at input index "+i+":":""},n=e.map($c),n.forEach(function(i,a){if(!ud(i)&&!xs(i)&&!br(i))throw typeof e[a]=="string"?new Error("toNetInput -"+t(a)+" string passed, but could not resolve HTMLElement for element id "+e[a]):new Error("toNetInput -"+t(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(br(i)){var s=i.shape[0];if(s!==1)throw new Error("toNetInput -"+t(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(n.map(function(i){return ud(i)&&N1(i)}))];case 1:return o.sent(),[2,new Xa(n,Array.isArray(r))]}})})}function Jc(r,e){return se(this,void 0,void 0,function(){var t,n,o,i,a,s,u;return ue(this,function(c){switch(c.label){case 0:return t=Nt.getEnv().Canvas,n=r,r instanceof t?[3,5]:[4,gt(r)];case 1:if(o=c.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=o.getInput(0),i instanceof t?(a=i,[3,4]):[3,2];case 2:return[4,D1(i)];case 3:a=c.sent(),c.label=4;case 4:n=a,c.label=5;case 5:return s=Un(n),u=e.map(function(l){return l instanceof Qt?l.forSize(n.width,n.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(n.width,n.height)}),[2,u.map(function(l){var h=l.x,d=l.y,f=l.width,p=l.height,v=Cs({width:f,height:p});return Un(v).putImageData(s.getImageData(h,d,f,p),0,0),v})]}})})}function Qc(r,e){return se(this,void 0,void 0,function(){return ue(this,function(t){if(!xs(r)&&!br(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(br(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ee(function(){var n=r.shape.slice(br(r)?1:0),o=n[0],i=n[1],a=n[2],s=e.map(function(c){return c instanceof Qt?c.forSize(i,o).box:c}).map(function(c){return c.clipAtImageBorders(i,o)}),u=s.map(function(c){var l=c.x,h=c.y,d=c.width,f=c.height;return dp(r.as3D(o,i,a),[h,l,0],[f,d,a])});return u})]})})}function F1(r,e){return se(this,void 0,void 0,function(){var t,n;return ue(this,function(o){switch(o.label){case 0:return t=Nt.getEnv().fetch,[4,t(r,e)];case 1:if(n=o.sent(),!(n.status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function M1(r){return se(this,void 0,void 0,function(){return ue(this,function(e){switch(e.label){case 0:return[4,F1(r)];case 1:return[2,e.sent().json()]}})})}function Up(r,e){var t=e+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:t};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var n=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(n,"");var o=r.split("/").filter(function(s){return s}),i=r.endsWith(".json")?o[o.length-1]:t,a=n+(r.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return a=r.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+i:a+"/"+i}}function P1(r,e){return se(this,void 0,void 0,function(){var t,n,o,i;return ue(this,function(a){switch(a.label){case 0:return t=Up(r,e),n=t.manifestUri,o=t.modelBaseUri,[4,M1(n)];case 1:return i=a.sent(),[2,Ip.loadWeights(i,o)]}})})}function B1(r,e,t){t===void 0&&(t=!1);var n=t?Yc(e):e,o=n.width,i=n.height;return r.width=o,r.height=i,{width:o,height:i}}var ir=function(){function r(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),n=t.obj,o=t.objProp;return n[o]},r.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),o=n.obj,i=n.objProp;o[i].dispose(),o[i]=t},r.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Oo})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Oo)})},r.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,o=t.tensor;e.reassignParamFromPath(n,o.variable())})},r.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,o=t.tensor,i=Ct(o.dataSync());o.dispose(),e.reassignParamFromPath(n,i)})},r.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},r.prototype.load=function(e){return se(this,void 0,void 0,function(){return ue(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},r.prototype.loadFromUri=function(e){return se(this,void 0,void 0,function(){var t;return ue(this,function(n){switch(n.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,P1(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},r.prototype.loadFromDisk=function(e){return se(this,void 0,void 0,function(){var t,n,o,i,a,s,u,c,l,h;return ue(this,function(d){switch(d.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=Nt.getEnv().readFile,n=Up(e,this.getDefaultModelName()),o=n.manifestUri,i=n.modelBaseUri,a=function(f){return Promise.all(f.map(function(p){return t(p).then(function(v){return v.buffer})}))},s=Ip.weightsLoaderFactory(a),l=(c=JSON).parse,[4,t(o)];case 1:return u=l.apply(c,[d.sent().toString()]),[4,s(u,i)];case 2:return h=d.sent(),this.loadFromWeightMap(h),[2]}})})},r.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,o=t.params;this._paramMappings=n,this._params=o},r.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,o=t.params;this._paramMappings=n,this._params=o},r.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+e);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),n=t.obj,o=t.objProp;if(!n||!o||!(n[o]instanceof He))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:o}},r}();function Zt(r,e,t){return ee(function(){var n=Oc(r,e.depthwise_filter,e.pointwise_filter,t,"same");return n=be(n,e.bias),n})}function wu(r,e,t){return t===void 0&&(t=!1),ee(function(){var n=je(t?be(cn(r,e.conv0.filters,[2,2],"same"),e.conv0.bias):Zt(r,e.conv0,[2,2])),o=Zt(n,e.conv1,[1,1]),i=je(be(n,o)),a=Zt(i,e.conv2,[1,1]);return je(be(n,be(o,a)))})}function da(r,e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!0),ee(function(){var o=je(t?be(cn(r,e.conv0.filters,n?[2,2]:[1,1],"same"),e.conv0.bias):Zt(r,e.conv0,n?[2,2]:[1,1])),i=Zt(o,e.conv1,[1,1]),a=je(be(o,i)),s=Zt(a,e.conv2,[1,1]),u=je(be(o,be(i,s))),c=Zt(u,e.conv3,[1,1]);return je(be(o,be(i,be(s,c))))})}function mn(r,e,t,n){return t===void 0&&(t="same"),n===void 0&&(n=!1),ee(function(){var o=be(cn(r,e.filters,[1,1],t),e.bias);return n?je(o):o})}function ar(r,e){Object.keys(r).forEach(function(t){e.some(function(n){return n.originalPath===t})||r[t].dispose()})}function Es(r,e){return function(t,n,o,i){var a=Bt(r(t*n*o*o),[o,o,t,n]),s=rt(r(n));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function el(r,e){return function(t,n,o){var i=yr(r(t*n),[t,n]),a=rt(r(n));return e.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var zp=function(){function r(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n}return r}();function tl(r,e){return function(t,n,o){var i=Bt(r(9*t),[3,3,t,1]),a=Bt(r(t*n),[1,1,t,n]),s=rt(r(n));return e.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new zp(i,a,s)}}function nl(r){return function(e){var t=r(e+"/depthwise_filter",4),n=r(e+"/pointwise_filter",4),o=r(e+"/bias",1);return new zp(t,n,o)}}function Ar(r,e){return function(t,n,o){var i=r[t];if(!bs(i,n))throw new Error("expected weightMap["+t+"] to be a Tensor"+n+"D, instead have "+i);return e.push({originalPath:t,paramPath:o||t}),i}}function sr(r){var e=r;function t(o){var i=e.slice(0,o);return e=e.slice(o),i}function n(){return e}return{extractWeights:t,getRemainingWeights:n}}function Gp(r,e){var t=Es(r,e),n=tl(r,e);function o(a,s,u,c){c===void 0&&(c=!1);var l=c?t(a,s,3,u+"/conv0"):n(a,s,u+"/conv0"),h=n(s,s,u+"/conv1"),d=n(s,s,u+"/conv2");return{conv0:l,conv1:h,conv2:d}}function i(a,s,u,c){c===void 0&&(c=!1);var l=o(a,s,u,c),h=l.conv0,d=l.conv1,f=l.conv2,p=n(s,s,u+"/conv3");return{conv0:h,conv1:d,conv2:f,conv3:p}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function L1(r){var e=[],t=sr(r),n=t.extractWeights,o=t.getRemainingWeights,i=Gp(n,e).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}function qp(r){return function(e){var t=r(e+"/filters",4),n=r(e+"/bias",1);return{filters:t,bias:n}}}function Hp(r,e){var t=Ar(r,e),n=qp(t),o=nl(t);function i(s,u){u===void 0&&(u=!1);var c=u?n(s+"/conv0"):o(s+"/conv0"),l=o(s+"/conv1"),h=o(s+"/conv2");return{conv0:c,conv1:l,conv2:h}}function a(s,u){u===void 0&&(u=!1);var c=u?n(s+"/conv0"):o(s+"/conv0"),l=o(s+"/conv1"),h=o(s+"/conv2"),d=o(s+"/conv3");return{conv0:c,conv1:l,conv2:h,conv3:d}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function W1(r){var e=[],t=Hp(r,e).extractDenseBlock4Params,n={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return ar(r,e),{params:n,paramMappings:e}}var jp=function(r){fe(e,r);function e(){return r.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("FaceFeatureExtractor - load model before inference");return ee(function(){var o=t.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=zi(o,i).div(J(255)),s=da(a,n.dense0,!0);return s=da(s,n.dense1),s=da(s,n.dense2),s=da(s,n.dense3),s=Vi(s,[7,7],[2,2],"valid"),s})},e.prototype.forward=function(t){return se(this,void 0,void 0,function(){var n;return ue(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,gt(t)];case 1:return[2,n.apply(this,[o.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return W1(t)},e.prototype.extractParams=function(t){return L1(t)},e}(ir);function Mn(r,e){return ee(function(){return be(gs(r,e.weights),e.bias)})}function V1(r,e,t){var n=[],o=sr(r),i=o.extractWeights,a=o.getRemainingWeights,s=el(i,n),u=s(e,t,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{fc:u}}}function U1(r){var e=[],t=Ar(r,e);function n(i){var a=t(i+"/weights",2),s=t(i+"/bias",1);return{weights:a,bias:s}}var o={fc:n("fc")};return ar(r,e),{params:o,paramMappings:e}}function Xp(r){var e={},t={};return Object.keys(r).forEach(function(n){var o=n.startsWith("fc")?t:e;o[n]=r[n]}),{featureExtractorMap:e,classifierMap:t}}var Kp=function(r){fe(e,r);function e(t,n){var o=r.call(this,t)||this;return o._faceFeatureExtractor=n,o}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var n=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return ee(function(){var i=t instanceof Xa?n.faceFeatureExtractor.forwardInput(t):t;return Mn(i.as2D(i.shape[0],-1),o.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var n=this.extractClassifierParams(t),o=n.params,i=n.paramMappings;this._params=o,this._paramMappings=i},e.prototype.extractClassifierParams=function(t){return V1(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var n=Xp(t),o=n.featureExtractorMap,i=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),U1(i)},e.prototype.extractParams=function(t){var n=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*n+o,a=t.slice(0,t.length-i),s=t.slice(t.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},e}(ir),cd=["neutral","happy","sad","angry","fearful","disgusted","surprised"],rl=function(){function r(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);cd.forEach(function(n,o){t[n]=e[o]})}return r.prototype.asSortedArray=function(){var e=this;return cd.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,n){return n.probability-t.probability})},r}(),z1=function(r){fe(e,r);function e(t){return t===void 0&&(t=new jp),r.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var n=this;return ee(function(){return rr(n.runNet(t))})},e.prototype.forward=function(t){return se(this,void 0,void 0,function(){var n;return ue(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,gt(t)];case 1:return[2,n.apply(this,[o.sent()])]}})})},e.prototype.predictExpressions=function(t){return se(this,void 0,void 0,function(){var n,o,i,a,s=this;return ue(this,function(u){switch(u.label){case 0:return[4,gt(t)];case 1:return n=u.sent(),[4,this.forwardInput(n)];case 2:return o=u.sent(),[4,Promise.all(ut(o).map(function(c){return se(s,void 0,void 0,function(){var l;return ue(this,function(h){switch(h.label){case 0:return[4,c.data()];case 1:return l=h.sent(),c.dispose(),[2,l]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(c){return new rl(c)}),[2,n.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(Kp);function G1(r){return r.expressions instanceof rl}function $p(r,e){var t={expressions:e};return Object.assign({},r,t)}function q1(r,e,t,n){t===void 0&&(t=.1);var o=Array.isArray(e)?e:[e];o.forEach(function(i){var a=i instanceof rl?i:G1(i)?i.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var s=a.asSortedArray(),u=s.filter(function(h){return h.probability>t}),c=Si(i)?i.detection.box.bottomLeft:new Ae(0,0),l=new Wp(u.map(function(h){return h.expression+" ("+Hc(h.probability)+")"}),c);l.draw(r)})}function ol(r){return Si(r)&&r.landmarks instanceof Po&&r.unshiftedLandmarks instanceof Po&&r.alignedRect instanceof Qt}function Ss(r,e){var t=r.detection.box,n=e.shiftBy(t.x,t.y),o=n.align(),i=r.detection.imageDims,a=new Qt(r.detection.score,o.rescale(i.reverse()),i),s={landmarks:n,unshiftedLandmarks:e,alignedRect:a};return Object.assign({},r,s)}var H1=function(){function r(e){e===void 0&&(e={});var t=e.drawLines,n=t===void 0?!0:t,o=e.drawPoints,i=o===void 0?!0:o,a=e.lineWidth,s=e.lineColor,u=e.pointSize,c=e.pointColor;this.drawLines=n,this.drawPoints=i,this.lineWidth=a||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"}return r}(),j1=function(){function r(e,t){t===void 0&&(t={}),this.faceLandmarks=e,this.options=new H1(t)}return r.prototype.draw=function(e){var t=Un(e),n=this.options,o=n.drawLines,i=n.drawPoints,a=n.lineWidth,s=n.lineColor,u=n.pointSize,c=n.pointColor;if(o&&this.faceLandmarks instanceof Dp&&(t.strokeStyle=s,t.lineWidth=a,Pr(t,this.faceLandmarks.getJawOutline()),Pr(t,this.faceLandmarks.getLeftEyeBrow()),Pr(t,this.faceLandmarks.getRightEyeBrow()),Pr(t,this.faceLandmarks.getNose()),Pr(t,this.faceLandmarks.getLeftEye(),!0),Pr(t,this.faceLandmarks.getRightEye(),!0),Pr(t,this.faceLandmarks.getMouth(),!0)),i){t.strokeStyle=c,t.fillStyle=c;var l=function(h){t.beginPath(),t.arc(h.x,h.y,u,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(l)}},r}();function X1(r,e){var t=Array.isArray(e)?e:[e];t.forEach(function(n){var o=n instanceof Po?n:ol(n)?n.landmarks:void 0;if(!o)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new j1(o).draw(r)})}function K1(r,e){var t=Es(r,e),n=tl(r,e);function o(a,s,u){var c=n(a,s,u+"/separable_conv0"),l=n(s,s,u+"/separable_conv1"),h=t(a,s,1,u+"/expansion_conv");return{separable_conv0:c,separable_conv1:l,expansion_conv:h}}function i(a,s){var u=n(a,a,s+"/separable_conv0"),c=n(a,a,s+"/separable_conv1"),l=n(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:t,extractSeparableConvParams:n,extractReductionBlockParams:o,extractMainBlockParams:i}}function $1(r,e){var t=[],n=sr(r),o=n.extractWeights,i=n.getRemainingWeights,a=K1(o,t),s=a.extractConvParams,u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,h=s(3,32,3,"entry_flow/conv_in"),d=c(32,64,"entry_flow/reduction_block_0"),f=c(64,128,"entry_flow/reduction_block_1"),p={conv_in:h,reduction_block_0:d,reduction_block_1:f},v={};Ci(e,0,1).forEach(function(x){v["main_block_"+x]=l(128,"middle_flow/main_block_"+x)});var m=c(128,256,"exit_flow/reduction_block"),g=u(256,512,"exit_flow/separable_conv"),_={reduction_block:m,separable_conv:g};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:v,exit_flow:_}}}function Y1(r,e){var t=Ar(r,e),n=qp(t),o=nl(t);function i(s){var u=o(s+"/separable_conv0"),c=o(s+"/separable_conv1"),l=n(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:c,expansion_conv:l}}function a(s){var u=o(s+"/separable_conv0"),c=o(s+"/separable_conv1"),l=o(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:n,extractSeparableConvParams:o,extractReductionBlockParams:i,extractMainBlockParams:a}}function Z1(r,e){var t=[],n=Y1(r,t),o=n.extractConvParams,i=n.extractSeparableConvParams,a=n.extractReductionBlockParams,s=n.extractMainBlockParams,u=o("entry_flow/conv_in"),c=a("entry_flow/reduction_block_0"),l=a("entry_flow/reduction_block_1"),h={conv_in:u,reduction_block_0:c,reduction_block_1:l},d={};Ci(e,0,1).forEach(function(m){d["main_block_"+m]=s("middle_flow/main_block_"+m)});var f=a("exit_flow/reduction_block"),p=i("exit_flow/separable_conv"),v={reduction_block:f,separable_conv:p};return ar(r,t),{params:{entry_flow:h,middle_flow:d,exit_flow:v},paramMappings:t}}function Yp(r,e,t){return be(cn(r,e.filters,t,"same"),e.bias)}function Cu(r,e,t){t===void 0&&(t=!0);var n=t?je(r):r;return n=Zt(n,e.separable_conv0,[1,1]),n=Zt(je(n),e.separable_conv1,[1,1]),n=pt(n,[3,3],[2,2],"same"),n=be(n,Yp(r,e.expansion_conv,[2,2])),n}function J1(r,e){var t=Zt(je(r),e.separable_conv0,[1,1]);return t=Zt(je(t),e.separable_conv1,[1,1]),t=Zt(je(t),e.separable_conv2,[1,1]),t=be(t,r),t}var Q1=function(r){fe(e,r);function e(t){var n=r.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return e.prototype.forwardInput=function(t){var n=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return ee(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=zi(i,a).div(J(256)),u=je(Yp(s,o.entry_flow.conv_in,[2,2]));return u=Cu(u,o.entry_flow.reduction_block_0,!1),u=Cu(u,o.entry_flow.reduction_block_1),Ci(n._numMainBlocks,0,1).forEach(function(c){u=J1(u,o.middle_flow["main_block_"+c])}),u=Cu(u,o.exit_flow.reduction_block),u=je(Zt(u,o.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(t){return se(this,void 0,void 0,function(){var n;return ue(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,gt(t)];case 1:return[2,n.apply(this,[o.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Z1(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return $1(t,this._numMainBlocks)},e}(ir);function ew(r){var e=[],t=sr(r),n=t.extractWeights,o=t.getRemainingWeights,i=el(n,e),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}function tw(r){var e=[],t=Ar(r,e);function n(i){var a=t(i+"/weights",2),s=t(i+"/bias",1);return{weights:a,bias:s}}var o={fc:{age:n("fc/age"),gender:n("fc/gender")}};return ar(r,e),{params:o,paramMappings:e}}var Ka;(function(r){r.FEMALE="female",r.MALE="male"})(Ka||(Ka={}));var nw=function(r){fe(e,r);function e(t){t===void 0&&(t=new Q1(2));var n=r.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var n=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return ee(function(){var i=t instanceof Xa?n.faceFeatureExtractor.forwardInput(t):t,a=Vi(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),s=Mn(a,o.fc.age).as1D(),u=Mn(a,o.fc.gender);return{age:s,gender:u}})},e.prototype.forwardInput=function(t){var n=this;return ee(function(){var o=n.runNet(t),i=o.age,a=o.gender;return{age:i,gender:rr(a)}})},e.prototype.forward=function(t){return se(this,void 0,void 0,function(){var n;return ue(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,gt(t)];case 1:return[2,n.apply(this,[o.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return se(this,void 0,void 0,function(){var n,o,i,a,s,u,c=this;return ue(this,function(l){switch(l.label){case 0:return[4,gt(t)];case 1:return n=l.sent(),[4,this.forwardInput(n)];case 2:return o=l.sent(),i=ut(o.age),a=ut(o.gender),s=i.map(function(h,d){return{ageTensor:h,genderTensor:a[d]}}),[4,Promise.all(s.map(function(h){var d=h.ageTensor,f=h.genderTensor;return se(c,void 0,void 0,function(){var p,v,m,g,_;return ue(this,function(x){switch(x.label){case 0:return[4,d.data()];case 1:return p=x.sent()[0],[4,f.data()];case 2:return v=x.sent()[0],m=v>.5,g=m?Ka.MALE:Ka.FEMALE,_=m?v:1-v,d.dispose(),f.dispose(),[2,{age:p,gender:g,genderProbability:_}]}})})}))];case 3:return u=l.sent(),o.age.dispose(),o.gender.dispose(),[2,n.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var n=this.extractClassifierParams(t),o=n.params,i=n.paramMappings;this._params=o,this._paramMappings=i},e.prototype.extractClassifierParams=function(t){return ew(t)},e.prototype.extractParamsFromWeigthMap=function(t){var n=Xp(t),o=n.featureExtractorMap,i=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),tw(i)},e.prototype.extractParams=function(t){var n=1539,o=t.slice(0,t.length-n),i=t.slice(t.length-n);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},e}(ir),Zp=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.postProcess=function(t,n,o){var i=o.map(function(s){var u=s.width,c=s.height,l=n/Math.max(c,u);return{width:u*l,height:c*l}}),a=i.length;return ee(function(){var s=function(d,f){return Jt([Ln([68],d),Ln([68],f)],1).as2D(1,136).as1D()},u=function(d,f){var p=i[d],v=p.width,m=p.height;return f(v,m)?Math.abs(v-m)/2:0},c=function(d){return u(d,function(f,p){return f<p})},l=function(d){return u(d,function(f,p){return p<f})},h=t.mul(Ln([a,136],n)).sub(Jt(Array.from(Array(a),function(d,f){return s(c(f),l(f))}))).div(Jt(Array.from(Array(a),function(d,f){return s(i[f].width,i[f].height)})));return h})},e.prototype.forwardInput=function(t){var n=this;return ee(function(){var o=n.runNet(t);return n.postProcess(o,t.inputSize,t.inputDimensions.map(function(i){var a=i[0],s=i[1];return{height:a,width:s}}))})},e.prototype.forward=function(t){return se(this,void 0,void 0,function(){var n;return ue(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,gt(t)];case 1:return[2,n.apply(this,[o.sent()])]}})})},e.prototype.detectLandmarks=function(t){return se(this,void 0,void 0,function(){var n,o,i,a=this;return ue(this,function(s){switch(s.label){case 0:return[4,gt(t)];case 1:return n=s.sent(),o=ee(function(){return ut(a.forwardInput(n))}),[4,Promise.all(o.map(function(u,c){return se(a,void 0,void 0,function(){var l,h,d,f,p;return ue(this,function(v){switch(v.label){case 0:return d=(h=Array).from,[4,u.data()];case 1:return l=d.apply(h,[v.sent()]),f=l.filter(function(m,g){return rd(g)}),p=l.filter(function(m,g){return!rd(g)}),[2,new Dp(Array(68).fill(0).map(function(m,g){return new Ae(f[g],p[g])}),{height:n.getInputHeight(c),width:n.getInputWidth(c)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,n.isBatchInput?i:i[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(Kp),Jp=function(r){fe(e,r);function e(t){return t===void 0&&(t=new jp),r.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(Zp);function rw(r){var e=[],t=Hp(r,e).extractDenseBlock3Params,n={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return ar(r,e),{params:n,paramMappings:e}}function ow(r){var e=[],t=sr(r),n=t.extractWeights,o=t.getRemainingWeights,i=Gp(n,e).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}var iw=function(r){fe(e,r);function e(){return r.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ee(function(){var o=t.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=zi(o,i).div(J(255)),s=wu(a,n.dense0,!0);return s=wu(s,n.dense1),s=wu(s,n.dense2),s=Vi(s,[14,14],[2,2],"valid"),s})},e.prototype.forward=function(t){return se(this,void 0,void 0,function(){var n;return ue(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,gt(t)];case 1:return[2,n.apply(this,[o.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return rw(t)},e.prototype.extractParams=function(t){return ow(t)},e}(ir),aw=function(r){fe(e,r);function e(t){return t===void 0&&(t=new iw),r.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(Zp);(function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(Jp);function sw(r,e){return be(It(r,e.weights),e.biases)}function il(r,e,t,n,o){o===void 0&&(o="same");var i=e.conv,a=i.filters,s=i.bias,u=cn(r,a,t,o);return u=be(u,s),u=sw(u,e.scale),n?je(u):u}function uw(r,e){return il(r,e,[1,1],!0)}function Qp(r,e){return il(r,e,[1,1],!1)}function ev(r,e){return il(r,e,[2,2],!0,"valid")}function cw(r,e){function t(s,u,c){var l=r(s),h=l.length/(u*c*c);if(g1(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return ee(function(){return wr(Bt(l,[u,h,c,c]),[2,3,1,0])})}function n(s,u,c,l){var h=t(s,u,c),d=rt(r(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:h,bias:d}}function o(s,u){var c=rt(r(s)),l=rt(r(s));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}function i(s,u,c,l){var h=n(s,u,c,l+"/conv"),d=o(u,l+"/scale");return{conv:h,scale:d}}function a(s,u,c,l,h){h===void 0&&(h=!1);var d=i((h?.5:1)*s,u,c,l+"/conv1"),f=i(s,u,c,l+"/conv2");return{conv1:d,conv2:f}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function lw(r){var e=sr(r),t=e.extractWeights,n=e.getRemainingWeights,o=[],i=cw(t,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),_=s(147456,128,3,"conv128_2"),x=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),y=s(589824,256,3,"conv256_2"),w=s(589824,256,3,"conv256_down_out"),E=ee(function(){return wr(yr(t(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),n().length!==0)throw new Error("weights remaing after extract: "+n().length);var C={conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:h,conv64_down:d,conv64_1:f,conv64_2:p,conv64_3:v,conv128_down:m,conv128_1:g,conv128_2:_,conv256_down:x,conv256_1:b,conv256_2:y,conv256_down_out:w,fc:E};return{params:C,paramMappings:o}}function hw(r,e){var t=Ar(r,e);function n(a){var s=t(a+"/scale/weights",1),u=t(a+"/scale/biases",1);return{weights:s,biases:u}}function o(a){var s=t(a+"/conv/filters",4),u=t(a+"/conv/bias",1),c=n(a);return{conv:{filters:s,bias:u},scale:c}}function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function dw(r){var e=[],t=hw(r,e),n=t.extractConvLayerParams,o=t.extractResidualLayerParams,i=n("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),h=o("conv64_2"),d=o("conv64_3"),f=o("conv128_down"),p=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),g=o("conv256_1"),_=o("conv256_2"),x=o("conv256_down_out"),b=r.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!m1(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var y={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:h,conv64_3:d,conv128_down:f,conv128_1:p,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:_,conv256_down_out:x,fc:b};return ar(r,e),{params:y,paramMappings:e}}function An(r,e){var t=uw(r,e.conv1);return t=Qp(t,e.conv2),t=be(t,r),t=je(t),t}function fa(r,e){var t=ev(r,e.conv1);t=Qp(t,e.conv2);var n=Vi(r,2,2,"valid"),o=Ve(n.shape),i=n.shape[3]!==t.shape[3],a=n.shape[1]!==t.shape[1]||n.shape[2]!==t.shape[2];if(a){var s=di(t.shape);s[1]=1;var u=Ve(s);t=st([t,u],1);var c=di(t.shape);c[2]=1;var l=Ve(c);t=st([t,l],2)}return n=i?st([n,o],3):n,t=be(n,t),t=je(t),t}var fw=function(r){fe(e,r);function e(){return r.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("FaceRecognitionNet - load model before inference");return ee(function(){var o=t.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],a=zi(o,i).div(J(256)),s=ev(a,n.conv32_down);s=pt(s,3,2,"valid"),s=An(s,n.conv32_1),s=An(s,n.conv32_2),s=An(s,n.conv32_3),s=fa(s,n.conv64_down),s=An(s,n.conv64_1),s=An(s,n.conv64_2),s=An(s,n.conv64_3),s=fa(s,n.conv128_down),s=An(s,n.conv128_1),s=An(s,n.conv128_2),s=fa(s,n.conv256_down),s=An(s,n.conv256_1),s=An(s,n.conv256_2),s=fa(s,n.conv256_down_out);var u=s.mean([1,2]),c=gs(u,n.fc);return c})},e.prototype.forward=function(t){return se(this,void 0,void 0,function(){var n;return ue(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,gt(t)];case 1:return[2,n.apply(this,[o.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return se(this,void 0,void 0,function(){var n,o,i,a=this;return ue(this,function(s){switch(s.label){case 0:return[4,gt(t)];case 1:return n=s.sent(),o=ee(function(){return ut(a.forwardInput(n))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,n.isBatchInput?i:i[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return dw(t)},e.prototype.extractParams=function(t){return lw(t)},e}(ir);function tv(r,e){var t={descriptor:e};return Object.assign({},r,t)}function nv(r,e){var t={age:e};return Object.assign({},r,t)}function rv(r,e,t){var n={gender:e,genderProbability:t};return Object.assign({},r,n)}var ov=function(){function r(e){var t=e===void 0?{}:e,n=t.minFaceSize,o=t.scaleFactor,i=t.maxNumScales,a=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r}();function pw(r,e){function t(u,c){var l=Bt(r(9*u),[3,3,u,1]),h=rt(r(u)),d=rt(r(u)),f=rt(r(u)),p=rt(r(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:h,batch_norm_offset:d,batch_norm_mean:f,batch_norm_variance:p}}function n(u,c,l,h,d){var f=Bt(r(u*c*l*l),[l,l,u,c]),p=rt(r(c));return e.push({paramPath:h+"/filters"},{paramPath:h+"/"+(d?"batch_norm_offset":"bias")}),{filters:f,bias:p}}function o(u,c,l,h){var d=n(u,c,l,h,!0),f=d.filters,p=d.bias;return{filters:f,batch_norm_offset:p}}function i(u,c,l){var h=t(u,l+"/depthwise_conv"),d=o(u,c,1,l+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:d}}function a(){var u=o(3,32,3,"mobilenetv1/conv_0"),c=i(32,64,"mobilenetv1/conv_1"),l=i(64,128,"mobilenetv1/conv_2"),h=i(128,128,"mobilenetv1/conv_3"),d=i(128,256,"mobilenetv1/conv_4"),f=i(256,256,"mobilenetv1/conv_5"),p=i(256,512,"mobilenetv1/conv_6"),v=i(512,512,"mobilenetv1/conv_7"),m=i(512,512,"mobilenetv1/conv_8"),g=i(512,512,"mobilenetv1/conv_9"),_=i(512,512,"mobilenetv1/conv_10"),x=i(512,512,"mobilenetv1/conv_11"),b=i(512,1024,"mobilenetv1/conv_12"),y=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:c,conv_2:l,conv_3:h,conv_4:d,conv_5:f,conv_6:p,conv_7:v,conv_8:m,conv_9:g,conv_10:_,conv_11:x,conv_12:b,conv_13:y}}function s(){var u=o(1024,256,1,"prediction_layer/conv_0"),c=o(256,512,3,"prediction_layer/conv_1"),l=o(512,128,1,"prediction_layer/conv_2"),h=o(128,256,3,"prediction_layer/conv_3"),d=o(256,128,1,"prediction_layer/conv_4"),f=o(128,256,3,"prediction_layer/conv_5"),p=o(256,64,1,"prediction_layer/conv_6"),v=o(64,128,3,"prediction_layer/conv_7"),m=n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=n(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),_=n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),x=n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),b=n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),y=n(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),w=n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),E=n(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),C=n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),T=n(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),S=n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),I=n(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),A={box_encoding_predictor:m,class_predictor:g},F={box_encoding_predictor:_,class_predictor:x},O={box_encoding_predictor:b,class_predictor:y},M={box_encoding_predictor:w,class_predictor:E},B={box_encoding_predictor:C,class_predictor:T},P={box_encoding_predictor:S,class_predictor:I};return{conv_0:u,conv_1:c,conv_2:l,conv_3:h,conv_4:d,conv_5:f,conv_6:p,conv_7:v,box_predictor_0:A,box_predictor_1:F,box_predictor_2:O,box_predictor_3:M,box_predictor_4:B,box_predictor_5:P}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function vw(r){var e=[],t=sr(r),n=t.extractWeights,o=t.getRemainingWeights,i=pw(n,e),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=a(),c=s(),l=yc(n(5118*4),[1,5118,4]),h={extra_dim:l};if(e.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:h},paramMappings:e}}function mw(r,e){var t=Ar(r,e);function n(c,l,h){var d=t(c+"/Conv2d_"+l+"_pointwise/weights",4,h+"/filters"),f=t(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:d,batch_norm_offset:f}}function o(c){var l="mobilenetv1/conv_"+c,h="MobilenetV1/Conv2d_"+c+"_depthwise",d=l+"/depthwise_conv",f=l+"/pointwise_conv",p=t(h+"/depthwise_weights",4,d+"/filters"),v=t(h+"/BatchNorm/gamma",1,d+"/batch_norm_scale"),m=t(h+"/BatchNorm/beta",1,d+"/batch_norm_offset"),g=t(h+"/BatchNorm/moving_mean",1,d+"/batch_norm_mean"),_=t(h+"/BatchNorm/moving_variance",1,d+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:v,batch_norm_offset:m,batch_norm_mean:g,batch_norm_variance:_},pointwise_conv:n("MobilenetV1",c,f)}}function i(){return{conv_0:n("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function a(c,l){var h=t(c+"/weights",4,l+"/filters"),d=t(c+"/biases",1,l+"/bias");return{filters:h,bias:d}}function s(c){var l=a("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),h=a("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor");return{box_encoding_predictor:l,class_predictor:h}}function u(){return{conv_0:n("Prediction",0,"prediction_layer/conv_0"),conv_1:n("Prediction",1,"prediction_layer/conv_1"),conv_2:n("Prediction",2,"prediction_layer/conv_2"),conv_3:n("Prediction",3,"prediction_layer/conv_3"),conv_4:n("Prediction",4,"prediction_layer/conv_4"),conv_5:n("Prediction",5,"prediction_layer/conv_5"),conv_6:n("Prediction",6,"prediction_layer/conv_6"),conv_7:n("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:u}}function gw(r){var e=[],t=mw(r,e),n=t.extractMobilenetV1Params,o=t.extractPredictionLayerParams,i=r["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!xs(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:n(),prediction_layer:o(),output_layer:{extra_dim:i}};return ar(r,e),{params:a,paramMappings:e}}function Rn(r,e,t){return ee(function(){var n=cn(r,e.filters,t,"same");return n=be(n,e.batch_norm_offset),Ic(n,0,6)})}var yw=.0010000000474974513;function _w(r,e,t){return ee(function(){var n=ms(r,e.filters,t,"same");return n=Zf(n,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,yw),Ic(n,0,6)})}function bw(r){return[2,4,6,12].some(function(e){return e===r})?[2,2]:[1,1]}function xw(r,e){return ee(function(){var t=null,n=Rn(r,e.conv_0,[2,2]),o=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(o.forEach(function(i,a){var s=a+1,u=bw(s);n=_w(n,i.depthwise_conv,u),n=Rn(n,i.pointwise_conv,[1,1]),s===11&&(t=n)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:n,conv11:t}})}function ww(r,e,t,n,o){var i=r.shape[0],a=Math.min(t,i),s=e.map(function(l,h){return{score:l,boxIndex:h}}).filter(function(l){return l.score>o}).sort(function(l,h){return h.score-l.score}),u=function(l){return l<=n?1:0},c=[];return s.forEach(function(l){if(!(c.length>=a)){for(var h=l.score,d=c.length-1;d>=0;--d){var f=Cw(r,l.boxIndex,c[d]);if(f!==0&&(l.score*=u(f),l.score<=o))break}h===l.score&&c.push(l.boxIndex)}}),c}function Cw(r,e,t){var n=r.arraySync(),o=Math.min(n[e][0],n[e][2]),i=Math.min(n[e][1],n[e][3]),a=Math.max(n[e][0],n[e][2]),s=Math.max(n[e][1],n[e][3]),u=Math.min(n[t][0],n[t][2]),c=Math.min(n[t][1],n[t][3]),l=Math.max(n[t][0],n[t][2]),h=Math.max(n[t][1],n[t][3]),d=(a-o)*(s-i),f=(l-u)*(h-c);if(d<=0||f<=0)return 0;var p=Math.max(o,u),v=Math.max(i,c),m=Math.min(a,l),g=Math.min(s,h),_=Math.max(m-p,0)*Math.max(g-v,0);return _/(d+f-_)}function Ew(r){var e=ut(wr(r,[1,0])),t=[ht(e[2],e[0]),ht(e[3],e[1])],n=[be(e[0],dn(t[0],J(2))),be(e[1],dn(t[1],J(2)))];return{sizes:t,centers:n}}function Sw(r,e){var t=Ew(r),n=t.sizes,o=t.centers,i=ut(wr(e,[1,0])),a=dn(It(Uu(dn(i[2],J(5))),n[0]),J(2)),s=be(It(dn(i[0],J(10)),n[0]),o[0]),u=dn(It(Uu(dn(i[3],J(5))),n[1]),J(2)),c=be(It(dn(i[1],J(10)),n[1]),o[1]);return wr(Jt([ht(s,a),ht(c,u),be(s,a),be(c,u)]),[1,0])}function Tw(r,e,t){return ee(function(){var n=r.shape[0],o=Sw(pn(Eo(t.extra_dim,[n,1,1]),[-1,4]),pn(r,[-1,4]));o=pn(o,[n,o.shape[0]/n,4]);var i=Xf(Wn(e,[0,0,1],[-1,-1,-1])),a=Wn(i,[0,0,0],[-1,-1,1]);a=pn(a,[n,a.shape[1]]);var s=ut(o),u=ut(a);return{boxes:s,scores:u}})}function co(r,e){return ee(function(){var t=r.shape[0],n=pn(mn(r,e.box_encoding_predictor),[t,-1,1,4]),o=pn(mn(r,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:n,classPrediction:o}})}function kw(r,e,t){return ee(function(){var n=Rn(r,t.conv_0,[1,1]),o=Rn(n,t.conv_1,[2,2]),i=Rn(o,t.conv_2,[1,1]),a=Rn(i,t.conv_3,[2,2]),s=Rn(a,t.conv_4,[1,1]),u=Rn(s,t.conv_5,[2,2]),c=Rn(u,t.conv_6,[1,1]),l=Rn(c,t.conv_7,[2,2]),h=co(e,t.box_predictor_0),d=co(r,t.box_predictor_1),f=co(o,t.box_predictor_2),p=co(a,t.box_predictor_3),v=co(u,t.box_predictor_4),m=co(l,t.box_predictor_5),g=st([h.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),_=st([h.classPrediction,d.classPrediction,f.classPrediction,p.classPrediction,v.classPrediction,m.classPrediction],1);return{boxPredictions:g,classPredictions:_}})}var Ts=function(){function r(e){var t=e===void 0?{}:e,n=t.minConfidence,o=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r}(),iv=function(r){fe(e,r);function e(){return r.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("SsdMobilenetv1 - load model before inference");return ee(function(){var o=t.toBatchTensor(512,!1).toFloat(),i=ht(It(o,J(.007843137718737125)),J(1)),a=xw(i,n.mobilenetv1),s=kw(a.out,a.conv11,n.prediction_layer),u=s.boxPredictions,c=s.classPredictions;return Tw(u,c,n.output_layer)})},e.prototype.forward=function(t){return se(this,void 0,void 0,function(){var n;return ue(this,function(o){switch(o.label){case 0:return n=this.forwardInput,[4,gt(t)];case 1:return[2,n.apply(this,[o.sent()])]}})})},e.prototype.locateFaces=function(t,n){return n===void 0&&(n={}),se(this,void 0,void 0,function(){var o,i,a,s,u,c,l,h,d,f,p,v,m,g,_,x,b,y,w,E,C;return ue(this,function(T){switch(T.label){case 0:return o=new Ts(n),i=o.maxResults,a=o.minConfidence,[4,gt(t)];case 1:for(s=T.sent(),u=this.forwardInput(s),c=u.boxes,l=u.scores,h=c[0],d=l[0],f=1;f<c.length;f++)c[f].dispose(),l[f].dispose();return m=(v=Array).from,[4,d.data()];case 2:return p=m.apply(v,[T.sent()]),g=.5,_=ww(h,p,i,g,a),x=s.getReshapedInputDimensions(0),b=s.inputSize,y=b/x.width,w=b/x.height,E=h.arraySync(),C=_.map(function(S){var I=[Math.max(0,E[S][0]),Math.min(1,E[S][2])].map(function(P){return P*w}),A=I[0],F=I[1],O=[Math.max(0,E[S][1]),Math.min(1,E[S][3])].map(function(P){return P*y}),M=O[0],B=O[1];return new Qt(p[S],new Xc(M,A,B-M,F-A),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),h.dispose(),d.dispose(),[2,C]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return gw(t)},e.prototype.extractParams=function(t){return vw(t)},e}(ir);(function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(iv);var Aw=.4,Iw=[new Ae(.738768,.874946),new Ae(2.42204,2.65704),new Ae(4.30971,7.04493),new Ae(10.246,4.59428),new Ae(12.6868,11.8741)],Rw=[new Ae(1.603231,2.094468),new Ae(6.041143,7.080126),new Ae(2.882459,3.518061),new Ae(4.266906,5.178857),new Ae(9.041765,10.66308)],Nw=[117.001,114.697,97.404],Dw="tiny_yolov2_model",Ow="tiny_yolov2_separable_conv_model",pa=function(r){return typeof r=="number"};function Fw(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!pa(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(e){return e||{}}).every(function(e){return pa(e.x)&&pa(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every(pa)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function al(r){return ee(function(){var e=It(r,J(.10000000149011612));return be(je(ht(r,e)),e)})}function hr(r,e){return ee(function(){var t=Jr(r,[[0,0],[1,1],[1,1],[0,0]]);return t=cn(t,e.conv.filters,[1,1],"valid"),t=ht(t,e.bn.sub),t=It(t,e.bn.truediv),t=be(t,e.conv.bias),al(t)})}function dr(r,e){return ee(function(){var t=Jr(r,[[0,0],[1,1],[1,1],[0,0]]);return t=Oc(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=be(t,e.bias),al(t)})}function Mw(r,e){var t=Es(r,e);function n(a,s){var u=rt(r(a)),c=rt(r(a));return e.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}function o(a,s,u){var c=t(a,s,3,u+"/conv"),l=n(s,u+"/bn");return{conv:c,bn:l}}var i=tl(r,e);return{extractConvParams:t,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function Pw(r,e,t,n){var o=sr(r),i=o.extractWeights,a=o.getRemainingWeights,s=[],u=Mw(i,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams,d;if(e.withSeparableConvs){var f=n[0],p=n[1],v=n[2],m=n[3],g=n[4],_=n[5],x=n[6],b=n[7],y=n[8],w=e.isFirstLayerConv2d?c(f,p,3,"conv0"):h(f,p,"conv0"),E=h(p,v,"conv1"),C=h(v,m,"conv2"),T=h(m,g,"conv3"),S=h(g,_,"conv4"),I=h(_,x,"conv5"),A=b?h(x,b,"conv6"):void 0,F=y?h(b,y,"conv7"):void 0,O=c(y||b||x,5*t,1,"conv8");d={conv0:w,conv1:E,conv2:C,conv3:T,conv4:S,conv5:I,conv6:A,conv7:F,conv8:O}}else{var f=n[0],p=n[1],v=n[2],m=n[3],g=n[4],_=n[5],x=n[6],b=n[7],y=n[8],w=l(f,p,"conv0"),E=l(p,v,"conv1"),C=l(v,m,"conv2"),T=l(m,g,"conv3"),S=l(g,_,"conv4"),I=l(_,x,"conv5"),A=l(x,b,"conv6"),F=l(b,y,"conv7"),O=c(y,5*t,1,"conv8");d={conv0:w,conv1:E,conv2:C,conv3:T,conv4:S,conv5:I,conv6:A,conv7:F,conv8:O}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:d,paramMappings:s}}function Bw(r,e){var t=Ar(r,e);function n(s){var u=t(s+"/sub",1),c=t(s+"/truediv",1);return{sub:u,truediv:c}}function o(s){var u=t(s+"/filters",4),c=t(s+"/bias",1);return{filters:u,bias:c}}function i(s){var u=o(s+"/conv"),c=n(s+"/bn");return{conv:u,bn:c}}var a=nl(t);return{extractConvParams:o,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function Lw(r,e){var t=[],n=Bw(r,t),o=n.extractConvParams,i=n.extractConvWithBatchNormParams,a=n.extractSeparableConvParams,s;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;s={conv0:e.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return ar(r,t),{params:s,paramMappings:t}}var ld;(function(r){r[r.XS=224]="XS",r[r.SM=320]="SM",r[r.MD=416]="MD",r[r.LG=608]="LG"})(ld||(ld={}));var sl=function(){function r(e){var t=e===void 0?{}:e,n=t.inputSize,o=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r}(),av=function(r){fe(e,r);function e(t){var n=r.call(this,"TinyYolov2")||this;return Fw(t),n._config=t,n}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,n){var o=hr(t,n.conv0);return o=pt(o,[2,2],[2,2],"same"),o=hr(o,n.conv1),o=pt(o,[2,2],[2,2],"same"),o=hr(o,n.conv2),o=pt(o,[2,2],[2,2],"same"),o=hr(o,n.conv3),o=pt(o,[2,2],[2,2],"same"),o=hr(o,n.conv4),o=pt(o,[2,2],[2,2],"same"),o=hr(o,n.conv5),o=pt(o,[2,2],[1,1],"same"),o=hr(o,n.conv6),o=hr(o,n.conv7),mn(o,n.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,n){var o=this.config.isFirstLayerConv2d?al(mn(t,n.conv0,"valid",!1)):dr(t,n.conv0);return o=pt(o,[2,2],[2,2],"same"),o=dr(o,n.conv1),o=pt(o,[2,2],[2,2],"same"),o=dr(o,n.conv2),o=pt(o,[2,2],[2,2],"same"),o=dr(o,n.conv3),o=pt(o,[2,2],[2,2],"same"),o=dr(o,n.conv4),o=pt(o,[2,2],[2,2],"same"),o=dr(o,n.conv5),o=pt(o,[2,2],[1,1],"same"),o=n.conv6?dr(o,n.conv6):o,o=n.conv7?dr(o,n.conv7):o,mn(o,n.conv8,"valid",!1)},e.prototype.forwardInput=function(t,n){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return ee(function(){var a=t.toBatchTensor(n,!1).toFloat();return a=o.config.meanRgb?zi(a,o.config.meanRgb):a,a=a.div(J(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},e.prototype.forward=function(t,n){return se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,gt(t)];case 1:return[4,o.apply(this,[i.sent(),n])];case 2:return[2,i.sent()]}})})},e.prototype.detect=function(t,n){return n===void 0&&(n={}),se(this,void 0,void 0,function(){var o,i,a,s,u,c,l,h,d,f,p,v,m,g,_=this;return ue(this,function(x){switch(x.label){case 0:return o=new sl(n),i=o.inputSize,a=o.scoreThreshold,[4,gt(t)];case 1:return s=x.sent(),[4,this.forwardInput(s,i)];case 2:return u=x.sent(),c=ee(function(){return ut(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),a)];case 3:return h=x.sent(),u.dispose(),c.dispose(),d=h.map(function(b){return b.box}),f=h.map(function(b){return b.score}),p=h.map(function(b){return b.classScore}),v=h.map(function(b){return _.config.classes[b.label]}),m=Ei(d.map(function(b){return b.rescale(i)}),f,this.config.iouThreshold,!0),g=m.map(function(b){return new Np(f[b],p[b],v[b],d[b],l)}),[2,g]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return Lw(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,o=n?n.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return Pw(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,n,o){return se(this,void 0,void 0,function(){var i,a,s,u,c,l,h,d,f,p,v,m,g,_,x,b,y,w,E,C,T,S,I,A,F,O,M,B,P,L=this;return ue(this,function(W){switch(W.label){case 0:return i=n.width,a=n.height,s=Math.max(i,a),u=s/i,c=s/a,l=t.shape[1],h=this.config.anchors.length,d=ee(function(){var z=t.reshape([l,l,h,L.boxEncodingSize]),H=z.slice([0,0,0,0],[l,l,h,4]),Y=z.slice([0,0,0,4],[l,l,h,1]),te=L.withClassScores?rr(z.slice([0,0,0,5],[l,l,h,L.config.classes.length]),3):J(0);return[H,Y,te]}),f=d[0],p=d[1],v=d[2],m=[],[4,p.array()];case 1:return g=W.sent(),[4,f.array()];case 2:_=W.sent(),x=0,W.label=3;case 3:if(!(x<l))return[3,12];b=0,W.label=4;case 4:if(!(b<l))return[3,11];y=0,W.label=5;case 5:return y<h?(w=xu(g[x][b][y][0]),!o||w>o?(E=(b+xu(_[x][b][y][0]))/l*u,C=(x+xu(_[x][b][y][1]))/l*c,T=Math.exp(_[x][b][y][2])*this.config.anchors[y].x/l*u,S=Math.exp(_[x][b][y][3])*this.config.anchors[y].y/l*c,I=E-T/2,A=C-S/2,F={row:x,col:b,anchor:y},this.withClassScores?[4,this.extractPredictedClass(v,F)]:[3,7]):[3,9]):[3,10];case 6:return P=W.sent(),[3,8];case 7:P={classScore:1,label:0},W.label=8;case 8:O=P,M=O.classScore,B=O.label,m.push(Tt({box:new ws(I,A,I+T,A+S),score:w,classScore:w*M,label:B},F)),W.label=9;case 9:return y++,[3,5];case 10:return b++,[3,4];case 11:return x++,[3,3];case 12:return f.dispose(),p.dispose(),v.dispose(),[2,m]}})})},e.prototype.extractPredictedClass=function(t,n){return se(this,void 0,void 0,function(){var o,i,a,s;return ue(this,function(u){switch(u.label){case 0:return o=n.row,i=n.col,a=n.anchor,[4,t.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[o][i][a][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(ir),Ww=function(r){fe(e,r);function e(t){t===void 0&&(t=!0);var n=this,o=Object.assign({},{withSeparableConvs:t,iouThreshold:Aw,classes:["face"]},t?{anchors:Rw,meanRgb:Nw}:{anchors:Iw,withClassScores:!0});return n=r.call(this,o)||this,n}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,n){return se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return[4,this.detect(t,n)];case 1:return o=i.sent(),[2,o.map(function(a){return new Qt(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?Ow:Dw},e.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},e}(av),sv=function(r){fe(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e}(sl),Gi=function(){function r(){}return r.prototype.then=function(e){return se(this,void 0,void 0,function(){var t;return ue(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},r.prototype.run=function(){return se(this,void 0,void 0,function(){return ue(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},r}();function ks(r,e,t,n,o){return o===void 0&&(o=function(i){var a=i.alignedRect;return a}),se(this,void 0,void 0,function(){var i,a,s,u,c;return ue(this,function(l){switch(l.label){case 0:return i=r.map(function(h){return ol(h)?o(h):h.detection}),s=n,s?[3,5]:e instanceof He?[4,Qc(e,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,Jc(e,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return a=s,[4,t(a)];case 6:return c=l.sent(),a.forEach(function(h){return h instanceof He&&h.dispose()}),[2,c]}})})}function ul(r,e,t,n,o){return se(this,void 0,void 0,function(){var i=this;return ue(this,function(a){return[2,ks([r],e,function(s){return se(i,void 0,void 0,function(){return ue(this,function(u){return[2,t(s[0])]})})},n,o)]})})}function Vw(r){return ee(function(){return Jt(ut(r,3).reverse(),3)})}var va=2,$a=12;function Uw(r,e){var t=Es(r,e),n=el(r,e);function o(c,l){var h=rt(r(c));return e.push({paramPath:l}),h}function i(c,l,h){h===void 0&&(h=!1);var d=t(c[0],c[1],3,l+"/conv1"),f=o(c[1],l+"/prelu1_alpha"),p=t(c[1],c[2],3,l+"/conv2"),v=o(c[2],l+"/prelu2_alpha"),m=t(c[2],c[3],h?2:3,l+"/conv3"),g=o(c[3],l+"/prelu3_alpha");return{conv1:d,prelu1_alpha:f,conv2:p,prelu2_alpha:v,conv3:m,prelu3_alpha:g}}function a(){var c=i([3,10,16,32],"pnet"),l=t(32,2,1,"pnet/conv4_1"),h=t(32,4,1,"pnet/conv4_2");return Tt(Tt({},c),{conv4_1:l,conv4_2:h})}function s(){var c=i([3,28,48,64],"rnet",!0),l=n(576,128,"rnet/fc1"),h=o(128,"rnet/prelu4_alpha"),d=n(128,2,"rnet/fc2_1"),f=n(128,4,"rnet/fc2_2");return Tt(Tt({},c),{fc1:l,prelu4_alpha:h,fc2_1:d,fc2_2:f})}function u(){var c=i([3,32,64,64],"onet"),l=t(64,128,2,"onet/conv4"),h=o(128,"onet/prelu4_alpha"),d=n(1152,256,"onet/fc1"),f=o(256,"onet/prelu5_alpha"),p=n(256,2,"onet/fc2_1"),v=n(256,4,"onet/fc2_2"),m=n(256,10,"onet/fc2_3");return Tt(Tt({},c),{conv4:l,prelu4_alpha:h,fc1:d,prelu5_alpha:f,fc2_1:p,fc2_2:v,fc2_3:m})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function zw(r){var e=sr(r),t=e.extractWeights,n=e.getRemainingWeights,o=[],i=Uw(t,o),a=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,c=a(),l=s(),h=u();if(n().length!==0)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:c,rnet:l,onet:h},paramMappings:o}}function Gw(r,e){var t=Ar(r,e);function n(l){var h=t(l+"/weights",4,l+"/filters"),d=t(l+"/bias",1);return{filters:h,bias:d}}function o(l){var h=t(l+"/weights",2),d=t(l+"/bias",1);return{weights:h,bias:d}}function i(l){return t(l,1)}function a(l){var h=n(l+"/conv1"),d=i(l+"/prelu1_alpha"),f=n(l+"/conv2"),p=i(l+"/prelu2_alpha"),v=n(l+"/conv3"),m=i(l+"/prelu3_alpha");return{conv1:h,prelu1_alpha:d,conv2:f,prelu2_alpha:p,conv3:v,prelu3_alpha:m}}function s(){var l=a("pnet"),h=n("pnet/conv4_1"),d=n("pnet/conv4_2");return Tt(Tt({},l),{conv4_1:h,conv4_2:d})}function u(){var l=a("rnet"),h=o("rnet/fc1"),d=i("rnet/prelu4_alpha"),f=o("rnet/fc2_1"),p=o("rnet/fc2_2");return Tt(Tt({},l),{fc1:h,prelu4_alpha:d,fc2_1:f,fc2_2:p})}function c(){var l=a("onet"),h=n("onet/conv4"),d=i("onet/prelu4_alpha"),f=o("onet/fc1"),p=i("onet/prelu5_alpha"),v=o("onet/fc2_1"),m=o("onet/fc2_2"),g=o("onet/fc2_3");return Tt(Tt({},l),{conv4:h,prelu4_alpha:d,fc1:f,prelu5_alpha:p,fc2_1:v,fc2_2:m,fc2_3:g})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:c}}function qw(r){var e=[],t=Gw(r,e),n=t.extractPNetParams,o=t.extractRNetParams,i=t.extractONetParams,a=n(),s=o(),u=i();return ar(r,e),{params:{pnet:a,rnet:s,onet:u},paramMappings:e}}function $u(r,e){var t=e[0],n=e[1];return{height:Math.floor(t*r),width:Math.floor(n*r)}}function Hw(r,e,t){for(var n=t[0],o=t[1],i=$a/r,a=[],s=Math.min(n,o)*i,u=0;s>=12;)a.push(i*Math.pow(e,u)),s=s*e,u+=1;return a}var cl=function(r){fe(e,r);function e(t,n,o,i){return r.call(this,{left:t,top:n,right:o,bottom:i},!0)||this}return e}(Vn);function uv(r){return ee(function(){return It(ht(r,J(127.5)),J(.0078125))})}function Io(r,e){return ee(function(){return be(je(r),It(e,Ga(je(Ga(r)))))})}function ll(r,e,t){return t===void 0&&(t=!1),ee(function(){var n=mn(r,e.conv1,"valid");return n=Io(n,e.prelu1_alpha),n=pt(n,t?[2,2]:[3,3],[2,2],"same"),n=mn(n,e.conv2,"valid"),n=Io(n,e.prelu2_alpha),n=t?n:pt(n,[3,3],[2,2],"valid"),n=mn(n,e.conv3,"valid"),n=Io(n,e.prelu3_alpha),n})}function jw(r,e){return ee(function(){var t=ll(r,e,!0),n=mn(t,e.conv4_1,"valid"),o=tn(ys(n,3),3),i=rr(ht(n,o),3),a=mn(t,e.conv4_2,"valid");return{prob:i,regions:a}})}function Xw(r,e){return ee(function(){var t=$u(e,r.shape.slice(1)),n=t.height,o=t.width,i=Lc.resizeBilinear(r,[n,o]),a=uv(i);return wr(a,[0,2,1,3])})}function Kw(r,e,t,n){for(var o=[],i=r.arraySync(),a=0;a<r.shape[0];a++)for(var s=0;s<r.shape[1];s++)i[a][s]>=n&&o.push(new Ae(s,a));var u=o.map(function(c){var l=new ws(Math.round((c.y*va+1)/t),Math.round((c.x*va+1)/t),Math.round((c.y*va+$a)/t),Math.round((c.x*va+$a)/t)),h=i[c.y][c.x],d=e.arraySync(),f=new cl(d[c.y][c.x][0],d[c.y][c.x][1],d[c.y][c.x][2],d[c.y][c.x][3]);return{cell:l,score:h,region:f}});return u}function $w(r,e,t,n,o){o.stage1=[];var i=e.map(function(d){return ee(function(){var f={scale:d},p=Xw(r,d),v=Date.now(),m=jw(p,n),g=m.prob,_=m.regions;f.pnet=Date.now()-v;var x=ut(ut(g,3)[1])[0],b=ut(_)[0];return{scoresTensor:x,regionsTensor:b,scale:d,statsForScale:f}})}),a=i.map(function(d){var f=d.scoresTensor,p=d.regionsTensor,v=d.scale,m=d.statsForScale,g=Kw(f,p,v,t);if(f.dispose(),p.dispose(),!g.length)return o.stage1.push(m),[];var _=Date.now(),x=Ei(g.map(function(b){return b.cell}),g.map(function(b){return b.score}),.5);return m.nms=Date.now()-_,m.numBoxes=x.length,o.stage1.push(m),x.map(function(b){return g[b]})}),s=a.reduce(function(d,f){return d.concat(f)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),h=Ei(s.map(function(d){return d.cell}),s.map(function(d){return d.score}),.7);o.stage1_nms=Date.now()-l,c=h.map(function(d){return s[d].score}),u=h.map(function(d){return s[d]}).map(function(d){var f=d.cell,p=d.region;return new ws(f.left+p.left*f.width,f.top+p.top*f.height,f.right+p.right*f.width,f.bottom+p.bottom*f.height).toSquare().round()})}return{boxes:u,scores:c}}function cv(r,e,t){var n=t.width,o=t.height;return se(this,void 0,void 0,function(){var i,a,s,u=this;return ue(this,function(c){switch(c.label){case 0:return i=Un(r),[4,Promise.all(e.map(function(l){return se(u,void 0,void 0,function(){var h,d,f,p,v,m,g,_;return ue(this,function(x){return h=l.padAtBorders(r.height,r.width),d=h.y,f=h.ey,p=h.x,v=h.ex,m=p-1,g=d-1,_=i.getImageData(m,g,v-m,f-g),[2,Nt.isNodejs()?Zc(_):createImageBitmap(_)]})})}))];case 1:return a=c.sent(),s=[],a.forEach(function(l){var h=Cs({width:n,height:o}),d=Un(h);d.drawImage(l,0,0,n,o);for(var f=d.getImageData(0,0,n,o).data,p=[],v=0;v<f.length;v+=4)p.push(f[v+2]),p.push(f[v+1]),p.push(f[v]);s.push(p)}),[2,s.map(function(l){var h=ee(function(){var d=wr(Bt(l,[1,n,o,3]),[0,2,1,3]).toFloat();return uv(d)});return h})]}})})}function Yw(r,e){return ee(function(){var t=ll(r,e),n=pn(t,[t.shape[0],e.fc1.weights.shape[0]]),o=Mn(n,e.fc1),i=Io(o,e.prelu4_alpha),a=Mn(i,e.fc2_1),s=tn(ys(a,1),1),u=rr(ht(a,s),1),c=Mn(i,e.fc2_2),l=ut(u,1)[1];return{scores:l,regions:c}})}function Zw(r,e,t,n,o){return se(this,void 0,void 0,function(){var i,a,s,u,c,l,h,d,f,p,v,m,g,_;return ue(this,function(x){switch(x.label){case 0:return i=Date.now(),[4,cv(r,e,{width:24,height:24})];case 1:return a=x.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(b){var y=Yw(b,n);return b.dispose(),y}),o.stage2_rnet=Date.now()-i,u=s.length>1?st(s.map(function(b){return b.scores})):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[x.sent()]),u.dispose(),d=c.map(function(b,y){return{score:b,idx:y}}).filter(function(b){return b.score>t}).map(function(b){var y=b.idx;return y}),f=d.map(function(b){return e[b]}),p=d.map(function(b){return c[b]}),v=[],m=[],f.length>0&&(i=Date.now(),g=Ei(f,p,.7),o.stage2_nms=Date.now()-i,_=g.map(function(b){var y=s[d[b]].regions.arraySync();return new cl(y[0][0],y[0][1],y[0][2],y[0][3])}),m=g.map(function(b){return p[b]}),v=g.map(function(b,y){return f[b].calibrate(_[y])})),s.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:v,scores:m}]}})})}function Jw(r,e){return ee(function(){var t=ll(r,e);t=pt(t,[2,2],[2,2],"same"),t=mn(t,e.conv4,"valid"),t=Io(t,e.prelu4_alpha);var n=pn(t,[t.shape[0],e.fc1.weights.shape[0]]),o=Mn(n,e.fc1),i=Io(o,e.prelu5_alpha),a=Mn(i,e.fc2_1),s=tn(ys(a,1),1),u=rr(ht(a,s),1),c=Mn(i,e.fc2_2),l=Mn(i,e.fc2_3),h=ut(u,1)[1];return{scores:h,regions:c,points:l}})}function Qw(r,e,t,n,o){return se(this,void 0,void 0,function(){var i,a,s,u,c,l,h,d,f,p,v,m,g,_,x;return ue(this,function(b){switch(b.label){case 0:return i=Date.now(),[4,cv(r,e,{width:48,height:48})];case 1:return a=b.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(y){var w=Jw(y,n);return y.dispose(),w}),o.stage3_onet=Date.now()-i,u=s.length>1?st(s.map(function(y){return y.scores})):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[b.sent()]),u.dispose(),d=c.map(function(y,w){return{score:y,idx:w}}).filter(function(y){return y.score>t}).map(function(y){var w=y.idx;return w}),f=d.map(function(y){var w=s[y].regions.arraySync();return new cl(w[0][0],w[0][1],w[0][2],w[0][3])}),p=d.map(function(y,w){return e[y].calibrate(f[w])}),v=d.map(function(y){return c[y]}),m=[],g=[],_=[],p.length>0&&(i=Date.now(),x=Ei(p,v,.7,!1),o.stage3_nms=Date.now()-i,m=x.map(function(y){return p[y]}),g=x.map(function(y){return v[y]}),_=x.map(function(y,w){return Array(5).fill(0).map(function(E,C){var T=s[y].points.arraySync();return new Ae(T[0][C]*(m[w].width+1)+m[w].left,T[0][C+5]*(m[w].height+1)+m[w].top)})})),s.forEach(function(y){y.regions.dispose(),y.scores.dispose(),y.points.dispose()}),[2,{boxes:m,scores:g,points:_}]}})})}var eC=function(r){fe(e,r);function e(){return r.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return se(this,void 0,void 0,function(){return ue(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return se(this,void 0,void 0,function(){return ue(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,n){return n===void 0&&(n={}),se(this,void 0,void 0,function(){var o,i,a,s,u,c,l,h,d,f,p,v,m,g,_,x,b,y,w,E,C;return ue(this,function(T){switch(T.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(i=t.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=ee(function(){return Vw(tn(qc.fromPixels(i)).toFloat())}),c=function(S){return u.dispose(),a.total=Date.now()-s,S},l=u.shape.slice(1),h=l[0],d=l[1],f=new ov(n),p=f.minFaceSize,v=f.scaleFactor,m=f.maxNumScales,g=f.scoreThresholds,_=f.scaleSteps,x=(_||Hw(p,v,[h,d])).filter(function(S){var I=$u(S,[h,d]);return Math.min(I.width,I.height)>$a}).slice(0,m),a.scales=x,a.pyramid=x.map(function(S){return $u(S,[h,d])}),b=Date.now(),[4,$w(u,x,g[0],o.pnet,a)];case 1:return y=T.sent(),a.total_stage1=Date.now()-b,y.boxes.length?(a.stage2_numInputBoxes=y.boxes.length,b=Date.now(),[4,Zw(i,y.boxes,g[1],o.rnet,a)]):[2,c({results:[],stats:a})];case 2:return w=T.sent(),a.total_stage2=Date.now()-b,w.boxes.length?(a.stage3_numInputBoxes=w.boxes.length,b=Date.now(),[4,Qw(i,w.boxes,g[2],o.onet,a)]):[2,c({results:[],stats:a})];case 3:return E=T.sent(),a.total_stage3=Date.now()-b,C=E.boxes.map(function(S,I){return Ss(Ti({},new Qt(E.scores[I],new Xc(S.left/d,S.top/h,S.width/d,S.height/h),{height:h,width:d})),new S1(E.points[I].map(function(A){return A.sub(new Ae(S.left,S.top)).div(new Ae(S.width,S.height))}),{width:S.width,height:S.height}))}),[2,c({results:C,stats:a})]}})})},e.prototype.forward=function(t,n){return n===void 0&&(n={}),se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,gt(t)];case 1:return[4,o.apply(this,[i.sent(),n])];case 2:return[2,i.sent().results]}})})},e.prototype.forwardWithStats=function(t,n){return n===void 0&&(n={}),se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,gt(t)];case 1:return[2,o.apply(this,[i.sent(),n])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return qw(t)},e.prototype.extractParams=function(t){return zw(t)},e}(ir),tC=.4,nC=[new Ae(1.603231,2.094468),new Ae(6.041143,7.080126),new Ae(2.882459,3.518061),new Ae(4.266906,5.178857),new Ae(9.041765,10.66308)],rC=[117.001,114.697,97.404],oC=function(r){fe(e,r);function e(){var t=this,n={withSeparableConvs:!0,iouThreshold:tC,classes:["face"],anchors:nC,meanRgb:rC,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=r.call(this,n)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,n){return se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return[4,this.detect(t,n)];case 1:return o=i.sent(),[2,o.map(function(a){return new Qt(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},e}(av),at={ssdMobilenetv1:new iv,tinyFaceDetector:new oC,tinyYolov2:new Ww,mtcnn:new eC,faceLandmark68Net:new Jp,faceLandmark68TinyNet:new aw,faceRecognitionNet:new fw,faceExpressionNet:new z1,ageGenderNet:new nw},lv=function(r){fe(e,r);function e(t,n,o){var i=r.call(this)||this;return i.parentTask=t,i.input=n,i.extractedFaces=o,i}return e}(Gi),hl=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return se(this,void 0,void 0,function(){var t,n,o=this;return ue(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,ks(t,this.input,function(a){return se(o,void 0,void 0,function(){return ue(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return at.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return n=i.sent(),[2,t.map(function(a,s){return $p(a,n[s])})]}})})},e.prototype.withAgeAndGender=function(){return new vl(this,this.input)},e}(lv),dl=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return se(this,void 0,void 0,function(){var t,n;return ue(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),t?[4,ul(t,this.input,function(i){return at.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return n=o.sent(),[2,$p(t,n)]}})})},e.prototype.withAgeAndGender=function(){return new ml(this,this.input)},e}(lv),fl=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new gl(this,this.input)},e.prototype.withFaceDescriptors=function(){return new _l(this,this.input)},e}(hl),pl=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new yl(this,this.input)},e.prototype.withFaceDescriptor=function(){return new bl(this,this.input)},e}(dl),hv=function(r){fe(e,r);function e(t,n,o){var i=r.call(this)||this;return i.parentTask=t,i.input=n,i.extractedFaces=o,i}return e}(Gi),vl=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return se(this,void 0,void 0,function(){var t,n,o=this;return ue(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,ks(t,this.input,function(a){return se(o,void 0,void 0,function(){return ue(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return at.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return n=i.sent(),[2,t.map(function(a,s){var u=n[s],c=u.age,l=u.gender,h=u.genderProbability;return nv(rv(a,l,h),c)})]}})})},e.prototype.withFaceExpressions=function(){return new hl(this,this.input)},e}(hv),ml=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return se(this,void 0,void 0,function(){var t,n,o,i,a;return ue(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,ul(t,this.input,function(u){return at.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return n=s.sent(),o=n.age,i=n.gender,a=n.genderProbability,[2,nv(rv(t,i,a),o)]}})})},e.prototype.withFaceExpressions=function(){return new dl(this,this.input)},e}(hv),gl=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new fl(this,this.input)},e.prototype.withFaceDescriptors=function(){return new _l(this,this.input)},e}(vl),yl=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new pl(this,this.input)},e.prototype.withFaceDescriptor=function(){return new bl(this,this.input)},e}(ml),dv=function(r){fe(e,r);function e(t,n){var o=r.call(this)||this;return o.parentTask=t,o.input=n,o}return e}(Gi),_l=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return se(this,void 0,void 0,function(){var t,n;return ue(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,ks(t,this.input,function(i){return Promise.all(i.map(function(a){return at.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return n=o.sent(),[2,n.map(function(i,a){return tv(t[a],i)})]}})})},e.prototype.withFaceExpressions=function(){return new fl(this,this.input)},e.prototype.withAgeAndGender=function(){return new gl(this,this.input)},e}(dv),bl=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return se(this,void 0,void 0,function(){var t,n;return ue(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),t?[4,ul(t,this.input,function(i){return at.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return n=o.sent(),[2,tv(t,n)]}})})},e.prototype.withFaceExpressions=function(){return new pl(this,this.input)},e.prototype.withAgeAndGender=function(){return new yl(this,this.input)},e}(dv),fv=function(r){fe(e,r);function e(t,n,o){var i=r.call(this)||this;return i.parentTask=t,i.input=n,i.useTinyLandmarkNet=o,i}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?at.faceLandmark68TinyNet:at.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(Gi),iC=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return se(this,void 0,void 0,function(){var t,n,o,i,a,s=this;return ue(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),n=t.map(function(c){return c.detection}),this.input instanceof He?[4,Qc(this.input,n)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,Jc(this.input,n)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return a=u.sent(),o.forEach(function(c){return c instanceof He&&c.dispose()}),[2,t.map(function(c,l){return Ss(c,a[l])})]}})})},e.prototype.withFaceExpressions=function(){return new fl(this,this.input)},e.prototype.withAgeAndGender=function(){return new gl(this,this.input)},e.prototype.withFaceDescriptors=function(){return new _l(this,this.input)},e}(fv),aC=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return se(this,void 0,void 0,function(){var t,n,o,i,a;return ue(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(n=t.detection,this.input instanceof He?[4,Qc(this.input,[n])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,Jc(this.input,[n])];case 4:i=s.sent(),s.label=5;case 5:return o=i,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof He&&u.dispose()}),[2,Ss(t,a)]}})})},e.prototype.withFaceExpressions=function(){return new pl(this,this.input)},e.prototype.withAgeAndGender=function(){return new yl(this,this.input)},e.prototype.withFaceDescriptor=function(){return new bl(this,this.input)},e}(fv),pv=function(r){fe(e,r);function e(t,n){n===void 0&&(n=new Ts);var o=r.call(this)||this;return o.input=t,o.options=n,o}return e}(Gi),vv=function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return se(this,void 0,void 0,function(){var t,n,o,i;return ue(this,function(a){switch(a.label){case 0:return t=this,n=t.input,o=t.options,o instanceof ov?[4,at.mtcnn.forward(n,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(i=o instanceof sv?function(s){return at.tinyFaceDetector.locateFaces(s,o)}:o instanceof Ts?function(s){return at.ssdMobilenetv1.locateFaces(s,o)}:o instanceof sl?function(s){return at.tinyYolov2.locateFaces(s,o)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(n)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(n){return se(t,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,n(o.map(function(a){return Ti({},a)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new iC(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new hl(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new vl(this.runAndExtendWithFaceDetections(),this.input)},e}(pv);(function(r){fe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return se(this,void 0,void 0,function(){var t,n;return ue(this,function(o){switch(o.label){case 0:return[4,new vv(this.input,this.options)];case 1:return t=o.sent(),n=t[0],t.forEach(function(i){i.score>n.score&&(n=i)}),[2,n]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(n){return se(t,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,n(o?Ti({},o):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new aC(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new dl(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new ml(this.runAndExtendWithFaceDetection(),this.input)},e})(pv);function sC(r,e){return e===void 0&&(e=new Ts),new vv(r,e)}function uC(r,e){if(r.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(r),n=Array.from(e);return Math.sqrt(t.map(function(o,i){return o-n[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}(function(){function r(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=n.map(function(a){if(a instanceof ha)return a;if(a instanceof Float32Array)return new ha(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new ha(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(e,t){return t.map(function(n){return uC(n,e)}).reduce(function(n,o){return n+o},0)/(t.length||1)},r.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var o=n.descriptors,i=n.label;return new ad(i,t.computeMeanDistance(e,o))}).reduce(function(n,o){return n.distance<o.distance?n:o})},r.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new ad("unknown",t.distance)},r.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},r.fromJSON=function(e){var t=e.labeledDescriptors.map(function(n){return ha.fromJSON(n)});return new r(t,e.distanceThreshold)},r})();function mv(r,e){var t=new zr(e.width,e.height),n=t.width,o=t.height;if(n<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:n,height:o}));if(Array.isArray(r))return r.map(function(s){return mv(s,{width:n,height:o})});if(ol(r)){var i=r.detection.forSize(n,o),a=r.unshiftedLandmarks.forSize(i.box.width,i.box.height);return Ss(Ti(r,i),a)}return Si(r)?Ti(r,r.detection.forSize(n,o)):r instanceof Po||r instanceof Qt?r.forSize(n,o):r}function cC(r){if(!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=r,document.head.appendChild(e),r}}function yo(r,e){var t=r.__state.conversionName.toString(),n=Math.round(r.r),o=Math.round(r.g),i=Math.round(r.b),a=r.a,s=Math.round(r.h),u=r.s.toFixed(1),c=r.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var l=r.hex.toString(16);l.length<6;)l="0"+l;return"#"+l}else{if(t==="CSS_RGB")return"rgb("+n+","+o+","+i+")";if(t==="CSS_RGBA")return"rgba("+n+","+o+","+i+","+a+")";if(t==="HEX")return"0x"+r.hex.toString(16);if(t==="RGB_ARRAY")return"["+n+","+o+","+i+"]";if(t==="RGBA_ARRAY")return"["+n+","+o+","+i+","+a+"]";if(t==="RGB_OBJ")return"{r:"+n+",g:"+o+",b:"+i+"}";if(t==="RGBA_OBJ")return"{r:"+n+",g:"+o+",b:"+i+",a:"+a+"}";if(t==="HSV_OBJ")return"{h:"+s+",s:"+u+",v:"+c+"}";if(t==="HSVA_OBJ")return"{h:"+s+",s:"+u+",v:"+c+",a:"+a+"}"}return"unknown format"}var hd=Array.prototype.forEach,ii=Array.prototype.slice,j={BREAK:{},extend:function(e){return this.each(ii.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach((function(o){this.isUndefined(t[o])||(e[o]=t[o])}).bind(this))},this),e},defaults:function(e){return this.each(ii.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach((function(o){this.isUndefined(e[o])&&(e[o]=t[o])}).bind(this))},this),e},compose:function(){var e=ii.call(arguments);return function(){for(var t=ii.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e){if(hd&&e.forEach&&e.forEach===hd)e.forEach(t,n);else if(e.length===e.length+0){var o=void 0,i=void 0;for(o=0,i=e.length;o<i;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var a in e)if(t.call(n,e[a],a)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var o=void 0;return function(){var i=this,a=arguments;function s(){o=null,n||e.apply(i,a)}var u=n||!o;clearTimeout(o),o=setTimeout(s,t),u&&e.apply(i,a)}},toArray:function(e){return e.toArray?e.toArray():ii.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(r){function e(t){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}(function(r){return isNaN(r)}),isArray:Array.isArray||function(r){return r.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},lC=[{litmus:j.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:yo},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:yo},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:yo},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:yo}}},{litmus:j.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:j.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:j.isObject,conversions:{RGBA_OBJ:{read:function(e){return j.isNumber(e.r)&&j.isNumber(e.g)&&j.isNumber(e.b)&&j.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return j.isNumber(e.r)&&j.isNumber(e.g)&&j.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return j.isNumber(e.h)&&j.isNumber(e.s)&&j.isNumber(e.v)&&j.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return j.isNumber(e.h)&&j.isNumber(e.s)&&j.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],ai=void 0,ma=void 0,Ya=function(){ma=!1;var e=arguments.length>1?j.toArray(arguments):arguments[0];return j.each(lC,function(t){if(t.litmus(e))return j.each(t.conversions,function(n,o){if(ai=n.read(e),ma===!1&&ai!==!1)return ma=ai,ai.conversionName=o,ai.conversion=n,j.BREAK}),j.BREAK}),ma},dd=void 0,ki={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),a=n*(1-t),s=n*(1-i*t),u=n*(1-(1-i)*t),c=[[n,u,a],[s,n,a],[a,n,u],[a,s,n],[u,a,n],[n,a,s]][o];return{r:c[0]*255,g:c[1]*255,b:c[2]*255}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),a=i-o,s=void 0,u=void 0;if(i!==0)u=a/i;else return{h:NaN,s:0,v:0};return e===i?s=(t-n)/a:t===i?s=2+(n-e)/a:s=4+(e-t)/a,s/=6,s<0&&(s+=1),{h:s*360,s:u,v:i/255}},rgb_to_hex:function(e,t,n){var o=this.hex_with_component(0,2,e);return o=this.hex_with_component(o,1,t),o=this.hex_with_component(o,0,n),o},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(e,t,n){return n<<(dd=t*8)|e&~(255<<dd)}},hC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},xn=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},wn=function(){function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),Cr=function r(e,t,n){e===null&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(o===void 0){var i=Object.getPrototypeOf(e);return i===null?void 0:r(i,t,n)}else{if("value"in o)return o.value;var a=o.get;return a===void 0?void 0:a.call(n)}},Ir=function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(r,e):r.__proto__=e)},Rr=function(r,e){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:r},ct=function(){function r(){if(xn(this,r),this.__state=Ya.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return wn(r,[{key:"toString",value:function(){return yo(this)}},{key:"toHexString",value:function(){return yo(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),r}();function xl(r,e,t){Object.defineProperty(r,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(ct.recalculateRGB(this,e,t),this.__state[e])},set:function(o){this.__state.space!=="RGB"&&(ct.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=o}})}function wl(r,e){Object.defineProperty(r,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(ct.recalculateHSV(this),this.__state[e])},set:function(n){this.__state.space!=="HSV"&&(ct.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=n}})}ct.recalculateRGB=function(r,e,t){if(r.__state.space==="HEX")r.__state[e]=ki.component_from_hex(r.__state.hex,t);else if(r.__state.space==="HSV")j.extend(r.__state,ki.hsv_to_rgb(r.__state.h,r.__state.s,r.__state.v));else throw new Error("Corrupted color state")};ct.recalculateHSV=function(r){var e=ki.rgb_to_hsv(r.r,r.g,r.b);j.extend(r.__state,{s:e.s,v:e.v}),j.isNaN(e.h)?j.isUndefined(r.__state.h)&&(r.__state.h=0):r.__state.h=e.h};ct.COMPONENTS=["r","g","b","h","s","v","hex","a"];xl(ct.prototype,"r",2);xl(ct.prototype,"g",1);xl(ct.prototype,"b",0);wl(ct.prototype,"h");wl(ct.prototype,"s");wl(ct.prototype,"v");Object.defineProperty(ct.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(ct.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=ki.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Nr=function(){function r(e,t){xn(this,r),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return wn(r,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),r}(),dC={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},gv={};j.each(dC,function(r,e){j.each(r,function(t){gv[t]=e})});var fC=/(\d+(\.\d+)?)px/;function In(r){if(r==="0"||j.isUndefined(r))return 0;var e=r.match(fC);return j.isNull(e)?0:parseFloat(e[1])}var U={makeSelectable:function(e,t){e===void 0||e.style===void 0||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var o=n,i=t;j.isUndefined(i)&&(i=!0),j.isUndefined(o)&&(o=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),o&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var i=n||{},a=gv[t];if(!a)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":{var u=i.x||i.clientX||0,c=i.y||i.clientY||0;s.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,u,c,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var l=s.initKeyboardEvent||s.initKeyEvent;j.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break}default:{s.initEvent(t,i.bubbles||!1,i.cancelable||!0);break}}j.defaults(s,o),e.dispatchEvent(s)},bind:function(e,t,n,o){var i=o||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),U},unbind:function(e,t,n,o){var i=o||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),U},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);n.indexOf(t)===-1&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return U},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),o=n.indexOf(t);o!==-1&&(n.splice(o,1),e.className=n.join(" "))}else e.className=void 0;return U},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return In(t["border-left-width"])+In(t["border-right-width"])+In(t["padding-left"])+In(t["padding-right"])+In(t.width)},getHeight:function(e){var t=getComputedStyle(e);return In(t["border-top-width"])+In(t["border-bottom-width"])+In(t["padding-top"])+In(t["padding-bottom"])+In(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Cl=function(r){Ir(e,r);function e(t,n){xn(this,e);var o=Rr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),i=o;o.__prev=o.getValue(),o.__checkbox=document.createElement("input"),o.__checkbox.setAttribute("type","checkbox");function a(){i.setValue(!i.__prev)}return U.bind(o.__checkbox,"change",a,!1),o.domElement.appendChild(o.__checkbox),o.updateDisplay(),o}return wn(e,[{key:"setValue",value:function(n){var o=Cr(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),o}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Cr(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Nr),yv=function(r){Ir(e,r);function e(t,n,o){xn(this,e);var i=Rr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),a=o,s=i;if(i.__select=document.createElement("select"),j.isArray(a)){var u={};j.each(a,function(c){u[c]=c}),a=u}return j.each(a,function(c,l){var h=document.createElement("option");h.innerHTML=l,h.setAttribute("value",c),s.__select.appendChild(h)}),i.updateDisplay(),U.bind(i.__select,"change",function(){var c=this.options[this.selectedIndex].value;s.setValue(c)}),i.domElement.appendChild(i.__select),i}return wn(e,[{key:"setValue",value:function(n){var o=Cr(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),o}},{key:"updateDisplay",value:function(){return U.isActive(this.__select)?this:(this.__select.value=this.getValue(),Cr(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(Nr),_v=function(r){Ir(e,r);function e(t,n){xn(this,e);var o=Rr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),i=o;function a(){i.setValue(i.__input.value)}function s(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),U.bind(o.__input,"keyup",a),U.bind(o.__input,"change",a),U.bind(o.__input,"blur",s),U.bind(o.__input,"keydown",function(u){u.keyCode===13&&this.blur()}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return wn(e,[{key:"updateDisplay",value:function(){return U.isActive(this.__input)||(this.__input.value=this.getValue()),Cr(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Nr);function fd(r){var e=r.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var El=function(r){Ir(e,r);function e(t,n,o){xn(this,e);var i=Rr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),a=o||{};return i.__min=a.min,i.__max=a.max,i.__step=a.step,j.isUndefined(i.__step)?i.initialValue===0?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=fd(i.__impliedStep),i}return wn(e,[{key:"setValue",value:function(n){var o=n;return this.__min!==void 0&&o<this.__min?o=this.__min:this.__max!==void 0&&o>this.__max&&(o=this.__max),this.__step!==void 0&&o%this.__step!==0&&(o=Math.round(o/this.__step)*this.__step),Cr(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,o)}},{key:"min",value:function(n){return this.__min=n,this}},{key:"max",value:function(n){return this.__max=n,this}},{key:"step",value:function(n){return this.__step=n,this.__impliedStep=n,this.__precision=fd(n),this}}]),e}(Nr);function pC(r,e){var t=Math.pow(10,e);return Math.round(r*t)/t}var Ai=function(r){Ir(e,r);function e(t,n,o){xn(this,e);var i=Rr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));i.__truncationSuspended=!1;var a=i,s=void 0;function u(){var p=parseFloat(a.__input.value);j.isNaN(p)||a.setValue(p)}function c(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function l(){c()}function h(p){var v=s-p.clientY;a.setValue(a.getValue()+v*a.__impliedStep),s=p.clientY}function d(){U.unbind(window,"mousemove",h),U.unbind(window,"mouseup",d),c()}function f(p){U.bind(window,"mousemove",h),U.bind(window,"mouseup",d),s=p.clientY}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),U.bind(i.__input,"change",u),U.bind(i.__input,"blur",l),U.bind(i.__input,"mousedown",f),U.bind(i.__input,"keydown",function(p){p.keyCode===13&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,c())}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return wn(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():pC(this.getValue(),this.__precision),Cr(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(El);function pd(r,e,t,n,o){return n+(o-n)*((r-e)/(t-e))}var Za=function(r){Ir(e,r);function e(t,n,o,i,a){xn(this,e);var s=Rr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:o,max:i,step:a})),u=s;s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),U.bind(s.__background,"mousedown",c),U.bind(s.__background,"touchstart",d),U.addClass(s.__background,"slider"),U.addClass(s.__foreground,"slider-fg");function c(v){document.activeElement.blur(),U.bind(window,"mousemove",l),U.bind(window,"mouseup",h),l(v)}function l(v){v.preventDefault();var m=u.__background.getBoundingClientRect();return u.setValue(pd(v.clientX,m.left,m.right,u.__min,u.__max)),!1}function h(){U.unbind(window,"mousemove",l),U.unbind(window,"mouseup",h),u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}function d(v){v.touches.length===1&&(U.bind(window,"touchmove",f),U.bind(window,"touchend",p),f(v))}function f(v){var m=v.touches[0].clientX,g=u.__background.getBoundingClientRect();u.setValue(pd(m,g.left,g.right,u.__min,u.__max))}function p(){U.unbind(window,"touchmove",f),U.unbind(window,"touchend",p),u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}return s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return wn(e,[{key:"updateDisplay",value:function(){var n=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=n*100+"%",Cr(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(El),Sl=function(r){Ir(e,r);function e(t,n,o){xn(this,e);var i=Rr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),a=i;return i.__button=document.createElement("div"),i.__button.innerHTML=o===void 0?"Fire":o,U.bind(i.__button,"click",function(s){return s.preventDefault(),a.fire(),!1}),U.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return wn(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(Nr),Ja=function(r){Ir(e,r);function e(t,n){xn(this,e);var o=Rr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));o.__color=new ct(o.getValue()),o.__temp=new ct(0);var i=o;o.domElement=document.createElement("div"),U.makeSelectable(o.domElement,!1),o.__selector=document.createElement("div"),o.__selector.className="selector",o.__saturation_field=document.createElement("div"),o.__saturation_field.className="saturation-field",o.__field_knob=document.createElement("div"),o.__field_knob.className="field-knob",o.__field_knob_border="2px solid ",o.__hue_knob=document.createElement("div"),o.__hue_knob.className="hue-knob",o.__hue_field=document.createElement("div"),o.__hue_field.className="hue-field",o.__input=document.createElement("input"),o.__input.type="text",o.__input_textShadow="0 1px 1px ",U.bind(o.__input,"keydown",function(v){v.keyCode===13&&h.call(this)}),U.bind(o.__input,"blur",h),U.bind(o.__selector,"mousedown",function(){U.addClass(this,"drag").bind(window,"mouseup",function(){U.removeClass(i.__selector,"drag")})}),U.bind(o.__selector,"touchstart",function(){U.addClass(this,"drag").bind(window,"touchend",function(){U.removeClass(i.__selector,"drag")})});var a=document.createElement("div");j.extend(o.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),j.extend(o.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:o.__field_knob_border+(o.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),j.extend(o.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),j.extend(o.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),j.extend(a.style,{width:"100%",height:"100%",background:"none"}),vd(a,"top","rgba(0,0,0,0)","#000"),j.extend(o.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),mC(o.__hue_field),j.extend(o.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:o.__input_textShadow+"rgba(0,0,0,0.7)"}),U.bind(o.__saturation_field,"mousedown",s),U.bind(o.__saturation_field,"touchstart",s),U.bind(o.__field_knob,"mousedown",s),U.bind(o.__field_knob,"touchstart",s),U.bind(o.__hue_field,"mousedown",u),U.bind(o.__hue_field,"touchstart",u);function s(v){f(v),U.bind(window,"mousemove",f),U.bind(window,"touchmove",f),U.bind(window,"mouseup",c),U.bind(window,"touchend",c)}function u(v){p(v),U.bind(window,"mousemove",p),U.bind(window,"touchmove",p),U.bind(window,"mouseup",l),U.bind(window,"touchend",l)}function c(){U.unbind(window,"mousemove",f),U.unbind(window,"touchmove",f),U.unbind(window,"mouseup",c),U.unbind(window,"touchend",c),d()}function l(){U.unbind(window,"mousemove",p),U.unbind(window,"touchmove",p),U.unbind(window,"mouseup",l),U.unbind(window,"touchend",l),d()}function h(){var v=Ya(this.value);v!==!1?(i.__color.__state=v,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function d(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}o.__saturation_field.appendChild(a),o.__selector.appendChild(o.__field_knob),o.__selector.appendChild(o.__saturation_field),o.__selector.appendChild(o.__hue_field),o.__hue_field.appendChild(o.__hue_knob),o.domElement.appendChild(o.__input),o.domElement.appendChild(o.__selector),o.updateDisplay();function f(v){v.type.indexOf("touch")===-1&&v.preventDefault();var m=i.__saturation_field.getBoundingClientRect(),g=v.touches&&v.touches[0]||v,_=g.clientX,x=g.clientY,b=(_-m.left)/(m.right-m.left),y=1-(x-m.top)/(m.bottom-m.top);return y>1?y=1:y<0&&(y=0),b>1?b=1:b<0&&(b=0),i.__color.v=y,i.__color.s=b,i.setValue(i.__color.toOriginal()),!1}function p(v){v.type.indexOf("touch")===-1&&v.preventDefault();var m=i.__hue_field.getBoundingClientRect(),g=v.touches&&v.touches[0]||v,_=g.clientY,x=1-(_-m.top)/(m.bottom-m.top);return x>1?x=1:x<0&&(x=0),i.__color.h=x*360,i.setValue(i.__color.toOriginal()),!1}return o}return wn(e,[{key:"updateDisplay",value:function(){var n=Ya(this.getValue());if(n!==!1){var o=!1;j.each(ct.COMPONENTS,function(s){if(!j.isUndefined(n[s])&&!j.isUndefined(this.__color.__state[s])&&n[s]!==this.__color.__state[s])return o=!0,{}},this),o&&j.extend(this.__color.__state,n)}j.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,a=255-i;j.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,vd(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),j.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),e}(Nr),vC=["-moz-","-o-","-webkit-","-ms-",""];function vd(r,e,t,n){r.style.background="",j.each(vC,function(o){r.style.cssText+="background: "+o+"linear-gradient("+e+", "+t+" 0%, "+n+" 100%); "})}function mC(r){r.style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var gC={load:function(e,t){var n=t||document,o=n.createElement("link");o.type="text/css",o.rel="stylesheet",o.href=e,n.getElementsByTagName("head")[0].appendChild(o)},inject:function(e,t){var n=t||document,o=document.createElement("style");o.type="text/css",o.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(o)}catch{}}},yC=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,_C=function(e,t){var n=e[t];return j.isArray(arguments[2])||j.isObject(arguments[2])?new yv(e,t,arguments[2]):j.isNumber(n)?j.isNumber(arguments[2])&&j.isNumber(arguments[3])?j.isNumber(arguments[4])?new Za(e,t,arguments[2],arguments[3],arguments[4]):new Za(e,t,arguments[2],arguments[3]):j.isNumber(arguments[4])?new Ai(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Ai(e,t,{min:arguments[2],max:arguments[3]}):j.isString(n)?new _v(e,t):j.isFunction(n)?new Sl(e,t,""):j.isBoolean(n)?new Cl(e,t):null};function bC(r){setTimeout(r,1e3/60)}var xC=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||bC,wC=function(){function r(){xn(this,r),this.backgroundElement=document.createElement("div"),j.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),U.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),j.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;U.bind(this.backgroundElement,"click",function(){e.hide()})}return wn(r,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),j.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,n=function o(){t.domElement.style.display="none",t.backgroundElement.style.display="none",U.unbind(t.domElement,"webkitTransitionEnd",o),U.unbind(t.domElement,"transitionend",o),U.unbind(t.domElement,"oTransitionEnd",o)};U.bind(this.domElement,"webkitTransitionEnd",n),U.bind(this.domElement,"transitionend",n),U.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-U.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-U.getHeight(this.domElement)/2+"px"}}]),r}(),CC=cC(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);gC.inject(CC);var md="dg",gd=72,yd=20,Ii="Default",si=function(){try{return!!window.localStorage}catch{return!1}}(),fi=void 0,_d=!0,vo=void 0,Eu=!1,bv=[],Pe=function r(e){var t=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),U.addClass(this.domElement,md),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=j.defaults(n,{closeOnTop:!1,autoPlace:!0,width:r.DEFAULT_WIDTH}),n=j.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),j.isUndefined(n.load)?n.load={preset:Ii}:n.preset&&(n.load.preset=n.preset),j.isUndefined(n.parent)&&n.hideable&&bv.push(this),n.resizable=j.isUndefined(n.parent)&&n.resizable,n.autoPlace&&j.isUndefined(n.scrollable)&&(n.scrollable=!0);var o=si&&localStorage.getItem(mo(this,"isLocal"))==="true",i=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:n.load.preset},set:function(d){t.parent?t.getRoot().preset=d:n.load.preset=d,kC(this),t.revert()}},width:{get:function(){return n.width},set:function(d){n.width=d,Ju(t,d)}},name:{get:function(){return n.name},set:function(d){n.name=d,a&&(a.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(d){n.closed=d,n.closed?U.addClass(t.__ul,r.CLASS_CLOSED):U.removeClass(t.__ul,r.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=d?r.TEXT_OPEN:r.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return o},set:function(d){si&&(o=d,d?U.bind(window,"unload",i):U.unbind(window,"unload",i),localStorage.setItem(mo(t,"isLocal"),d))}}}),j.isUndefined(n.parent)){if(this.closed=n.closed||!1,U.addClass(this.domElement,r.CLASS_MAIN),U.makeSelectable(this.domElement,!1),si&&o){t.useLocalStorage=!0;var s=localStorage.getItem(mo(this,"gui"));s&&(n.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=r.TEXT_CLOSED,U.addClass(this.__closeButton,r.CLASS_CLOSE_BUTTON),n.closeOnTop?(U.addClass(this.__closeButton,r.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(U.addClass(this.__closeButton,r.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),U.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{n.closed===void 0&&(n.closed=!0);var u=document.createTextNode(n.name);U.addClass(u,"controller-name"),a=Tl(t,u);var c=function(d){return d.preventDefault(),t.closed=!t.closed,!1};U.addClass(this.__ul,r.CLASS_CLOSED),U.addClass(a,"title"),U.bind(a,"click",c),n.closed||(this.closed=!1)}n.autoPlace&&(j.isUndefined(n.parent)&&(_d&&(vo=document.createElement("div"),U.addClass(vo,md),U.addClass(vo,r.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(vo),_d=!1),vo.appendChild(this.domElement),U.addClass(this.domElement,r.CLASS_AUTO_PLACE)),this.parent||Ju(t,n.width)),this.__resizeHandler=function(){t.onResizeDebounced()},U.bind(window,"resize",this.__resizeHandler),U.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),U.bind(this.__ul,"transitionend",this.__resizeHandler),U.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&TC(this),i=function(){si&&localStorage.getItem(mo(t,"isLocal"))==="true"&&localStorage.setItem(mo(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=i;function l(){var h=t.getRoot();h.width+=1,j.defer(function(){h.width-=1})}n.parent||l()};Pe.toggleHide=function(){Eu=!Eu,j.each(bv,function(r){r.domElement.style.display=Eu?"none":""})};Pe.CLASS_AUTO_PLACE="a";Pe.CLASS_AUTO_PLACE_CONTAINER="ac";Pe.CLASS_MAIN="main";Pe.CLASS_CONTROLLER_ROW="cr";Pe.CLASS_TOO_TALL="taller-than-window";Pe.CLASS_CLOSED="closed";Pe.CLASS_CLOSE_BUTTON="close-button";Pe.CLASS_CLOSE_TOP="close-top";Pe.CLASS_CLOSE_BOTTOM="close-bottom";Pe.CLASS_DRAG="drag";Pe.DEFAULT_WIDTH=245;Pe.TEXT_CLOSED="Close Controls";Pe.TEXT_OPEN="Open Controls";Pe._keydownHandler=function(r){document.activeElement.type!=="text"&&(r.which===gd||r.keyCode===gd)&&Pe.toggleHide()};U.bind(window,"keydown",Pe._keydownHandler,!1);j.extend(Pe.prototype,{add:function(e,t){return pi(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return pi(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;j.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&vo.removeChild(this.domElement);var e=this;j.each(this.__folders,function(t){e.removeFolder(t)}),U.unbind(window,"keydown",Pe._keydownHandler,!1),bd(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Pe(t);this.__folders[e]=n;var o=Tl(this,n.domElement);return U.addClass(o,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],bd(e);var t=this;j.each(e.__folders,function(n){e.removeFolder(n)}),j.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=U.getOffset(e.__ul).top,n=0;j.each(e.__ul.childNodes,function(o){e.autoPlace&&o===e.__save_row||(n+=U.getHeight(o))}),window.innerHeight-t-yd<n?(U.addClass(e.domElement,Pe.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-yd+"px"):(U.removeClass(e.domElement,Pe.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&j.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:j.debounce(function(){this.onResize()},50),remember:function(){if(j.isUndefined(fi)&&(fi=new wC,fi.domElement.innerHTML=yC),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;j.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length===0&&SC(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&Ju(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=ga(this)),e.folders={},j.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ga(this),Yu(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Ii]=ga(this,!0)),this.load.remembered[e]=ga(this),this.preset=e,Zu(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){j.each(this.__controllers,function(t){this.getRoot().load.remembered?xv(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),j.each(this.__folders,function(t){t.revert(t)}),e||Yu(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length===0;this.__listening.push(e),t&&wv(this.__listening)},updateDisplay:function(){j.each(this.__controllers,function(e){e.updateDisplay()}),j.each(this.__folders,function(e){e.updateDisplay()})}});function Tl(r,e,t){var n=document.createElement("li");return e&&n.appendChild(e),t?r.__ul.insertBefore(n,t):r.__ul.appendChild(n),r.onResize(),n}function bd(r){U.unbind(window,"resize",r.__resizeHandler),r.saveToLocalStorageIfPossible&&U.unbind(window,"unload",r.saveToLocalStorageIfPossible)}function Yu(r,e){var t=r.__preset_select[r.__preset_select.selectedIndex];e?t.innerHTML=t.value+"*":t.innerHTML=t.value}function EC(r,e,t){if(t.__li=e,t.__gui=r,j.extend(t,{options:function(a){if(arguments.length>1){var s=t.__li.nextElementSibling;return t.remove(),pi(r,t.object,t.property,{before:s,factoryArgs:[j.toArray(arguments)]})}if(j.isArray(a)||j.isObject(a)){var u=t.__li.nextElementSibling;return t.remove(),pi(r,t.object,t.property,{before:u,factoryArgs:[a]})}},name:function(a){return t.__li.firstElementChild.firstElementChild.innerHTML=a,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof Za){var n=new Ai(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});j.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(i){var a=t[i],s=n[i];t[i]=n[i]=function(){var u=Array.prototype.slice.call(arguments);return s.apply(n,u),a.apply(t,u)}}),U.addClass(e,"has-slider"),t.domElement.insertBefore(n.domElement,t.domElement.firstElementChild)}else if(t instanceof Ai){var o=function(a){if(j.isNumber(t.__min)&&j.isNumber(t.__max)){var s=t.__li.firstElementChild.firstElementChild.innerHTML,u=t.__gui.__listening.indexOf(t)>-1;t.remove();var c=pi(r,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return c.name(s),u&&c.listen(),c}return a};t.min=j.compose(o,t.min),t.max=j.compose(o,t.max)}else t instanceof Cl?(U.bind(e,"click",function(){U.fakeEvent(t.__checkbox,"click")}),U.bind(t.__checkbox,"click",function(i){i.stopPropagation()})):t instanceof Sl?(U.bind(e,"click",function(){U.fakeEvent(t.__button,"click")}),U.bind(e,"mouseover",function(){U.addClass(t.__button,"hover")}),U.bind(e,"mouseout",function(){U.removeClass(t.__button,"hover")})):t instanceof Ja&&(U.addClass(e,"color"),t.updateDisplay=j.compose(function(i){return e.style.borderLeftColor=t.__color.toString(),i},t.updateDisplay),t.updateDisplay());t.setValue=j.compose(function(i){return r.getRoot().__preset_select&&t.isModified()&&Yu(r.getRoot(),!0),i},t.setValue)}function xv(r,e){var t=r.getRoot(),n=t.__rememberedObjects.indexOf(e.object);if(n!==-1){var o=t.__rememberedObjectIndecesToControllers[n];if(o===void 0&&(o={},t.__rememberedObjectIndecesToControllers[n]=o),o[e.property]=e,t.load&&t.load.remembered){var i=t.load.remembered,a=void 0;if(i[r.preset])a=i[r.preset];else if(i[Ii])a=i[Ii];else return;if(a[n]&&a[n][e.property]!==void 0){var s=a[n][e.property];e.initialValue=s,e.setValue(s)}}}}function pi(r,e,t,n){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var o=void 0;if(n.color)o=new Ja(e,t);else{var i=[e,t].concat(n.factoryArgs);o=_C.apply(r,i)}n.before instanceof Nr&&(n.before=n.before.__li),xv(r,o),U.addClass(o.domElement,"c");var a=document.createElement("span");U.addClass(a,"property-name"),a.innerHTML=o.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(o.domElement);var u=Tl(r,s,n.before);return U.addClass(u,Pe.CLASS_CONTROLLER_ROW),o instanceof Ja?U.addClass(u,"color"):U.addClass(u,hC(o.getValue())),EC(r,u,o),r.__controllers.push(o),o}function mo(r,e){return document.location.href+"."+e}function Zu(r,e,t){var n=document.createElement("option");n.innerHTML=e,n.value=e,r.__preset_select.appendChild(n),t&&(r.__preset_select.selectedIndex=r.__preset_select.length-1)}function xd(r,e){e.style.display=r.useLocalStorage?"block":"none"}function SC(r){var e=r.__save_row=document.createElement("li");U.addClass(r.domElement,"has-save"),r.__ul.insertBefore(e,r.__ul.firstChild),U.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",U.addClass(t,"button gears");var n=document.createElement("span");n.innerHTML="Save",U.addClass(n,"button"),U.addClass(n,"save");var o=document.createElement("span");o.innerHTML="New",U.addClass(o,"button"),U.addClass(o,"save-as");var i=document.createElement("span");i.innerHTML="Revert",U.addClass(i,"button"),U.addClass(i,"revert");var a=r.__preset_select=document.createElement("select");if(r.load&&r.load.remembered?j.each(r.load.remembered,function(h,d){Zu(r,d,d===r.preset)}):Zu(r,Ii,!1),U.bind(a,"change",function(){for(var h=0;h<r.__preset_select.length;h++)r.__preset_select[h].innerHTML=r.__preset_select[h].value;r.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(n),e.appendChild(o),e.appendChild(i),si){var s=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block",localStorage.getItem(mo(r,"isLocal"))==="true"&&u.setAttribute("checked","checked"),xd(r,s),U.bind(u,"change",function(){r.useLocalStorage=!r.useLocalStorage,xd(r,s)})}var l=document.getElementById("dg-new-constructor");U.bind(l,"keydown",function(h){h.metaKey&&(h.which===67||h.keyCode===67)&&fi.hide()}),U.bind(t,"click",function(){l.innerHTML=JSON.stringify(r.getSaveObject(),void 0,2),fi.show(),l.focus(),l.select()}),U.bind(n,"click",function(){r.save()}),U.bind(o,"click",function(){var h=prompt("Enter a new preset name.");h&&r.saveAs(h)}),U.bind(i,"click",function(){r.revert()})}function TC(r){var e=void 0;r.__resize_handle=document.createElement("div"),j.extend(r.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function t(i){return i.preventDefault(),r.width+=e-i.clientX,r.onResize(),e=i.clientX,!1}function n(){U.removeClass(r.__closeButton,Pe.CLASS_DRAG),U.unbind(window,"mousemove",t),U.unbind(window,"mouseup",n)}function o(i){return i.preventDefault(),e=i.clientX,U.addClass(r.__closeButton,Pe.CLASS_DRAG),U.bind(window,"mousemove",t),U.bind(window,"mouseup",n),!1}U.bind(r.__resize_handle,"mousedown",o),U.bind(r.__closeButton,"mousedown",o),r.domElement.insertBefore(r.__resize_handle,r.domElement.firstElementChild)}function Ju(r,e){r.domElement.style.width=e+"px",r.__save_row&&r.autoPlace&&(r.__save_row.style.width=e+"px"),r.__closeButton&&(r.__closeButton.style.width=e+"px")}function ga(r,e){var t={};return j.each(r.__rememberedObjects,function(n,o){var i={},a=r.__rememberedObjectIndecesToControllers[o];j.each(a,function(s,u){i[u]=e?s.initialValue:s.getValue()}),t[o]=i}),t}function kC(r){for(var e=0;e<r.__preset_select.length;e++)r.__preset_select[e].value===r.preset&&(r.__preset_select.selectedIndex=e)}function wv(r){r.length!==0&&xC.call(window,function(){wv(r)}),j.each(r,function(e){e.updateDisplay()})}var AC={Color:ct,math:ki,interpret:Ya},IC={Controller:Nr,BooleanController:Cl,OptionController:yv,StringController:_v,NumberController:El,NumberControllerBox:Ai,NumberControllerSlider:Za,FunctionController:Sl,ColorController:Ja},RC={dom:U},NC={GUI:Pe},DC=Pe,OC={color:AC,controllers:IC,dom:RC,gui:NC,GUI:DC};const Cv="15.0.4",wd=(r,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:r}),Cd=(r,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:r}),Qu=(r,e)=>({startTime:e,type:"setValue",value:r}),Ev=(r,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:r}),Sv=(r,e,{startTime:t,target:n,timeConstant:o})=>n+(e-n)*Math.exp((t-r)/o),_o=r=>r.type==="exponentialRampToValue",Qa=r=>r.type==="linearRampToValue",pr=r=>_o(r)||Qa(r),kl=r=>r.type==="setValue",Zn=r=>r.type==="setValueCurve",es=(r,e,t,n)=>{const o=r[e];return o===void 0?n:pr(o)||kl(o)?o.value:Zn(o)?o.values[o.values.length-1]:Sv(t,es(r,e-1,o.startTime,n),o)},Ed=(r,e,t,n,o)=>t===void 0?[n.insertTime,o]:pr(t)?[t.endTime,t.value]:kl(t)?[t.startTime,t.value]:Zn(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,es(r,e-1,t.startTime,o)],ec=r=>r.type==="cancelAndHold",tc=r=>r.type==="cancelScheduledValues",fr=r=>ec(r)||tc(r)?r.cancelTime:_o(r)||Qa(r)?r.endTime:r.startTime,Sd=(r,e,t,{endTime:n,value:o})=>t===o?o:0<t&&0<o||t<0&&o<0?t*(o/t)**((r-e)/(n-e)):0,Td=(r,e,t,{endTime:n,value:o})=>t+(r-e)/(n-e)*(o-t),FC=(r,e)=>{const t=Math.floor(e),n=Math.ceil(e);return t===n?r[t]:(1-(e-t))*r[t]+(1-(n-e))*r[n]},MC=(r,{duration:e,startTime:t,values:n})=>{const o=(r-t)/e*(n.length-1);return FC(n,o)},ya=r=>r.type==="setTarget";class PC{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=fr(e);if(ec(e)||tc(e)){const n=this._automationEvents.findIndex(i=>tc(e)&&Zn(i)?i.startTime+i.duration>=t:fr(i)>=t),o=this._automationEvents[n];if(n!==-1&&(this._automationEvents=this._automationEvents.slice(0,n)),ec(e)){const i=this._automationEvents[this._automationEvents.length-1];if(o!==void 0&&pr(o)){if(i!==void 0&&ya(i))throw new Error("The internal list is malformed.");const a=i===void 0?o.insertTime:Zn(i)?i.startTime+i.duration:fr(i),s=i===void 0?this._defaultValue:Zn(i)?i.values[i.values.length-1]:i.value,u=_o(o)?Sd(t,a,s,o):Td(t,a,s,o),c=_o(o)?wd(u,t,this._currenTime):Cd(u,t,this._currenTime);this._automationEvents.push(c)}if(i!==void 0&&ya(i)&&this._automationEvents.push(Qu(this.getValue(t),t)),i!==void 0&&Zn(i)&&i.startTime+i.duration>t){const a=t-i.startTime,s=(i.values.length-1)/i.duration,u=Math.max(2,1+Math.ceil(a*s)),c=a/(u-1)*s,l=i.values.slice(0,u);if(c<1)for(let h=1;h<u;h+=1){const d=c*h%1;l[h]=i.values[h-1]*(1-d)+i.values[h]*d}this._automationEvents[this._automationEvents.length-1]=Ev(l,i.startTime,a)}}}else{const n=this._automationEvents.findIndex(a=>fr(a)>t),o=n===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(o!==void 0&&Zn(o)&&fr(o)+o.duration>t)return!1;const i=_o(e)?wd(e.value,e.endTime,this._currenTime):Qa(e)?Cd(e.value,t,this._currenTime):e;if(n===-1)this._automationEvents.push(i);else{if(Zn(e)&&t+e.duration>fr(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,i)}}return!0}flush(e){const t=this._automationEvents.findIndex(n=>fr(n)>e);if(t>1){const n=this._automationEvents.slice(t-1),o=n[0];ya(o)&&n.unshift(Qu(es(this._automationEvents,t-2,o.startTime,this._defaultValue),o.startTime)),this._automationEvents=n}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(a=>fr(a)>e),n=this._automationEvents[t],o=(t===-1?this._automationEvents.length:t)-1,i=this._automationEvents[o];if(i!==void 0&&ya(i)&&(n===void 0||!pr(n)||n.insertTime>e))return Sv(e,es(this._automationEvents,o-1,i.startTime,this._defaultValue),i);if(i!==void 0&&kl(i)&&(n===void 0||!pr(n)))return i.value;if(i!==void 0&&Zn(i)&&(n===void 0||!pr(n)||i.startTime+i.duration>e))return e<i.startTime+i.duration?MC(e,i):i.values[i.values.length-1];if(i!==void 0&&pr(i)&&(n===void 0||!pr(n)))return i.value;if(n!==void 0&&_o(n)){const[a,s]=Ed(this._automationEvents,o,i,n,this._defaultValue);return Sd(e,a,s,n)}if(n!==void 0&&Qa(n)){const[a,s]=Ed(this._automationEvents,o,i,n,this._defaultValue);return Td(e,a,s,n)}return this._defaultValue}}const BC=r=>({cancelTime:r,type:"cancelAndHold"}),LC=r=>({cancelTime:r,type:"cancelScheduledValues"}),WC=(r,e)=>({endTime:e,type:"exponentialRampToValue",value:r}),VC=(r,e)=>({endTime:e,type:"linearRampToValue",value:r}),UC=(r,e,t)=>({startTime:e,target:r,timeConstant:t,type:"setTarget"}),zC=()=>new DOMException("","AbortError"),GC=r=>(e,t,[n,o,i],a)=>{r(e[o],[t,n,i],s=>s[0]===t&&s[1]===n,a)},qC=r=>(e,t,n)=>{const o=[];for(let i=0;i<n.numberOfInputs;i+=1)o.push(new Set);r.set(e,{activeInputs:o,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},HC=r=>(e,t)=>{r.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},Bo=new WeakSet,Tv=new WeakMap,Al=new WeakMap,kv=new WeakMap,Il=new WeakMap,As=new WeakMap,Av=new WeakMap,nc=new WeakMap,rc=new WeakMap,oc=new WeakMap,Iv={construct(){return Iv}},jC=r=>{try{const e=new Proxy(r,Iv);new e}catch{return!1}return!0},kd=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Ad=(r,e)=>{const t=[];let n=r.replace(/^[\s]+/,""),o=n.match(kd);for(;o!==null;){const i=o[1].slice(1,-1),a=o[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,e).toString());t.push(a),n=n.slice(o[0].length).replace(/^[\s]+/,""),o=n.match(kd)}return[t.join(";"),n]},Id=r=>{if(r!==void 0&&!Array.isArray(r))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Rd=r=>{if(!jC(r))throw new TypeError("The given value for processorCtor should be a constructor.");if(r.prototype===null||typeof r.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},XC=(r,e,t,n,o,i,a,s,u,c,l,h,d)=>{let f=0;return(p,v,m={credentials:"omit"})=>{const g=l.get(p);if(g!==void 0&&g.has(v))return Promise.resolve();const _=c.get(p);if(_!==void 0){const y=_.get(v);if(y!==void 0)return y}const x=i(p),b=x.audioWorklet===void 0?o(v).then(([y,w])=>{const[E,C]=Ad(y,w),T=`${E};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${C}
})})(window,'_AWGS')`;return t(T)}).then(()=>{const y=d._AWGS.pop();if(y===void 0)throw new SyntaxError;n(x.currentTime,x.sampleRate,()=>y(class{},void 0,(w,E)=>{if(w.trim()==="")throw e();const C=rc.get(x);if(C!==void 0){if(C.has(w))throw e();Rd(E),Id(E.parameterDescriptors),C.set(w,E)}else Rd(E),Id(E.parameterDescriptors),rc.set(x,new Map([[w,E]]))},x.sampleRate,void 0,void 0))}):Promise.all([o(v),Promise.resolve(r(h,h))]).then(([[y,w],E])=>{const C=f+1;f=C;const[T,S]=Ad(y,w),O=`${T};((AudioWorkletProcessor,registerProcessor)=>{${S}
})(${E?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${E?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${E?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${C}',class extends AudioWorkletProcessor{process(){return !1}})`,M=new Blob([O],{type:"application/javascript; charset=utf-8"}),B=URL.createObjectURL(M);return x.audioWorklet.addModule(B,m).then(()=>{if(s(x))return x;const P=a(x);return P.audioWorklet.addModule(B,m).then(()=>P)}).then(P=>{if(u===null)throw new SyntaxError;try{new u(P,`__sac${C}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(B))});return _===void 0?c.set(p,new Map([[v,b]])):_.set(v,b),b.then(()=>{const y=l.get(p);y===void 0?l.set(p,new Set([v])):y.add(v)}).finally(()=>{const y=c.get(p);y!==void 0&&y.delete(v)}),b}},yn=(r,e)=>{const t=r.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},Is=(r,e)=>{const t=Array.from(r).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[n]=t;return r.delete(n),n},Rv=(r,e,t,n)=>{const o=yn(r,e),i=Is(o,a=>a[0]===t&&a[1]===n);return o.size===0&&r.delete(e),i},qi=r=>yn(Av,r),Lo=r=>{if(Bo.has(r))throw new Error("The AudioNode is already stored.");Bo.add(r),qi(r).forEach(e=>e(!0))},Nv=r=>"port"in r,Hi=r=>{if(!Bo.has(r))throw new Error("The AudioNode is not stored.");Bo.delete(r),qi(r).forEach(e=>e(!1))},ic=(r,e)=>{!Nv(r)&&e.every(t=>t.size===0)&&Hi(r)},KC=(r,e,t,n,o,i,a,s,u,c,l,h,d)=>{const f=new WeakMap;return(p,v,m,g,_)=>{const{activeInputs:x,passiveInputs:b}=i(v),{outputs:y}=i(p),w=s(p),E=C=>{const T=u(v),S=u(p);if(C){const I=Rv(b,p,m,g);r(x,p,I,!1),!_&&!h(p)&&t(S,T,m,g),d(v)&&Lo(v)}else{const I=n(x,p,m,g);e(b,g,I,!1),!_&&!h(p)&&o(S,T,m,g);const A=a(v);if(A===0)l(v)&&ic(v,x);else{const F=f.get(v);F!==void 0&&clearTimeout(F),f.set(v,setTimeout(()=>{l(v)&&ic(v,x)},A*1e3))}}};return c(y,[v,m,g],C=>C[0]===v&&C[1]===m&&C[2]===g,!0)?(w.add(E),l(p)?r(x,p,[m,g,E],!0):e(b,g,[p,m,E],!0),!0):!1}},$C=r=>(e,t,[n,o,i],a)=>{const s=e.get(n);s===void 0?e.set(n,new Set([[o,t,i]])):r(s,[o,t,i],u=>u[0]===o&&u[1]===t,a)},YC=r=>(e,t)=>{const n=r(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);const o=()=>{t.removeEventListener("ended",o),t.disconnect(n),n.disconnect()};t.addEventListener("ended",o)},ZC=r=>(e,t)=>{r(e).add(t)},JC={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},QC=(r,e,t,n,o,i)=>class extends r{constructor(s,u){const c=o(s),l={...JC,...u},h=n(c,l),d=i(c)?e():null;super(s,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(s){this._nativeAnalyserNode.fftSize=s}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(s){const u=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=s,!(s>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=u,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(s){const u=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=s,!(this._nativeAnalyserNode.maxDecibels>s))throw this._nativeAnalyserNode.minDecibels=u,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(s){this._nativeAnalyserNode.smoothingTimeConstant=s}getByteFrequencyData(s){this._nativeAnalyserNode.getByteFrequencyData(s)}getByteTimeDomainData(s){this._nativeAnalyserNode.getByteTimeDomainData(s)}getFloatFrequencyData(s){this._nativeAnalyserNode.getFloatFrequencyData(s)}getFloatTimeDomainData(s){this._nativeAnalyserNode.getFloatTimeDomainData(s)}},Dt=(r,e)=>r.context===e,e2=(r,e,t)=>()=>{const n=new WeakMap,o=async(i,a)=>{let s=e(i);if(!Dt(s,a)){const c={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,fftSize:s.fftSize,maxDecibels:s.maxDecibels,minDecibels:s.minDecibels,smoothingTimeConstant:s.smoothingTimeConstant};s=r(a,c)}return n.set(a,s),await t(i,a,s),s};return{render(i,a){const s=n.get(a);return s!==void 0?Promise.resolve(s):o(i,a)}}},ts=r=>{try{r.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},jn=()=>new DOMException("","IndexSizeError"),Rl=r=>{r.getChannelData=(e=>t=>{try{return e.call(r,t)}catch(n){throw n.code===12?jn():n}})(r.getChannelData)},t2={numberOfChannels:1},n2=(r,e,t,n,o,i,a,s)=>{let u=null;return class Dv{constructor(l){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:f}={...t2,...l};u===null&&(u=new o(1,1,44100));const p=n!==null&&e(i,i)?new n({length:h,numberOfChannels:d,sampleRate:f}):u.createBuffer(d,h,f);if(p.numberOfChannels===0)throw t();return typeof p.copyFromChannel!="function"?(a(p),Rl(p)):e(ts,()=>ts(p))||s(p),r.add(p),p}static[Symbol.hasInstance](l){return l!==null&&typeof l=="object"&&Object.getPrototypeOf(l)===Dv.prototype||r.has(l)}}},Lt=-34028234663852886e22,Ft=-Lt,er=r=>Bo.has(r),r2={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},o2=(r,e,t,n,o,i,a,s)=>class extends r{constructor(c,l){const h=i(c),d={...r2,...l},f=o(h,d),p=a(h),v=p?e():null;super(c,!1,f,v),this._audioBufferSourceNodeRenderer=v,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=f,this._onended=null,this._playbackRate=t(this,p,f.playbackRate,Ft,Lt)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(c){if(this._nativeAudioBufferSourceNode.buffer=c,c!==null){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(c){this._nativeAudioBufferSourceNode.loop=c}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(c){this._nativeAudioBufferSourceNode.loopEnd=c}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(c){this._nativeAudioBufferSourceNode.loopStart=c}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?s(this,c):null;this._nativeAudioBufferSourceNode.onended=l;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===l?c:h}get playbackRate(){return this._playbackRate}start(c=0,l=0,h){if(this._nativeAudioBufferSourceNode.start(c,l,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[c,l]:[c,l,h]),this.context.state!=="closed"){Lo(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),er(this)&&Hi(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(c=0){this._nativeAudioBufferSourceNode.stop(c),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=c)}},i2=(r,e,t,n,o)=>()=>{const i=new WeakMap;let a=null,s=null;const u=async(c,l)=>{let h=t(c);const d=Dt(h,l);if(!d){const f={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(l,f),a!==null&&h.start(...a),s!==null&&h.stop(s)}return i.set(l,h),d?await r(l,c.playbackRate,h.playbackRate):await n(l,c.playbackRate,h.playbackRate),await o(c,l,h),h};return{set start(c){a=c},set stop(c){s=c},render(c,l){const h=i.get(l);return h!==void 0?Promise.resolve(h):u(c,l)}}},a2=r=>"playbackRate"in r,s2=r=>"frequency"in r&&"gain"in r,u2=r=>"offset"in r,c2=r=>!("frequency"in r)&&"gain"in r,l2=r=>"detune"in r&&"frequency"in r&&!("gain"in r),h2=r=>"pan"in r,Mt=r=>yn(Tv,r),ji=r=>yn(kv,r),ac=(r,e)=>{const{activeInputs:t}=Mt(r);t.forEach(o=>o.forEach(([i])=>{e.includes(r)||ac(i,[...e,r])}));const n=a2(r)?[r.playbackRate]:Nv(r)?Array.from(r.parameters.values()):s2(r)?[r.Q,r.detune,r.frequency,r.gain]:u2(r)?[r.offset]:c2(r)?[r.gain]:l2(r)?[r.detune,r.frequency]:h2(r)?[r.pan]:[];for(const o of n){const i=ji(o);i!==void 0&&i.activeInputs.forEach(([a])=>ac(a,e))}er(r)&&Hi(r)},Ov=r=>{ac(r.destination,[])},d2=r=>r===void 0||typeof r=="number"||typeof r=="string"&&(r==="balanced"||r==="interactive"||r==="playback"),f2=(r,e,t,n,o,i,a,s,u)=>class extends r{constructor(l={}){if(u===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new u(l)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?t():p}if(h===null)throw n();if(!d2(l.latencyHint))throw new TypeError(`The provided value '${l.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(l.sampleRate!==void 0&&h.sampleRate!==l.sampleRate)throw t();super(h,2);const{latencyHint:d}=l,{sampleRate:f}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/f:d==="interactive"||d===void 0?256/f:d==="playback"?1024/f:Math.max(2,Math.min(128,Math.round(d*f/128)))*128/f,this._nativeAudioContext=h,u.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",p)};h.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Ov(this)}))}createMediaElementSource(l){return new o(this,{mediaElement:l})}createMediaStreamDestination(){return new i(this)}createMediaStreamSource(l){return new a(this,{mediaStream:l})}createMediaStreamTrackSource(l){return new s(this,{mediaStreamTrack:l})}resume(){return this._state==="suspended"?new Promise((l,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?l():this.resume().then(l,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(l=>{throw l===void 0||l.code===15?e():l})}suspend(){return this._nativeAudioContext.suspend().catch(l=>{throw l===void 0?e():l})}},p2=(r,e,t,n,o,i,a,s)=>class extends r{constructor(c,l){const h=i(c),d=a(h),f=o(h,l,d),p=d?e(s):null;super(c,!1,f,p),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=f}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(c){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(c>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=c}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(c){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=c}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},v2=r=>{const e=new WeakMap,t=async(n,o)=>{const i=o.destination;return e.set(o,i),await r(n,o,i),i};return{render(n,o){const i=e.get(o);return i!==void 0?Promise.resolve(i):t(n,o)}}},m2=(r,e,t,n,o,i,a,s)=>(u,c)=>{const l=c.listener,h=()=>{const y=new Float32Array(1),w=e(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),E=a(c);let C=!1,T=[0,0,-1,0,1,0],S=[0,0,0];const I=()=>{if(C)return;C=!0;const M=n(c,256,9,0);M.onaudioprocess=({inputBuffer:B})=>{const P=[i(B,y,0),i(B,y,1),i(B,y,2),i(B,y,3),i(B,y,4),i(B,y,5)];P.some((W,z)=>W!==T[z])&&(l.setOrientation(...P),T=P);const L=[i(B,y,6),i(B,y,7),i(B,y,8)];L.some((W,z)=>W!==S[z])&&(l.setPosition(...L),S=L)},w.connect(M)},A=M=>B=>{B!==T[M]&&(T[M]=B,l.setOrientation(...T))},F=M=>B=>{B!==S[M]&&(S[M]=B,l.setPosition(...S))},O=(M,B,P)=>{const L=t(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:B});L.connect(w,0,M),L.start(),Object.defineProperty(L.offset,"defaultValue",{get(){return B}});const W=r({context:u},E,L.offset,Ft,Lt);return s(W,"value",z=>()=>z.call(W),z=>H=>{try{z.call(W,H)}catch(Y){if(Y.code!==9)throw Y}I(),E&&P(H)}),W.cancelAndHoldAtTime=(z=>E?()=>{throw o()}:(...H)=>{const Y=z.apply(W,H);return I(),Y})(W.cancelAndHoldAtTime),W.cancelScheduledValues=(z=>E?()=>{throw o()}:(...H)=>{const Y=z.apply(W,H);return I(),Y})(W.cancelScheduledValues),W.exponentialRampToValueAtTime=(z=>E?()=>{throw o()}:(...H)=>{const Y=z.apply(W,H);return I(),Y})(W.exponentialRampToValueAtTime),W.linearRampToValueAtTime=(z=>E?()=>{throw o()}:(...H)=>{const Y=z.apply(W,H);return I(),Y})(W.linearRampToValueAtTime),W.setTargetAtTime=(z=>E?()=>{throw o()}:(...H)=>{const Y=z.apply(W,H);return I(),Y})(W.setTargetAtTime),W.setValueAtTime=(z=>E?()=>{throw o()}:(...H)=>{const Y=z.apply(W,H);return I(),Y})(W.setValueAtTime),W.setValueCurveAtTime=(z=>E?()=>{throw o()}:(...H)=>{const Y=z.apply(W,H);return I(),Y})(W.setValueCurveAtTime),W};return{forwardX:O(0,0,A(0)),forwardY:O(1,0,A(1)),forwardZ:O(2,-1,A(2)),positionX:O(6,0,F(0)),positionY:O(7,0,F(1)),positionZ:O(8,0,F(2)),upX:O(3,0,A(3)),upY:O(4,1,A(4)),upZ:O(5,0,A(5))}},{forwardX:d,forwardY:f,forwardZ:p,positionX:v,positionY:m,positionZ:g,upX:_,upY:x,upZ:b}=l.forwardX===void 0?h():l;return{get forwardX(){return d},get forwardY(){return f},get forwardZ(){return p},get positionX(){return v},get positionY(){return m},get positionZ(){return g},get upX(){return _},get upY(){return x},get upZ(){return b}}},ns=r=>"context"in r,Xi=r=>ns(r[0]),no=(r,e,t,n)=>{for(const o of r)if(t(o)){if(n)return!1;throw Error("The set contains at least one similar element.")}return r.add(e),!0},Nd=(r,e,[t,n],o)=>{no(r,[e,t,n],i=>i[0]===e&&i[1]===t,o)},Dd=(r,[e,t,n],o)=>{const i=r.get(e);i===void 0?r.set(e,new Set([[t,n]])):no(i,[t,n],a=>a[0]===t,o)},Xo=r=>"inputs"in r,rs=(r,e,t,n)=>{if(Xo(e)){const o=e.inputs[n];return r.connect(o,t,0),[o,t,0]}return r.connect(e,t,n),[e,t,n]},Fv=(r,e,t)=>{for(const n of r)if(n[0]===e&&n[1]===t)return r.delete(n),n;return null},g2=(r,e,t)=>Is(r,n=>n[0]===e&&n[1]===t),Mv=(r,e)=>{if(!qi(r).delete(e))throw new Error("Missing the expected event listener.")},Pv=(r,e,t)=>{const n=yn(r,e),o=Is(n,i=>i[0]===t);return n.size===0&&r.delete(e),o},os=(r,e,t,n)=>{Xo(e)?r.disconnect(e.inputs[n],t,0):r.disconnect(e,t,n)},Ue=r=>yn(Al,r),Ri=r=>yn(Il,r),Xr=r=>nc.has(r),Sa=r=>!Bo.has(r),Od=(r,e)=>new Promise(t=>{if(e!==null)t(!0);else{const n=r.createScriptProcessor(256,1,1),o=r.createGain(),i=r.createBuffer(1,2,44100),a=i.getChannelData(0);a[0]=1,a[1]=1;const s=r.createBufferSource();s.buffer=i,s.loop=!0,s.connect(n).connect(r.destination),s.connect(o),s.disconnect(o),n.onaudioprocess=u=>{const c=u.inputBuffer.getChannelData(0);Array.prototype.some.call(c,l=>l===1)?t(!0):t(!1),s.stop(),n.onaudioprocess=null,s.disconnect(n),n.disconnect(r.destination)},s.start()}}),Su=(r,e)=>{const t=new Map;for(const n of r)for(const o of n){const i=t.get(o);t.set(o,i===void 0?1:i+1)}t.forEach((n,o)=>e(o,n))},is=r=>"context"in r,y2=r=>{const e=new Map;r.connect=(t=>(n,o=0,i=0)=>{const a=is(n)?t(n,o,i):t(n,o),s=e.get(n);return s===void 0?e.set(n,[{input:i,output:o}]):s.every(u=>u.input!==i||u.output!==o)&&s.push({input:i,output:o}),a})(r.connect.bind(r)),r.disconnect=(t=>(n,o,i)=>{if(t.apply(r),n===void 0)e.clear();else if(typeof n=="number")for(const[a,s]of e){const u=s.filter(c=>c.output!==n);u.length===0?e.delete(a):e.set(a,u)}else if(e.has(n))if(o===void 0)e.delete(n);else{const a=e.get(n);if(a!==void 0){const s=a.filter(u=>u.output!==o&&(u.input!==i||i===void 0));s.length===0?e.delete(n):e.set(n,s)}}for(const[a,s]of e)s.forEach(u=>{is(a)?r.connect(a,u.output,u.input):r.connect(a,u.output)})})(r.disconnect)},_2=(r,e,t,n)=>{const{activeInputs:o,passiveInputs:i}=ji(e),{outputs:a}=Mt(r),s=qi(r),u=c=>{const l=Ue(r),h=Ri(e);if(c){const d=Pv(i,r,t);Nd(o,r,d,!1),!n&&!Xr(r)&&l.connect(h,t)}else{const d=g2(o,r,t);Dd(i,d,!1),!n&&!Xr(r)&&l.disconnect(h,t)}};return no(a,[e,t],c=>c[0]===e&&c[1]===t,!0)?(s.add(u),er(r)?Nd(o,r,[t,u],!0):Dd(i,[r,t,u],!0),!0):!1},b2=(r,e,t,n)=>{const{activeInputs:o,passiveInputs:i}=Mt(e),a=Fv(o[n],r,t);return a===null?[Rv(i,r,t,n)[2],!1]:[a[2],!0]},x2=(r,e,t)=>{const{activeInputs:n,passiveInputs:o}=ji(e),i=Fv(n,r,t);return i===null?[Pv(o,r,t)[1],!1]:[i[2],!0]},Nl=(r,e,t,n,o)=>{const[i,a]=b2(r,t,n,o);if(i!==null&&(Mv(r,i),a&&!e&&!Xr(r)&&os(Ue(r),Ue(t),n,o)),er(t)){const{activeInputs:s}=Mt(t);ic(t,s)}},Dl=(r,e,t,n)=>{const[o,i]=x2(r,t,n);o!==null&&(Mv(r,o),i&&!e&&!Xr(r)&&Ue(r).disconnect(Ri(t),n))},w2=(r,e)=>{const t=Mt(r),n=[];for(const o of t.outputs)Xi(o)?Nl(r,e,...o):Dl(r,e,...o),n.push(o[0]);return t.outputs.clear(),n},C2=(r,e,t)=>{const n=Mt(r),o=[];for(const i of n.outputs)i[1]===t&&(Xi(i)?Nl(r,e,...i):Dl(r,e,...i),o.push(i[0]),n.outputs.delete(i));return o},E2=(r,e,t,n,o)=>{const i=Mt(r);return Array.from(i.outputs).filter(a=>a[0]===t&&(n===void 0||a[1]===n)&&(o===void 0||a[2]===o)).map(a=>(Xi(a)?Nl(r,e,...a):Dl(r,e,...a),i.outputs.delete(a),a[0]))},S2=(r,e,t,n,o,i,a,s,u,c,l,h,d,f,p,v)=>class extends c{constructor(g,_,x,b){super(x),this._context=g,this._nativeAudioNode=x;const y=l(g);h(y)&&t(Od,()=>Od(y,v))!==!0&&y2(x),Al.set(this,x),Av.set(this,new Set),g.state!=="closed"&&_&&Lo(this),r(this,b,x)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(g){this._nativeAudioNode.channelCount=g}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(g){this._nativeAudioNode.channelCountMode=g}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(g){this._nativeAudioNode.channelInterpretation=g}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(g,_=0,x=0){if(_<0||_>=this._nativeAudioNode.numberOfOutputs)throw o();const b=l(this._context),y=p(b);if(d(g)||f(g))throw i();if(ns(g)){const C=Ue(g);try{const S=rs(this._nativeAudioNode,C,_,x),I=Sa(this);(y||I)&&this._nativeAudioNode.disconnect(...S),this.context.state!=="closed"&&!I&&Sa(g)&&Lo(g)}catch(S){throw S.code===12?i():S}if(e(this,g,_,x,y)){const S=u([this],g);Su(S,n(y))}return g}const w=Ri(g);if(w.name==="playbackRate"&&w.maxValue===1024)throw a();try{this._nativeAudioNode.connect(w,_),(y||Sa(this))&&this._nativeAudioNode.disconnect(w,_)}catch(C){throw C.code===12?i():C}if(_2(this,g,_,y)){const C=u([this],g);Su(C,n(y))}}disconnect(g,_,x){let b;const y=l(this._context),w=p(y);if(g===void 0)b=w2(this,w);else if(typeof g=="number"){if(g<0||g>=this.numberOfOutputs)throw o();b=C2(this,w,g)}else{if(_!==void 0&&(_<0||_>=this.numberOfOutputs)||ns(g)&&x!==void 0&&(x<0||x>=g.numberOfInputs))throw o();if(b=E2(this,w,g,_,x),b.length===0)throw i()}for(const E of b){const C=u([this],E);Su(C,s)}}},T2=(r,e,t,n,o,i,a,s,u,c,l,h,d)=>(f,p,v,m=null,g=null)=>{const _=v.value,x=new PC(_),b=p?n(x):null,y={get defaultValue(){return _},get maxValue(){return m===null?v.maxValue:m},get minValue(){return g===null?v.minValue:g},get value(){return v.value},set value(w){v.value=w,y.setValueAtTime(w,f.context.currentTime)},cancelAndHoldAtTime(w){if(typeof v.cancelAndHoldAtTime=="function")b===null&&x.flush(f.context.currentTime),x.add(o(w)),v.cancelAndHoldAtTime(w);else{const E=Array.from(x).pop();b===null&&x.flush(f.context.currentTime),x.add(o(w));const C=Array.from(x).pop();v.cancelScheduledValues(w),E!==C&&C!==void 0&&(C.type==="exponentialRampToValue"?v.exponentialRampToValueAtTime(C.value,C.endTime):C.type==="linearRampToValue"?v.linearRampToValueAtTime(C.value,C.endTime):C.type==="setValue"?v.setValueAtTime(C.value,C.startTime):C.type==="setValueCurve"&&v.setValueCurveAtTime(C.values,C.startTime,C.duration))}return y},cancelScheduledValues(w){return b===null&&x.flush(f.context.currentTime),x.add(i(w)),v.cancelScheduledValues(w),y},exponentialRampToValueAtTime(w,E){if(w===0)throw new RangeError;if(!Number.isFinite(E)||E<0)throw new RangeError;const C=f.context.currentTime;return b===null&&x.flush(C),Array.from(x).length===0&&(x.add(c(_,C)),v.setValueAtTime(_,C)),x.add(a(w,E)),v.exponentialRampToValueAtTime(w,E),y},linearRampToValueAtTime(w,E){const C=f.context.currentTime;return b===null&&x.flush(C),Array.from(x).length===0&&(x.add(c(_,C)),v.setValueAtTime(_,C)),x.add(s(w,E)),v.linearRampToValueAtTime(w,E),y},setTargetAtTime(w,E,C){return b===null&&x.flush(f.context.currentTime),x.add(u(w,E,C)),v.setTargetAtTime(w,E,C),y},setValueAtTime(w,E){return b===null&&x.flush(f.context.currentTime),x.add(c(w,E)),v.setValueAtTime(w,E),y},setValueCurveAtTime(w,E,C){const T=w instanceof Float32Array?w:new Float32Array(w);if(h!==null&&h.name==="webkitAudioContext"){const S=E+C,I=f.context.sampleRate,A=Math.ceil(E*I),F=Math.floor(S*I),O=F-A,M=new Float32Array(O);for(let P=0;P<O;P+=1){const L=(T.length-1)/C*((A+P)/I-E),W=Math.floor(L),z=Math.ceil(L);M[P]=W===z?T[W]:(1-(L-W))*T[W]+(1-(z-L))*T[z]}b===null&&x.flush(f.context.currentTime),x.add(l(M,E,C)),v.setValueCurveAtTime(M,E,C);const B=F/I;B<S&&d(y,M[M.length-1],B),d(y,T[T.length-1],S)}else b===null&&x.flush(f.context.currentTime),x.add(l(T,E,C)),v.setValueCurveAtTime(T,E,C);return y}};return t.set(y,v),e.set(y,f),r(y,b),y},k2=r=>({replay(e){for(const t of r)if(t.type==="exponentialRampToValue"){const{endTime:n,value:o}=t;e.exponentialRampToValueAtTime(o,n)}else if(t.type==="linearRampToValue"){const{endTime:n,value:o}=t;e.linearRampToValueAtTime(o,n)}else if(t.type==="setTarget"){const{startTime:n,target:o,timeConstant:i}=t;e.setTargetAtTime(o,n,i)}else if(t.type==="setValue"){const{startTime:n,value:o}=t;e.setValueAtTime(o,n)}else if(t.type==="setValueCurve"){const{duration:n,startTime:o,values:i}=t;e.setValueCurveAtTime(i,o,n)}else throw new Error("Can't apply an unknown automation.")}});class Bv{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((n,o)=>e.call(t,n,o,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const A2={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},I2=(r,e,t,n,o,i,a,s,u,c,l,h,d,f)=>class extends e{constructor(v,m,g){var _;const x=s(v),b=u(x),y=l({...A2,...g});d(y);const w=rc.get(x),E=w==null?void 0:w.get(m),C=b||x.state!=="closed"?x:(_=a(x))!==null&&_!==void 0?_:x,T=o(C,b?null:v.baseLatency,c,m,E,y),S=b?n(m,y,E):null;super(v,!0,T,S);const I=[];T.parameters.forEach((F,O)=>{const M=t(this,b,F);I.push([O,M])}),this._nativeAudioWorkletNode=T,this._onprocessorerror=null,this._parameters=new Bv(I),b&&r(x,this);const{activeInputs:A}=i(this);h(T,A)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(v){const m=typeof v=="function"?f(this,v):null;this._nativeAudioWorkletNode.onprocessorerror=m;const g=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=g!==null&&g===m?v:g}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function as(r,e,t,n,o){if(typeof r.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),r.copyFromChannel(e[t],n,o);else{const i=r.getChannelData(n);if(e[t].byteLength===0)e[t]=i.slice(o,o+128);else{const a=new Float32Array(i.buffer,o*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(a)}}}const Lv=(r,e,t,n,o)=>{typeof r.copyToChannel=="function"?e[t].byteLength!==0&&r.copyToChannel(e[t],n,o):e[t].byteLength!==0&&r.getChannelData(n).set(e[t],o)},ss=(r,e)=>{const t=[];for(let n=0;n<r;n+=1){const o=[],i=typeof e=="number"?e:e[n];for(let a=0;a<i;a+=1)o.push(new Float32Array(128));t.push(o)}return t},R2=(r,e)=>{const t=yn(oc,r),n=Ue(e);return yn(t,n)},N2=async(r,e,t,n,o,i,a)=>{const s=e===null?Math.ceil(r.context.length/128)*128:e.length,u=n.channelCount*n.numberOfInputs,c=o.reduce((m,g)=>m+g,0),l=c===0?null:t.createBuffer(c,s,t.sampleRate);if(i===void 0)throw new Error("Missing the processor constructor.");const h=Mt(r),d=await R2(t,r),f=ss(n.numberOfInputs,n.channelCount),p=ss(n.numberOfOutputs,o),v=Array.from(r.parameters.keys()).reduce((m,g)=>({...m,[g]:new Float32Array(128)}),{});for(let m=0;m<s;m+=128){if(n.numberOfInputs>0&&e!==null)for(let g=0;g<n.numberOfInputs;g+=1)for(let _=0;_<n.channelCount;_+=1)as(e,f[g],_,_,m);i.parameterDescriptors!==void 0&&e!==null&&i.parameterDescriptors.forEach(({name:g},_)=>{as(e,v,g,u+_,m)});for(let g=0;g<n.numberOfInputs;g+=1)for(let _=0;_<o[g];_+=1)p[g][_].byteLength===0&&(p[g][_]=new Float32Array(128));try{const g=f.map((x,b)=>h.activeInputs[b].size===0?[]:x),_=a(m/t.sampleRate,t.sampleRate,()=>d.process(g,p,v));if(l!==null)for(let x=0,b=0;x<n.numberOfOutputs;x+=1){for(let y=0;y<o[x];y+=1)Lv(l,p[x],y,b+y,m);b+=o[x]}if(!_)break}catch(g){r.dispatchEvent(new ErrorEvent("processorerror",{colno:g.colno,filename:g.filename,lineno:g.lineno,message:g.message}));break}}return l},D2=(r,e,t,n,o,i,a,s,u,c,l,h,d,f,p,v)=>(m,g,_)=>{const x=new WeakMap;let b=null;const y=async(w,E)=>{let C=l(w),T=null;const S=Dt(C,E),I=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(h===null){const A=I.reduce((B,P)=>B+P,0),F=o(E,{channelCount:Math.max(1,A),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,A)}),O=[];for(let B=0;B<w.numberOfOutputs;B+=1)O.push(n(E,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:I[B]}));const M=a(E,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1});M.connect=e.bind(null,O),M.disconnect=u.bind(null,O),T=[F,O,M]}else S||(C=new h(E,m));if(x.set(E,T===null?C:T[2]),T!==null){if(b===null){if(_===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const P=w.channelCount*w.numberOfInputs,L=_.parameterDescriptors===void 0?0:_.parameterDescriptors.length,W=P+L;b=N2(w,W===0?null:await(async()=>{const H=new d(W,Math.ceil(w.context.length/128)*128,E.sampleRate),Y=[],te=[];for(let oe=0;oe<g.numberOfInputs;oe+=1)Y.push(a(H,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),te.push(o(H,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const ce=await Promise.all(Array.from(w.parameters.values()).map(async oe=>{const le=i(H,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:oe.value});return await f(H,oe,le.offset),le})),Z=n(H,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,P+L)});for(let oe=0;oe<g.numberOfInputs;oe+=1){Y[oe].connect(te[oe]);for(let le=0;le<g.channelCount;le+=1)te[oe].connect(Z,le,oe*g.channelCount+le)}for(const[oe,le]of ce.entries())le.connect(Z,0,P+oe),le.start(0);return Z.connect(H.destination),await Promise.all(Y.map(oe=>p(w,H,oe))),v(H)})(),E,g,I,_,c)}const A=await b,F=t(E,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[O,M,B]=T;A!==null&&(F.buffer=A,F.start(0)),F.connect(O);for(let P=0,L=0;P<w.numberOfOutputs;P+=1){const W=M[P];for(let z=0;z<I[P];z+=1)O.connect(W,L+z,z);L+=I[P]}return B}if(S)for(const[A,F]of w.parameters.entries())await r(E,F,C.parameters.get(A));else for(const[A,F]of w.parameters.entries())await f(E,F,C.parameters.get(A));return await p(w,E,C),C};return{render(w,E){s(E,w);const C=x.get(E);return C!==void 0?Promise.resolve(C):y(w,E)}}},O2=(r,e,t,n,o,i,a,s,u,c,l,h,d,f,p,v,m,g,_,x)=>class extends p{constructor(y,w){super(y,w),this._nativeContext=y,this._audioWorklet=r===void 0?void 0:{addModule:(E,C)=>r(this,E,C)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new o(this)}createBuffer(y,w,E){return new t({length:w,numberOfChannels:y,sampleRate:E})}createBufferSource(){return new n(this)}createChannelMerger(y=6){return new i(this,{numberOfInputs:y})}createChannelSplitter(y=6){return new a(this,{numberOfOutputs:y})}createConstantSource(){return new s(this)}createConvolver(){return new u(this)}createDelay(y=1){return new l(this,{maxDelayTime:y})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(y,w){return new f(this,{feedback:w,feedforward:y})}createOscillator(){return new v(this)}createPanner(){return new m(this)}createPeriodicWave(y,w,E={disableNormalization:!1}){return new g(this,{...E,imag:w,real:y})}createStereoPanner(){return new _(this)}createWaveShaper(){return new x(this)}decodeAudioData(y,w,E){return c(this._nativeContext,y).then(C=>(typeof w=="function"&&w(C),C),C=>{throw typeof E=="function"&&E(C),C})}},F2={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},M2=(r,e,t,n,o,i,a,s)=>class extends r{constructor(c,l){const h=i(c),d={...F2,...l},f=o(h,d),p=a(h),v=p?t():null;super(c,!1,f,v),this._Q=e(this,p,f.Q,Ft,Lt),this._detune=e(this,p,f.detune,1200*Math.log2(Ft),-1200*Math.log2(Ft)),this._frequency=e(this,p,f.frequency,c.sampleRate/2,0),this._gain=e(this,p,f.gain,40*Math.log10(Ft),Lt),this._nativeBiquadFilterNode=f,s(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(c){this._nativeBiquadFilterNode.type=c}getFrequencyResponse(c,l,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(c,l,h)}catch(d){throw d.code===11?n():d}if(c.length!==l.length||l.length!==h.length)throw n()}},P2=(r,e,t,n,o)=>()=>{const i=new WeakMap,a=async(s,u)=>{let c=t(s);const l=Dt(c,u);if(!l){const h={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=e(u,h)}return i.set(u,c),l?(await r(u,s.Q,c.Q),await r(u,s.detune,c.detune),await r(u,s.frequency,c.frequency),await r(u,s.gain,c.gain)):(await n(u,s.Q,c.Q),await n(u,s.detune,c.detune),await n(u,s.frequency,c.frequency),await n(u,s.gain,c.gain)),await o(s,u,c),c};return{render(s,u){const c=i.get(u);return c!==void 0?Promise.resolve(c):a(s,u)}}},B2=(r,e)=>(t,n)=>{const o=e.get(t);if(o!==void 0)return o;const i=r.get(t);if(i!==void 0)return i;try{const a=n();return a instanceof Promise?(r.set(t,a),a.catch(()=>!1).then(s=>(r.delete(t),e.set(t,s),s))):(e.set(t,a),a)}catch{return e.set(t,!1),!1}},L2={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},W2=(r,e,t,n,o)=>class extends r{constructor(a,s){const u=n(a),c={...L2,...s},l=t(u,c),h=o(u)?e():null;super(a,!1,l,h)}},V2=(r,e,t)=>()=>{const n=new WeakMap,o=async(i,a)=>{let s=e(i);if(!Dt(s,a)){const c={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,numberOfInputs:s.numberOfInputs};s=r(a,c)}return n.set(a,s),await t(i,a,s),s};return{render(i,a){const s=n.get(a);return s!==void 0?Promise.resolve(s):o(i,a)}}},U2={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},z2=(r,e,t,n,o,i)=>class extends r{constructor(s,u){const c=n(s),l=i({...U2,...u}),h=t(c,l),d=o(c)?e():null;super(s,!1,h,d)}},G2=(r,e,t)=>()=>{const n=new WeakMap,o=async(i,a)=>{let s=e(i);if(!Dt(s,a)){const c={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,numberOfOutputs:s.numberOfOutputs};s=r(a,c)}return n.set(a,s),await t(i,a,s),s};return{render(i,a){const s=n.get(a);return s!==void 0?Promise.resolve(s):o(i,a)}}},q2=r=>(e,t,n)=>r(t,e,n),H2=r=>(e,t,n=0,o=0)=>{const i=e[n];if(i===void 0)throw r();return is(t)?i.connect(t,0,o):i.connect(t,0)},j2=r=>(e,t)=>{const n=r(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),o=e.createBuffer(1,2,44100);return n.buffer=o,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}},X2={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},K2=(r,e,t,n,o,i,a)=>class extends r{constructor(u,c){const l=o(u),h={...X2,...c},d=n(l,h),f=i(l),p=f?t():null;super(u,!1,d,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=d,this._offset=e(this,f,d.offset,Ft,Lt),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(u){const c=typeof u=="function"?a(this,u):null;this._nativeConstantSourceNode.onended=c;const l=this._nativeConstantSourceNode.onended;this._onended=l!==null&&l===c?u:l}start(u=0){if(this._nativeConstantSourceNode.start(u),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=u),this.context.state!=="closed"){Lo(this);const c=()=>{this._nativeConstantSourceNode.removeEventListener("ended",c),er(this)&&Hi(this)};this._nativeConstantSourceNode.addEventListener("ended",c)}}stop(u=0){this._nativeConstantSourceNode.stop(u),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=u)}},$2=(r,e,t,n,o)=>()=>{const i=new WeakMap;let a=null,s=null;const u=async(c,l)=>{let h=t(c);const d=Dt(h,l);if(!d){const f={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(l,f),a!==null&&h.start(a),s!==null&&h.stop(s)}return i.set(l,h),d?await r(l,c.offset,h.offset):await n(l,c.offset,h.offset),await o(c,l,h),h};return{set start(c){a=c},set stop(c){s=c},render(c,l){const h=i.get(l);return h!==void 0?Promise.resolve(h):u(c,l)}}},Y2=r=>e=>(r[0]=e,r[0]),Z2={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},J2=(r,e,t,n,o,i)=>class extends r{constructor(s,u){const c=n(s),l={...Z2,...u},h=t(c,l),f=o(c)?e():null;super(s,!1,h,f),this._isBufferNullified=!1,this._nativeConvolverNode=h,l.buffer!==null&&i(this,l.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(s){if(this._nativeConvolverNode.buffer=s,s===null&&this._nativeConvolverNode.buffer!==null){const u=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=u.createBuffer(1,1,u.sampleRate),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(s){this._nativeConvolverNode.normalize=s}},Q2=(r,e,t)=>()=>{const n=new WeakMap,o=async(i,a)=>{let s=e(i);if(!Dt(s,a)){const c={buffer:s.buffer,channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,disableNormalization:!s.normalize};s=r(a,c)}return n.set(a,s),Xo(s)?await t(i,a,s.inputs[0]):await t(i,a,s),s};return{render(i,a){const s=n.get(a);return s!==void 0?Promise.resolve(s):o(i,a)}}},eE=(r,e)=>(t,n,o)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,n,o)}catch(i){throw i.name==="SyntaxError"?r():i}},tE=()=>new DOMException("","DataCloneError"),Fd=r=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(n=>{const o=()=>{t.onmessage=null,e.close(),t.close(),n()};t.onmessage=()=>o();try{e.postMessage(r,[r])}catch{}finally{o()}})},nE=(r,e,t,n,o,i,a,s,u,c,l)=>(h,d)=>{const f=a(h)?h:i(h);if(o.has(d)){const p=t();return Promise.reject(p)}try{o.add(d)}catch{}return e(u,()=>u(f))?f.decodeAudioData(d).then(p=>(Fd(d).catch(()=>{}),e(s,()=>s(p))||l(p),r.add(p),p)):new Promise((p,v)=>{const m=async()=>{try{await Fd(d)}catch{}},g=_=>{v(_),m()};try{f.decodeAudioData(d,_=>{typeof _.copyFromChannel!="function"&&(c(_),Rl(_)),r.add(_),m().then(()=>p(_))},_=>{g(_===null?n():_)})}catch(_){g(_)}})},rE=(r,e,t,n,o,i,a,s)=>(u,c)=>{const l=e.get(u);if(l===void 0)throw new Error("Missing the expected cycle count.");const h=i(u.context),d=s(h);if(l===c){if(e.delete(u),!d&&a(u)){const f=n(u),{outputs:p}=t(u);for(const v of p)if(Xi(v)){const m=n(v[0]);r(f,m,v[1],v[2])}else{const m=o(v[0]);f.connect(m,v[1])}}}else e.set(u,l-c)},oE={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},iE=(r,e,t,n,o,i,a)=>class extends r{constructor(u,c){const l=o(u),h={...oE,...c},d=n(l,h),f=i(l),p=f?t(h.maxDelayTime):null;super(u,!1,d,p),this._delayTime=e(this,f,d.delayTime),a(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},aE=(r,e,t,n,o)=>i=>{const a=new WeakMap,s=async(u,c)=>{let l=t(u);const h=Dt(l,c);if(!h){const d={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,delayTime:l.delayTime.value,maxDelayTime:i};l=e(c,d)}return a.set(c,l),h?await r(c,u.delayTime,l.delayTime):await n(c,u.delayTime,l.delayTime),await o(u,c,l),l};return{render(u,c){const l=a.get(c);return l!==void 0?Promise.resolve(l):s(u,c)}}},sE=r=>(e,t,n,o)=>r(e[o],i=>i[0]===t&&i[1]===n),uE=r=>(e,t)=>{r(e).delete(t)},cE=r=>"delayTime"in r,lE=(r,e,t)=>function n(o,i){const a=ns(i)?i:t(r,i);if(cE(a))return[];if(o[0]===a)return[o];if(o.includes(a))return[];const{outputs:s}=e(a);return Array.from(s).map(u=>n([...o,a],u[0])).reduce((u,c)=>u.concat(c),[])},_a=(r,e,t)=>{const n=e[t];if(n===void 0)throw r();return n},hE=r=>(e,t=void 0,n=void 0,o=0)=>t===void 0?e.forEach(i=>i.disconnect()):typeof t=="number"?_a(r,e,t).disconnect():is(t)?n===void 0?e.forEach(i=>i.disconnect(t)):o===void 0?_a(r,e,n).disconnect(t,0):_a(r,e,n).disconnect(t,0,o):n===void 0?e.forEach(i=>i.disconnect(t)):_a(r,e,n).disconnect(t,0),dE={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},fE=(r,e,t,n,o,i,a,s)=>class extends r{constructor(c,l){const h=i(c),d={...dE,...l},f=n(h,d),p=a(h),v=p?t():null;super(c,!1,f,v),this._attack=e(this,p,f.attack),this._knee=e(this,p,f.knee),this._nativeDynamicsCompressorNode=f,this._ratio=e(this,p,f.ratio),this._release=e(this,p,f.release),this._threshold=e(this,p,f.threshold),s(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(c){const l=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=c,c>2)throw this._nativeDynamicsCompressorNode.channelCount=l,o()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(c){const l=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=c,c==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=l,o()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},pE=(r,e,t,n,o)=>()=>{const i=new WeakMap,a=async(s,u)=>{let c=t(s);const l=Dt(c,u);if(!l){const h={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=e(u,h)}return i.set(u,c),l?(await r(u,s.attack,c.attack),await r(u,s.knee,c.knee),await r(u,s.ratio,c.ratio),await r(u,s.release,c.release),await r(u,s.threshold,c.threshold)):(await n(u,s.attack,c.attack),await n(u,s.knee,c.knee),await n(u,s.ratio,c.ratio),await n(u,s.release,c.release),await n(u,s.threshold,c.threshold)),await o(s,u,c),c};return{render(s,u){const c=i.get(u);return c!==void 0?Promise.resolve(c):a(s,u)}}},vE=()=>new DOMException("","EncodingError"),mE=r=>e=>new Promise((t,n)=>{if(r===null){n(new SyntaxError);return}const o=r.document.head;if(o===null)n(new SyntaxError);else{const i=r.document.createElement("script"),a=new Blob([e],{type:"application/javascript"}),s=URL.createObjectURL(a),u=r.onerror,c=()=>{r.onerror=u,URL.revokeObjectURL(s)};r.onerror=(l,h,d,f,p)=>{if(h===s||h===r.location.href&&d===1&&f===1)return c(),n(p),!1;if(u!==null)return u(l,h,d,f,p)},i.onerror=()=>{c(),n(new SyntaxError)},i.onload=()=>{c(),t()},i.src=s,i.type="module",o.appendChild(i)}}),gE=r=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,n,o){if(n!==null){let i=this._listeners.get(n);i===void 0&&(i=r(this,n),typeof n=="function"&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(t,i,o)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,n,o){const i=n===null?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(t,i===void 0?null:i,o)}},yE=r=>(e,t,n)=>{Object.defineProperties(r,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return n()}finally{r!==null&&(delete r.currentFrame,delete r.currentTime)}},_E=r=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw r()},bE={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},xE=(r,e,t,n,o,i)=>class extends r{constructor(s,u){const c=o(s),l={...bE,...u},h=n(c,l),d=i(c),f=d?t():null;super(s,!1,h,f),this._gain=e(this,d,h.gain,Ft,Lt)}get gain(){return this._gain}},wE=(r,e,t,n,o)=>()=>{const i=new WeakMap,a=async(s,u)=>{let c=t(s);const l=Dt(c,u);if(!l){const h={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=e(u,h)}return i.set(u,c),l?await r(u,s.gain,c.gain):await n(u,s.gain,c.gain),await o(s,u,c),c};return{render(s,u){const c=i.get(u);return c!==void 0?Promise.resolve(c):a(s,u)}}},CE=(r,e)=>t=>e(r,t),EE=r=>e=>{const t=r(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},SE=r=>e=>{var t;return(t=r.get(e))!==null&&t!==void 0?t:0},TE=r=>e=>{const t=r(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},kE=r=>e=>r.get(e),mt=()=>new DOMException("","InvalidStateError"),AE=r=>e=>{const t=r.get(e);if(t===void 0)throw mt();return t},IE=(r,e)=>t=>{let n=r.get(t);if(n!==void 0)return n;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),r.set(t,n),n},RE=r=>e=>{const t=r.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},Rs=()=>new DOMException("","InvalidAccessError"),NE=r=>{r.getFrequencyResponse=(e=>(t,n,o)=>{if(t.length!==n.length||n.length!==o.length)throw Rs();return e.call(r,t,n,o)})(r.getFrequencyResponse)},DE={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},OE=(r,e,t,n,o,i)=>class extends r{constructor(s,u){const c=n(s),l=o(c),h={...DE,...u},d=e(c,l?null:s.baseLatency,h),f=l?t(h.feedback,h.feedforward):null;super(s,!1,d,f),NE(d),this._nativeIIRFilterNode=d,i(this,1)}getFrequencyResponse(s,u,c){return this._nativeIIRFilterNode.getFrequencyResponse(s,u,c)}},Wv=(r,e,t,n,o,i,a,s,u,c,l)=>{const h=c.length;let d=s;for(let f=0;f<h;f+=1){let p=t[0]*c[f];for(let v=1;v<o;v+=1){const m=d-v&u-1;p+=t[v]*i[m],p-=r[v]*a[m]}for(let v=o;v<n;v+=1)p+=t[v]*i[d-v&u-1];for(let v=o;v<e;v+=1)p-=r[v]*a[d-v&u-1];i[d]=c[f],a[d]=p,d=d+1&u-1,l[f]=p}return d},FE=(r,e,t,n)=>{const o=t instanceof Float64Array?t:new Float64Array(t),i=n instanceof Float64Array?n:new Float64Array(n),a=o.length,s=i.length,u=Math.min(a,s);if(o[0]!==1){for(let p=0;p<a;p+=1)i[p]/=o[0];for(let p=1;p<s;p+=1)o[p]/=o[0]}const c=32,l=new Float32Array(c),h=new Float32Array(c),d=e.createBuffer(r.numberOfChannels,r.length,r.sampleRate),f=r.numberOfChannels;for(let p=0;p<f;p+=1){const v=r.getChannelData(p),m=d.getChannelData(p);l.fill(0),h.fill(0),Wv(o,a,i,s,u,l,h,0,c,v,m)}return d},ME=(r,e,t,n,o)=>(i,a)=>{const s=new WeakMap;let u=null;const c=async(l,h)=>{let d=null,f=e(l);const p=Dt(f,h);if(h.createIIRFilter===void 0?d=r(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(f=h.createIIRFilter(a,i)),s.set(h,d===null?f:d),d!==null){if(u===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const m=new t(l.context.destination.channelCount,l.context.length,h.sampleRate);u=(async()=>{await n(l,m,m.destination);const g=await o(m);return FE(g,h,i,a)})()}const v=await u;return d.buffer=v,d.start(0),d}return await n(l,h,f),f};return{render(l,h){const d=s.get(h);return d!==void 0?Promise.resolve(d):c(l,h)}}},PE=(r,e,t,n,o,i)=>a=>(s,u)=>{const c=r.get(s);if(c===void 0){if(!a&&i(s)){const l=n(s),{outputs:h}=t(s);for(const d of h)if(Xi(d)){const f=n(d[0]);e(l,f,d[1],d[2])}else{const f=o(d[0]);l.disconnect(f,d[1])}}r.set(s,u)}else r.set(s,c+u)},BE=(r,e)=>t=>{const n=r.get(t);return e(n)||e(t)},LE=(r,e)=>t=>r.has(t)||e(t),WE=(r,e)=>t=>r.has(t)||e(t),VE=(r,e)=>t=>{const n=r.get(t);return e(n)||e(t)},UE=r=>e=>r!==null&&e instanceof r,zE=r=>e=>r!==null&&typeof r.AudioNode=="function"&&e instanceof r.AudioNode,GE=r=>e=>r!==null&&typeof r.AudioParam=="function"&&e instanceof r.AudioParam,qE=(r,e)=>t=>r(t)||e(t),HE=r=>e=>r!==null&&e instanceof r,jE=r=>r!==null&&r.isSecureContext,XE=(r,e,t,n)=>class extends r{constructor(i,a){const s=t(i),u=e(s,a);if(n(s))throw TypeError();super(i,!0,u,null),this._nativeMediaElementAudioSourceNode=u}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},KE={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},$E=(r,e,t,n)=>class extends r{constructor(i,a){const s=t(i);if(n(s))throw new TypeError;const u={...KE,...a},c=e(s,u);super(i,!1,c,null),this._nativeMediaStreamAudioDestinationNode=c}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},YE=(r,e,t,n)=>class extends r{constructor(i,a){const s=t(i),u=e(s,a);if(n(s))throw new TypeError;super(i,!0,u,null),this._nativeMediaStreamAudioSourceNode=u}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},ZE=(r,e,t)=>class extends r{constructor(o,i){const a=t(o),s=e(a,i);super(o,!0,s,null)}},JE=(r,e,t,n,o,i)=>class extends t{constructor(s,u){super(s),this._nativeContext=s,As.set(this,s),n(s)&&o.set(s,new Set),this._destination=new r(this,u),this._listener=e(this,s),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(s){const u=typeof s=="function"?i(this,s):null;this._nativeContext.onstatechange=u;const c=this._nativeContext.onstatechange;this._onstatechange=c!==null&&c===u?s:c}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},Ni=r=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=r.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},QE=(r,e)=>(t,n,o)=>{const i=new Set;return t.connect=(a=>(s,u=0,c=0)=>{const l=i.size===0;if(e(s))return a.call(t,s,u,c),r(i,[s,u,c],h=>h[0]===s&&h[1]===u&&h[2]===c,!0),l&&n(),s;a.call(t,s,u),r(i,[s,u],h=>h[0]===s&&h[1]===u,!0),l&&n()})(t.connect),t.disconnect=(a=>(s,u,c)=>{const l=i.size>0;if(s===void 0)a.apply(t),i.clear();else if(typeof s=="number"){a.call(t,s);for(const d of i)d[1]===s&&i.delete(d)}else{e(s)?a.call(t,s,u,c):a.call(t,s,u);for(const d of i)d[0]===s&&(u===void 0||d[1]===u)&&(c===void 0||d[2]===c)&&i.delete(d)}const h=i.size===0;l&&h&&o()})(t.disconnect),t},Ge=(r,e,t)=>{const n=e[t];n!==void 0&&n!==r[t]&&(r[t]=n)},dt=(r,e)=>{Ge(r,e,"channelCount"),Ge(r,e,"channelCountMode"),Ge(r,e,"channelInterpretation")},Md=r=>typeof r.getFloatTimeDomainData=="function",eS=r=>{r.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);r.getByteTimeDomainData(t);const n=Math.max(t.length,r.fftSize);for(let o=0;o<n;o+=1)e[o]=(t[o]-128)*.0078125;return e}},tS=(r,e)=>(t,n)=>{const o=t.createAnalyser();if(dt(o,n),!(n.maxDecibels>n.minDecibels))throw e();return Ge(o,n,"fftSize"),Ge(o,n,"maxDecibels"),Ge(o,n,"minDecibels"),Ge(o,n,"smoothingTimeConstant"),r(Md,()=>Md(o))||eS(o),o},nS=r=>r===null?null:r.hasOwnProperty("AudioBuffer")?r.AudioBuffer:null,Ye=(r,e,t)=>{const n=e[t];n!==void 0&&n!==r[t].value&&(r[t].value=n)},rS=r=>{r.start=(e=>{let t=!1;return(n=0,o=0,i)=>{if(t)throw mt();e.call(r,n,o,i),t=!0}})(r.start)},Ol=r=>{r.start=(e=>(t=0,n=0,o)=>{if(typeof o=="number"&&o<0||n<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(r,t,n,o)})(r.start)},Fl=r=>{r.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(r,t)})(r.stop)},oS=(r,e,t,n,o,i,a,s,u,c,l)=>(h,d)=>{const f=h.createBufferSource();return dt(f,d),Ye(f,d,"playbackRate"),Ge(f,d,"buffer"),Ge(f,d,"loop"),Ge(f,d,"loopEnd"),Ge(f,d,"loopStart"),e(t,()=>t(h))||rS(f),e(n,()=>n(h))||u(f),e(o,()=>o(h))||c(f,h),e(i,()=>i(h))||Ol(f),e(a,()=>a(h))||l(f,h),e(s,()=>s(h))||Fl(f),r(h,f),f},iS=r=>r===null?null:r.hasOwnProperty("AudioContext")?r.AudioContext:r.hasOwnProperty("webkitAudioContext")?r.webkitAudioContext:null,aS=(r,e)=>(t,n,o)=>{const i=t.destination;if(i.channelCount!==n)try{i.channelCount=n}catch{}o&&i.channelCountMode!=="explicit"&&(i.channelCountMode="explicit"),i.maxChannelCount===0&&Object.defineProperty(i,"maxChannelCount",{value:n});const a=r(t,{channelCount:n,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return e(a,"channelCount",s=>()=>s.call(a),s=>u=>{s.call(a,u);try{i.channelCount=u}catch(c){if(u>i.maxChannelCount)throw c}}),e(a,"channelCountMode",s=>()=>s.call(a),s=>u=>{s.call(a,u),i.channelCountMode=u}),e(a,"channelInterpretation",s=>()=>s.call(a),s=>u=>{s.call(a,u),i.channelInterpretation=u}),Object.defineProperty(a,"maxChannelCount",{get:()=>i.maxChannelCount}),a.connect(i),a},sS=r=>r===null?null:r.hasOwnProperty("AudioWorkletNode")?r.AudioWorkletNode:null,uS=r=>{const{port1:e}=new MessageChannel;try{e.postMessage(r)}finally{e.close()}},cS=(r,e,t,n,o)=>(i,a,s,u,c,l)=>{if(s!==null)try{const h=new s(i,u,l),d=new Map;let f=null;if(Object.defineProperties(h,{channelCount:{get:()=>l.channelCount,set:()=>{throw r()}},channelCountMode:{get:()=>"explicit",set:()=>{throw r()}},onprocessorerror:{get:()=>f,set:p=>{typeof f=="function"&&h.removeEventListener("processorerror",f),f=typeof p=="function"?p:null,typeof f=="function"&&h.addEventListener("processorerror",f)}}}),h.addEventListener=(p=>(...v)=>{if(v[0]==="processorerror"){const m=typeof v[1]=="function"?v[1]:typeof v[1]=="object"&&v[1]!==null&&typeof v[1].handleEvent=="function"?v[1].handleEvent:null;if(m!==null){const g=d.get(v[1]);g!==void 0?v[1]=g:(v[1]=_=>{_.type==="error"?(Object.defineProperties(_,{type:{value:"processorerror"}}),m(_)):m(new ErrorEvent(v[0],{..._}))},d.set(m,v[1]))}}return p.call(h,"error",v[1],v[2]),p.call(h,...v)})(h.addEventListener),h.removeEventListener=(p=>(...v)=>{if(v[0]==="processorerror"){const m=d.get(v[1]);m!==void 0&&(d.delete(v[1]),v[1]=m)}return p.call(h,"error",v[1],v[2]),p.call(h,v[0],v[1],v[2])})(h.removeEventListener),l.numberOfOutputs!==0){const p=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(i.destination),o(h,()=>p.disconnect(),()=>p.connect(i.destination))}return h}catch(h){throw h.code===11?n():h}if(c===void 0)throw n();return uS(l),e(i,a,c,l)},Vv=(r,e)=>r===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(r*e))))),lS=r=>new Promise((e,t)=>{const{port1:n,port2:o}=new MessageChannel;n.onmessage=({data:i})=>{n.close(),o.close(),e(i)},n.onmessageerror=({data:i})=>{n.close(),o.close(),t(i)},o.postMessage(r)}),hS=async(r,e)=>{const t=await lS(e);return new r(t)},dS=(r,e,t,n)=>{let o=oc.get(r);o===void 0&&(o=new WeakMap,oc.set(r,o));const i=hS(t,n);return o.set(e,i),i},fS=(r,e,t,n,o,i,a,s,u,c,l,h,d)=>(f,p,v,m)=>{if(m.numberOfInputs===0&&m.numberOfOutputs===0)throw u();const g=Array.isArray(m.outputChannelCount)?m.outputChannelCount:Array.from(m.outputChannelCount);if(g.some(K=>K<1))throw u();if(g.length!==m.numberOfOutputs)throw e();if(m.channelCountMode!=="explicit")throw u();const _=m.channelCount*m.numberOfInputs,x=g.reduce((K,Q)=>K+Q,0),b=v.parameterDescriptors===void 0?0:v.parameterDescriptors.length;if(_+b>6||x>6)throw u();const y=new MessageChannel,w=[],E=[];for(let K=0;K<m.numberOfInputs;K+=1)w.push(a(f,{channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation,gain:1})),E.push(o(f,{channelCount:m.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:m.channelCount}));const C=[];if(v.parameterDescriptors!==void 0)for(const{defaultValue:K,maxValue:Q,minValue:Ie,name:Se}of v.parameterDescriptors){const de=i(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:m.parameterData[Se]!==void 0?m.parameterData[Se]:K===void 0?0:K});Object.defineProperties(de.offset,{defaultValue:{get:()=>K===void 0?0:K},maxValue:{get:()=>Q===void 0?Ft:Q},minValue:{get:()=>Ie===void 0?Lt:Ie}}),C.push(de)}const T=n(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,_+b)}),S=Vv(p,f.sampleRate),I=s(f,S,_+b,Math.max(1,x)),A=o(f,{channelCount:Math.max(1,x),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,x)}),F=[];for(let K=0;K<m.numberOfOutputs;K+=1)F.push(n(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:g[K]}));for(let K=0;K<m.numberOfInputs;K+=1){w[K].connect(E[K]);for(let Q=0;Q<m.channelCount;Q+=1)E[K].connect(T,Q,K*m.channelCount+Q)}const O=new Bv(v.parameterDescriptors===void 0?[]:v.parameterDescriptors.map(({name:K},Q)=>{const Ie=C[Q];return Ie.connect(T,0,_+Q),Ie.start(0),[K,Ie.offset]}));T.connect(I);let M=m.channelInterpretation,B=null;const P=m.numberOfOutputs===0?[I]:F,L={get bufferSize(){return S},get channelCount(){return m.channelCount},set channelCount(K){throw t()},get channelCountMode(){return m.channelCountMode},set channelCountMode(K){throw t()},get channelInterpretation(){return M},set channelInterpretation(K){for(const Q of w)Q.channelInterpretation=K;M=K},get context(){return I.context},get inputs(){return w},get numberOfInputs(){return m.numberOfInputs},get numberOfOutputs(){return m.numberOfOutputs},get onprocessorerror(){return B},set onprocessorerror(K){typeof B=="function"&&L.removeEventListener("processorerror",B),B=typeof K=="function"?K:null,typeof B=="function"&&L.addEventListener("processorerror",B)},get parameters(){return O},get port(){return y.port2},addEventListener(...K){return I.addEventListener(K[0],K[1],K[2])},connect:r.bind(null,P),disconnect:c.bind(null,P),dispatchEvent(...K){return I.dispatchEvent(K[0])},removeEventListener(...K){return I.removeEventListener(K[0],K[1],K[2])}},W=new Map;y.port1.addEventListener=(K=>(...Q)=>{if(Q[0]==="message"){const Ie=typeof Q[1]=="function"?Q[1]:typeof Q[1]=="object"&&Q[1]!==null&&typeof Q[1].handleEvent=="function"?Q[1].handleEvent:null;if(Ie!==null){const Se=W.get(Q[1]);Se!==void 0?Q[1]=Se:(Q[1]=de=>{l(f.currentTime,f.sampleRate,()=>Ie(de))},W.set(Ie,Q[1]))}}return K.call(y.port1,Q[0],Q[1],Q[2])})(y.port1.addEventListener),y.port1.removeEventListener=(K=>(...Q)=>{if(Q[0]==="message"){const Ie=W.get(Q[1]);Ie!==void 0&&(W.delete(Q[1]),Q[1]=Ie)}return K.call(y.port1,Q[0],Q[1],Q[2])})(y.port1.removeEventListener);let z=null;Object.defineProperty(y.port1,"onmessage",{get:()=>z,set:K=>{typeof z=="function"&&y.port1.removeEventListener("message",z),z=typeof K=="function"?K:null,typeof z=="function"&&(y.port1.addEventListener("message",z),y.port1.start())}}),v.prototype.port=y.port1;let H=null;dS(f,L,v,m).then(K=>H=K);const te=ss(m.numberOfInputs,m.channelCount),ce=ss(m.numberOfOutputs,g),Z=v.parameterDescriptors===void 0?[]:v.parameterDescriptors.reduce((K,{name:Q})=>({...K,[Q]:new Float32Array(128)}),{});let oe=!0;const le=()=>{m.numberOfOutputs>0&&I.disconnect(A);for(let K=0,Q=0;K<m.numberOfOutputs;K+=1){const Ie=F[K];for(let Se=0;Se<g[K];Se+=1)A.disconnect(Ie,Q+Se,Se);Q+=g[K]}},$=new Map;I.onaudioprocess=({inputBuffer:K,outputBuffer:Q})=>{if(H!==null){const Ie=h(L);for(let Se=0;Se<S;Se+=128){for(let de=0;de<m.numberOfInputs;de+=1)for(let Oe=0;Oe<m.channelCount;Oe+=1)as(K,te[de],Oe,Oe,Se);v.parameterDescriptors!==void 0&&v.parameterDescriptors.forEach(({name:de},Oe)=>{as(K,Z,de,_+Oe,Se)});for(let de=0;de<m.numberOfInputs;de+=1)for(let Oe=0;Oe<g[de];Oe+=1)ce[de][Oe].byteLength===0&&(ce[de][Oe]=new Float32Array(128));try{const de=te.map((Ke,_t)=>{if(Ie[_t].size>0)return $.set(_t,S/128),Ke;const Tn=$.get(_t);return Tn===void 0?[]:(Ke.every(ln=>ln.every(ei=>ei===0))&&(Tn===1?$.delete(_t):$.set(_t,Tn-1)),Ke)});oe=l(f.currentTime+Se/f.sampleRate,f.sampleRate,()=>H.process(de,ce,Z));for(let Ke=0,_t=0;Ke<m.numberOfOutputs;Ke+=1){for(let Ot=0;Ot<g[Ke];Ot+=1)Lv(Q,ce[Ke],Ot,_t+Ot,Se);_t+=g[Ke]}}catch(de){oe=!1,L.dispatchEvent(new ErrorEvent("processorerror",{colno:de.colno,filename:de.filename,lineno:de.lineno,message:de.message}))}if(!oe){for(let de=0;de<m.numberOfInputs;de+=1){w[de].disconnect(E[de]);for(let Oe=0;Oe<m.channelCount;Oe+=1)E[Se].disconnect(T,Oe,de*m.channelCount+Oe)}if(v.parameterDescriptors!==void 0){const de=v.parameterDescriptors.length;for(let Oe=0;Oe<de;Oe+=1){const Ke=C[Oe];Ke.disconnect(T,0,_+Oe),Ke.stop()}}T.disconnect(I),I.onaudioprocess=null,ve?le():Ee();break}}}};let ve=!1;const De=a(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),me=()=>I.connect(De).connect(f.destination),Ee=()=>{I.disconnect(De),De.disconnect()},ke=()=>{if(oe){Ee(),m.numberOfOutputs>0&&I.connect(A);for(let K=0,Q=0;K<m.numberOfOutputs;K+=1){const Ie=F[K];for(let Se=0;Se<g[K];Se+=1)A.connect(Ie,Q+Se,Se);Q+=g[K]}}ve=!0},ze=()=>{oe&&(me(),le()),ve=!1};return me(),d(L,ke,ze)},Uv=(r,e)=>{const t=r.createBiquadFilter();return dt(t,e),Ye(t,e,"Q"),Ye(t,e,"detune"),Ye(t,e,"frequency"),Ye(t,e,"gain"),Ge(t,e,"type"),t},pS=(r,e)=>(t,n)=>{const o=t.createChannelMerger(n.numberOfInputs);return r!==null&&r.name==="webkitAudioContext"&&e(t,o),dt(o,n),o},vS=r=>{const e=r.numberOfOutputs;Object.defineProperty(r,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw mt()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw mt()}}),Object.defineProperty(r,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw mt()}})},Ki=(r,e)=>{const t=r.createChannelSplitter(e.numberOfOutputs);return dt(t,e),vS(t),t},mS=(r,e,t,n,o)=>(i,a)=>{if(i.createConstantSource===void 0)return t(i,a);const s=i.createConstantSource();return dt(s,a),Ye(s,a,"offset"),e(n,()=>n(i))||Ol(s),e(o,()=>o(i))||Fl(s),r(i,s),s},Ko=(r,e)=>(r.connect=e.connect.bind(e),r.disconnect=e.disconnect.bind(e),r),gS=(r,e,t,n)=>(o,{offset:i,...a})=>{const s=o.createBuffer(1,2,44100),u=e(o,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=t(o,{...a,gain:i}),l=s.getChannelData(0);l[0]=1,l[1]=1,u.buffer=s,u.loop=!0;const h={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(p){c.channelCount=p},get channelCountMode(){return c.channelCountMode},set channelCountMode(p){c.channelCountMode=p},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(p){c.channelInterpretation=p},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return u.onended},set onended(p){u.onended=p},addEventListener(...p){return u.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return u.dispatchEvent(p[0])},removeEventListener(...p){return u.removeEventListener(p[0],p[1],p[2])},start(p=0){u.start.call(u,p)},stop(p=0){u.stop.call(u,p)}},d=()=>u.connect(c),f=()=>u.disconnect(c);return r(o,u),n(Ko(h,c),d,f)},yS=(r,e)=>(t,n)=>{const o=t.createConvolver();if(dt(o,n),n.disableNormalization===o.normalize&&(o.normalize=!n.disableNormalization),Ge(o,n,"buffer"),n.channelCount>2||(e(o,"channelCount",i=>()=>i.call(o),i=>a=>{if(a>2)throw r();return i.call(o,a)}),n.channelCountMode==="max"))throw r();return e(o,"channelCountMode",i=>()=>i.call(o),i=>a=>{if(a==="max")throw r();return i.call(o,a)}),o},zv=(r,e)=>{const t=r.createDelay(e.maxDelayTime);return dt(t,e),Ye(t,e,"delayTime"),t},_S=r=>(e,t)=>{const n=e.createDynamicsCompressor();if(dt(n,t),t.channelCount>2||t.channelCountMode==="max")throw r();return Ye(n,t,"attack"),Ye(n,t,"knee"),Ye(n,t,"ratio"),Ye(n,t,"release"),Ye(n,t,"threshold"),n},qt=(r,e)=>{const t=r.createGain();return dt(t,e),Ye(t,e,"gain"),t},bS=r=>(e,t,n)=>{if(e.createIIRFilter===void 0)return r(e,t,n);const o=e.createIIRFilter(n.feedforward,n.feedback);return dt(o,n),o};function xS(r,e){const t=e[0]*e[0]+e[1]*e[1];return[(r[0]*e[0]+r[1]*e[1])/t,(r[1]*e[0]-r[0]*e[1])/t]}function wS(r,e){return[r[0]*e[0]-r[1]*e[1],r[0]*e[1]+r[1]*e[0]]}function Pd(r,e){let t=[0,0];for(let n=r.length-1;n>=0;n-=1)t=wS(t,e),t[0]+=r[n];return t}const CS=(r,e,t,n)=>(o,i,{channelCount:a,channelCountMode:s,channelInterpretation:u,feedback:c,feedforward:l})=>{const h=Vv(i,o.sampleRate),d=c instanceof Float64Array?c:new Float64Array(c),f=l instanceof Float64Array?l:new Float64Array(l),p=d.length,v=f.length,m=Math.min(p,v);if(p===0||p>20)throw n();if(d[0]===0)throw e();if(v===0||v>20)throw n();if(f[0]===0)throw e();if(d[0]!==1){for(let C=0;C<v;C+=1)f[C]/=d[0];for(let C=1;C<p;C+=1)d[C]/=d[0]}const g=t(o,h,a,a);g.channelCount=a,g.channelCountMode=s,g.channelInterpretation=u;const _=32,x=[],b=[],y=[];for(let C=0;C<a;C+=1){x.push(0);const T=new Float32Array(_),S=new Float32Array(_);T.fill(0),S.fill(0),b.push(T),y.push(S)}g.onaudioprocess=C=>{const T=C.inputBuffer,S=C.outputBuffer,I=T.numberOfChannels;for(let A=0;A<I;A+=1){const F=T.getChannelData(A),O=S.getChannelData(A);x[A]=Wv(d,p,f,v,m,b[A],y[A],x[A],_,F,O)}};const w=o.sampleRate/2;return Ko({get bufferSize(){return h},get channelCount(){return g.channelCount},set channelCount(C){g.channelCount=C},get channelCountMode(){return g.channelCountMode},set channelCountMode(C){g.channelCountMode=C},get channelInterpretation(){return g.channelInterpretation},set channelInterpretation(C){g.channelInterpretation=C},get context(){return g.context},get inputs(){return[g]},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},addEventListener(...C){return g.addEventListener(C[0],C[1],C[2])},dispatchEvent(...C){return g.dispatchEvent(C[0])},getFrequencyResponse(C,T,S){if(C.length!==T.length||T.length!==S.length)throw r();const I=C.length;for(let A=0;A<I;A+=1){const F=-Math.PI*(C[A]/w),O=[Math.cos(F),Math.sin(F)],M=Pd(f,O),B=Pd(d,O),P=xS(M,B);T[A]=Math.sqrt(P[0]*P[0]+P[1]*P[1]),S[A]=Math.atan2(P[1],P[0])}},removeEventListener(...C){return g.removeEventListener(C[0],C[1],C[2])}},g)},ES=(r,e)=>r.createMediaElementSource(e.mediaElement),SS=(r,e)=>{const t=r.createMediaStreamDestination();return dt(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},TS=(r,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((i,a)=>i.id<a.id?-1:i.id>a.id?1:0);const n=t.slice(0,1),o=r.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(o,"mediaStream",{value:e}),o},kS=(r,e)=>(t,{mediaStreamTrack:n})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(n);const o=new MediaStream([n]),i=t.createMediaStreamSource(o);if(n.kind!=="audio")throw r();if(e(t))throw new TypeError;return i},AS=r=>r===null?null:r.hasOwnProperty("OfflineAudioContext")?r.OfflineAudioContext:r.hasOwnProperty("webkitOfflineAudioContext")?r.webkitOfflineAudioContext:null,IS=(r,e,t,n,o,i)=>(a,s)=>{const u=a.createOscillator();return dt(u,s),Ye(u,s,"detune"),Ye(u,s,"frequency"),s.periodicWave!==void 0?u.setPeriodicWave(s.periodicWave):Ge(u,s,"type"),e(t,()=>t(a))||Ol(u),e(n,()=>n(a))||i(u,a),e(o,()=>o(a))||Fl(u),r(a,u),u},RS=r=>(e,t)=>{const n=e.createPanner();return n.orientationX===void 0?r(e,t):(dt(n,t),Ye(n,t,"orientationX"),Ye(n,t,"orientationY"),Ye(n,t,"orientationZ"),Ye(n,t,"positionX"),Ye(n,t,"positionY"),Ye(n,t,"positionZ"),Ge(n,t,"coneInnerAngle"),Ge(n,t,"coneOuterAngle"),Ge(n,t,"coneOuterGain"),Ge(n,t,"distanceModel"),Ge(n,t,"maxDistance"),Ge(n,t,"panningModel"),Ge(n,t,"refDistance"),Ge(n,t,"rolloffFactor"),n)},NS=(r,e,t,n,o,i,a,s,u,c)=>(l,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:f,distanceModel:p,maxDistance:v,orientationX:m,orientationY:g,orientationZ:_,panningModel:x,positionX:b,positionY:y,positionZ:w,refDistance:E,rolloffFactor:C,...T})=>{const S=l.createPanner();if(T.channelCount>2||T.channelCountMode==="max")throw a();dt(S,T);const I={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},A=t(l,{...I,channelInterpretation:"speakers",numberOfInputs:6}),F=n(l,{...T,gain:1}),O=n(l,{...I,gain:1}),M=n(l,{...I,gain:0}),B=n(l,{...I,gain:0}),P=n(l,{...I,gain:0}),L=n(l,{...I,gain:0}),W=n(l,{...I,gain:0}),z=o(l,256,6,1),H=i(l,{...I,curve:new Float32Array([1,1]),oversample:"none"});let Y=[m,g,_],te=[b,y,w];const ce=new Float32Array(1);z.onaudioprocess=({inputBuffer:$})=>{const ve=[u($,ce,0),u($,ce,1),u($,ce,2)];ve.some((me,Ee)=>me!==Y[Ee])&&(S.setOrientation(...ve),Y=ve);const De=[u($,ce,3),u($,ce,4),u($,ce,5)];De.some((me,Ee)=>me!==te[Ee])&&(S.setPosition(...De),te=De)},Object.defineProperty(M.gain,"defaultValue",{get:()=>0}),Object.defineProperty(B.gain,"defaultValue",{get:()=>0}),Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(L.gain,"defaultValue",{get:()=>0}),Object.defineProperty(W.gain,"defaultValue",{get:()=>0});const Z={get bufferSize(){},get channelCount(){return S.channelCount},set channelCount($){if($>2)throw a();F.channelCount=$,S.channelCount=$},get channelCountMode(){return S.channelCountMode},set channelCountMode($){if($==="max")throw a();F.channelCountMode=$,S.channelCountMode=$},get channelInterpretation(){return S.channelInterpretation},set channelInterpretation($){F.channelInterpretation=$,S.channelInterpretation=$},get coneInnerAngle(){return S.coneInnerAngle},set coneInnerAngle($){S.coneInnerAngle=$},get coneOuterAngle(){return S.coneOuterAngle},set coneOuterAngle($){S.coneOuterAngle=$},get coneOuterGain(){return S.coneOuterGain},set coneOuterGain($){if($<0||$>1)throw e();S.coneOuterGain=$},get context(){return S.context},get distanceModel(){return S.distanceModel},set distanceModel($){S.distanceModel=$},get inputs(){return[F]},get maxDistance(){return S.maxDistance},set maxDistance($){if($<0)throw new RangeError;S.maxDistance=$},get numberOfInputs(){return S.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},get orientationX(){return O.gain},get orientationY(){return M.gain},get orientationZ(){return B.gain},get panningModel(){return S.panningModel},set panningModel($){S.panningModel=$},get positionX(){return P.gain},get positionY(){return L.gain},get positionZ(){return W.gain},get refDistance(){return S.refDistance},set refDistance($){if($<0)throw new RangeError;S.refDistance=$},get rolloffFactor(){return S.rolloffFactor},set rolloffFactor($){if($<0)throw new RangeError;S.rolloffFactor=$},addEventListener(...$){return F.addEventListener($[0],$[1],$[2])},dispatchEvent(...$){return F.dispatchEvent($[0])},removeEventListener(...$){return F.removeEventListener($[0],$[1],$[2])}};h!==Z.coneInnerAngle&&(Z.coneInnerAngle=h),d!==Z.coneOuterAngle&&(Z.coneOuterAngle=d),f!==Z.coneOuterGain&&(Z.coneOuterGain=f),p!==Z.distanceModel&&(Z.distanceModel=p),v!==Z.maxDistance&&(Z.maxDistance=v),m!==Z.orientationX.value&&(Z.orientationX.value=m),g!==Z.orientationY.value&&(Z.orientationY.value=g),_!==Z.orientationZ.value&&(Z.orientationZ.value=_),x!==Z.panningModel&&(Z.panningModel=x),b!==Z.positionX.value&&(Z.positionX.value=b),y!==Z.positionY.value&&(Z.positionY.value=y),w!==Z.positionZ.value&&(Z.positionZ.value=w),E!==Z.refDistance&&(Z.refDistance=E),C!==Z.rolloffFactor&&(Z.rolloffFactor=C),(Y[0]!==1||Y[1]!==0||Y[2]!==0)&&S.setOrientation(...Y),(te[0]!==0||te[1]!==0||te[2]!==0)&&S.setPosition(...te);const oe=()=>{F.connect(S),r(F,H,0,0),H.connect(O).connect(A,0,0),H.connect(M).connect(A,0,1),H.connect(B).connect(A,0,2),H.connect(P).connect(A,0,3),H.connect(L).connect(A,0,4),H.connect(W).connect(A,0,5),A.connect(z).connect(l.destination)},le=()=>{F.disconnect(S),s(F,H,0,0),H.disconnect(O),O.disconnect(A),H.disconnect(M),M.disconnect(A),H.disconnect(B),B.disconnect(A),H.disconnect(P),P.disconnect(A),H.disconnect(L),L.disconnect(A),H.disconnect(W),W.disconnect(A),A.disconnect(z),z.disconnect(l.destination)};return c(Ko(Z,S),oe,le)},DS=r=>(e,{disableNormalization:t,imag:n,real:o})=>{const i=n instanceof Float32Array?n:new Float32Array(n),a=o instanceof Float32Array?o:new Float32Array(o),s=e.createPeriodicWave(a,i,{disableNormalization:t});if(Array.from(n).length<2)throw r();return s},$i=(r,e,t,n)=>r.createScriptProcessor(e,t,n),OS=(r,e)=>(t,n)=>{const o=n.channelCountMode;if(o==="clamped-max")throw e();if(t.createStereoPanner===void 0)return r(t,n);const i=t.createStereoPanner();return dt(i,n),Ye(i,n,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>o,set:a=>{if(a!==o)throw e()}}),i},FS=(r,e,t,n,o,i)=>{const s=new Float32Array([1,1]),u=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},l={...c,oversample:"none"},h=(p,v,m,g)=>{const _=new Float32Array(16385),x=new Float32Array(16385);for(let T=0;T<16385;T+=1){const S=T/16384*u;_[T]=Math.cos(S),x[T]=Math.sin(S)}const b=t(p,{...c,gain:0}),y=n(p,{...l,curve:_}),w=n(p,{...l,curve:s}),E=t(p,{...c,gain:0}),C=n(p,{...l,curve:x});return{connectGraph(){v.connect(b),v.connect(w.inputs===void 0?w:w.inputs[0]),v.connect(E),w.connect(m),m.connect(y.inputs===void 0?y:y.inputs[0]),m.connect(C.inputs===void 0?C:C.inputs[0]),y.connect(b.gain),C.connect(E.gain),b.connect(g,0,0),E.connect(g,0,1)},disconnectGraph(){v.disconnect(b),v.disconnect(w.inputs===void 0?w:w.inputs[0]),v.disconnect(E),w.disconnect(m),m.disconnect(y.inputs===void 0?y:y.inputs[0]),m.disconnect(C.inputs===void 0?C:C.inputs[0]),y.disconnect(b.gain),C.disconnect(E.gain),b.disconnect(g,0,0),E.disconnect(g,0,1)}}},d=(p,v,m,g)=>{const _=new Float32Array(16385),x=new Float32Array(16385),b=new Float32Array(16385),y=new Float32Array(16385),w=Math.floor(16385/2);for(let P=0;P<16385;P+=1)if(P>w){const L=(P-w)/(16384-w)*u;_[P]=Math.cos(L),x[P]=Math.sin(L),b[P]=0,y[P]=1}else{const L=P/(16384-w)*u;_[P]=1,x[P]=0,b[P]=Math.cos(L),y[P]=Math.sin(L)}const E=e(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),C=t(p,{...c,gain:0}),T=n(p,{...l,curve:_}),S=t(p,{...c,gain:0}),I=n(p,{...l,curve:x}),A=n(p,{...l,curve:s}),F=t(p,{...c,gain:0}),O=n(p,{...l,curve:b}),M=t(p,{...c,gain:0}),B=n(p,{...l,curve:y});return{connectGraph(){v.connect(E),v.connect(A.inputs===void 0?A:A.inputs[0]),E.connect(C,0),E.connect(S,0),E.connect(F,1),E.connect(M,1),A.connect(m),m.connect(T.inputs===void 0?T:T.inputs[0]),m.connect(I.inputs===void 0?I:I.inputs[0]),m.connect(O.inputs===void 0?O:O.inputs[0]),m.connect(B.inputs===void 0?B:B.inputs[0]),T.connect(C.gain),I.connect(S.gain),O.connect(F.gain),B.connect(M.gain),C.connect(g,0,0),F.connect(g,0,0),S.connect(g,0,1),M.connect(g,0,1)},disconnectGraph(){v.disconnect(E),v.disconnect(A.inputs===void 0?A:A.inputs[0]),E.disconnect(C,0),E.disconnect(S,0),E.disconnect(F,1),E.disconnect(M,1),A.disconnect(m),m.disconnect(T.inputs===void 0?T:T.inputs[0]),m.disconnect(I.inputs===void 0?I:I.inputs[0]),m.disconnect(O.inputs===void 0?O:O.inputs[0]),m.disconnect(B.inputs===void 0?B:B.inputs[0]),T.disconnect(C.gain),I.disconnect(S.gain),O.disconnect(F.gain),B.disconnect(M.gain),C.disconnect(g,0,0),F.disconnect(g,0,0),S.disconnect(g,0,1),M.disconnect(g,0,1)}}},f=(p,v,m,g,_)=>{if(v===1)return h(p,m,g,_);if(v===2)return d(p,m,g,_);throw o()};return(p,{channelCount:v,channelCountMode:m,pan:g,..._})=>{if(m==="max")throw o();const x=r(p,{..._,channelCount:1,channelCountMode:m,numberOfInputs:2}),b=t(p,{..._,channelCount:v,channelCountMode:m,gain:1}),y=t(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:g});let{connectGraph:w,disconnectGraph:E}=f(p,v,b,y,x);Object.defineProperty(y.gain,"defaultValue",{get:()=>0}),Object.defineProperty(y.gain,"maxValue",{get:()=>1}),Object.defineProperty(y.gain,"minValue",{get:()=>-1});const C={get bufferSize(){},get channelCount(){return b.channelCount},set channelCount(A){b.channelCount!==A&&(T&&E(),{connectGraph:w,disconnectGraph:E}=f(p,A,b,y,x),T&&w()),b.channelCount=A},get channelCountMode(){return b.channelCountMode},set channelCountMode(A){if(A==="clamped-max"||A==="max")throw o();b.channelCountMode=A},get channelInterpretation(){return b.channelInterpretation},set channelInterpretation(A){b.channelInterpretation=A},get context(){return b.context},get inputs(){return[b]},get numberOfInputs(){return b.numberOfInputs},get numberOfOutputs(){return b.numberOfOutputs},get pan(){return y.gain},addEventListener(...A){return b.addEventListener(A[0],A[1],A[2])},dispatchEvent(...A){return b.dispatchEvent(A[0])},removeEventListener(...A){return b.removeEventListener(A[0],A[1],A[2])}};let T=!1;const S=()=>{w(),T=!0},I=()=>{E(),T=!1};return i(Ko(C,x),S,I)}},MS=(r,e,t,n,o,i,a)=>(s,u)=>{const c=s.createWaveShaper();if(i!==null&&i.name==="webkitAudioContext"&&s.createGain().gain.automationRate===void 0)return t(s,u);dt(c,u);const l=u.curve===null||u.curve instanceof Float32Array?u.curve:new Float32Array(u.curve);if(l!==null&&l.length<2)throw e();Ge(c,{curve:l},"curve"),Ge(c,u,"oversample");let h=null,d=!1;return a(c,"curve",v=>()=>v.call(c),v=>m=>(v.call(c,m),d&&(n(m)&&h===null?h=r(s,c):!n(m)&&h!==null&&(h(),h=null)),m)),o(c,()=>{d=!0,n(c.curve)&&(h=r(s,c))},()=>{d=!1,h!==null&&(h(),h=null)})},PS=(r,e,t,n,o)=>(i,{curve:a,oversample:s,...u})=>{const c=i.createWaveShaper(),l=i.createWaveShaper();dt(c,u),dt(l,u);const h=t(i,{...u,gain:1}),d=t(i,{...u,gain:-1}),f=t(i,{...u,gain:1}),p=t(i,{...u,gain:-1});let v=null,m=!1,g=null;const _={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(y){h.channelCount=y,d.channelCount=y,c.channelCount=y,f.channelCount=y,l.channelCount=y,p.channelCount=y},get channelCountMode(){return c.channelCountMode},set channelCountMode(y){h.channelCountMode=y,d.channelCountMode=y,c.channelCountMode=y,f.channelCountMode=y,l.channelCountMode=y,p.channelCountMode=y},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(y){h.channelInterpretation=y,d.channelInterpretation=y,c.channelInterpretation=y,f.channelInterpretation=y,l.channelInterpretation=y,p.channelInterpretation=y},get context(){return c.context},get curve(){return g},set curve(y){if(y!==null&&y.length<2)throw e();if(y===null)c.curve=y,l.curve=y;else{const w=y.length,E=new Float32Array(w+2-w%2),C=new Float32Array(w+2-w%2);E[0]=y[0],C[0]=-y[w-1];const T=Math.ceil((w+1)/2),S=(w+1)/2-1;for(let I=1;I<T;I+=1){const A=I/T*S,F=Math.floor(A),O=Math.ceil(A);E[I]=F===O?y[F]:(1-(A-F))*y[F]+(1-(O-A))*y[O],C[I]=F===O?-y[w-1-F]:-((1-(A-F))*y[w-1-F])-(1-(O-A))*y[w-1-O]}E[T]=w%2===1?y[T-1]:(y[T-2]+y[T-1])/2,c.curve=E,l.curve=C}g=y,m&&(n(g)&&v===null?v=r(i,h):v!==null&&(v(),v=null))},get inputs(){return[h]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(y){c.oversample=y,l.oversample=y},addEventListener(...y){return h.addEventListener(y[0],y[1],y[2])},dispatchEvent(...y){return h.dispatchEvent(y[0])},removeEventListener(...y){return h.removeEventListener(y[0],y[1],y[2])}};a!==null&&(_.curve=a instanceof Float32Array?a:new Float32Array(a)),s!==_.oversample&&(_.oversample=s);const x=()=>{h.connect(c).connect(f),h.connect(d).connect(l).connect(p).connect(f),m=!0,n(g)&&(v=r(i,h))},b=()=>{h.disconnect(c),c.disconnect(f),h.disconnect(d),d.disconnect(l),l.disconnect(p),p.disconnect(f),m=!1,v!==null&&(v(),v=null)};return o(Ko(_,f),x,b)},Pt=()=>new DOMException("","NotSupportedError"),BS={numberOfChannels:1},LS=(r,e,t,n,o)=>class extends r{constructor(a,s,u){let c;if(typeof a=="number"&&s!==void 0&&u!==void 0)c={length:s,numberOfChannels:a,sampleRate:u};else if(typeof a=="object")c=a;else throw new Error("The given parameters are not valid.");const{length:l,numberOfChannels:h,sampleRate:d}={...BS,...c},f=n(h,l,d);e(Ni,()=>Ni(f))||f.addEventListener("statechange",(()=>{let p=0;const v=m=>{this._state==="running"&&(p>0?(f.removeEventListener("statechange",v),m.stopImmediatePropagation(),this._waitForThePromiseToSettle(m)):p+=1)};return v})()),super(f,h),this._length=l,this._nativeOfflineAudioContext=f,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",o(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Ov(this)}))}_waitForThePromiseToSettle(a){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(a):setTimeout(()=>this._waitForThePromiseToSettle(a))}},WS={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},VS=(r,e,t,n,o,i,a)=>class extends r{constructor(u,c){const l=o(u),h={...WS,...c},d=t(l,h),f=i(l),p=f?n():null,v=u.sampleRate/2;super(u,!1,d,p),this._detune=e(this,f,d.detune,153600,-153600),this._frequency=e(this,f,d.frequency,v,-v),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(u){const c=typeof u=="function"?a(this,u):null;this._nativeOscillatorNode.onended=c;const l=this._nativeOscillatorNode.onended;this._onended=l!==null&&l===c?u:l}get type(){return this._nativeOscillatorNode.type}set type(u){this._nativeOscillatorNode.type=u,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(u){this._nativeOscillatorNode.setPeriodicWave(u),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=u)}start(u=0){if(this._nativeOscillatorNode.start(u),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=u),this.context.state!=="closed"){Lo(this);const c=()=>{this._nativeOscillatorNode.removeEventListener("ended",c),er(this)&&Hi(this)};this._nativeOscillatorNode.addEventListener("ended",c)}}stop(u=0){this._nativeOscillatorNode.stop(u),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=u)}},US=(r,e,t,n,o)=>()=>{const i=new WeakMap;let a=null,s=null,u=null;const c=async(l,h)=>{let d=t(l);const f=Dt(d,h);if(!f){const p={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:a===null?void 0:a,type:d.type};d=e(h,p),s!==null&&d.start(s),u!==null&&d.stop(u)}return i.set(h,d),f?(await r(h,l.detune,d.detune),await r(h,l.frequency,d.frequency)):(await n(h,l.detune,d.detune),await n(h,l.frequency,d.frequency)),await o(l,h,d),d};return{set periodicWave(l){a=l},set start(l){s=l},set stop(l){u=l},render(l,h){const d=i.get(h);return d!==void 0?Promise.resolve(d):c(l,h)}}},zS={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},GS=(r,e,t,n,o,i,a)=>class extends r{constructor(u,c){const l=o(u),h={...zS,...c},d=t(l,h),f=i(l),p=f?n():null;super(u,!1,d,p),this._nativePannerNode=d,this._orientationX=e(this,f,d.orientationX,Ft,Lt),this._orientationY=e(this,f,d.orientationY,Ft,Lt),this._orientationZ=e(this,f,d.orientationZ,Ft,Lt),this._positionX=e(this,f,d.positionX,Ft,Lt),this._positionY=e(this,f,d.positionY,Ft,Lt),this._positionZ=e(this,f,d.positionZ,Ft,Lt),a(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(u){this._nativePannerNode.coneInnerAngle=u}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(u){this._nativePannerNode.coneOuterAngle=u}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(u){this._nativePannerNode.coneOuterGain=u}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(u){this._nativePannerNode.distanceModel=u}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(u){this._nativePannerNode.maxDistance=u}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(u){this._nativePannerNode.panningModel=u}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(u){this._nativePannerNode.refDistance=u}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(u){this._nativePannerNode.rolloffFactor=u}},qS=(r,e,t,n,o,i,a,s,u,c)=>()=>{const l=new WeakMap;let h=null;const d=async(f,p)=>{let v=null,m=i(f);const g={channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation},_={...g,coneInnerAngle:m.coneInnerAngle,coneOuterAngle:m.coneOuterAngle,coneOuterGain:m.coneOuterGain,distanceModel:m.distanceModel,maxDistance:m.maxDistance,panningModel:m.panningModel,refDistance:m.refDistance,rolloffFactor:m.rolloffFactor},x=Dt(m,p);if("bufferSize"in m)v=n(p,{...g,gain:1});else if(!x){const b={..._,orientationX:m.orientationX.value,orientationY:m.orientationY.value,orientationZ:m.orientationZ.value,positionX:m.positionX.value,positionY:m.positionY.value,positionZ:m.positionZ.value};m=o(p,b)}if(l.set(p,v===null?m:v),v!==null){if(h===null){if(a===null)throw new Error("Missing the native OfflineAudioContext constructor.");const I=new a(6,f.context.length,p.sampleRate),A=e(I,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});A.connect(I.destination),h=(async()=>{const F=await Promise.all([f.orientationX,f.orientationY,f.orientationZ,f.positionX,f.positionY,f.positionZ].map(async(O,M)=>{const B=t(I,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:M===0?1:0});return await s(I,O,B.offset),B}));for(let O=0;O<6;O+=1)F[O].connect(A,0,O),F[O].start(0);return c(I)})()}const b=await h,y=n(p,{...g,gain:1});await u(f,p,y);const w=[];for(let I=0;I<b.numberOfChannels;I+=1)w.push(b.getChannelData(I));let E=[w[0][0],w[1][0],w[2][0]],C=[w[3][0],w[4][0],w[5][0]],T=n(p,{...g,gain:1}),S=o(p,{..._,orientationX:E[0],orientationY:E[1],orientationZ:E[2],positionX:C[0],positionY:C[1],positionZ:C[2]});y.connect(T).connect(S.inputs[0]),S.connect(v);for(let I=128;I<b.length;I+=128){const A=[w[0][I],w[1][I],w[2][I]],F=[w[3][I],w[4][I],w[5][I]];if(A.some((O,M)=>O!==E[M])||F.some((O,M)=>O!==C[M])){E=A,C=F;const O=I/p.sampleRate;T.gain.setValueAtTime(0,O),T=n(p,{...g,gain:0}),S=o(p,{..._,orientationX:E[0],orientationY:E[1],orientationZ:E[2],positionX:C[0],positionY:C[1],positionZ:C[2]}),T.gain.setValueAtTime(1,O),y.connect(T).connect(S.inputs[0]),S.connect(v)}}return v}return x?(await r(p,f.orientationX,m.orientationX),await r(p,f.orientationY,m.orientationY),await r(p,f.orientationZ,m.orientationZ),await r(p,f.positionX,m.positionX),await r(p,f.positionY,m.positionY),await r(p,f.positionZ,m.positionZ)):(await s(p,f.orientationX,m.orientationX),await s(p,f.orientationY,m.orientationY),await s(p,f.orientationZ,m.orientationZ),await s(p,f.positionX,m.positionX),await s(p,f.positionY,m.positionY),await s(p,f.positionZ,m.positionZ)),Xo(m)?await u(f,p,m.inputs[0]):await u(f,p,m),m};return{render(f,p){const v=l.get(p);return v!==void 0?Promise.resolve(v):d(f,p)}}},HS={disableNormalization:!1},jS=(r,e,t,n)=>class Gv{constructor(i,a){const s=e(i),u=n({...HS,...a}),c=r(s,u);return t.add(c),c}static[Symbol.hasInstance](i){return i!==null&&typeof i=="object"&&Object.getPrototypeOf(i)===Gv.prototype||t.has(i)}},XS=(r,e)=>(t,n,o)=>(r(n).replay(o),e(n,t,o)),KS=(r,e,t)=>async(n,o,i)=>{const a=r(n);await Promise.all(a.activeInputs.map((s,u)=>Array.from(s).map(async([c,l])=>{const d=await e(c).render(c,o),f=n.context.destination;!t(c)&&(n!==f||!t(n))&&d.connect(i,l,u)})).reduce((s,u)=>[...s,...u],[]))},$S=(r,e,t)=>async(n,o,i)=>{const a=e(n);await Promise.all(Array.from(a.activeInputs).map(async([s,u])=>{const l=await r(s).render(s,o);t(s)||l.connect(i,u)}))},YS=(r,e,t,n)=>o=>r(Ni,()=>Ni(o))?Promise.resolve(r(n,n)).then(i=>{if(!i){const a=t(o,512,0,1);o.oncomplete=()=>{a.onaudioprocess=null,a.disconnect()},a.onaudioprocess=()=>o.currentTime,a.connect(o.destination)}return o.startRendering()}):new Promise(i=>{const a=e(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});o.oncomplete=s=>{a.disconnect(),i(s.renderedBuffer)},a.connect(o.destination),o.startRendering()}),ZS=r=>(e,t)=>{r.set(e,t)},JS=r=>(e,t)=>r.set(e,t),QS=(r,e,t,n,o,i,a,s)=>(u,c)=>t(u).render(u,c).then(()=>Promise.all(Array.from(n(c)).map(l=>t(l).render(l,c)))).then(()=>o(c)).then(l=>(typeof l.copyFromChannel!="function"?(a(l),Rl(l)):e(i,()=>i(l))||s(l),r.add(l),l)),eT={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},tT=(r,e,t,n,o,i)=>class extends r{constructor(s,u){const c=o(s),l={...eT,...u},h=t(c,l),d=i(c),f=d?n():null;super(s,!1,h,f),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},nT=(r,e,t,n,o)=>()=>{const i=new WeakMap,a=async(s,u)=>{let c=t(s);const l=Dt(c,u);if(!l){const h={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=e(u,h)}return i.set(u,c),l?await r(u,s.pan,c.pan):await n(u,s.pan,c.pan),Xo(c)?await o(s,u,c.inputs[0]):await o(s,u,c),c};return{render(s,u){const c=i.get(u);return c!==void 0?Promise.resolve(c):a(s,u)}}},rT=r=>()=>{if(r===null)return!1;try{new r({length:1,sampleRate:44100})}catch{return!1}return!0},oT=(r,e)=>async()=>{if(r===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),o=URL.createObjectURL(t);let i=!1,a=!1;try{await n.audioWorklet.addModule(o);const s=new r(n,"a",{numberOfOutputs:0}),u=n.createOscillator();s.port.onmessage=()=>i=!0,s.onprocessorerror=()=>a=!0,u.connect(s),u.start(0),await n.startRendering(),await new Promise(c=>setTimeout(c))}catch{}finally{URL.revokeObjectURL(o)}return i&&!a},iT=(r,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),n=r(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(o=>{t.oncomplete=()=>{n.disconnect(),o(t.currentTime!==0)},t.startRendering()})},aT=()=>new DOMException("","UnknownError"),sT={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},uT=(r,e,t,n,o,i,a)=>class extends r{constructor(u,c){const l=o(u),h={...sT,...c},d=t(l,h),p=i(l)?n():null;super(u,!0,d,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,a(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(u){if(u===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(u.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=u}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(u){this._nativeWaveShaperNode.oversample=u}},cT=(r,e,t)=>()=>{const n=new WeakMap,o=async(i,a)=>{let s=e(i);if(!Dt(s,a)){const c={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,curve:s.curve,oversample:s.oversample};s=r(a,c)}return n.set(a,s),Xo(s)?await t(i,a,s.inputs[0]):await t(i,a,s),s};return{render(i,a){const s=n.get(a);return s!==void 0?Promise.resolve(s):o(i,a)}}},lT=()=>typeof window>"u"?null:window,hT=(r,e)=>t=>{t.copyFromChannel=(n,o,i=0)=>{const a=r(i),s=r(o);if(s>=t.numberOfChannels)throw e();const u=t.length,c=t.getChannelData(s),l=n.length;for(let h=a<0?-a:0;h+a<u&&h<l;h+=1)n[h]=c[h+a]},t.copyToChannel=(n,o,i=0)=>{const a=r(i),s=r(o);if(s>=t.numberOfChannels)throw e();const u=t.length,c=t.getChannelData(s),l=n.length;for(let h=a<0?-a:0;h+a<u&&h<l;h+=1)c[h+a]=n[h]}},dT=r=>e=>{e.copyFromChannel=(t=>(n,o,i=0)=>{const a=r(i),s=r(o);if(a<e.length)return t.call(e,n,s,a)})(e.copyFromChannel),e.copyToChannel=(t=>(n,o,i=0)=>{const a=r(i),s=r(o);if(a<e.length)return t.call(e,n,s,a)})(e.copyToChannel)},fT=r=>(e,t)=>{const n=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=n),r(e,"buffer",o=>()=>{const i=o.call(e);return i===n?null:i},o=>i=>o.call(e,i===null?n:i))},pT=(r,e)=>(t,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw r()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw r()}});const o=t.createBufferSource();e(n,()=>{const s=n.numberOfInputs;for(let u=0;u<s;u+=1)o.connect(n,0,u)},()=>o.disconnect(n))},qv=(r,e,t)=>r.copyFromChannel===void 0?r.getChannelData(t)[0]:(r.copyFromChannel(e,t),e[0]),Hv=r=>{if(r===null)return!1;const e=r.length;return e%2!==0?r[Math.floor(e/2)]!==0:r[e/2-1]+r[e/2]!==0},Yi=(r,e,t,n)=>{let o=r;for(;!o.hasOwnProperty(e);)o=Object.getPrototypeOf(o);const{get:i,set:a}=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(r,e,{get:t(i),set:n(a)})},vT=r=>({...r,outputChannelCount:r.outputChannelCount!==void 0?r.outputChannelCount:r.numberOfInputs===1&&r.numberOfOutputs===1?[r.channelCount]:Array.from({length:r.numberOfOutputs},()=>1)}),mT=r=>({...r,channelCount:r.numberOfOutputs}),gT=r=>{const{imag:e,real:t}=r;return e===void 0?t===void 0?{...r,imag:[0,0],real:[0,0]}:{...r,imag:Array.from(t,()=>0),real:t}:t===void 0?{...r,imag:e,real:Array.from(e,()=>0)}:{...r,imag:e,real:t}},jv=(r,e,t)=>{try{r.setValueAtTime(e,t)}catch(n){if(n.code!==9)throw n;jv(r,e,t+1e-7)}},yT=r=>{const e=r.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},_T=r=>{const e=r.createBufferSource(),t=r.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},bT=r=>{const e=r.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},Ml=r=>{const e=r.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},Xv=r=>{const e=r.createBuffer(1,1,44100),t=r.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},Pl=r=>{const e=r.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},xT=r=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(r)}finally{e.close(),t.close()}},wT=r=>{r.start=(e=>(t=0,n=0,o)=>{const i=r.buffer,a=i===null?n:Math.min(i.duration,n);i!==null&&a>i.duration-.5/r.context.sampleRate?e.call(r,t,0,0):e.call(r,t,a,o)})(r.start)},Kv=(r,e)=>{const t=e.createGain();r.connect(t);const n=(o=>()=>{o.call(r,t),r.removeEventListener("ended",n)})(r.disconnect);r.addEventListener("ended",n),Ko(r,t),r.stop=(o=>{let i=!1;return(a=0)=>{if(i)try{o.call(r,a)}catch{t.gain.setValueAtTime(0,a)}else o.call(r,a),i=!0}})(r.stop)},$o=(r,e)=>t=>{const n={value:r};return Object.defineProperties(t,{currentTarget:n,target:n}),typeof e=="function"?e.call(r,t):e.handleEvent.call(r,t)},CT=GC(no),ET=$C(no),ST=sE(Is),$v=new WeakMap,TT=SE($v),Cn=B2(new Map,new WeakMap),zn=lT(),Yv=tS(Cn,jn),Bl=EE(Mt),Et=KS(Mt,Bl,Xr),kT=e2(Yv,Ue,Et),Le=AE(As),ur=AS(zn),Me=HE(ur),Zv=new WeakMap,Jv=gE($o),Zi=iS(zn),Ll=UE(Zi),Wl=zE(zn),Qv=GE(zn),Di=sS(zn),Qe=S2(qC(Tv),KC(CT,ET,rs,ST,os,Mt,TT,qi,Ue,no,er,Xr,Sa),Cn,PE(nc,os,Mt,Ue,Ri,er),jn,Rs,Pt,rE(rs,nc,Mt,Ue,Ri,Le,er,Me),lE(Zv,Mt,yn),Jv,Le,Ll,Wl,Qv,Me,Di),AT=QC(Qe,kT,jn,Yv,Le,Me),Vl=new WeakSet,Bd=nS(zn),em=Y2(new Uint32Array(1)),Ul=hT(em,jn),zl=dT(em),tm=n2(Vl,Cn,Pt,Bd,ur,rT(Bd),Ul,zl),Ns=YC(qt),nm=$S(Bl,ji,Xr),Xn=q2(nm),Yo=oS(Ns,Cn,yT,_T,bT,Ml,Xv,Pl,wT,fT(Yi),Kv),Kn=XS(TE(ji),nm),IT=i2(Xn,Yo,Ue,Kn,Et),En=T2(HC(kv),Zv,Il,k2,BC,LC,WC,VC,UC,Qu,Ev,Zi,jv),RT=o2(Qe,IT,En,mt,Yo,Le,Me,$o),NT=p2(Qe,v2,jn,mt,aS(qt,Yi),Le,Me,Et),DT=P2(Xn,Uv,Ue,Kn,Et),ro=JS($v),OT=M2(Qe,En,DT,Rs,Uv,Le,Me,ro),Dr=QE(no,Wl),FT=pT(mt,Dr),Or=pS(Zi,FT),MT=V2(Or,Ue,Et),PT=W2(Qe,MT,Or,Le,Me),BT=G2(Ki,Ue,Et),LT=z2(Qe,BT,Ki,Le,Me,mT),WT=gS(Ns,Yo,qt,Dr),Zo=mS(Ns,Cn,WT,Ml,Pl),VT=$2(Xn,Zo,Ue,Kn,Et),UT=K2(Qe,En,VT,Zo,Le,Me,$o),rm=yS(Pt,Yi),zT=Q2(rm,Ue,Et),GT=J2(Qe,zT,rm,Le,Me,ro),qT=aE(Xn,zv,Ue,Kn,Et),HT=iE(Qe,En,qT,zv,Le,Me,ro),om=_S(Pt),jT=pE(Xn,om,Ue,Kn,Et),XT=fE(Qe,En,jT,om,Pt,Le,Me,ro),KT=wE(Xn,qt,Ue,Kn,Et),$T=xE(Qe,En,KT,qt,Le,Me),YT=CS(Rs,mt,$i,Pt),Ds=YS(Cn,qt,$i,iT(qt,ur)),ZT=ME(Yo,Ue,ur,Et,Ds),JT=bS(YT),QT=OE(Qe,JT,ZT,Le,Me,ro),ek=m2(En,Or,Zo,$i,Pt,qv,Me,Yi),im=new WeakMap,tk=JE(NT,ek,Jv,Me,im,$o),am=IS(Ns,Cn,Ml,Xv,Pl,Kv),nk=US(Xn,am,Ue,Kn,Et),rk=VS(Qe,En,am,nk,Le,Me,$o),sm=j2(Yo),ok=PS(sm,mt,qt,Hv,Dr),Os=MS(sm,mt,ok,Hv,Dr,Zi,Yi),ik=NS(rs,mt,Or,qt,$i,Os,Pt,os,qv,Dr),um=RS(ik),ak=qS(Xn,Or,Zo,qt,um,Ue,ur,Kn,Et,Ds),sk=GS(Qe,En,um,ak,Le,Me,ro),uk=DS(jn),ck=jS(uk,Le,new WeakSet,gT),lk=FS(Or,Ki,qt,Os,Pt,Dr),cm=OS(lk,Pt),hk=nT(Xn,cm,Ue,Kn,Et),dk=tT(Qe,En,cm,hk,Le,Me),fk=cT(Os,Ue,Et),pk=uT(Qe,mt,Os,fk,Le,Me,ro),lm=jE(zn),Gl=yE(zn),hm=new WeakMap,vk=IE(hm,ur),mk=lm?XC(Cn,Pt,mE(zn),Gl,_E(zC),Le,vk,Me,Di,new WeakMap,new WeakMap,oT(Di,ur),zn):void 0,gk=qE(Ll,Me),yk=nE(Vl,Cn,tE,vE,new WeakSet,Le,gk,ts,Ni,Ul,zl),dm=O2(mk,AT,tm,RT,OT,PT,LT,UT,GT,yk,HT,XT,$T,QT,tk,rk,sk,ck,dk,pk),_k=XE(Qe,ES,Le,Me),bk=$E(Qe,SS,Le,Me),xk=YE(Qe,TS,Le,Me),wk=kS(mt,Me),Ck=ZE(Qe,wk,Le),Ek=f2(dm,mt,Pt,aT,_k,bk,xk,Ck,Zi),ql=RE(im),Sk=ZC(ql),fm=H2(jn),Tk=uE(ql),pm=hE(jn),vm=new WeakMap,kk=CE(vm,yn),Ak=fS(fm,jn,mt,Or,Ki,Zo,qt,$i,Pt,pm,Gl,kk,Dr),Ik=cS(mt,Ak,qt,Pt,Dr),Rk=D2(Xn,fm,Yo,Or,Ki,Zo,qt,Tk,pm,Gl,Ue,Di,ur,Kn,Et,Ds),Nk=kE(hm),Dk=ZS(vm),Ld=lm?I2(Sk,Qe,En,Rk,Ik,Mt,Nk,Le,Me,Di,vT,Dk,xT,$o):void 0,Ok=eE(Pt,ur),Fk=QS(Vl,Cn,Bl,ql,Ds,ts,Ul,zl),Mk=LS(dm,Cn,mt,Ok,Fk),Pk=BE(As,Ll),Bk=LE(Al,Wl),Lk=WE(Il,Qv),Wk=VE(As,Me);function sn(r){return r===void 0}function Ce(r){return r!==void 0}function Vk(r){return typeof r=="function"}function Kr(r){return typeof r=="number"}function qr(r){return Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object}function Uk(r){return typeof r=="boolean"}function gn(r){return Array.isArray(r)}function tr(r){return typeof r=="string"}function ba(r){return tr(r)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(r)}function _e(r,e){if(!r)throw new Error(e)}function Er(r,e,t=1/0){if(!(e<=r&&r<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${r}`)}function mm(r){!r.isOffline&&r.state!=="running"&&Hl('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let gm=!1,Wd=!1;function Vd(r){gm=r}function zk(r){sn(r)&&gm&&!Wd&&(Wd=!0,Hl("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let ym=console;function Gk(...r){ym.log(...r)}function Hl(...r){ym.warn(...r)}function qk(r){return new Ek(r)}function Hk(r,e,t){return new Mk(r,e,t)}const Kt=typeof self=="object"?self:null,jk=Kt&&(Kt.hasOwnProperty("AudioContext")||Kt.hasOwnProperty("webkitAudioContext"));function Xk(r,e,t){return _e(Ce(Ld),"AudioWorkletNode only works in a secure context (https or localhost)"),new(r instanceof(Kt==null?void 0:Kt.BaseAudioContext)?Kt==null?void 0:Kt.AudioWorkletNode:Ld)(r,e,t)}function Sn(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}function ot(r,e,t,n){function o(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function s(l){try{c(n.next(l))}catch(h){a(h)}}function u(l){try{c(n.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):o(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}class Kk{constructor(e,t,n,o){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(o||44100),.001),this.updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function $r(r){return Lk(r)}function xr(r){return Bk(r)}function Ta(r){return Wk(r)}function go(r){return Pk(r)}function $k(r){return r instanceof tm}function Yk(r,e){return r==="value"||$r(e)||xr(e)||$k(e)}function Ro(r,...e){if(!e.length)return r;const t=e.shift();if(qr(r)&&qr(t))for(const n in t)Yk(n,t[n])?r[n]=t[n]:qr(t[n])?(r[n]||Object.assign(r,{[n]:{}}),Ro(r[n],t[n])):Object.assign(r,{[n]:t[n]});return Ro(r,...e)}function Zk(r,e){return r.length===e.length&&r.every((t,n)=>e[n]===t)}function ye(r,e,t=[],n){const o={},i=Array.from(e);if(qr(i[0])&&n&&!Reflect.has(i[0],n)&&(Object.keys(i[0]).some(s=>Reflect.has(r,s))||(Ro(o,{[n]:i[0]}),t.splice(t.indexOf(n),1),i.shift())),i.length===1&&qr(i[0]))Ro(o,i[0]);else for(let a=0;a<t.length;a++)Ce(i[a])&&(o[t[a]]=i[a]);return Ro(r,o)}function Jk(r){return r.constructor.getDefaults()}function No(r,e){return sn(r)?e:r}function Ud(r,e){return e.forEach(t=>{Reflect.has(r,t)&&delete r[t]}),r}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class cr{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Kt&&this.toString()===Kt.TONE_DEBUG_CLASS)&&Gk(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}cr.version=Cv;const jl=1e-6;function Wo(r,e){return r>e+jl}function sc(r,e){return Wo(r,e)||fn(r,e)}function us(r,e){return r+jl<e}function fn(r,e){return Math.abs(r-e)<jl}function Qk(r,e,t){return Math.max(Math.min(r,t),e)}class un extends cr{constructor(){super(),this.name="Timeline",this._timeline=[];const e=ye(un.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(_e(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];_e(sc(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const n=this._search(e,t);return n!==-1?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(fn(this._timeline[t].time,e)){for(let n=t;n>=0&&fn(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&sc(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let n=0;const o=this._timeline.length;let i=o;if(o>0&&this._timeline[o-1][t]<=e)return o-1;for(;n<i;){let a=Math.floor(n+(i-n)/2);const s=this._timeline[a],u=this._timeline[a+1];if(fn(s[t],e)){for(let c=a;c<this._timeline.length;c++){const l=this._timeline[c];if(fn(l[t],e))a=c;else break}return a}else{if(us(s[t],e)&&Wo(u[t],e))return a;Wo(s[t],e)?i=a:n=a+1}}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return n!==-1&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let o=this._search(e),i=this._search(t);return o!==-1&&i!==-1?(this._timeline[o].time!==e&&(o+=1),this._timeline[i].time===t&&(i-=1),this._iterate(n,o,i)):o===-1&&this._iterate(n,0,i),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(n!==-1&&fn(this._timeline[n].time,e)){let o=n;for(let i=n;i>=0&&fn(this._timeline[i].time,e);i--)o=i;this._iterate(i=>{t(i)},o,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const _m=[];function Fs(r){_m.push(r)}function eA(r){_m.forEach(e=>e(r))}const bm=[];function Ms(r){bm.push(r)}function tA(r){bm.forEach(e=>e(r))}class Ji extends cr{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(o=>{sn(this._events)&&(this._events={}),this._events.hasOwnProperty(o)||(this._events[o]=[]),this._events[o].push(t)}),this}once(e,t){const n=(...o)=>{t(...o),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach(o=>{if(sn(this._events)&&(this._events={}),this._events.hasOwnProperty(o))if(sn(t))this._events[o]=[];else{const i=this._events[o];for(let a=i.length-1;a>=0;a--)i[a]===t&&i.splice(a,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let o=0,i=n.length;o<i;o++)n[o].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const n=Object.getOwnPropertyDescriptor(Ji.prototype,t);Object.defineProperty(e.prototype,t,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class xm extends Ji{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Qi extends xm{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new un,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const n=ye(Qi.getDefaults(),arguments,["context"]);n.context?(this._context=n.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=qk({latencyHint:n.latencyHint}),this._latencyHint=n.latencyHint),this._ticker=new Kk(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=n.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(eA(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return _e(go(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return _e(go(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return _e(go(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){_e(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){_e(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){_e(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){_e(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return Xk(this.rawContext,e,t)}addAudioWorkletModule(e){return ot(this,void 0,void 0,function*(){_e(Ce(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return ot(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return go(this._context)?this._context.resume():Promise.resolve()}close(){return ot(this,void 0,void 0,function*(){go(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&tA(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=e;const o=this._context.createBufferSource();return o.channelCount=1,o.channelCountMode="explicit",o.buffer=t,o.loop=!0,o.start(0),this._constants.set(e,o),o}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,o=()=>{const i=this.now();this._timeouts.add({callback:()=>{e(),o()},id:n,time:i+t})};return o(),n}}class nA extends xm{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return ot(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function Ze(r,e){gn(e)?e.forEach(t=>Ze(r,t)):Object.defineProperty(r,e,{enumerable:!0,writable:!1})}function wm(r,e){gn(e)?e.forEach(t=>wm(r,t)):Object.defineProperty(r,e,{writable:!0})}const Fe=()=>{};class We extends cr{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Fe;const e=ye(We.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,tr(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:Fe,onload:Fe,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:on().sampleRate}set(e){return e instanceof We?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return ot(this,void 0,void 0,function*(){const t=We.load(e).then(n=>{this.set(n),this.onload(this)});We.downloads.push(t);try{yield t}finally{const n=We.downloads.indexOf(t);We.downloads.splice(n,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=gn(e)&&e[0].length>0,n=t?e.length:1,o=t?e[0].length:e.length,i=on(),a=i.createBuffer(n,o,i.sampleRate),s=!t&&n===1?[e]:e;for(let u=0;u<n;u++)a.copyToChannel(s[u],u);return this._buffer=a,this}toMono(e){if(Kr(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const n=this.numberOfChannels;for(let o=0;o<n;o++){const i=this.toArray(o);for(let a=0;a<i.length;a++)t[a]+=i[a]}t=t.map(o=>o/n),this.fromArray(t)}return this}toArray(e){if(Kr(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let n=0;n<this.numberOfChannels;n++)t[n]=this.getChannelData(n);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){_e(this.loaded,"Buffer is not loaded");const n=Math.floor(e*this.sampleRate),o=Math.floor(t*this.sampleRate);_e(n<o,"The start time must be less than the end time");const i=o-n,a=on().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let s=0;s<this.numberOfChannels;s++)a.copyToChannel(this.getChannelData(s).subarray(n,o),s);return new We(a)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new We().fromArray(e)}static fromUrl(e){return ot(this,void 0,void 0,function*(){return yield new We().load(e)})}static load(e){return ot(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const u=t[1].split("|");let c=u[0];for(const l of u)if(We.supportsType(l)){c=l;break}e=e.replace(t[0],c)}const n=We.baseUrl===""||We.baseUrl.endsWith("/")?We.baseUrl:We.baseUrl+"/",o=document.createElement("a");o.href=n+e,o.pathname=(o.pathname+o.hash).split("/").map(encodeURIComponent).join("/");const i=yield fetch(o.href);if(!i.ok)throw new Error(`could not load url: ${e}`);const a=yield i.arrayBuffer();return yield on().decodeAudioData(a)})}static supportsType(e){const t=e.split("."),n=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+n)!==""}static loaded(){return ot(this,void 0,void 0,function*(){for(yield Promise.resolve();We.downloads.length;)yield We.downloads[0]})}}We.baseUrl="";We.downloads=[];class Xl extends Qi{constructor(){super({clockSource:"offline",context:Ta(arguments[0])?arguments[0]:Hk(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:Ta(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Ta(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return ot(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n===0&&(yield new Promise(o=>setTimeout(o,1)))}})}render(){return ot(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new We(t)})}close(){return Promise.resolve()}}const Cm=new nA;let bo=Cm;function on(){return bo===Cm&&jk&&rA(new Qi),bo}function rA(r,e=!1){e&&bo.dispose(),go(r)?bo=new Qi(r):Ta(r)?bo=new Xl(r):bo=r}if(Kt&&!Kt.TONE_SILENCE_LOGGING){const e=` * Tone.js v${Cv} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function oA(r){return Math.pow(10,r/20)}function iA(r){return 20*(Math.log(r)/Math.LN10)}function Em(r){return Math.pow(2,r/12)}let Ps=440;function aA(){return Ps}function sA(r){Ps=r}function uc(r){return Math.round(Sm(r))}function Sm(r){return 69+12*Math.log2(r/Ps)}function uA(r){return Ps*Math.pow(2,(r-69)/12)}class Kl extends cr{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),o=t==="."?1.5:1;return n===1?this._beatsToUnits(this._getTimeSignature())*o:this._beatsToUnits(4/n)*o},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let o=0;return e&&e!=="0"&&(o+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(o+=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(o+=this._beatsToUnits(parseFloat(n)/4)),o},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Kl&&this.fromType(this._val),sn(this._val))return this._noArg();if(tr(this._val)&&sn(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(qr(this._val)){let e=0;for(const t in this._val)if(Ce(this._val[t])){const n=this._val[t],o=new this.constructor(this.context,t).valueOf()*n;e+=o}return e}if(Ce(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return tr(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class vn extends Kl{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new vn(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const n=new this.constructor(this.context,e).valueOf(),o=this.valueOf(),s=Math.round(o/n)*n-o;return o+s*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let i=1;i<9;i++){const a=Math.pow(2,i);t.push(a+"n."),t.push(a+"n"),t.push(a+"t")}t.push("0");let n=t[0],o=new vn(this.context,t[0]).toSeconds();return t.forEach(i=>{const a=new vn(this.context,i).toSeconds();Math.abs(a-e)<Math.abs(o-e)&&(n=i,o=a)}),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let o=t%1*4;t=Math.floor(t)%this._getTimeSignature();const i=o.toString();return i.length>3&&(o=parseFloat(parseFloat(i).toFixed(3))),[n,t,o].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return uc(this.toFrequency())}_now(){return this.context.now()}}class an extends vn{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return aA()}static set A4(e){sA(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:an.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const o=cA[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?o:an.mtof(o)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let o=1;return e&&e!=="0"&&(o*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(o*=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(o*=this._beatsToUnits(parseFloat(n)/4)),o}}})}transpose(e){return new an(this.context,this.valueOf()*Em(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return uc(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/an.A4);let n=Math.round(12*t)+57;const o=Math.floor(n/12);return o<0&&(n+=-12*o),lA[n%12]+o.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return uA(e)}static ftom(e){return uc(e)}}const cA={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},lA=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class vi extends vn{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Ut extends cr{constructor(){super();const e=ye(Ut.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:on()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return zk(e),new vn(this.context,e).toSeconds()}toFrequency(e){return new an(this.context,e).toFrequency()}toTicks(e){return new vi(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(n=>{sn(e[n])&&delete t[n]}),t}get(){const e=Jk(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const n=this[t];Ce(n)&&Ce(n.value)&&Ce(n.setValueAtTime)?e[t]=n.value:n instanceof Ut?e[t]=n._getPartialProperties(e[t]):gn(n)||Kr(n)||tr(n)||Uk(n)?e[t]=n:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&Ce(this[t])&&(this[t]&&Ce(this[t].value)&&Ce(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof Ut?this[t].set(e[t]):this[t]=e[t])}),this}}class $l extends un{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,n){return Er(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){const n=this._search(t);for(let o=n;o>=0;o--){const i=this._timeline[o];if(i.state===e)return i}}getNextState(e,t){const n=this._search(t);if(n!==-1)for(let o=n;o<this._timeline.length;o++){const i=this._timeline[o];if(i.state===e)return i}}}class qe extends Ut{constructor(){const e=ye(qe.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,_e(Ce(e.param)&&($r(e.param)||e.param instanceof qe),"param must be an AudioParam");!$r(e.param);)e.param=e.param._param;this._swappable=Ce(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new un(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,Ce(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Ut.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return Ce(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return Ce(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return Ce(this.maxValue)&&Ce(this.minValue)&&Er(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?oA(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?iA(e):e}setValueAtTime(e,t){const n=this.toSeconds(t),o=this._fromType(e);return _e(isFinite(o)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(o),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:o}),this._param.setValueAtTime(o,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),o=this._events.get(t);let i=this._initialValue;if(o===null)i=this._initialValue;else if(o.type==="setTargetAtTime"&&(n===null||n.type==="setValueAtTime")){const a=this._events.getBefore(o.time);let s;a===null?s=this._initialValue:s=a.value,o.type==="setTargetAtTime"&&(i=this._exponentialApproach(o.time,s,o.value,o.constant,t))}else if(n===null)i=o.value;else if(n.type==="linearRampToValueAtTime"||n.type==="exponentialRampToValueAtTime"){let a=o.value;if(o.type==="setTargetAtTime"){const s=this._events.getBefore(o.time);s===null?a=this._initialValue:a=s.value}n.type==="linearRampToValueAtTime"?i=this._linearInterpolate(o.time,a,n.time,n.value,t):i=this._exponentialInterpolate(o.time,a,n.time,n.value,t)}else i=o.value;return this._toType(i)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),o=this.toSeconds(t);return _e(isFinite(n)&&isFinite(o),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:o,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,o),this._param.linearRampToValueAtTime(n,o),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=fn(n,0)?this._minOutput:n,this._assertRange(n);const o=this.toSeconds(t);return _e(isFinite(n)&&isFinite(o),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:o,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,o),this._param.exponentialRampToValueAtTime(n,o),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const o=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,o),this.cancelAndHoldAtTime(t+n*.9),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const o=this._fromType(e);_e(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(t);return this._assertRange(o),_e(isFinite(o)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:o}),this.log(this.units,"setTargetAtTime",e,i,n),this._param.setTargetAtTime(o,i,n),this}setValueCurveAtTime(e,t,n,o=1){n=this.toSeconds(n),t=this.toSeconds(t);const i=this._fromType(e[0])*o;this.setValueAtTime(this._toType(i),t);const a=n/(e.length-1);for(let s=1;s<e.length;s++){const u=this._fromType(e[s])*o;this.linearRampToValueAtTime(this._toType(u),t+s*a)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return _e(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));_e(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const o=this._events.get(t),i=this._events.getAfter(t);return o&&fn(o.time,t)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),i.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(n),t):i.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&n.type==="setTargetAtTime"){const o=this._events.getAfter(n.time),i=o?o.time:t+2,a=(i-t)/10;for(let s=t;s<i;s+=a)e.linearRampToValueAtTime(this.getValueAtTime(s),s)}return this._events.forEachAfter(this.context.currentTime,o=>{o.type==="cancelScheduledValues"?e.cancelScheduledValues(o.time):o.type==="setTargetAtTime"?e.setTargetAtTime(o.value,o.time,o.constant):e[o.type](o.value,o.time)}),this}setParam(e){_e(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,o,i){return n+(t-n)*Math.exp(-(i-e)/o)}_linearInterpolate(e,t,n,o,i){return t+(o-t)*((i-e)/(n-e))}_exponentialInterpolate(e,t,n,o,i){return t*Math.pow(o/t,(i-e)/(n-e))}}class we extends Ut{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return Ce(this.input)?$r(this.input)||this.input instanceof qe?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Ce(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return Ce(e)&&(e instanceof we||xr(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();_e(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return Jo(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Hl("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return hA(this,e,t,n),this}chain(...e){return cc(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),Ce(this.input)&&(this.input instanceof we?this.input.dispose():xr(this.input)&&this.input.disconnect()),Ce(this.output)&&(this.output instanceof we?this.output.dispose():xr(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function cc(...r){const e=r.shift();r.reduce((t,n)=>(t instanceof we?t.connect(n):xr(t)&&Jo(t,n),n),e)}function Jo(r,e,t=0,n=0){for(_e(Ce(r),"Cannot connect from undefined node"),_e(Ce(e),"Cannot connect to undefined node"),(e instanceof we||xr(e))&&_e(e.numberOfInputs>0,"Cannot connect to node with no inputs"),_e(r.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof we||e instanceof qe;)Ce(e.input)&&(e=e.input);for(;r instanceof we;)Ce(r.output)&&(r=r.output);$r(e)?r.connect(e,t):r.connect(e,t,n)}function hA(r,e,t=0,n=0){if(Ce(e))for(;e instanceof we;)e=e.input;for(;!xr(r);)Ce(r.output)&&(r=r.output);$r(e)?r.disconnect(e,t):xr(e)?r.disconnect(e,t,n):r.disconnect()}class Rt extends we{constructor(){const e=ye(Rt.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new qe({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Ze(this,"gain")}static getDefaults(){return Object.assign(we.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Vo extends we{constructor(e){super(e),this.onended=Fe,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Rt({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const n=this.toSeconds(t);return this._startTime!==-1&&n>=this._startTime&&(this._stopTime===-1||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(we.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Fe})}_startGain(e,t=1){_e(this._startTime===-1,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){_e(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const n=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Fe&&(this.onended(this),this.onended=Fe,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),_e(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Fe,this}}class Yl extends Vo{constructor(){const e=ye(Yl.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),Jo(this._source,this._gainNode),this.offset=new qe({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Vo.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class yt extends we{constructor(){const e=ye(yt.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new Yl({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(we.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return Zl(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,o){return this._param.setValueCurveAtTime(e,t,n,o),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function Zl(r,e,t,n){(e instanceof qe||$r(e)||e instanceof yt&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof yt&&(e.overridden=!0)),Jo(r,e,t,n)}class Jl extends qe{constructor(){const e=ye(Jl.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new un(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(qe.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const o=this._fromType(e),i=this._events.get(t),a=Math.round(Math.max(1/n,1));for(let s=0;s<=a;s++){const u=n*s+t,c=this._exponentialApproach(i.time,i.value,o,n,u);this.linearRampToValueAtTime(this._toType(c),u)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const o=this._events.get(n),i=this._events.previousEvent(o),a=this._getTicksUntilEvent(i,n);return o.ticks=Math.max(a,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const o=this._events.get(n),i=this._events.previousEvent(o),a=this._getTicksUntilEvent(i,n);return o.ticks=Math.max(a,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),o=this._events.get(t),i=Math.round(Math.max((t-o.time)*10,1)),a=(t-o.time)/i;for(let s=0;s<=i;s++){const u=a*s+o.time,c=this._exponentialInterpolate(o.time,o.value,t,n,u);this.linearRampToValueAtTime(this._toType(c),u)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(sn(e.ticks)){const a=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(a,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let o=this._fromType(this.getValueAtTime(t));const i=this._events.get(t);return i&&i.time===t&&i.type==="setValueAtTime"&&(o=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+o)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),o=this.getTicksAtTime(t);return this.getTimeOfTick(o+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&n.type==="linearRampToValueAtTime"&&t.value!==n.value){const o=this._fromType(this.getValueAtTime(t.time)),a=(this._fromType(this.getValueAtTime(n.time))-o)/(n.time-t.time),s=Math.sqrt(Math.pow(o,2)-2*a*(t.ticks-e)),u=(-o+s)/a,c=(-o-s)/a;return(u>0?u:c)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),o=this.toSeconds(e),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+o)-i}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class Ql extends yt{constructor(){const e=ye(Ql.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new Jl({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(yt.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class eh extends Ut{constructor(){const e=ye(eh.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new $l,this._tickOffset=new un,this._ticksAtTime=new un,this._secondsAtTime=new un,this.frequency=new Ql({context:this.context,units:e.units,value:e.frequency}),Ze(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Ut.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),Ce(t)&&this.setTicksAtTime(t,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),o=this._ticksAtTime.get(t),i={state:"paused",time:t};this._state.add(i);let a=o||n,s=o?o.ticks:0,u=null;return this._state.forEachBetween(a.time,t+this.sampleTime,c=>{let l=a.time;const h=this._tickOffset.get(c.time);h&&h.time>=a.time&&(s=h.ticks,l=h.time),a.state==="started"&&c.state!=="started"&&(s+=this.frequency.getTicksAtTime(c.time)-this.frequency.getTicksAtTime(l),c.time!==i.time&&(u={state:c.state,time:c.time,ticks:s})),a=c}),this._state.remove(i),u&&this._ticksAtTime.add(u),s}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);const o=this._secondsAtTime.get(e);let i=o||t,a=o?o.seconds:0,s=null;return this._state.forEachBetween(i.time,e+this.sampleTime,u=>{let c=i.time;const l=this._tickOffset.get(u.time);l&&l.time>=i.time&&(a=l.seconds,c=l.time),i.state==="started"&&u.state!=="started"&&(a+=u.time-c,u.time!==n.time&&(s={state:u.state,time:u.time,seconds:a})),i=u}),this._state.remove(n),s&&this._secondsAtTime.add(s),a}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const n=this._tickOffset.get(t),o=this._state.get(t),i=Math.max(n.time,o.time),a=this.frequency.getTicksAtTime(i)+e-n.ticks;return this.frequency.getTimeOfTick(a)}forEachTickBetween(e,t,n){let o=this._state.get(e);this._state.forEachBetween(e,t,a=>{o&&o.state==="started"&&a.state!=="started"&&this.forEachTickBetween(Math.max(o.time,e),a.time-this.sampleTime,n),o=a});let i=null;if(o&&o.state==="started"){const a=Math.max(o.time,e),s=this.frequency.getTicksAtTime(a),u=this.frequency.getTicksAtTime(o.time),c=s-u;let l=Math.ceil(c)-c;l=fn(l,1)?0:l;let h=this.frequency.getTimeOfTick(s+l);for(;h<t;){try{n(h,Math.round(this.getTicksAtTime(h)))}catch(d){i=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class Bs extends Ut{constructor(){const e=ye(Bs.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=Fe,this._lastUpdate=0,this._state=new $l("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new eh({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Ze(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Ut.getDefaults(),{callback:Fe,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){mm(this.context);const n=this.toSeconds(e);return this.log("start",n),this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),o=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(o+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,n=>{switch(n.state){case"started":const o=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,o);break;case"stopped":n.time!==0&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time);break}}),this._tickSource.forEachTickBetween(e,t,(n,o)=>{this.callback(n,o)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Ji.mixin(Bs);class Qo extends we{constructor(){const e=ye(Qo.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new Rt({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Ze(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(we.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class th extends we{constructor(){const e=ye(th.getDefaults(),arguments);super(e),this.name="Destination",this.input=new Qo({context:this.context}),this.output=new Rt({context:this.context}),this.volume=this.input.volume,cc(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(we.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),cc(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Fs(r=>{r.destination=new th({context:r})});Ms(r=>{r.destination.dispose()});class dA extends we{constructor(){super(...arguments),this.name="Listener",this.positionX=new qe({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new qe({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new qe({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new qe({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new qe({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new qe({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new qe({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new qe({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new qe({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(we.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Fs(r=>{r.listener=new dA({context:r})});Ms(r=>{r.listener.dispose()});class nh extends cr{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=ye(nh.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Fe,onload:Fe,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return _e(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,n=Fe,o=Fe){return tr(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new We(this.baseUrl+t,n,o))):this._buffers.set(e.toString(),new We(t,n,o)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class xo extends vi{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class fA extends Ut{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new un,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Fs(r=>{r.draw=new fA({context:r})});Ms(r=>{r.draw.dispose()});class pA extends cr{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){_e(Ce(e.time),"Events must have a time property"),_e(Ce(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new vA(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let n,o=null;if(t>0)if(e.left.right===null)n=e.left,n.right=e.right,o=n;else{for(n=e.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,o=n.parent,n.left=e.left,n.right=e.right)}else if(e.right.left===null)n=e.right,n.left=e.left,o=n;else{for(n=e.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,o=n.parent,n.left=e.left,n.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),o&&this._rebalance(o)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),o=e.right;o&&(e.right=o.left,o.left=e),t!==null?n?t.left=o:t.right=o:this._setRoot(o)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),o=e.left;o&&(e.left=o.right,o.right=e),t!==null?n?t.left=o:t.right=o:this._setRoot(o)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let n=t[0];for(let o=1;o<t.length;o++)t[o].low>n.low&&(n=t[o]);return n.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(n=>t.push(n)),t.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const n=[];this._root.search(e,n),n.forEach(o=>{o.event&&t(o.event)})}return this}forEachFrom(e,t){if(this._root!==null){const n=[];this._root.searchAfter(e,n),n.forEach(o=>{o.event&&t(o.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class vA{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class mA extends cr{constructor(e){super(),this.name="TimelineValue",this._timeline=new un({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class Uo extends we{constructor(){super(ye(Uo.getDefaults(),arguments,["context"]))}connect(e,t=0,n=0){return Zl(this,e,t,n),this}}class ea extends Uo{constructor(){const e=ye(ea.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,gn(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):Vk(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(yt.getDefaults(),{length:1024})}setMap(e,t=1024){const n=new Float32Array(t);for(let o=0,i=t;o<i;o++){const a=o/(i-1)*2-1;n[o]=e(a,o)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(n=>n.includes(e));_e(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class rh extends Uo{constructor(){const e=ye(rh.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new ea({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Uo.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Sr{constructor(e,t){this.id=Sr._eventId++,this._remainderTime=0;const n=Object.assign(Sr.getDefaults(),t);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=Math.floor(n.time),this._remainderTime=n.time-this.time}static getDefaults(){return{callback:Fe,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Sr._eventId=0;class oh extends Sr{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(oh.getDefaults(),t);this.duration=n.duration,this._interval=n.interval,this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Sr.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return us(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new xo(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){us(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new xo(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);Wo(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class Ls extends Ut{constructor(){const e=ye(Ls.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new mA(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new un,this._repeatedEvents=new pA,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new Bs({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),Ze(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Ut.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const n=t%(this._swingTicks*2)/(this._swingTicks*2),o=Math.sin(n*Math.PI)*this._swingAmount;e+=new xo(this.context,this._swingTicks*2/3).toSeconds()*o}Vd(!0),this._timeline.forEachAtTime(t,n=>n.invoke(e)),Vd(!1)}schedule(e,t){const n=new Sr(this,{callback:e,time:new vi(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,o=1/0){const i=new oh(this,{callback:e,duration:new vn(this.context,o).toTicks(),interval:new vn(this.context,t).toTicks(),time:new vi(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(e,t){const n=new Sr(this,{callback:e,once:!0,time:new vi(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(t,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new xo(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let n;return Ce(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){gn(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new vn(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new vn(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new xo(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new xo(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const n=this._clock.getTicksAtTime(t),o=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t),i=t+o;this.emit("stop",i),this._clock.setTicksAtTime(e,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),n=this.getTicksAtTime(t),o=e-n%e;return this._clock.nextTickTime(o,t)}}syncSignal(e,t){const n=this.now();let o=this.bpm,i=1/(60/o.getValueAtTime(n)/this.PPQ),a=[];if(e.units==="time"){const u=.015625/i,c=new Rt(u),l=new rh(-1),h=new Rt(u);o.chain(c,l,h),o=h,i=1/i,a=[c,l,h]}t||(e.getValueAtTime(n)!==0?t=e.getValueAtTime(n)/i:t=0);const s=new Rt(t);return o.connect(s),s.connect(e._param),a.push(s),this._syncedSignals.push({initial:e.value,nodes:a,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.nodes.forEach(o=>o.dispose()),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),wm(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Ji.mixin(Ls);Fs(r=>{r.transport=new Ls({context:r})});Ms(r=>{r.transport.dispose()});class en extends we{constructor(e){super(e),this.input=void 0,this._state=new $l("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Fe,this._syncedStop=Fe,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Qo({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Ze(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(we.getDefaults(),{mute:!1,onstop:Fe,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let o=sn(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(o=this._clampToCurrentTime(o),!this._synced&&this._state.getValueAtTime(o)==="started")_e(Wo(o,this._state.get(o).time),"Start time must be strictly greater than previous start time"),this._state.cancel(o),this._state.setStateAtTime("started",o),this.log("restart",o),this.restart(o,t,n);else if(this.log("start",o),this._state.setStateAtTime("started",o),this._synced){const i=this._state.get(o);i&&(i.offset=this.toSeconds(No(t,0)),i.duration=n?this.toSeconds(n):void 0);const a=this.context.transport.schedule(s=>{this._start(s,t,n)},o);this._scheduled.push(a),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>o&&this._syncedStart(this.now(),this.context.transport.seconds)}else mm(this.context),this._start(o,t,n);return this}stop(e){let t=sn(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||Ce(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(Wo(t,0)){const n=this._state.get(t);if(n&&n.state==="started"&&n.time!==t){const o=t-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-o),this._start(e,this.toSeconds(n.offset)+o,i)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Fe,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Ws extends Vo{constructor(){const e=ye(Ws.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,Jo(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new qe({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new We(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Vo.getDefaults(),{url:new We,loop:!1,loopEnd:0,loopStart:0,onload:Fe,onerror:Fe,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,o=1){_e(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(e);this._startGain(i,o),this.loop?t=No(t,this.loopStart):t=No(t,0);let a=Math.max(this.toSeconds(t),0);if(this.loop){const s=this.toSeconds(this.loopEnd)||this.buffer.duration,u=this.toSeconds(this.loopStart),c=s-u;sc(a,s)&&(a=(a-u)%c+u),fn(a,this.buffer.duration)&&(a=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,us(a,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,a)),Ce(n)){let s=this.toSeconds(n);s=Math.max(s,0),this.stop(i+s)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function oo(r,e){return ot(this,void 0,void 0,function*(){const t=e/r.context.sampleRate,n=new Xl(1,t,r.context.sampleRate);return new r.constructor(Object.assign(r.get(),{frequency:2/t,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}class ih extends Vo{constructor(){const e=ye(ih.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],Jo(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new qe({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new qe({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Ze(this,["frequency","detune"])}static getDefaults(){return Object.assign(Vo.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class nt extends en{constructor(){const e=ye(nt.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new yt({context:this.context,units:"frequency",value:e.frequency}),Ze(this,"frequency"),this.detune=new yt({context:this.context,units:"cents",value:e.detune}),Ze(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(en.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),n=new ih({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return nt._periodicWaveCache.find(t=>t.phase===this._phase&&Zk(t.partials,this._partials));{const e=nt._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const n=this._getCachedPeriodicWave();if(Ce(n)){const{partials:o,wave:i}=n;this._wave=i,this._partials=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[o,i]=this._getRealImaginary(e,this._phase),a=this.context.createPeriodicWave(o,i);this._wave=a,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),nt._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:o,type:this._type,wave:this._wave}),nt._periodicWaveCache.length>100&&nt._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Er(e,0);let t=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const o=new Float32Array(e);this._partials.forEach((i,a)=>o[a]=i),this._partials=Array.from(o),this.type=this._type}}_getRealImaginary(e,t){let o=2048;const i=new Float32Array(o),a=new Float32Array(o);let s=1;if(e==="custom"){if(s=this._partials.length+1,this._partialCount=this._partials.length,o=s,this._partials.length===0)return[i,a]}else{const u=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);u?(s=parseInt(u[2],10)+1,this._partialCount=parseInt(u[2],10),e=u[1],s=Math.max(s,2),o=s):this._partialCount=0,this._partials=[]}for(let u=1;u<o;++u){const c=2/(u*Math.PI);let l;switch(e){case"sine":l=u<=s?1:0,this._partials[u-1]=l;break;case"square":l=u&1?2*c:0,this._partials[u-1]=l;break;case"sawtooth":l=c*(u&1?1:-1),this._partials[u-1]=l;break;case"triangle":u&1?l=2*(c*c)*(u-1>>1&1?-1:1):l=0,this._partials[u-1]=l;break;case"custom":l=this._partials[u-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}l!==0?(i[u]=-l*Math.sin(t*u),a[u]=l*Math.cos(t*u)):(i[u]=0,a[u]=0)}return[i,a]}_inverseFFT(e,t,n){let o=0;const i=e.length;for(let a=0;a<i;a++)o+=e[a]*Math.cos(a*n)+t[a]*Math.sin(a*n);return o}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let n=0;const o=Math.PI*2,i=32;for(let a=0;a<i;a++)n=Math.max(this._inverseFFT(e,t,a/i*o),n);return Qk(-this._inverseFFT(e,t,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return ot(this,arguments,void 0,function*(e=1024){return oo(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}nt._periodicWaveCache=[];class gA extends Uo{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new ea({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class zo extends yt{constructor(){const e=ye(zo.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new Rt({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(yt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Vs extends en{constructor(){const e=ye(Vs.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new gA({context:this.context}),this._modulationNode=new Rt({context:this.context}),this._carrier=new nt({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new nt({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new zo({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Ze(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(nt.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return ot(this,arguments,void 0,function*(e=1024){return oo(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Us extends en{constructor(){const e=ye(Us.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new Rt({context:this.context,gain:0}),this._carrier=new nt({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new yt({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new nt({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new zo({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new zo({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Ze(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(nt.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return ot(this,arguments,void 0,function*(e=1024){return oo(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class ta extends en{constructor(){const e=ye(ta.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new Rt({context:this.context,gain:0}),this._thresh=new ea({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new yt({context:this.context,units:"audioRange",value:e.width}),this._triangle=new nt({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Ze(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(en.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return ot(this,arguments,void 0,function*(e=1024){return oo(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class zs extends en{constructor(){const e=ye(zs.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new yt({context:this.context,units:"frequency",value:e.frequency}),this.detune=new yt({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,Ze(this,["frequency","detune"])}static getDefaults(){return Object.assign(nt.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,n=e/(this._oscillators.length-1);this._forEach((o,i)=>o.detune.value=t+n*i)}}get count(){return this._oscillators.length}set count(e){if(Er(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const n=new nt({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):Fe});this.type==="custom"&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,n)=>t.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(){return ot(this,arguments,void 0,function*(e=1024){return oo(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class Gs extends en{constructor(){const e=ye(Gs.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new zo({context:this.context,value:2}),this._pulse=new ta({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new nt({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Ze(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(en.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return ot(this,arguments,void 0,function*(e=1024){return oo(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const zd={am:Vs,fat:zs,fm:Us,oscillator:nt,pulse:ta,pwm:Gs};class cs extends en{constructor(){const e=ye(cs.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new yt({context:this.context,units:"frequency",value:e.frequency}),this.detune=new yt({context:this.context,units:"cents",value:e.detune}),Ze(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(nt.getDefaults(),Us.getDefaults(),Vs.getDefaults(),zs.getDefaults(),ta.getDefaults(),Gs.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=zd[e],n=this.now();if(this._oscillator){const o=this._oscillator;o.stop(n),this.context.setTimeout(()=>o.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof zd[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&Kr(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&Kr(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&tr(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return ot(this,arguments,void 0,function*(e=1024){return oo(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function Tm(r,e=1/0){const t=new WeakMap;return function(n,o){Reflect.defineProperty(n,o,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){Er(i,r,e),t.set(this,i)}})}}function lr(r,e=1/0){const t=new WeakMap;return function(n,o){Reflect.defineProperty(n,o,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){Er(this.toSeconds(i),r,e),t.set(this,i)}})}}class qs extends en{constructor(){const e=ye(qs.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new We({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(en.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Fe,onerror:Fe,playbackRate:1,reverse:!1})}load(e){return ot(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=Fe){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){this._loop?t=No(t,this._loopStart):t=No(t,0);const o=this.toSeconds(t),i=n;n=No(n,Math.max(this._buffer.duration-o,0));let a=this.toSeconds(n);a=a/this._playbackRate,e=this.toSeconds(e);const s=new Ws({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+a),this._state.setStateAtTime("stopped",e+a,{implicitEnd:!0})),this._activeSources.add(s),this._loop&&sn(i)?s.start(e,o):s.start(e,o,a-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(t))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){var o;(o=[...this._activeSources].pop())===null||o===void 0||o.stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if(this._state.getValueAtTime(n)==="started"){const o=this.toSeconds(e);this._stop(n),this._start(n,o)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Er(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Er(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(o=>o.cancelStop())),this._activeSources.forEach(o=>{o.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Sn([lr(0)],qs.prototype,"fadeIn",void 0);Sn([lr(0)],qs.prototype,"fadeOut",void 0);class Fr extends we{constructor(){const e=ye(Fr.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new yt({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(we.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(tr(e))return e;{let n;for(n in xa)if(xa[n][t]===e)return n;return e}}_setCurve(e,t,n){if(tr(n)&&Reflect.has(xa,n)){const o=xa[n];qr(o)?e!=="_decayCurve"&&(this[e]=o[t]):this[e]=o}else if(gn(n)&&e!=="_decayCurve")this[e]=n;else throw new Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let o=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),a=this.getValueAtTime(e);if(a>0){const s=1/o;o=(1-a)/s}if(o<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,o,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,o,e);else{this._sig.cancelAndHoldAtTime(e);let s=this._attackCurve;for(let u=1;u<s.length;u++)if(s[u-1]<=a&&a<=s[u]){s=this._attackCurve.slice(u),s[0]=a;break}this._sig.setValueCurveAtTime(s,e,o,t)}if(i&&this.sustain<1){const s=t*this.sustain,u=e+o;this.log("decay",u),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(s,i+u):this._sig.exponentialApproachValueAtTime(s,u,i)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,n,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,n,e):(_e(gn(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return Zl(this,e,t,n),this}asArray(){return ot(this,arguments,void 0,function*(e=1024){const t=e/this.context.sampleRate,n=new Xl(1,t,this.context.sampleRate),o=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=o+this.toSeconds(this.release),a=i*.1,s=i+a,u=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/s,decay:t*this.toSeconds(this.decay)/s,release:t*this.toSeconds(this.release)/s,context:n}));return u._sig.toDestination(),u.triggerAttackRelease(t*(o+a)/s,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Sn([lr(0)],Fr.prototype,"attack",void 0);Sn([lr(0)],Fr.prototype,"decay",void 0);Sn([Tm(0,1)],Fr.prototype,"sustain",void 0);Sn([lr(0)],Fr.prototype,"release",void 0);const xa=(()=>{let e,t;const n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/127*(Math.PI/2));const o=[],i=6.4;for(e=0;e<127;e++){t=e/127;const d=Math.sin(t*(Math.PI*2)*i-Math.PI/2)+1;o[e]=d/10+t*.83}o[127]=1;const a=[],s=5;for(e=0;e<128;e++)a[e]=Math.ceil(e/127*s)/s;const u=[];for(e=0;e<128;e++)t=e/127,u[e]=.5*(1-Math.cos(Math.PI*t));const c=[];for(e=0;e<128;e++){t=e/127;const d=Math.pow(t,3)*4+.2,f=Math.cos(d*Math.PI*2*t);c[e]=Math.abs(f*(1-t))}function l(d){const f=new Array(d.length);for(let p=0;p<d.length;p++)f[p]=1-d[p];return f}function h(d){return d.slice(0).reverse()}return{bounce:{In:l(c),Out:c},cosine:{In:n,Out:h(n)},exponential:"exponential",linear:"linear",ripple:{In:o,Out:l(o)},sine:{In:u,Out:l(u)},step:{In:a,Out:l(a)}}})();class Go extends we{constructor(){const e=ye(Go.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new Qo({context:this.context,volume:e.volume}),this.volume=this._volume.volume,Ze(this,"volume")}static getDefaults(){return Object.assign(we.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const n=this["_original_"+e]=this[e];this[e]=(...o)=>{const i=o[t],a=this.context.transport.schedule(s=>{o[t]=s,n.apply(this,o)},i);this._scheduledEvents.push(a)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,n,o){const i=this.toSeconds(n),a=this.toSeconds(t);return this.triggerAttack(e,i,o),this.triggerRelease(i+a),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class qo extends Go{constructor(){const e=ye(qo.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Go.getDefaults(),{detune:0,onsilence:Fe,portamento:0})}triggerAttack(e,t,n=1){this.log("triggerAttack",e,t,n);const o=this.toSeconds(t);return this._triggerEnvelopeAttack(o,n),this.setNote(e,o),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const n=this.toSeconds(t),o=e instanceof an?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(o,i,n)}else this.frequency.setValueAtTime(o,n);return this}}Sn([lr(0)],qo.prototype,"portamento",void 0);class ah extends Fr{constructor(){super(ye(ah.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Rt({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Yr extends qo{constructor(){const e=ye(Yr.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new cs(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new ah(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),Ze(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(qo.getDefaults(),{envelope:Object.assign(Ud(Fr.getDefaults(),Object.keys(we.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Ud(cs.getDefaults(),[...Object.keys(en.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),o=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+o)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Hs extends Yr{constructor(){const e=ye(Hs.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,Ze(this,["oscillator","envelope"])}static getDefaults(){return Ro(qo.getDefaults(),Yr.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const n=this.toSeconds(t),o=this.toFrequency(e instanceof an?e.toFrequency():e),i=o*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(o,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Sn([Tm(0)],Hs.prototype,"octaves",void 0);Sn([lr(0)],Hs.prototype,"pitchDecay",void 0);const km=new Set;function sh(r){km.add(r)}function Am(r,e){const t=`registerProcessor("${r}", ${e})`;km.add(t)}const yA=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;sh(yA);const _A=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;sh(_A);const bA=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;sh(bA);const xA="feedback-comb-filter",wA=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Am(xA,wA);class js extends Go{constructor(){const e=ye(js.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const t={};Object.keys(e.urls).forEach(n=>{const o=parseInt(n,10);if(_e(ba(n)||Kr(o)&&isFinite(o),`url key is neither a note or midi pitch: ${n}`),ba(n)){const i=new an(this.context,n).toMidi();t[i]=e.urls[n]}else Kr(o)&&isFinite(o)&&(t[o]=e.urls[o])}),this._buffers=new nh({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Go.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Fe,onerror:Fe,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach(o=>{const i=Sm(new an(this.context,o).toFrequency()),a=Math.round(i),s=i-a,u=this._findClosest(a),c=a-u,l=this._buffers.get(c),h=Em(u+s),d=new Ws({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(t,0,l.duration/h,n),gn(this._activeSources.get(a))||this._activeSources.set(a,[]),this._activeSources.get(a).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(a)){const f=this._activeSources.get(a),p=f.indexOf(d);p!==-1&&f.splice(p,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(n=>{const o=new an(this.context,n).toMidi();if(this._activeSources.has(o)&&this._activeSources.get(o).length){const i=this._activeSources.get(o);t=this.toSeconds(t),i.forEach(a=>{a.stop(t)}),this._activeSources.set(o,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,o=1){const i=this.toSeconds(n);return this.triggerAttack(e,i,o),gn(t)?(_e(gn(e),"notes must be an array when duration is array"),e.forEach((a,s)=>{const u=t[Math.min(s,t.length-1)];this.triggerRelease(a,i+this.toSeconds(u))})):this.triggerRelease(e,i+this.toSeconds(t)),this}add(e,t,n){if(_e(ba(e)||isFinite(e),`note must be a pitch or midi: ${e}`),ba(e)){const o=new an(this.context,e).toMidi();this._buffers.add(o,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}Sn([lr(0)],js.prototype,"attack",void 0);Sn([lr(0)],js.prototype,"release",void 0);class Oi extends we{constructor(){const e=ye(Oi.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new qe({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Ze(this,"pan")}static getDefaults(){return Object.assign(we.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const CA="bit-crusher",EA=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Am(CA,EA);class et extends we{constructor(){const e=ye(et.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new Rt({context:this.context}),et._allSolos.has(this.context)||et._allSolos.set(this.context,new Set),et._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(we.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),et._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){et._soloed.has(this.context)||et._soloed.set(this.context,new Set),et._soloed.get(this.context).add(this)}_removeSolo(){et._soloed.has(this.context)&&et._soloed.get(this.context).delete(this)}_isSoloed(){return et._soloed.has(this.context)&&et._soloed.get(this.context).has(this)}_noSolos(){return!et._soloed.has(this.context)||et._soloed.has(this.context)&&et._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),et._allSolos.get(this.context).delete(this),this._removeSolo(),this}}et._allSolos=new Map;et._soloed=new Map;class uh extends we{constructor(){const e=ye(uh.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new Oi({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Qo({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Ze(this,["pan","volume"])}static getDefaults(){return Object.assign(we.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class wo extends we{constructor(){const e=ye(wo.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new et({solo:e.solo,context:this.context}),this._panVol=this.output=new uh({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Ze(this,["pan","volume"])}static getDefaults(){return Object.assign(we.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return wo.buses.has(e)||wo.buses.set(e,new Rt({context:this.context})),wo.buses.get(e)}send(e,t=0){const n=this._getBus(e),o=new Rt({context:this.context,units:"decibels",gain:t});return this.connect(o),o.connect(n),o}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}wo.buses=new Map;function Hr(){return on().now()}on().transport;on().destination;on().destination;on().listener;on().draw;on();let mi,gi,Gd,qd,lc;function Im(){mi=new Yr,gi=new Yr,qd=new Oi(-1).toDestination(),lc=new Oi(0).toDestination(),mi.connect(qd),gi.connect(lc);const r=Hr();mi.triggerAttack("C4",r),gi.triggerAttack("C4",r)}function SA(r,e,t,n,o,i){const{pitchFloor:a,pitchCeil:s}=GA(),u=(e-r)/e*(s-a)+a;mi.frequency.setValueAtTime(u,Hr());const l=(t-i)/(o/2),h=Math.max(-1,Math.min(1,l));lc.pan.setValueAtTime(h,Hr());const d=(e-n)/e*(s-a)+a;gi.frequency.setValueAtTime(d,Hr())}function TA(){mi.triggerRelease(Hr()),gi.triggerRelease(Hr())}function kA(){Gd=new Yr().toDestination();const r=Hr();[{note:"C4",duration:"8n",time:r},{note:"A3",duration:"8n",time:r+.5},{note:"F3",duration:"8n",time:r+1},{note:"E3",duration:"8n",time:r+1.5},{note:"D3",duration:"8n",time:r+2},{note:"C3",duration:"4n",time:r+2.5}].forEach(({note:t,duration:n,time:o})=>{Gd.triggerAttackRelease(t,n,o)})}const tt=document.createElement("canvas");tt.id="gameCanvas";document.body.appendChild(tt);const hn=tt.getContext("2d");tt.width=window.innerWidth;tt.height=window.innerHeight;let hc=200,ui=50,Jn=tt.height/2,dc=Jn,fc=0,wa=100,Rm=3,pc=Rm,AA=.1,IA=700,ls=!0,bt=[];function ch(){let r=50,e=tt.height-hc-r-40,t=Math.floor(Math.random()*e)+r;bt.push({x:tt.width,y:t})}ch();function RA(){ui=50,Jn=tt.height/2,dc=Jn,fc=0,pc=Rm,bt=[],ch(),ls=!0,Im(),lh()}function lh(){if(!ls)return;hn.clearRect(0,0,tt.width,tt.height),hn.fillStyle="#228B22";let r=0,e=0;for(let n=0;n<bt.length;n++){let o=bt[n].y+hc;if(hn.fillRect(bt[n].x,0,wa,bt[n].y),hn.fillRect(bt[n].x,o,wa,tt.height-o-40),n===0&&(r=bt[n].x,e=bt[n].y+hc/2),bt[n].x-=pc,ui+20>=bt[n].x&&ui<=bt[n].x+wa&&(Jn<=bt[n].y||Jn+20>=o)){ls=!1,console.log("COLLIDE"),TA(),kA();return}bt[n].x+wa<0&&(bt.splice(n,1),fc++,pc+=AA)}bt[bt.length-1].x<tt.width-IA&&ch(),hn.fillStyle="#8B4513",hn.fillRect(0,tt.height-40,tt.width,40),hn.fillStyle="#FFD700",hn.fillRect(ui,Jn,20,20),dc=tt.height-zA()*tt.height,Jn+=(dc-Jn)*.1,SA(Jn,tt.height,r,e,tt.width,ui),hn.fillStyle="#000",hn.font="20px Arial",hn.fillText("Score: "+fc,10,tt.height-20),requestAnimationFrame(lh)}function NA(){lh()}function DA(){return ls}const Tu={inputSize:256,detectionInterval:20,scoreThreshold:.5,eyebrowThresholdFloor:10,eyebrowThresholdCeil:30,mouthThresholdFloor:10,mouthThresholdCeil:39,pitchFloor:20,pitchCeil:400,model:"tinyFaceDetector",showLandmarks:!1,showGraphics:!0},Hd="guiOpenState";function OA(){const r=localStorage.getItem("faceDetectionSettings");let e=r?JSON.parse(r):{...Tu};for(const t in Tu)t in e||(e[t]=Tu[t]);return e}let Re=OA(),jd,Dn,ci,ka=0,Ca=0,Xd=0;async function FA(){const r=document.createElement("video");r.id="video",document.body.appendChild(r);const e=await navigator.mediaDevices.getUserMedia({video:{}});return r.srcObject=e,new Promise(t=>{r.onloadedmetadata=()=>{t(r)}})}async function MA(){const r="./models";await at.tinyFaceDetector.loadFromUri(r),await at.ssdMobilenetv1.loadFromUri(r),await at.mtcnn.loadFromUri(r),await at.faceLandmark68Net.loadFromUri(r),await at.faceLandmark68TinyNet.loadFromUri(r),await at.faceRecognitionNet.loadFromUri(r),await at.faceExpressionNet.loadFromUri(r)}function PA(r,e){const t=r.x-e.x,n=r.y-e.y;return Math.sqrt(t*t+n*n)}function Kd(r,e,t,n,o,i){r.beginPath(),r.arc(e,t,n,0,2*Math.PI,!1),r.fillStyle=o,r.globalAlpha=i,r.fill(),r.closePath(),r.globalAlpha=1}function BA(r,e,t,n,o,i){r.beginPath(),r.moveTo(e,t-n),r.lineTo(e+n,t),r.lineTo(e,t+n),r.lineTo(e-n,t),r.lineTo(e,t-n),r.fillStyle=o,r.globalAlpha=i,r.fill(),r.closePath(),r.globalAlpha=1}function $d(r,e){const t=r.map((i,a)=>e[a]?Math.abs(i.y-e[a].y):0),o=(t.reduce((i,a)=>i+a,0)/t.length-Re.eyebrowThresholdFloor)/(Re.eyebrowThresholdCeil-Re.eyebrowThresholdFloor);return Math.max(0,Math.min(1,o))}function LA(r){const t=(PA(r[3],r[9])-Re.mouthThresholdFloor)/(Re.mouthThresholdCeil-Re.mouthThresholdFloor);return Math.max(0,Math.min(1,t))}async function WA(r){const e=await sC(r,new sv({inputSize:Re.inputSize,scoreThreshold:Re.scoreThreshold})).withFaceLandmarks().withFaceExpressions(),t={width:r.videoWidth,height:r.videoHeight};B1(Dn,t);const n=mv(e,t);ci.clearRect(0,0,Dn.width,Dn.height),Re.showLandmarks&&(R1(Dn,n),X1(Dn,n),q1(Dn,n));for(let o of n){const i=o.landmarks,a=i.getLeftEye(),s=i.getRightEye(),u=i.getLeftEyeBrow(),c=i.getRightEyeBrow(),l=i.getMouth();if(a.length===6&&s.length===6){Ca=$d(u,a);const h=$d(c,s),d=Date.now();if(!DA()&&Ca>.7&&d-Xd>3e3&&(RA(),Xd=d),Re.showGraphics){if(Ca>0){const f={x:(a[0].x+a[3].x)/2,y:(a[1].y+a[5].y)/2};Kd(ci,f.x,f.y,5,"blue",Ca)}if(h>0){const f={x:(s[0].x+s[3].x)/2,y:(s[1].y+s[5].y)/2};Kd(ci,f.x,f.y,5,"blue",h)}if(ka=LA(l),ka>0){const f={x:(a[0].x+s[3].x)/2,y:(u[2].y+c[2].y)/2-20};BA(ci,f.x,f.y,10,"blue",ka)}}}else console.log("Error: Eye landmarks not detected correctly.")}}async function Nm(r){clearInterval(jd),jd=setInterval(async()=>{await WA(r)},Re.detectionInterval)}function VA(){const r=new OC.GUI({autoPlace:!1});r.add(Re,"inputSize",128,320,32).onChange(Ht),r.add(Re,"detectionInterval",1,500,20).onChange(Ht),r.add(Re,"scoreThreshold",.1,.9,.1).onChange(Ht),r.add(Re,"eyebrowThresholdFloor",0,50,1).onChange(Ht),r.add(Re,"eyebrowThresholdCeil",0,50,1).onChange(Ht),r.add(Re,"mouthThresholdFloor",0,50,1).onChange(Ht),r.add(Re,"mouthThresholdCeil",0,50,1).onChange(Ht),r.add(Re,"model",["tinyFaceDetector","ssdMobilenetv1","mtcnn"]).onChange(Ht),r.add(Re,"showLandmarks").onChange(Ht),r.add(Re,"showGraphics").onChange(Ht),r.add(Re,"pitchFloor",20,2e3,1).onChange(Ht),r.add(Re,"pitchCeil",20,2e3,1).onChange(Ht),document.getElementById("gui-container").appendChild(r.domElement),localStorage.getItem(Hd)==="false"?r.closed=!0:r.closed=!1,window.serializeGUI=()=>{const n=JSON.stringify(Re);console.log("Serialized settings:",n)},window.applySerializedGUI=n=>{const o=JSON.parse(n);for(const i in o)i in Re&&(Re[i]=o[i]);Dm(Re),Ht()},r.domElement.addEventListener("click",()=>{localStorage.setItem(Hd,r.closed?"false":"true")})}function Ht(){Dm(Re);const r=document.getElementById("video");r&&Nm(r)}function Dm(r){localStorage.setItem("faceDetectionSettings",JSON.stringify(r))}async function UA(){await MA();const r=await FA();r.play(),r.addEventListener("play",()=>{Nm(r)}),Dn=document.createElement("canvas"),Dn.id="overlay",document.body.appendChild(Dn),ci=Dn.getContext("2d"),VA()}function zA(){return ka}function GA(){return{pitchFloor:Re.pitchFloor,pitchCeil:Re.pitchCeil}}async function qA(){await UA(),Im(),NA()}qA()});export default HA();
